shallow depth commonly photographer isolate distract background however standard phone camera cannot image optically focal aperture capture nearly focus image computationally synthesize shallow depth image mobile camera button image segmentation network accessory background available dense dual pixel auto focus hardware effectively sample approximately millimeter baseline compute dense depth signal combine render defocused image megapixel image mobile phone fully automatic robust non expert modular allows degrade naturally absence dual pixel sensor CCS concept compute methodology computational photography image processing additional depth defocus stereo segmentation introduction depth important aesthetic quality photograph refers depth scene image sharply focus primarily aperture capture camera lens aperture shallow depth narrow aperture depth professional photographer frequently depth  compositional  instance background blur shallow depth allows photographer isolate clutter distract background hardware DSLR style camera accomplish camera expensive inconvenient therefore compelling image largely limited professional mobile phone camera ubiquitous lens aperture image optically recently mobile phone manufacturer computationally shallow depth image technique camera instead apply stereo algorithm capture image compute depth image blur accord  however camera manufacturing increase acm trans graph vol article publication date august input mask output segmentation mask obtain camera input disparity output dual pixel DP disparity scene without gracefully input availability camera lack dual pixel image almost background segmentation alone sufficient shot disparity data dual pixel alone sufficient highquality output consumption phone manufacturer instead chosen flight structure depth sensor phone tend expensive intensive addition outdoors lens blur shallow depth image without additional hardware user phone capture introduce parallax photo negative user photographer fails camera trajectory photo introduce allows untrained photographer shallow depth image mobile camera button aim user combine feature DSLR smartphone requirement processing resolution output standard smartphone capture  capture extra requirement camera capture convincing shallow depth plausible blur focus scene opportunistically combine technology function neural network accessory network image input output mask indicates pixel belong available sensor dual pixel DP auto focus hardware effectively sample narrow millimeter baseline hardware increasingly mobile phone traditionally auto focus DP imagery extract dense depth mobile phone rear camera camera typically capture  photographer background camera usually fix focus therefore lack dual pixel however constrain category selfie image sufficient segmentation model apply uniform blur background contrast depth information photo rear camera depth variation scene content uniform blur unnatural photo augment segmentation  compute dual pixel augment input synthetic blur photo DP  alone stereo baseline dual pixel latter macro style photo nearby scene detector input image identify photograph neural network image identify infer resolution mask belong mask upsampled resolution aware filter mask uniformly blur background DP data available compute  align average burst DP image reduce stereo algorithm infer resolution noisy disparity estimate stereo baseline dual pixel estimate strongly affected optical aberration calibration procedure disparity estimate upsampled smooth bilateral technique yield resolution disparity disparity stereo proportional defocus blur lens aperture stereo baseline disparity apply synthetic blur thereby simulate shallow depth optical blur situation cannot difference deviate physically  depth  trick easy novice compelling shallow depth segmentation mask deviate physical correctness pixel mask render technique scene layer disparity  pixel translucent disk accord disparity composite layer acm trans graph vol article publication date august synthetic depth camera mobile phone actual disparity smooth depth dependent render render blur reduces camera unnatural adjacent focus retain synthetic defocused realistic typical mobile camera ill  photographer  perspective distortion improve image impose digital zoom addition photographer away zoom faster pixel  instead sensor  entire segmentation depth estimation defocus render fully automatic smartphone related besides approach hernández academic render synthetic shallow depth image camera hernández deliberate translation camera capture exploit parallax accidental shake approach suffer frequent failure due insufficient parallax due user camera correctly accidental sufficiently defocus cue extract depth capture multiple image increase capture approach non static scene compute intensive mobile device monocular depth estimation infer depth image render synthetic shallow depth image technique inverse render supervise machine significant progress highly  multi image depth estimation hence additionally approach fail generalize beyond datasets resolution depth synthesize shallow depth image diverse quality depth dataset challenge depth sensor indoors spatial resolution supervise approach truth depth stereo data fail yield quality depth achieve impressive generate synthetic shallow depth image limit photo background convolutional neural network blur background assume background constant depth extend approach differentiable mat layer network approach computationally expensive respectively output nvidia titan segmentation network rgb image location input stage model segmentation loss stage powerful desktop gpu infeasible mobile platform network segmentation approach photo without unnatural complex scene depth segmentation substantial image capture mobile phone image ubiquitous neural network accessory image segmentation augment noisy disparity DP data sec computer vision community substantial effort quality algorithm semantically image neural network photo render shallow depth contribution training data collection methodology accurate segmentation model capable mobile device aware filter upsample mask predict neural network sec data collection neural network image flickr flickr com annotate polygon mask outline image mask refine filter approach described sec augment data consist image instance label location keypoints infer predict training improve segmentation finally synthetic training image compositing portrait image onto background generate additional image specifically portrait image background flickr portrait image compute alpha matte composite onto randomly chosen background image cannot stress strongly importance training data segmentation task variety discard training image cleaning inaccurate acm trans graph vol article publication date august polygon mask etc improvement training data quality defocused portrait improve  training training network architecture consist stack net intermediate supervision stage network input channel image channel correspond rgb image resize pad resolution preserve aspect ratio fourth channel encodes location posterior distribution isotropic gaussian detection standard deviation pixel location stage output segmentation mask output layer sigmoid activation output heatmaps correspond location keypoints stage training stage entropy loss segmentation ratio stage training converge remove loss prune training image model prediction error pixel interior mask error boundary error boundary attribute annotation error model error obviously beneficial remove training annotation error model error sacrifice performance percentage image focus improve boundary percentage image implementation tensorflow image training later prune image remove image prediction error interior mask evaluation contains image batch model gpus across machine stochastic gradient descent rate later lower augment training data apply rotation chosen uniformly isotropic chosen uniformly translation image dimension empirical inference inference rgb image rectangle output detector model predict segmentation mask correspond location input heuristic avoid bystander segmentation mask network image multiple perform inference maximum segmentation mask mask maxi upsampled filter become resolution  mask sec mask generate shallow depth combine disparity sec rgb image coarse mask filter mask aware filter segmentation mask aware filter segmentation mask compute memory requirement impractical neural network directly predict resolution mask prior mask boundary align image aware filter approach upsample resolution mask predict network filter refine truth mask training enables annotator approximate mask improve quality annotation fix annotation denote coarse segmentation mask refine annotate mask resolution image binary pixel inside mask elsewhere resolution predict mask  upsample image resolution inclusive compute confidence heuristic confidence pixel predict pixel spatially mask boundary specifically morphological erosion structure dimension image correspond rgb image compute filter segmentation mask bilateral solver denote BS aware smooth towards apply sigmoid function specifically exp BS bilateral solver resolution generate speckle highly textured hence solver smooth frequency speckle apply gaussian blur upsample via joint bilateral upsampling image yield filter mask bilateral solver sec smooth noisy disparity DP data acm trans graph vol article publication date august synthetic depth camera mobile phone comparison model  model evaluation data model training data iou  model training data comparison model mask rcnn evaluation dataset model training data iou mask rcnn training data model training data accuracy efficiency accuracy model  model compute  union iou output truth output truth evaluation dataset model data accuracy model demonstrates effectiveness model architecture model training data accuracy thereby demonstrate training data semantic segmentation model mask rcnn training data implementation mask rcnn backbone resnet mask rcnn inferior data significantly model mask rcnn jointly detection segmentation multiple suitable segmentation location quality boundary model magnitude operation per inference giga flop  mask rcnn tensorflow model benchmark  benchmarked tensorflow implementation fcn model  depth dual pixel camera dual pixel DP auto focus splitting pixel integrates aperture vice versa image content optically blur distance focal shift disparity depends depth blur kernel normally autofocus sometimes phase detection auto focus application lens iteratively adjust average disparity within focus zero consequently focus sensor split pixel sensor focus arbitrary purpose DP data dense split pixel compute depth DP sensor effectively crude baseline sensor intensity disparity lens focal sensor sensor blur lens diagram DP data image data blur blur lens model relationship depth blur diameter disparity focus emits camera lens aperture diameter focus sensor distance lens pixel blur pixel lens image pixel shift disparity proportional blur sum image sensor without dual pixel mobile camera aperture synthetically defocused image shear integrate sufficient lytro camera however technique DP data sample per pixel synthetic aperture limited physical aperture technique compute depth typically DP sensor stereo technique compute disparity plausible approach depth estimation stereo extensive effective technique exist detailed depth resolution image image narrow baseline stereo camera however recent suggests standard stereo technique prohibitively expensive mobile platform artifact synthetic defocus due poorly localize output depth therefore upon stereo aware construct stereo algorithm tractable resolution  defocus task virtue input image difference DP data stereo standard camera data sensor exposure balance perfectly synchronize robust acm trans graph vol article publication date august  condence condence aer calibration bilateral smooth upsampling input image coarse  aer mask integration normalize slice input DP data intensity relative vertical pixel intensity input disparity algorithm input data image channel DP sum channel input image purpose visualization normalize DP data local standard deviation pixel intensity vertical location marked compute noisy heuristic confidence error due lens aberration highlight arrow calibration segmentation mask assign disparity textureless shirt bilateral technique convert noisy disparity confidence aware dense disparity camera scene addition standard stereo rectification horizontally split pixel purely horizontal disparity sensor reference frame baseline DP stereo camera benefit compute correspondence rarely suffers due occlusion disparity pixel however baseline compute disparity estimate subpixel precision rely image detail lose image scene traditional stereo calibration relationship disparity depth affected lens aberration variation split pixel due  error algorithm compute dense depth challenge synthesize shallow depth  image temporally denoise burst DP image technique compute correspondence DP extension adjust disparity spatially linear function lens aberration depth disparity image location segmentation compute sec flatten disparity within masked entire focus hide error disparity finally bilateral technique obtain smooth aware disparity estimate suitable defocus render compute disparity multiple frame denoising circular buffer raw DP frame capture camera shutter frame shutter align frame frame robustly average technique treat non  raw frame channel image bayer resolution sensor  DP data horizontally vertically pixel split horizontally resolution image bayer DP data linearly upsample DP data bayer resolution append channel bayer raw image fifth sixth channel alignment robust average apply channel image ensures alignment average apply DP alignment average significantly reduces input DP frame increase quality render scene image  background noisy recover meaningful disparity frame DP data however align robustly average frame recover meaningful disparity background blur away camera supplemental disparity align average frame noisy disparity frame scene lux compute disparity non overlap tile pixel pixel DP resolution integer shift compute sum difference ssd minimum quadratic ssd minimum surround location quadratic minimum sub pixel minimum technique differs perform dimensional brute dimensional pixel accelerate fourier transform fft slide filter brute faster fft tile compute confidence heuristic ssd loss magnitude horizontal gradient tile presence minimum acm trans graph vol article publication date august synthetic depth camera mobile phone conf conf input image frame frame merge disparity condence disparity condence render image render image denoising burst DP frame prior disparity computation improves scene  background disparity recoverable frame DP data background blur burst frame merge SNR background background therefore blur agreement disparity tile horizontal gradient notable departure dimensional tile variance purely horizontal vertical gradient informative due aperture upsample per tile disparity confidence noisy per pixel disparity confidence described image model calibration depth spatial location disparity due lens aberration sensor defect uncorrected artifact background synthetically defocused image remain apply calibration procedure understand disparity related depth image focus source lens focus sensor outof focus image sensor lens aperture  angle pixel applies aperture pixel image split pixel viewpoint roughly baseline proportional diameter aperture disparity proportional blur blur positive focal sensor negative otherwise assume  lens approximation relationship blur depth implies focus distance focal detail supplemental equation notable consequence disparity without calibration calibration synthetic shallow depth rendering without calibration uneven blur background depends focus distance zero depth focus distance linear relationship inverse depth disparity spatially however mobile camera lens deviate significantly  lens approximation optical aberration periphery affect blur significantly curvature aberration constant depth scene focus curve lens blur varies across sensor optical  axis reduce blur addition optical aberration location split pixel due  error optical blur kernel frame significantly calibrate variation blur mobile phone camera tripod textured fronto parallel planar target constant depth capture image span focus distance target distance compute disparity DP data  plot disparity versus inverse depth image empirically relationship disparity inverse depth linear predict however slope intercept varies spatially denote data solid pixel focus distance slope roughly constant across focus distance intercept strongly agrees lens model theoretically predict slope independent focus distance peripheral disparity inverse depth apply image coordinate disparity  focus distance varies continuously calibrate focus distance linearly interpolate combine disparity segmentation photo combine disparity segmentation mask sec goal entire acm trans graph vol article publication date august lens curve focal curvature  spatially blur kernel sensor multi aperture lens focal sensor image image target focus calibration aberration important stereo critical dual pixel aberration blur therefore disparity spatially constant depth curvature increase peripheral blur central blur ray oblique ray survives  thereby limit peripheral blur linear blur kernel image capture dual pixel camera image blur kernel sum DP cod accordingly focus blurring background significant expertise DSLR easy consumer intuitively entire narrow disparity focus segmentation mask cue accomplish compute average disparity  rectangle confidence disparity pixel interior segmentation mask  increase confidence interior define pixel cnn output cnn output  upsampled resolution disparity conservative threshold avoid background interior rely bilateral smooth sec snap focus boundary allows novice quality shallow depth  image entire focus hide error compute disparity particularly  blur facial feature rare approach depth focus unnatural segmentation mask photo without entire focus sec aware filter disparity bilateral solver noisy disparity smooth aware disparity suitable shallow depth render solver smooth segmentation mask sec bilateral solver  aware output resembles input wherever confidence allows confident disparity estimate propagate across confidence interior target distance disparity sample DP locally sample target distance target distance disparity inverse depth focus distance slope calibration setup focus target intercept focus focus focus focus calibration procedure mobile camera capture image fronto parallel textured target sweep focus target distance image disparity target distance spatial location focus disparity negative focus distance farthest target magnitude disparity pixel extreme target slope intercept linear function mapping inverse target distance disparity spatial location focus distance marked rectangle plot sec apply solver quarter image resolution apply median filter smooth disparity remove speckle artifact joint bilateral upsampling upsample smooth disparity resolution rendering input render stage smooth disparity compute sec  input image linear pixel proportional photon strike sensor render linear preserve highlight defocused theory input shallow depth output straightforward idealize render algorithm directly image formation model sec specifically scene project translucent disk image closer occlude farther away synthetically defocused image achieve sort pixel depth blurring accumulate standard compositing operator achieve acceptable performance mobile device approximate ideal render algorithm practical approximation specific application exist literature synthetic defocus approximation quantize disparity constant depth  optical blur focal stack decompose acm trans graph vol article publication date august synthetic depth camera mobile phone physically mapping mapping physically mapping focus blur mapping creates extend zero blur radius around focus entire focus scene discrete layer requirement approximation perfect disk kernel improve processing approach borrows assumption specific pipeline precomputing disk blur kernel pixel apply kernel sub image disparity finally composite intermediate gamma synthetic detail stage precomputing blur parameter sec zero disparity corresponds focus disparity elsewhere proportional defocus blur photograph correctly focus already defocused background however shallow depth greatly increase amount defocus evident screen mobile phone implies simulate aperture lens camera native aperture hence defocus kernel accomplish simply apply blur kernel radius proportional compute disparity camera accurately focus moreover simulate aperture slr adequate focus focus expert user shallow depth novice user address modify procedure compute disparity focus  median disparity detect output detector focus disparity zero absence usable denote user tap focus  cue exist trust auto focus  easy novice shallow depth artificially disparity within disparity  mapping zero blur radius pixel disparity    combine blur propose naïve pas halo illustrate propose prevents halo selectively remove component approach image difference technique  input image naïve blur foreground bleed background halo blurring image pas defocused background blur foreground  petal clearly visible difference inset compute blur radius max  overall strength blur function focus distance focus distance scene disparity increase compensate depicts typical mapping render blur radius computationally expensive cap rmax pixel apply blur perform blur decision concern visual quality defocused portion scene bokeh photography community topic endless debate bokeh optically bokeh primarily aperture camera lens  aperture hexagonal bokeh application however bokeh choice simulate ideal circular bokeh efficiently perfect circular bokeh disk blur mismatch defocus optic convolution technique optic defocus blur easily express scatter operation pixel input scatter influence onto disk pixel around output convolution algorithm however around operation pixel output influence nearby pixel input operation prefer easy acm trans graph vol article publication date august distance ideal kernel discretized kernel derivative disk blur kernel generate offset truncate distance function ideal kernel approximate discretized disk sparsity discrete kernel gradient positive negative respectively allows perform scatter blur operation per pixel parallelize blur kernel constant across image approach equivalent kernel spatially depth dependent blur naive convolution implementation unacceptable visual artifact obvious simply  scatter typical convolution approach defines filter image input image kernel  kernel function pixel sample express scatter indirectly  approach span maximum kernel iterate pixel possibly non zero summation blur kernel reasonable blur kernel synthetic defocus prohibitively expensive compute blur instead technique inspire sum observation disk kernel illustrate anti aliased disk approximate rasterize discrete disk discrete disk mostly constant sparse gradient without loss generality sparsity gradient useful perform blur gradient domain operation specifically input pixel scatter influence along solid disk influence consists positive negative gradient rightmost image pixel image accelerates blur max rmax scatter integrate gradient image along blur another increase perform blur reduce resolution blur downsample image factor dimension speedup blur radius halve equivalent appearance perceptible degradation visual quality later upsample resolution stage described sec additional aspect bokeh tackle realism specifically ensure background leak foreground guarantee pixel depth described sec computational approach however instead compute blur disparity input rgb image IR IG IB decompose  rgba sub image brevity omit per pixel index remainder cutoff disparity define later disparity sub image span disparity define IR IG IB truncate tent function disparity min signifies clamp within pixel disparity taper linearly outside disparity bound typically adjacent overlap smoother transition disparity cutoff denote disparity focus scene bound calculate disparity blur radius  supplemental detail remain cutoff chosen disparity evenly remain approach allows optimize specific blur kernel within efficiently compute brute scatter blur strongly blur sub image accelerate gradient image blur algorithm described earlier pas blur propose optimization disparity information segmentation mask blur becomes spatially invariant equivalent pas style blur background pixel subimage  IR IG IB simulate depth average input blur image spatially input image blur image image individual layer blur upsampled resolution composited focus layer insert sub image  directly resolution input avoid quality loss downsample upsample impose blur pipeline stage render pipeline synthetic blur portion image somewhat unusual postprocessing algorithm typically reduce eliminate blur stage remove blurry portion scene mismatch yield unrealistic cardboard  appearance reduce comparison treatment acm trans graph vol article publication date august synthetic depth camera mobile phone blur synth blur synth  input image image pas synthetic defocus remove naturally image visual artifact transition blur frame hide transition realistic subtle emphasize pas filter digitally screen function construct runtime periodic patch supplemental detail chosen relatively prime combine patch non realistic data storage overhead composited blur image  image synthetic     mod exposure dependent estimate local input image sensor chip vendor  mask correspond blur pixel image RESULTS described earlier pipeline pipeline DP segmentation applies scene camera dual pixel hardware disparity mask segmentation network pipeline DP applies scene camera dual pixel hardware pipeline segmentation mask integrate disparity pipeline segmentation applies image selfie camera typically dual pixel hardware pipeline depth renderer sec aware filter snap mask sec compute intensive layer mask renderer sec selection pipeline supplemental encourage reader zoom image disparity DP animation user participant algorithm ablation algorithm output prefer accumulate vote algorithm across image highlight prefer algorithm prefer algorithm user consistently prefer propose algorithm segmentation algorithm prefer user std DP segmentation DP segmentation switch disparity segmentation mask appropriate conduct user image DP data image version pipeline segmentation network stereo renderer latter chose explicitly focus synthetic shallow depth image user output algorithm ablation aforementioned baseline algorithm image procedure user prefer significant margin ablation model consistently prefer supplement detail experimental procedure image image pipeline cushion blur segmentation depth incorrect depth estimate textureless mask disparity robust error production daily failure mode detection failure blur background DP data mitigate failure reasonable disparity depth however camera without DP data important accurate detection input choice compress disparity multiple artifact physically unnatural image scene content blur susceptible error disparity computation prevalent aperture correspondence image structure parallel baseline segmentation mask semantics prevents acm trans graph vol article publication date august input seg DP DP seg output image inset pipeline renderer segmentation network unable cushion nearly depth blur algorithm DP compute incorrect disparity untextured blur background combine blur background millisecond algorithm highend mobile phone correspond variant algorithm standard deviation stage image stage DP seg DP seg detection segmentation denoise DP burst disparity computation depth renderer aware mask filter mask renderer error however image without background performance highend mobile phone cpu core ghz ghz code implement halide manually schedule cpu resolution pipeline discussion future compute synthetic shallow  image mobile phone combine segmentation network depth dense dual pixel choice technology mobile phone camera variety synthetic shallow depth image portrait mode google pixel pixel XL smartphones extension expand pet photograph addition render already non photorealistic purpose attention realistically simulate depth explore alternative foreground background   user accept computational photography  bond strict realism creative image 