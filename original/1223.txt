Abstract
Very little is known about the structure of the intersection of two k-generated monoids of words, even for k=3. Here we investigate the case of k-maximal monoids, that is, monoids whose basis of cardinality k cannot be non-trivially decomposed into at most k words. We characterize the intersection in the case of two 3-maximal monoids.

Keywords
3-maximal monoids
Intersection
Free graph

1. Introduction
In this paper, we investigate the intersection of three-generated monoids of words in a special case when these monoids are 3-maximal. A monoid of words is k-maximal if its generating set cannot be non-trivially decomposed into at most k (shorter) words. Obviously, the intersection of two finitely generated monoids of words is regular. However, already in the case of free monoids generated by two words, the structure of the intersection can be quite complex as we recall in Theorem 8, see [13], [11]. While monoids generated by three words have been classified (by Budkina and Markov in [4] and by Spehner in [17], see also [9] for a comparison of the two classifications), there is no classification of their intersection. It is useful to note, and we shall use this fact in the paper, that the general question about the structure of the intersection of two k-generated monoids is in fact a question about maximal solvable systems of equations over 2k unknowns, where the left hand sides and right hand sides are formed from disjoint sets of k unknowns respectively. This indicates why the question is so difficult for , where we have to deal with six unknowns.

It turns out, however, that when the condition of being k-maximal is added, the problem simplifies considerably. In [5], a kind of defect theorem is shown for 2-maximal monoids, see Theorem 10 below. In case of 3-maximal monoids, studied in this paper, we encounter a situation which rather resembles the general case of two two-generated monoids. In fact, there is a close similarity to the related problem of binary equality sets. In [6], it was shown that the binary equality set is either generated by at most two words, or it is of the form 
⁎
⁎
. While it was later shown in [10] that the latter possibility never takes place for binary equality words, we show in this paper that the set of possibilities given in the previous sentence is the exact description of intersection of two 3-maximal monoids. This setting therefore fits, from the point of its complexity, somewhere between binary equality words, and the intersection of free two-generated monoids.

2. Preliminaries
Let 
⁎
 (
⁎
 resp.) be the free monoid (free semigroup resp.) freely generated by a countable set Σ which will be fixed throughout the paper. As usually, we shall call the set Σ an alphabet, and understand elements of 
⁎
 (resp. 
) as finite words (finite nonempty words resp.) over Σ with the monoid operation of concatenation. Note however, that Σ, understood as the set of generators satisfying 
⁎
, is the set of words of length one, rather than a set of letters.

We say that a word u is a prefix (res. proper prefix) of w and we write  (resp. ) if  for some 
⁎
 (resp. 
). We say that u is a suffix of w if  for some 
⁎
. Two words v and w are prefix comparable iff either  or . A word w is primitive if 
 implies  and , otherwise it is called a power. If we consider pairs of words, we see 
⁎
⁎
 as a direct product of monoids, that is, a concatenation is defined in the natural way on pairs. In particular, we say that 
⁎
⁎
 is a prefix (resp. proper prefix)) of 
⁎
⁎
, and we write  (resp. ) if  and  (resp.  and ).

Given 
⁎
, by  we denote the longest common prefix of u and v. Let 
⁎
, by  we denote the first letter of u.

Given a subset X of 
⁎
, by 
⁎
 we denote the submonoid of 
⁎
 generated by X. Conversely, given a submonoid M of 
⁎
, there exists a unique minimal (w.r.t. the set inclusion) generating set  of M, that we call the basis of M, namely(1)
 That is, the basis of M is the set of all nonempty words of M that cannot be written as a concatenation of two nonempty words of M. For an arbitrary set 
⁎
, we shall write  instead of 
⁎
. The cardinality of  is the rank of X, denoted .

A submonoid M of 
⁎
 with the basis B is said to be free if any word of M can be uniquely expressed as a product of elements of B. The basis of a free monoid is called a code (see [3]).

It is well-known (see [18]) that for any set 
⁎
 there exists the smallest free submonoid 
 of 
⁎
 containing X. It is called the free hull of X. The basis of 
 is called the free basis of X, denoted by 
. The cardinality of 
 is called the free rank of X and denoted by 
. We refer to [8] for a procedure determining the free rank and the free basis of X.

For 
, let 
 where 
, 
, be the unique factorization of w into elements of 
. The words 
 are called X-prefixes of w. We write 
 if u is a X-prefix of w. Moreover, given 
, by 
 we denote the longest common X-prefix of u and w.

Example 1

Let . The free basis is , hence 
. For  and 
⁎
, we have 
,  and 
.

We have the following well-known lemma (see [2], Lemma 3.1).

Lemma 2

Let X a finite set of 
⁎
 and B its free basis. Then for each  there exists  such that 
.

In order to see the importance of the above lemma, let us define the free graph of a finite set 
 as the undirected graph 
 without loops where 
. Let  be the number of connected components of . By Lemma 2, we now have that

Remark 3

The notion of the free graph is tightly related to the graph 
 of the system Q of equations that is defined in [7, Section 3]. Namely, the graph of the system of all relations satisfied by the set X corresponds to a subgraph of the free graph of X. We remark that the two graphs would be equivalent if we considered the unique factorization hull instead of the free hull. We have chosen the free hull because it is simpler and sufficient for our purposes. In any case, the preceding equality immediately implies the Defect Theorem claiming that 
 if X is not a code (cf. [2] and [7]).

Example 4

Consider X of the Example 1. The free graph  has a unique edge  connecting the only two words starting with . Note that there is no edge between ca and , since 
.

The free graph is a frequently used tool in the paper because it allows us to easily establish the free rank of a set by considering the properties of the edges of the associated free graph.

3. k-maximal submonoids
In this section we study k-maximal submonoids introduced in [5]. With 
 we denote the family of submonoids M of 
⁎
 of rank at most k.

Definition 5

(cf. [5]) A submonoid 
 is k-maximal if for every 
, 
 implies 
.

In other words, the elements of the basis of M cannot be nontrivially factored into at most k words.

Example 6

For every word 
, the submonoid 
⁎
 (denoted simply by 
⁎
) is 1-maximal if and only if v is a primitive word.

The submonoid 
⁎
 is 3-maximal, whereas 
⁎
 is not 3-maximal since it is contained in 
⁎
.

Let , where  is the subset of letters of Σ occurring in the words in X. Then 
⁎
 is k-maximal if and only if 
⁎
⁎
. Also, a k-maximal submonoid is obviously generated by primitive words. On the other hand, a finite set of k primitive words does not necessarily generate a k-maximal submonoid of 
⁎
 as we can see in Example 6.

In [5], it is proved that the basis of a k-maximal submonoid of 
⁎
 is a bifix code, in particular its free rank is k. We repeat the proof here.

Proposition 7

Let X be the basis of a k-maximal submonoid. Then, X is a bifix code.

Proof

If , then 
⁎
⁎
 where Y is obtained from X by replacing uv with v. Hence 
⁎
 is not k-maximal, since . Similarly for suffixes. □

The inverse is not true, see again Example 6 where  is a bifix code.

Submonoids generated by two words, i.e., elements of 
, have been extensively studied in the literature (cf. [14], [13], [15], [1]) and play an important role in many fundamental aspects of combinatorics on words. It is known (see [13] and [11]) that if X and U have free rank 2, then the intersection 
⁎
⁎
 is a free monoid generated either by at most two words or by an infinite set of words. More formally, we have the following theorem.

Theorem 8

Let  and  be two sets of 
⁎
 with free rank 2, then 
⁎
⁎
 is one of the forms

•
⁎
⁎
⁎
, for some 
⁎
;

•
⁎
⁎
⁎
⁎
, for some 
⁎
 and some .

Example 9

Let 
 and 
. One can verify that 
⁎
⁎
⁎
. Let 
 and 
, then 
⁎
⁎
⁎
⁎
. Note that the submonoids here considered are not 2-maximal. Indeed, 
⁎
⁎
⁎
 and 
⁎
⁎
⁎
.

To our knowledge nothing is proved in general for the intersection of two monoids of free rank 3. In [14] and [12], some properties of codes with three elements are studied.

Let us turn our attention to the intersection of k-maximal submonoids. For the intersection of 1-maximals, that is, for the submonoids in 
, we have the following important property: If 
⁎
 and 
⁎
 are 1-maximal submonoids (i.e., x and u are primitive words), then 
⁎
⁎
. A generalization of this result, given in [5], to the case of 2-maximal submonoids is the following.

Theorem 10

Let  and , with , be such that 
⁎
 and 
⁎
 are 2-maximal submonoids of 
⁎
. If 
⁎
⁎
, then there exists a unique primitive word 
 such that 
⁎
⁎
⁎
.

Example 11

Let 
⁎
 and 
⁎
⁎
 be two 2-maximal submonoids of 
⁎
, then their intersection is 
⁎
.

The following example shows that Theorem 10 cannot be generalized to any .

Example 12

For  let  and . It is easy to see that 
⁎
 and 
⁎
 are 4-maximal and 
⁎
⁎
⁎
. For  the intersection can be generated by 6 elements, see for example  and  are two 5-maximal submonoids and 
⁎
⁎
⁎
. Similar examples are easily found for .

In the following section, we characterize the intersection of two 3-maximal submonoids.

4. The intersection of a pair of 3-maximal submonoids
In what follows,  and  will be two distinct three-element subsets of 
 such that 
⁎
 and 
⁎
 are 3-maximal. Let also .

The following property holds:

Lemma 13

The free rank of Z, that is, the number of connected components of , is more than three. Formally, 
.

Proof

If 
, then the inclusions 
⁎
⁎
 and 
⁎
⁎
 imply that 
⁎
 and 
⁎
 are not 3-maximal unless 
⁎
⁎
⁎
 which is excluded by the assumption that X and U are distinct. □

When we search for the elements of 
⁎
⁎
 we are searching for those words that can be decomposed both into words x, y and z, and into words u, v, w. Consider, as an example, the sets  and . Then  is such a word as can be seen from its factorizations .

Double factorizations of this kind are best dealt with using two ternary morphisms as follows. We set  and define morphisms 
⁎
⁎
 by 
  For better readability, we use the boldface style for elements of 
⁎
. The example above is then captured by the equality . That is, the word  has the structure  if considered in 
⁎
, and  if considered in 
⁎
.

We say that a morphism 
⁎
⁎
 is marked if for each pair of letters 
 we have 
. Furthermore, if X is a finite set of 
⁎
 and B its free basis we say that the morphism g is X-marked if for each pair of letters 
 we have 
.

Let 
⁎
⁎
 be two morphisms. The coincidence set of g and h is the set defined as follows
 The elements of the coincidence set are called solutions. A solution is minimal if it cannot be written as the concatenation of other solutions. That is, if , then  is not a solution. Obviously, any solution has a unique decomposition into minimal solutions. That is,  is a free submonoid of the direct product 
, freely generated by the set of minimal solutions.

The property of k-maximality guarantees (by Proposition 7) the following lemmas that are responsible for a relatively simple structure of the intersection. In particular, complications related to the second case of Theorem 8 are avoided.

Lemma 14

 iff 
.

Proof

If 
, then 
 holds trivially. Let now 
, and proceed by contradiction. Assume that there exist 
 such that 
 and 
. Then 
 which implies that  and 
 are prefix comparable, a contradiction with Proposition 7. □

Lemma 15

Let  and 
 be two distinct minimal solutions. Then  and 
 are not prefix comparable, and  and 
 are not prefix comparable.

Proof

Assume that  and 
 are prefix comparable, and assume, without loss of generality, that 
, with 
. Then 
 and 
. It follows by Lemma 14 that 
, hence 
 is not minimal. Similarly, we prove that  and 
 are not prefix comparable. □

Example 16

Let 
  The pair  is a solution. Indeed . See Fig. 1 for a representation of the solution and the free graph. The free basis of  is  and we highlight the decomposition into the free basis of Z by different colors. The edges of  are 
. One can verify by a simple exhaustive search that the set of minimal solutions is 
 and the intersection is therefore 
⁎
⁎
.

Fig. 1
Download : Download high-res image (19KB)
Download : Download full-size image
Fig. 1. A representation of the solution  and the free graph of morphisms of Example 16.

This way, the problem of finding the intersection 
⁎
⁎
 is reduced to the problem of finding minimal elements of the coincidence set of morphisms g and h. Indeed, when we find a minimal solution , with 
⁎
, then  (which is equal to ) is an element of the minimal generating set of the intersection 
⁎
⁎
. As we have seen in Example 16, the intersection of two 3-maximal submonoids can be infinitely generated. We shall see that in the case of a finite number of generators, the cardinality is at most two. A trivial example of a two generated intersection is 
⁎
⁎
⁎
. A less trivial example is the following.

Example 17

Let 
  There are only two minimal solutions, namely  and , hence the submonoid intersection is finitely generated by . The free basis of  is , see Fig. 2 for representations of the two solutions and the free graph.

Fig. 2
Download : Download high-res image (33KB)
Download : Download full-size image
Fig. 2. A representation of the solutions  and  and the free graph of morphisms of Example 17.

In what follows, we equivalently refer to X (resp. U) and  (resp. . Since , , 
 and , , 
 by definition, we have that 
 for any element w of the intersection.

As mentioned before, we often use the free graph of  as the source of information about the free basis of . The set 
 of nodes is the union of the images  and . In figures, we graphically arrange nodes in 
 in two rows containing elements from  and  respectively. We know that the number of connected components is the free rank of Z, which is at least four. Moreover, we naturally distinguish two different kinds of edges. The edges that involve nodes in the same set, either  or , are horizontal edges, and the edges that involve one node of  and one of  are vertical edges.

The following two observations are immediate:

•
A morphism g is Z-marked iff there are no horizontal edges in the corresponding row. Indeed, by definition, 
 iff 
. Analogously for the morphism h.

•
A solution creates a vertical edge. Indeed, if , then 
 and 
, where 
 and 
.

This implies the following property of our morphisms.

Lemma 18

If , then either g or h is Z-marked. Moreover, if h is not marked, then there exist exactly two letters 
 such that 
.

Proof

Since the set of solutions is nonempty, there is at least one vertical edge in the free graph of . Since the free rank of  is at least four, according to Lemma 13, the free graph has at least four connected components. Consequently, as attested by Fig. 3, the free graph of Z cannot contain two horizontal edges. The claim follows. □

Fig. 3
Download : Download high-res image (32KB)
Download : Download full-size image
Fig. 3. Free graphs with a nonempty coincidence set and two horizontal edges.

Example 16, Example 17 show two cases in which the morphism g is Z-marked and h is not. The following example shows two Z-marked morphisms g and h which have two minimal solutions.

Example 19

Let 
 

The free basis of  is , g and h are both Z-marked, and the only two minimal solutions are . In such a case each minimal solution introduces a vertical edge, which yields four connected components (cf. Fig. 4).

Fig. 4
Download : Download high-res image (18KB)
Download : Download full-size image
Fig. 4. A representation of the solutions  and the free graph of two Z-marked morphisms from Example 19.

Convention 20

By symmetry, we shall suppose in what follows that g is Z-marked, 
 and 
.

Now we introduce the key ingredient of the proof of our theorem, namely the definition of the critical overflow which was first introduced in [6] (see also [16, pp. 347–351]). We say that the word 
⁎
 is a critical overflow if , for some 
⁎
, and there are pairs 
, 
 in 
 such that 
, 
 and both 
 and 
. Moreover, we say that o is a critical overflow on .

Informally, if o is a critical overflow on a pair , then  is a prefix of at least two distinct minimal solutions 
 and 
. It represents the situation when the continuation of  is not given uniquely during the construction of the minimal solution neither for  nor for .

Example 21

Remark 22

Since g and h are morphism and 
 is free, it follows that the critical overflows belong to 
.

The previous remark is a basic trivial property of free monoids and its free basis but it is fundamental for the proof of the following results that characterize the critical overflows in our setting and the corresponding properties of the free graph.

Remark 23

For sake of completeness, we should also consider the case when o is nonempty and  in the definition of the critical overflow. Note however, that such a situation is excluded by the assumption that g is marked in Convention 20.

Proposition 24

If  and 
 are two distinct minimal solutions, then there is a critical overflow o on , with 
 and 
. Therefore, h is Z-marked iff o is an empty overflow.

Proof

By Lemma 15, the components of the two minimal solutions are not prefix comparable respectively. Therefore 
, 
, 
 and 
 where 
, 
, and all 
, 
, 
, 
 are nonempty. Let 
, 
, 
 and 
 where 
 and 
. The case  and  is excluded by the assumption that g is marked. The remaining possibilities are as follows:

•
If , then the empty word is a critical overflow on . Since  has two vertical edges  and 
, it cannot have an horizontal edge, hence h is Z-marked.

•
If  and , then  is a nonempty critical overflow on . We have 
, but 
 i.e., h is not Z-marked.

•
Finally, if both  and , then we have  because g is marked and moreover there is a nonempty critical overflow o with . By Remark 22 we have that 
, hence h is not Z-marked. □

Remark 25

We can reformulate the three cases of critical overflows of the previous proof in terms of properties of  as follows. Let  and 
 be two distinct minimal solutions and 
, 
. Let 
, 
, 
 and 
, 
, 
, 
 and 
 where 
 and 
. Then,

1.
2.
If  and , then  has two vertical edges  and 
 and an horizontal edge 
 creating a connected component of three nodes (see the second case in Fig. 6). Example 17 with Fig. 2 illustrate such a case.

3.
Finally, if both  and , then  has a vertical edge  and a horizontal edge 
 (see the first case in Fig. 6). Note that Example 16 and Fig. 1 show such a situation.

Note that in any of these cases, the graph  cannot have further edges.
Lemma 26

Let o be a critical nonempty overflow such that  with 
⁎
. Let 
 be such that 
 and 
 and
 Then

Proof

Note that o is prefix comparable with both  and 
. If  or 
, then also  and 
 are prefix comparable, contradicting Proposition 7. Moreover 
, by Remark 22.

Let 
 and let 
. Then 
, a contradiction with g being Z-marked. Therefore 
. □

We have the following corollary.

Corollary 27

The critical overflow is unique.

Proof

The critical overflow is empty if and only if h is marked by Proposition 24. If h is not marked, then the critical overflow is given uniquely by Lemma 26 and Lemma 18. □

We prove the following useful lemma.

Lemma 28

Let  and 
. If 
, then 
.

Proof

If 
, then also 
, hence 
. Since both  and 
 are prefixes of , they are prefix comparable. Lemma 14 now implies that also  and 
 are prefix comparable. A length argument concludes the proof. □

The following lemma constitutes an important part of the proof of the main theorem.

Lemma 29

Let 
, 
 and 
 be three distinct minimal solutions. Then the critical overflow is nonempty. Moreover, let
 be such that 
. Then
 and there are nonempty words , , 
 and 
 such that
 and

Proof

We first show that the critical overflow is nonempty. Indeed, assume it is not empty. Then, by the uniqueness of the critical overflow, we have 
. By Remark 25 Case 1, the graph  has three vertical edges, a contradiction.

By Proposition 24 and Corollary 27, we have(2)
 where o is the (unique) nonempty critical overflow. From 
, we have 
 by Lemma 28. Let(3)
 (cf. Fig. 7). From Lemma 15 we deduce that 
, 
, 
 and 
 are nonempty, and(4)

Fig. 7
Download : Download high-res image (46KB)
Download : Download full-size image
Fig. 7. The representation of three minimal solutions.

We show that 
 and 
. Assume 
, hence, by (2) and (3), also 
 and 
. This implies 
. Note also that 
 follows from 
. By Lemma 26, we have 
, i.e., we have three different elements of  having a nonempty common prefix. Therefore  has two distinct horizontal edges, a contradiction. We therefore have 
, hence also 
. From (3), we now obtain 
. Similarly, we have 
.

Suppose that 
 and 
, we obtain nonempty words  and  such that 
, and 
, and
 Note that 
. In particular, 
, hence (4) implies
 □

We can now prove the main result of the paper.

Theorem 30

Let 
⁎
, 
⁎
 be different 3-maximal submonoids of 
⁎
. Then

⁎
⁎
⁎
, for some 
⁎

or

⁎
⁎
⁎
⁎
, for some 
.

Proof

If there are at most two minimal solutions, then the first option takes place. In the rest of the proof we shall assume that there are at least three distinct minimal solutions.

Let 
, 
 and 
 be three distinct minimal solutions, and let , 
 and 
 be as in Lemma 29. Since , 
 and 
 are prefix comparable, we can assume, without loss of generality, that 
. Using Lemma 29 and canceling, if necessary, superfluous factors 
 satisfying 
, we can now choose 
, 
, 
, 
, 
 and 
 such that(5)
 and(6)
 with the following additional minimality properties:

1.
If 
 
, then 
 
.

2.
If 
 
, then 
 
.

3.
If 
 
, then 
 
.

We call the pairs 
 and 
 and 
 the beginning, middle and end block respectively, which motivates the notation.
From (5) it follows that all elements of the set 
 are solutions. We prove that it is in fact the set of all minimal solutions, i.e., we prove that a pair  is a minimal solution iff 
 for a certain . First, we prove that each minimal solution is of the form 
 for a certain . We have that 
 and 
 are minimal and have the desired form. We proceed by induction on the length of . Assume that 
, 
, and that any minimal solution shorter than  is of the desired form. (Fig. 8.)

Fig. 8
Download : Download high-res image (36KB)
Download : Download full-size image
Fig. 8. The block decomposition of minimal solutions 
, with i = 0,1,2.

From Proposition 24, we deduce(7)
 A length argument implies that pairs 
 and 
 are prefix comparable. Minimality of blocks, that is, 1., 2., 3., then imply 
 and 
. Similarly, we obtain from the minimality of blocks that 
 is either 
 or 
. The first possibility is excluded by Lemma 29, since 
, and we would have 
 for the triple 
, 
, . From (7), we obtain 
.

Therefore, we have that 
, where . Then , and 
 is a solution. Furthermore, 
 is minimal, indeed, let 
 be the minimal solution such that 
. By the induction assumption, we have 
 for some i. Hence 
, which implies 
 since  is minimal.

It remains to show that 
 is minimal for each . Consider the minimal solution 
. Then, as we have just shown, we have 
 for some . Then 
, and we deduce  from (6).

The second option of the theorem now takes place with 
 and 
. □

5. Conclusions
The hypothesis of k-maximality considerably simplifies the structure of the intersection of monoids and gives an interesting connection with the generation of binary equality set, in the case . Our proof also shows the importance of the free graph in this context. Together with combinatorial properties of k-maximal monoids investigated in [5], this is promising for further investigation of cases with arbitrary k.