We introduce and study level-planar straight-line drawings with a fixed number ğœ† of slopes. For proper level graphs (all edges connect vertices of adjacent levels), we give an ğ‘‚(ğ‘›log2ğ‘›/loglogğ‘›)-time algorithm that either finds such a drawing or determines that no such drawing exists. Moreover, we consider the partial drawing extension problem, where we seek to extend an immutable drawing of a subgraph to a drawing of the whole graph, and the simultaneous drawing problem, which asks about the existence of drawings of two graphs whose restrictions to their shared subgraph coincide. We present ğ‘‚(ğ‘›4/3logğ‘›)-time and ğ‘‚(ğœ†ğ‘›10/3logğ‘›)-time algorithms for these respective problems on proper level-planar graphs. We complement these positive results by showing that testing whether non-proper level graphs admit level-planar drawings with ğœ† slopes is NP-hard even in restricted cases.

Introduction
Directed graphs explaining hierarchy naturally appear in multiple industrial and academic applications. Some examples include PERT diagrams, UML component diagrams, text edition networks [1], text variant graphs [26], phylogenetic and neural networks. In these, and many other applications, it is essential to visualize the implied directed graph so that the viewer can perceive the hierarchical structure it contains. By far the most popular way to achieve this is to apply the Sugiyama frameworkâ€”a generic network visualization algorithm that results in a drawing where each vertex lies on a horizontal line, called layer, and each edge is directed from a lower layer to a higher layer [21].

The Sugiyama framework consists of several steps: elimination of directed cycles in the initial graph, assignment of vertices to layers, vertex ordering and coordinate assignment. During each of these steps several criteria are optimized, by leading to more readable visualizations, see e.g. [21]. In this paper we concentrate on the last step of the framework, namely coordinate assignment. Thus, the subject of our study are level graphs defined as follows. Let ğº=(ğ‘‰,ğ¸) be a directed graph. A k-level assignment of G is a function â„“:ğ‘‰â†’{1,2,â€¦,ğ‘˜} that assigns each vertex of G to one of k levels. We refer to G together with â„“ as to a k-level graph (or level graph for short). The length of an edge (u, v) is defined as â„“(ğ‘£)âˆ’â„“(ğ‘¢). We say that G is proper if all edges have length one. The level graph shown in Fig. 1a is proper, whereas the one shown in (b) is not. For a non-proper level graph G there exists a proper subdivision obtained by subdividing all edges with length greater than one which result in a proper graph.

A level drawing ğ›¤ of a level graph G maps each vertex ğ‘£âˆˆğ‘‰ to a point on the horizontal line with y-coordinate â„“(ğ‘£) and a real x-coordinate ğ›¤(ğ‘£), and each edge to a y-monotone curve between its endpoints. In particular, the levels are equispaced apart. A level drawing is called level-planar if no two edges intersect except in common endpoints. It is straight-line if the edges are straight-line segments. A level drawing of a proper (subdivision of a) level graph G induces a total left-to-right order on the vertices of a level. We say that two drawings are equivalent if they induce the same order on every level. An equivalence class of this equivalence relation is an embedding of G. We refer to G together with an embedding to as embedded level graph îˆ³. The third step of Sugiyama framework, vertex ordering, results in an embedded level graph.

The general goal of the coordinate assignment step is to produce a final visualization while further improving its readability. The criteria of readability that have been considered in the literature for this step include straightness and steepness of the edges [21]. Here we study the problem of coordinate assignment step with bounded number of slopes. The slope of an edge (u, v) in ğ›¤ is defined as (ğ›¤(ğ‘£)âˆ’ğ›¤(ğ‘¢))/(â„“(ğ‘£)âˆ’â„“(ğ‘¢)). For proper level graphs it is â„“(ğ‘£)âˆ’â„“(ğ‘¢)=1, the slope of (u, v) is then simply ğ›¤(ğ‘£)âˆ’ğ›¤(ğ‘¢). We restrict our study to drawings in which all slopes are non-negative; such drawings can be transformed into drawings with negative slopes by shearing; see Fig. 1.

Fig. 1
figure 1
Shearing drawings to change the slopes. In (a), the left drawing with slopes 0 and 1 is transformed into the right orthogonal drawing, i.e., one with slopes âˆ’1 and 1. In (b), the left drawing with slopes 0, 1 and 2 is transformed into a drawing with slopes âˆ’1,0 and 1

Full size image
A level drawing ğ›¤ is a ğœ†-slope drawing if all slopes in ğ›¤ appear in the set {0,1,â€¦,ğœ†âˆ’1}.

We study embedding-preserving straight-line level-planar ğœ†-slope drawings, or ğœ†-drawings for short and refer to the problem of finding these drawings as ğœ†-DRAWABILITY. Since the possible edge slopes in a ğœ†-drawing are integers all vertices lie on the integer grid.

Related Work The number of slopes used for the edges in a graph drawing can be seen as an indication of the simplicity of the drawing. For instance, the measure edge orthogonality, which specifies how close a drawing is to an orthogonal drawing, where edges are polylines consisting of horizontal and vertical segments only, has been proposed as a measure of aesthetic quality of a graph drawing [40]. In a similar spirit, Kindermann et al. studied the effect reducing the segment complexity on the aesthetics preference of graph drawings and observed that in some cases people prefer drawings using lower segment complexity [29]. More generally, the use of few slopes for a graph drawing may contribute to the formation of â€œPrÃ¤gnanzâ€ (â€œgood figureâ€ in German) of the visualization, that accordingly to the Gestalt law of PrÃ¤gnanz, or law of simplicity, contributes to the perceived quality of the visualizations. This design principle often guides the visualization of metro maps. See [37] for a survey of the existing approaches, most of which generate octilinear layouts of metro maps, and [36] for a recent model for drawing more general k-linear metro maps.

Level-planar drawing with few slopes have not been considered in the literature but drawings of undirected graphs with few slopes have been extensively studied. The planar slope number of a planar graph G is the smallest number s so that G has a planar straight-line drawing with edges of at most s distinct slopes. Special attention has been given to proving bounds on the (planar) slope number of undirected graph classes [4, 13, 14, 16, 17, 27, 28, 31, 32, 38]. Determining the planar slope number is hard in the existential theory of reals [23]. The slope number has also been studied for upward planar drawings, that is, drawings of directed graphs where each edge is drawn as a y-monotone curve (but, unlike with level planarity, the y-coordinate of the vertices is not prescribed) [5, 15].

Several graph visualization problems have been considered in the partial and simultaneous settings. In the partial drawing extension problem, one is presented with a graph and an immutable drawing of some subgraph thereof. The task is to determine whether the given drawing of the subgraph can be completed to a drawing of the entire graph. The problem has been studied for the planar setting [33, 39] and also the level-planar setting [10]. In the simultaneous drawing problem, one is presented with two graphs that may share some subgraph. The task is to draw both graphs so that the restrictions of both drawings to the shared subgraph are identical. We refer the reader to [6] for an older literature overview. The problem has been considered for orthogonal drawings [2] and level-planar drawings [3]. Up to our knowledge, neither partial nor simultaneous drawings have been considered in the restricted slope setting.

Contribution We introduce and study the ğœ†-DRAWABILITY problem. To solve this problem for proper level graphs, we introduce two models. In Sect. 3 we describe the first model, which uses a classic integer-circulation-based approach. This model allows us to solve the ğœ†-DRAWABILITY in ğ‘‚(ğ‘›log3ğ‘›) time and obtain a ğœ†-drawing within the same running time if one exists. In Sect. 4, we describe the second distance-based model. It uses the duality between flows in the primal graph and distances in the dual graph and allows us to solve the ğœ†-DRAWABILITY in ğ‘‚(ğ‘›log2ğ‘›/loglogğ‘›) time.

We also address the partial and simultaneous settings. The classic integer-circulation-based approach can be used to extend connected partial ğœ†-drawings in ğ‘‚(ğ‘›log3ğ‘›) time. In Sect. 5, we build on the distance-based model to extend not-necessarily-connected partial ğœ†-drawings in ğ‘‚(ğ‘›4/3logğ‘›) time, and to obtain simultaneous ğœ†-drawings in ğ‘‚(ğœ†ğ‘›10/3logğ‘›) time if they exist.

We complement these algorithmic results in Sect. 6 with a proof that 2-DRAWABILITY is NP-hard even for biconnected graphs where all edges have length one or two, and then finish with some concluding remarks in Sect. 7.

Preliminaries
Let ğ›¤ be a level-planar drawing of an embedded level-planar graph îˆ³. The width of ğ›¤ is defined as maxğ‘£âˆˆğ‘‰ğ›¤(ğ‘£)âˆ’minğ‘£âˆˆğ‘‰ğ›¤(ğ‘£). An integer ğ‘¥Â¯ is a gap in ğ›¤ if it is ğ›¤(ğ‘£)â‰ ğ‘¥Â¯ for all ğ‘£âˆˆğ‘‰, ğ›¤(ğ‘£1)<ğ‘¥Â¯ and ğ›¤(ğ‘£2)>ğ‘¥Â¯ for some ğ‘£1,ğ‘£2âˆˆğ‘‰, and ğ›¤(ğ‘¢)<ğ‘¥Â¯<ğ›¤(ğ‘£) for no edge (ğ‘¢,ğ‘£)âˆˆğ¸. For example, 2 is a gap in the left drawing in Fig. 1a. A drawing ğ›¤ is compact if it has no gap, e.g., the left drawing in Fig. 1b. Note that a ğœ†-drawing of a connected level-planar graph is inherently compact. In a ğœ†-drawing of a non-connected level-planar graph every gap can be eliminated by a horizontal shift. The fact that we only need to consider compact ğœ†-drawings helps us to limit the drawing width. In particular, a compact ğœ†-drawing has width at most (ğœ†âˆ’1)(ğ‘›âˆ’1).

Let u and v be two vertices on the same level i. With [ğ‘¢,ğ‘£]îˆ³ (or [u, v] when îˆ³ is clear from the context) we denote the set of vertices that contains u, v and all vertices in between u and v on level i in îˆ³. We say that two vertices u and v are consecutive in îˆ³ when [ğ‘¢,ğ‘£]={ğ‘¢,ğ‘£}. Two edges ğ‘’=(ğ‘¢,ğ‘¤),ğ‘’â€²=(ğ‘£,ğ‘¥) are consecutive in îˆ³ when the only edges with one endpoint in [ğ‘¢,ğ‘£]îˆ³ and the other endpoint in [ğ‘¤,ğ‘¥]îˆ³ are e and ğ‘’â€². For example, in Fig. 2b, the vertices u and v are consecutive, the vertices x and w are consecutive, and the edges (u, w) and (v, x) are consecutive; and in Fig. 2c, the vertices ğ‘£left and ğ‘£right are not consecutive.

A flow network ğ¹=(ğ‘,ğ´) consists of a set of nodes N connected by a set of directed arcs A. A node is a source if it has no incoming arcs and it is a sink if it has no outgoing arcs. A flow network is an st-graph if it has exactly one source and exactly one sink. Each arc has a demand specified by a function ğ‘‘:ğ´â†’â„•0 and a capacity specified by a function ğ‘:ğ´â†’â„•âˆª{âˆ} where âˆ means unlimited capacity. A circulation in F is a function ğœ‘:ğ´â†’â„•0 that assigns an integral flow to each arc of F and satisifies the two following conditions. First, the circulation has to respect the demands and capacities of the arcs, i.e., for each arc ğ‘âˆˆğ´ it is ğ‘‘(ğ‘)â‰¤ğœ‘(ğ‘)â‰¤ğ‘(ğ‘). Second, the circulation has to respect flow conservation, i.e., for each node ğ‘£âˆˆğ‘ it is âˆ‘(ğ‘¢,ğ‘£)âˆˆğ´ğœ‘(ğ‘¢,ğ‘£)=âˆ‘(ğ‘£,ğ‘¢)âˆˆğ´ğœ‘(ğ‘£,ğ‘¢). Depending on the flow network no circulation may exist.

Flow Model
In this section, we model the ğœ†-DRAWABILITY as a problem of finding a circulation in a flow network. Let îˆ³ be an embedded proper k-level graph. As a first step, we add two directed paths ğ‘left and ğ‘right that consist of one vertex on each level from 1 to k to îˆ³. Insert ğ‘left and ğ‘right into îˆ³ to the left and right of all other vertices as the left and right boundary, respectively. See Fig. 2a and c.

Fig. 2
figure 2
An embedded level graph îˆ³ (a). The definition of the arcs of the flow network (b). The graph îˆ³ together with the paths ğ‘left and ğ‘right in black (c). The resulting flow network ğ¹ğœ†îˆ³ consists of the blue slope arcs and the red space arcs, its nodes are formed by merging the nodes in the gray areas. The red space arcs have a demand of 1 and a capacity of (ğœ†âˆ’1)(ğ‘›âˆ’1) and the blue slope arcs have a demand of zero and a capacity of ğœ†âˆ’1 (Color figure online)

Full size image
From now on, we assume that îˆ³ contains the left and right boundary.

The flow network ğ¹ğœ†îˆ³ consists of nodes and arcs and is similar to a directed dual of îˆ³ with the difference that it takes the levels of îˆ³ into account. In particular, for every edge e of îˆ³, ğ¹ğœ†îˆ³ contains two nodes ğ‘’left and ğ‘’right, in the left and the right faces incident to e, and a dual slope arc ğ‘’â‹†=(ğ‘’right,ğ‘’left) with demand 0 and capacity ğœ†âˆ’1; see the blue arcs in Fig. 2b and c. The flow across ğ‘’â‹† determines the slope of e. Additionally, for every pair of consecutive vertices u, v we add two nodes [ğ‘¢,ğ‘£]low and [ğ‘¢,ğ‘£]high to ğ¹ğœ†îˆ³ and connect them by a space arc [ğ‘¢,ğ‘£]â‹†; see the red arcs in Fig. 2b and c. The flow across [ğ‘¢,ğ‘£]â‹† determines the space between u and v. The space between u and v needs to be at least one to prevent u and v from colliding and can be at most (ğœ†âˆ’1)(ğ‘›âˆ’1) due to the restriction to compact drawings. So, assign to [ğ‘¢,ğ‘£]â‹† a demand of one and a capacity of (ğœ†âˆ’1)(ğ‘›âˆ’1). To obtain the final flow network we merge certain nodes. Let ğ‘’=(ğ‘¢,ğ‘¤) and ğ‘’â€²=(ğ‘£,ğ‘¥) be consecutive edges. Merge the nodes ğ‘’right,ğ‘’â€²left, the nodes {{ğ‘¢â€²,ğ‘£â€²}high:âˆ€ğ‘¢â€²,ğ‘£â€²~consecutive in~[ğ‘¢,ğ‘£]} and the nodes {{ğ‘¤â€²,ğ‘¥â€²}low:âˆ€ğ‘¤â€²,ğ‘¥â€²~consecutive in~[ğ‘¤,ğ‘¥]} into a single node. Next, merge all remaining source and sink nodes into one source node s and one sink node t, respectively. See Fig. 2c, where the gray areas touch nodes that are merged into a single node. Observe that flow network is a connected st-graph. Clearly s is a source and t is a sink. Each remaining node v corresponds to two consecutive edges of îˆ³, so by construction it has exactly one incoming and one outgoing slope arc, so v is neither a source nor a sink. This also implies that there exists a directed path of slope arcs from s to v, and a directed path of slope arcs from v to t, so the flow network is connected. Finally, to admit non-trivial circulations, insert an arc from t to s with capacity âˆ. Observe that ğ¹ğœ†îˆ³ is planar by its construction based on the planar embedding of îˆ³.

The network ğ¹ğœ†îˆ³ is designed in such a way that the circulations in ğ¹ğœ†îˆ³ correspond bijectively to the ğœ†-drawings of îˆ³. Let ğ›¤ be a drawing of îˆ³ and let x be the function that assigns to each vertex of îˆ³ its x-coordinate in ğ›¤. We define a dual circulation ğ‘¥â‹† as follows. Recall that each arc a of ğ¹ğœ†îˆ³âˆ’(ğ‘ ,ğ‘¡) is a slope arc or a space arc. If a is a slope arc it is dual to an edge (u, w) of îˆ³. Then define ğ‘¥â‹†(ğ‘):=ğ‘¥(ğ‘¤)âˆ’ğ‘¥(ğ‘¢). If a is a space arc it is dual to consecutive vertices u, v of îˆ³, where u appears left of v. Then define ğ‘¥â‹†(ğ‘):=ğ‘¥(ğ‘£)âˆ’ğ‘¥(ğ‘¢). We remark the following, although we defer the proof to the next section.

Lemma 1
Let îˆ³ be an embedded proper level-planar graph together with a ğœ†-drawing ğ›¤. The dual ğ‘¥â‹† of the function x that assigns to each vertex of îˆ³ its x-coordinate in ğ›¤ is a circulation in ğ¹ğœ†îˆ³.

In the reverse direction, given a circulation ğœ‘ in ğ¹ğœ†îˆ³ we define a dual function ğœ‘â‹† that, when interpreted as assigning an x-coordinate to the vertices of îˆ³, defines a ğœ†-drawing of îˆ³. Refer to the level-1-vertex of ğ‘right as ğ‘£right. Start by setting ğœ‘â‹†(ğ‘£right)=0, i.e., the x-coordinate of ğ‘£right is 0. Process the remaining vertices of the right boundary in ascending order with respect to their levels. Let (u, v) be an edge of the right boundary so that u has already been processed and v has not been processed yet. Then set ğœ‘â‹†(ğ‘£)=ğœ‘â‹†(ğ‘¢)+ğœ‘((ğ‘¢,ğ‘£)â‹†), where (ğ‘¢,ğ‘£)â‹† is the slope arc dual to (u, v). Let w, x be a pair of consecutive vertices so that x has already been processed and w has not yet been processed yet. Then set ğœ‘â‹†(ğ‘¤)=ğœ‘â‹†(ğ‘¥)âˆ’ğœ‘([ğ‘¤,ğ‘¥]â‹†), where [ğ‘¤,ğ‘¥]â‹† is a space arc. It turns out that ğœ‘â‹† defines a ğœ†-drawing of îˆ³.

Lemma 2
Let îˆ³ be an embedded proper level-planar graph, let ğœ†âˆˆâ„• and let ğœ‘ be a circulation in ğ¹ğœ†îˆ³. Then the dual ğœ‘â‹†, when interpreted as assigning an x-coordinate to the vertices of îˆ³, defines a ğœ†-drawing of îˆ³.

While both Lemmas 1 and  2 can be proven directly, we defer their proofs to Sect. 4 where we introduce the distance model and prove Lemmas 3 and  4, the stronger versions of Lemmas 1 and  2, respectively. Combining Lemmas 1 and  2 we obtain the following.

Theorem 1
Let îˆ³ be an embedded proper level-planar graph and let ğœ†âˆˆâ„•. The circulations in ğ¹ğœ†îˆ³ correspond bijectively to the ğœ†-drawings of îˆ³.

Theorem 1 implies that a ğœ†-drawing can be found by applying existing flow algorithms to ğ¹ğœ†îˆ³. For that, first transform our flow network with arc demands to the standard single-source single-sink maximum flow setting without arc demands using the construction due to Kleinberg and Tardos [30, Chapter 7.7]. This construction adds one new â€œsuper-sourceâ€ ğ‘ âˆ— and one new â€œsuper-sinkâ€ ğ‘¡âˆ— to ğ¹ğœ†îˆ³, and connects them with arcs to the other nodes in ğ¹ğœ†îˆ³. In particular, the size of the resulting flow network is linear in the size of ğ¹ğœ†îˆ³. Subdivide the arcs incident to ğ‘ âˆ—,ğ‘¡âˆ— and then remove ğ‘ âˆ—,ğ‘¡âˆ— from the flow network, obtaining an instance of the multiple-source multiple-sink maximum flow problem. Note that this network is planar. Use the ğ‘‚(ğ‘›log3ğ‘›)-time multiple-source multiple-sink maximum flow algorithm due to Borradaile et al. [8] to find a circulation in ğ¹ğœ†îˆ³, or to determine that no circulation exists.

Corollary 1
Let îˆ³ be an embedded proper level-planar graph and let ğœ†âˆˆâ„•. It can be tested in ğ‘‚(ğ‘›log3ğ‘›) time whether a ğœ†-drawing of îˆ³ exists, and if so, such a drawing can be found within the same running time.

Connected Partial Drawings
Recall that a partial ğœ†-drawing is a tuple (îˆ³,îˆ´,ğ›±), where îˆ³ is an embedded level-planar graph, îˆ´ is an embedded subgraph of îˆ³ and ğ›± is a ğœ†-drawing of îˆ´. We say that (îˆ³,îˆ´,ğ›±) is ğœ†-extendable if îˆ³ admits a ğœ†-drawing ğ›¤ whose restriction to îˆ´ is ğ›±. Here ğ›¤ is referred to as a ğœ†-extension of (îˆ³,îˆ´,ğ›±).

In this section we show that in case îˆ´ is connected, we can use the flow model to decide whether (îˆ³,îˆ´,ğ›±) is ğœ†-extendable. Observe that when îˆ´ is connected ğ›± is completely defined by the slopes of the edges in îˆ´ up to horizontal translation. Let ğ¹ğœ†îˆ³ be the flow network corresponding to îˆ³. In order to fix the slopes of an edge e of îˆ´ to a value â„“, we fix the flow across the dual slope arc ğ‘’â‹† in îˆ´ to â„“. Checking whether a circulation in the resulting flow network exists can be reduced to a multiple-source multiple-sink maximum flow problem, which once again can be solved by the algorithm due to Borradaile et al. [8].

Corollary 2
Let (îˆ³,îˆ´,ğ›±) be a partial ğœ†-drawing where îˆ´ is connected. It can be tested in ğ‘‚(ğ‘›log3ğ‘›) time whether (îˆ³,îˆ´,ğ›±) is ğœ†-extendable, and if so, a corresponding ğœ†-extension can be constructed within the same running time.

Dual Distance Model
A minimum cut (and, equivalently, the value of the maximum flow) of an st-planar graph G can be determined by computing a shortest (ğ‘ â‹†,ğ‘¡â‹†)-path in a dual of G [24, 25]. Hassin showed that to construct a flow, it is sufficient to compute the distances from ğ‘ â‹† to all other vertices in the dual graph [20]. To the best of our knowledge, this duality has been exploited only for flow networks with arc capacities, but not with arc demands. In this section, we extend this duality to arcs with demands.

The resulting dual distance model improves the running time for the ğœ†-DRAWABILITY, lets us test the existence of ğœ†-extensions of partial ğœ†-drawings for non-connected subgraphs, and allows us to develop an efficient algorithm for testing the existence of simultaneous ğœ†-drawings.

We define ğ·ğœ†îˆ³ to be the weighted directed dual of ğ¹ğœ†îˆ³ as follows. Let a be an arc of ğ¹ğœ†îˆ³ with demand d(a) and capacity c(a). Further, let ğ‘“left and ğ‘“right denote the left and the right faces of a in ğ¹ğœ†îˆ³, respectively. The dual ğ·ğœ†îˆ³ contains ğ‘“left and ğ‘“right as vertices connected by the directed edge (ğ‘“left,ğ‘“right) with weight c(a) and the directed edge (ğ‘“right,ğ‘“left) with weight âˆ’ğ‘‘(ğ‘); see Fig. 3. Equivalently, ğ·ğœ†îˆ³ is obtained directly from îˆ³ as follows. Recall that if a is a slope arc, it is ğ‘‘(ğ‘)=0,ğ‘(ğ‘)=ğœ†âˆ’1 and ğ‘“left,ğ‘“right correspond to vertices u, w connected by the edge (u, w) in G. So, create for each directed edge (u, w) of îˆ³ the weighted directed edges (u, w) with weight ğœ†âˆ’1 and (w, u) with weight 0 in ğ·ğœ†îˆ³; see Fig. 3a. If a is not a slope arc then a is a space arc and it is ğ‘‘(ğ‘)=1,ğ‘(ğ‘)=(ğœ†âˆ’1)(ğ‘›âˆ’1) and ğ‘“left,ğ‘“right correspond to consecutive vertices u, v in îˆ³, where u appears to the left of v. So, create for each pair of consecutive vertices u, v in îˆ³ where u appears to the left of v the weighted directed edges (u, v) with weight (ğœ†âˆ’1)(ğ‘›âˆ’1) and (v, u) with weight âˆ’1 in ğ·ğœ†îˆ³; see Fig. 3b. Observe that ğ·ğœ†îˆ³ has the vertex set V of îˆ³ and a superset of its edges. Figure 4 shows the distance network obtained from the flow network shown in Fig. 2c.

Fig. 3
figure 3
Definition of the dual edges for a flow network arc ğ‘=(ğ‘¢,ğ‘£) with demand d(a) and capacity c(a). Let ğ‘“left and ğ‘“right denote the vertices corresponding to the faces to the left and right of a in ğ¹ğœ†îˆ³. Then add the edge (ğ‘“left,ğ‘“right) with weight c(a) and the reverse edge (ğ‘“right,ğ‘“left) with weight âˆ’ğ‘‘(ğ‘). The edge weights depend on whether a is a slope arc (a) or a space arc (b)

Full size image
Fig. 4
figure 4
The distance network ğ·2îˆ³ obtained from the flow network ğ¹2îˆ³ shown in Fig. 2c. The x-coordinate of every vertex is its distance from ğ‘£right in ğ·2îˆ³. Red arcs pointing right have weight (ğœ†âˆ’1)(ğ‘›âˆ’1)=19, red arcs pointing left have weight âˆ’1. Blue arcs pointing up have weight ğœ†âˆ’1=1 and blue arcs pointing down have weight 0 (Color figure online)

Full size image
A distance labeling is a function ğ‘¥:ğ‘‰â†’â„¤ that for every edge (u, v) of ğ·ğœ†îˆ³ with weight l satisfies ğ‘¥(ğ‘£)â‰¤ğ‘¥(ğ‘¢)+ğ‘™. We also say that (u, v) imposes the distance constraint ğ‘¥(ğ‘£)â‰¤ğ‘¥(ğ‘¢)+ğ‘™. A distance labeling for ğ·ğœ†îˆ³ is the x-coordinate assignment for a ğœ†-drawing: For an edge (u, v) of ğ·ğœ†îˆ³ where u, v are consecutive vertices in îˆ³, the distance labeling guarantees ğ‘¥(ğ‘£)â‰¤ğ‘¥(ğ‘¢)âˆ’1, i.e., the consecutive vertices are in the correct order and do not overlap. If an edge (u, v) between layers has weight ğœ†âˆ’1, then the distance labeling ensures ğ‘¥(ğ‘£)â‰¤ğ‘¥(ğ‘¢)+ğœ†âˆ’1, i.e., (u, v) has a slope in {0,â€¦,ğœ†âˆ’1}. Computing the shortest distances from ğ‘£right in ğ·ğœ†îˆ³ to every vertex (if they are well-defined) gives a distance labeling that we refer to as the shortest distance labeling. A distance labeling of ğ·ğœ†îˆ³ does not necessarily exist. This is the case when ğ·ğœ†îˆ³ contains a negative cycle, e.g., when the in- or out-degree of a vertex in îˆ³ is strictly larger than ğœ†. For a distance labeling x of ğ·ğœ†îˆ³ we define a dual circulation ğ‘¥â‹† as follows. Recall that each arc a of ğ¹ğœ†îˆ³âˆ’(ğ‘¡,ğ‘ ) is a slope arc or a space arc. If a is a slope arc it is dual to an edge (u, w) of îˆ³. Recall that u, w are vertices of ğ·ğœ†îˆ³ and define ğ‘¥â‹†(ğ‘):=ğ‘¥(ğ‘¤)âˆ’ğ‘¥(ğ‘¢). If a is a space arc it is dual to consecutive vertices u, v of îˆ³. Again, u, v are vertices of ğ·ğœ†îˆ³, define ğ‘¥â‹†(ğ‘):=ğ‘¥(ğ‘£)âˆ’ğ‘¥(ğ‘¢).

Lemma 3
Let îˆ³ be an embedded level-planar graph and ğ›¤ be a ğœ†-drawing of îˆ³. The function x that assigns to each vertex of îˆ³ its x-coordinate in ğ›¤ is a distance labeling of ğ·ğœ†îˆ³ and its dual ğ‘¥â‹† is a circulation in ğ¹ğœ†îˆ³.

Proof
Since ğ›¤ preserves the embedding of îˆ³, for each consecutive vertices v,  u, with v preceding u in îˆ³ it holds that ğ›¤(ğ‘£)<ğ›¤(ğ‘¢). Because ğ›¤ is a grid drawing ğ›¤(ğ‘£)â‰¤ğ›¤(ğ‘¢)âˆ’1, which implies ğ‘¥(ğ‘£)â‰¤ğ‘¥(ğ‘¢)+ğ‘™, where ğ‘™=âˆ’1 is the weight of (u, v). Since ğ›¤ is a ğœ†-drawing, i.e., every edge (u, v) between the two levels has a slope in {0,â€¦ğœ†âˆ’1}, it holds that ğ›¤(ğ‘¢)â‰¤ğ›¤(ğ‘£)â‰¤ğ›¤(ğ‘¢)+ğœ†âˆ’1, which implies ğ‘¥(ğ‘¢)â‰¤ğ‘¥(ğ‘£)+0, for the edge (v, u) of ğ·ğœ†îˆ³ with weight zero and ğ‘¥(ğ‘£)â‰¤ğ‘¥(ğ‘¢)+ğœ†âˆ’1 for the edge (u, v) of ğ·ğœ†îˆ³ with weight ğœ†âˆ’1. Hence, x is a distance labeling of ğ·ğœ†îˆ³.

We now show that ğ‘¥â‹† is a circulation in ğ¹ğœ†îˆ³. Let ğ‘“1,ğ‘“2,â€¦,ğ‘“ğ‘¡,ğ‘“ğ‘¡+1=ğ‘“1 be the faces incident to some node v of ğ¹ğœ†îˆ³ in counter-clockwise order. Let a be the arc incident to v and dual to the edge between ğ‘“ğ‘– and ğ‘“ğ‘–+1 with 1â‰¤ğ‘–â‰¤ğ‘¡. If a is an incoming arc, it adds a flow of ğ‘¥(ğ‘“ğ‘–+1)âˆ’ğ‘¥(ğ‘“ğ‘–) to v. If a is an outgoing arc, it removes a flow of ğ‘¥(ğ‘“ğ‘–)âˆ’ğ‘¥(ğ‘“ğ‘–+1) from v, or, equivalently, it adds a flow of ğ‘¥(ğ‘“ğ‘–+1)âˆ’ğ‘¥(ğ‘“ğ‘–) to v. Therefore, the flow through v is âˆ‘ğ‘–(ğ‘¥(ğ‘“ğ‘–+1)âˆ’ğ‘¥(ğ‘“ğ‘–)). This sum cancels to zero, i.e., the flow is preserved at v.

Now consider an arc a of ğ¹ğœ†îˆ³âˆ’(ğ‘¡,ğ‘ ).

If a is a slope arc it is dual to an edge (u, w) of îˆ³. Then ğ·ğœ†îˆ³ contains the edge (u, w) with weight c(a), which ensures ğ‘¥(ğ‘¤)â‰¤ğ‘¥(ğ‘¢)+ğ‘(ğ‘), so ğ‘¥â‹†(ğ‘)â‰¤ğ‘(ğ‘). It also contains the edge (w, u) with weight âˆ’ğ‘‘(ğ‘), which ensures ğ‘¥(ğ‘¢)â‰¤ğ‘¥(ğ‘¤)âˆ’ğ‘‘(ğ‘), so ğ‘¥â‹†(ğ‘)â‰¥ğ‘‘(ğ‘).

If a is a space arc it is dual to consecutive vertices u, v of îˆ³. Then ğ·ğœ†îˆ³ contains the edge (u, v) with weight c(a), which ensures ğ‘¥(ğ‘£)â‰¤ğ‘¥(ğ‘¢)+ğ‘(ğ‘), so ğ‘¥â‹†(ğ‘)â‰¤ğ‘(ğ‘). It also contains the edge (v, u) with weight âˆ’ğ‘‘(ğ‘), which ensures ğ‘¥(ğ‘¢)â‰¤ğ‘¥(ğ‘£)âˆ’ğ‘‘(ğ‘), so ğ‘¥â‹†(ğ‘)â‰¥ğ‘‘(ğ‘).

Finally, the arc (t, s) has demand 0 and capacity âˆ, so its demand is satisfied and its capacity is not exceeded.

Hence, ğ‘¥â‹† is indeed a circulation in ğ¹ğœ†îˆ³. â—»

Recall from Sect. 3 that for a circulation ğœ‘ in ğ¹ğœ†îˆ³ we define a dual drawing ğœ‘â‹† by setting the x-coordinates of the vertices of îˆ³ as follows. For the lowest vertex of the right boundary set ğœ‘â‹†(ğ‘£right)=0. Process the remaining vertices of the right boundary in ascending order with respect to their levels. Let (u, v) be an edge of the right boundary so that u has already been processed and v has not been processed yet. Then set ğœ‘â‹†(ğ‘£)=ğœ‘â‹†(ğ‘¢)+ğœ‘((ğ‘¢,ğ‘£)â‹†), where (ğ‘¢,ğ‘£)â‹† is the slope arc dual to (u, v). Let w, x be a pair of consecutive vertices so that x has already been processed and w has not yet been processed yet. Then set ğœ‘â‹†(ğ‘¤)=ğœ‘â‹†(ğ‘¥)âˆ’ğœ‘([ğ‘¤,ğ‘¥]â‹†), where [ğ‘¤,ğ‘¥]â‹† is a space arc. It turns out that ğœ‘â‹† is a distance labeling of ğ·ğœ†îˆ³ and a ğœ†-drawing of îˆ³.

Lemma 4
Let îˆ³ be an embedded level-planar graph, let ğœ†âˆˆâ„•, and let ğœ‘ be a circulation in ğ¹ğœ†îˆ³. The dual ğœ‘â‹† is a distance labeling of ğ·ğœ†îˆ³ and, when interpreted as assigning an x-coordinate to the vertices of îˆ³, defines a ğœ†-drawing of îˆ³.

Proof
We show that ğœ‘â‹† is a distance labeling in ğ·ğœ†îˆ³. The algorithm described above assigns a value to every vertex of ğ·ğœ†îˆ³. We now show that ğœ‘â‹† is indeed a distance labeling by showing that every edge satisfies a distance constraint.

Observe that the distance constraints imposed by edges dual to the space arcs are satisfied by construction. To show that the distance constraints imposed by edges dual to the slope arcs are also satisfied, we prove that for every edge (u, v), it holds that ğœ‘â‹†(ğ‘£)=ğœ‘â‹†(ğ‘¢)+ğœ‘((ğ‘¢,ğ‘£)â‹†). We refer to this as condition îˆ¯ for short. Since ğœ‘((ğ‘¢,ğ‘£)â‹†)â‰¤ğœ†âˆ’1 and the weight l of (u, v) is ğ‘™=ğœ†âˆ’1 we obtain ğœ‘â‹†(ğ‘£)=ğœ‘â‹†(ğ‘¢)+â„“, which implies that ğœ‘â‹† is a distance labeling of ğ·ğœ†îˆ³.

Fig. 5
figure 5
Proof of Lemma 4. Sets A and B contain the incoming and outgoing red flow network arcs incident to the gray oval, respectively (Color figure online)

Full size image
The proof is by induction based on the bottom to top and right to left order among the edges of ğ·ğœ†îˆ³. We say that (a, b) precedes (c, d) if either â„“(ğ‘)<â„“(ğ‘), or â„“(ğ‘)=â„“(ğ‘) and a is to the right of c, or â„“(ğ‘)=â„“(ğ‘) and b is to the right of d (in case ğ‘=ğ‘). For the base case observe that the edges with both end-vertices on the first level and the edges of ğ‘right satisfy condition îˆ¯ by the definition of ğœ‘â‹†. Now let (u, v) be an edge not addressed in the base case and assume that for every edge (ğ‘¢â€²,ğ‘£â€²) preceding edge (u, v) condition îˆ¯ holds. For the inductive step we show that condition îˆ¯ also holds for (u, v). Let (ğ‘¢â€²,ğ‘£â€²) denote the edge to the right of (u, v) so that (u, v) and (ğ‘¢â€²,ğ‘£â€²) are consecutive; see Fig. 5. Because v is not the rightmost vertex on its level this edge exists. Let A denote the set of space arcs [ğ‘¢1,ğ‘¢2]â‹† in ğ¹ğœ†îˆ³ with ğ‘¢1,ğ‘¢2âˆˆ[ğ‘¢â€²,ğ‘¢]. Analogously, let B denote the set of space arcs [ğ‘£1,ğ‘£2]â‹† in ğ¹ğœ†îˆ³ with ğ‘£1,ğ‘£2âˆˆ[ğ‘£â€²,ğ‘£]. It is ğœ‘â‹†(ğ‘£)=ğœ‘â‹†(ğ‘£â€²)âˆ’âˆ‘ğ‘âˆˆğµğœ‘(ğ‘) by definition of ğœ‘â‹†. Further, by induction hypothesis and since (ğ‘¢â€²,ğ‘£â€²) precedes (u, v) it is ğœ‘â‹†(ğ‘£â€²)=ğœ‘â‹†(ğ‘¢â€²)+ğœ‘((ğ‘¢â€²,ğ‘£â€²)â‹†). Inserting the latter into the former equation, we obtain

ğœ‘â‹†(ğ‘£)=ğœ‘â‹†(ğ‘¢â€²)+ğœ‘((ğ‘¢â€²,ğ‘£â€²)â‹†)âˆ’âˆ‘ğ‘âˆˆğµğœ‘(ğ‘).
(1)
Again, by definition of ğœ‘â‹†, it is ğœ‘â‹†(ğ‘¢)=ğœ‘â‹†(ğ‘¢â€²)âˆ’âˆ‘ğ‘âˆˆğ´ğœ‘(ğ‘). Solving for ğœ‘â‹†(ğ‘¢â€²) and inserting into (1) we obtain

ğœ‘â‹†(ğ‘£)=ğœ‘â‹†(ğ‘¢)+âˆ‘ğ‘âˆˆğ´ğœ‘(ğ‘)+ğœ‘((ğ‘¢â€²,ğ‘£â€²)â‹†)âˆ’âˆ‘ğ‘âˆˆğµğœ‘(ğ‘).
(2)
Flow conservation on the vertex of ğ¹ğœ†îˆ³ to which edges of A and B are incident gives

ğœ‘((ğ‘¢â€²,ğ‘£â€²)â‹†)+âˆ‘ğ‘âˆˆğ´ğœ‘(ğ‘)=ğœ‘((ğ‘¢,ğ‘£)â‹†)+âˆ‘ğ‘âˆˆğµğœ‘(ğ‘).
(3)
Solving Eq. (3) for ğœ‘((ğ‘¢â€²,ğ‘£â€²)â‹†) and then inserting it into Eq. (2) yields ğœ‘â‹†(ğ‘£)=ğœ‘â‹†(ğ‘¢)+ğœ‘((ğ‘¢,ğ‘£)â‹†), i.e., condition îˆ¯ holds for (u, v). Therefore ğœ‘â‹† is a distance labeling, which we have shown to define a ğœ†-drawing of îˆ³. â—»

Because ğ·ğœ†îˆ³ is planar we can use the ğ‘‚(ğ‘›log2ğ‘›/loglogğ‘›)-time shortest path algorithm due to Mozes and Wulff-Nilsen [35] to compute the shortest distance labeling. This improves our ğ‘‚(ğ‘›log3ğ‘›)-time algorithm from Sect. 3.

Theorem 2
Let îˆ³ be an embedded proper level-planar graph. The distance labelings of ğ·ğ‘˜îˆ³ correspond bijectively to the ğœ†-drawings of îˆ³. If such a drawing exists, it can be found in ğ‘‚(ğ‘›log2ğ‘›/loglogğ‘›) time.

Partial and Simultaneous Drawings
In this section we use the distance model from Sect. 4 to construct partial and simultaneous ğœ†-drawings. We start with introducing a useful kind of drawing. Let ğ›¤ be a ğœ†-drawing of îˆ³. We call ğ›¤ a ğœ†-rightmost drawing when there exists no ğœ†-drawing ğ›¤â€² with ğ›¤(ğ‘£)<ğ›¤â€²(ğ‘£) for some ğ‘£âˆˆğ‘‰. In this definition, we assume ğ‘¥(ğ›¤(ğ‘£right))=ğ‘¥(ğ›¤â€²(ğ‘£right))=0 to exclude trivial horizontal translations. Hence, a drawing is rightmost when every vertex is at its rightmost position across all level-planar ğœ†-slope grid drawings of îˆ³. It is not trivial that a ğœ†-rightmost drawing exists, but it follows directly from the definition that if such a drawing exists, it is unique. The following lemma establishes the relationship between ğœ†-rightmost drawings and shortest distance labelings of ğ·ğœ†îˆ³.

Lemma 5
Let îˆ³ be an embedded proper level-planar graph. If ğ·ğœ†îˆ³ has a shortest distance labeling it describes the ğœ†-rightmost drawing of îˆ³.

Proof
The shortest distance labeling of ğ·ğœ†îˆ³ is maximal in the sense that for any vertex v there exists a vertex u and an edge (u, v) with weight l so that it is ğ‘¥(ğ‘£)=ğ‘¥(ğ‘¢)+ğ‘™. Recall that the definition of distance labelings only requires ğ‘¥(ğ‘£)â‰¤ğ‘¥(ğ‘¢)+ğ‘™. The claim then follows by induction over V in ascending order with respect to the shortest distance labeling. â—»

Partial Drawings
Let (îˆ³,îˆ´,ğ›±) be a partial ğœ†-drawing. In Sect. 3.1 we have shown that the flow model can be adapted to check whether (îˆ³,îˆ´,ğ›±) has a ğœ†-extension, in case îˆ´ is connected. In this section, we show how to adapt the distance model to extend partial ğœ†-drawings, including the case îˆ´ is disconnected. Recall that the distance label of a vertex v is its x-coordinate. A partial ğœ†-drawing fixes the x-coordinates of the vertices of îˆ´. The idea is to express this with additional constraints in ğ·ğœ†îˆ³. Let ğ‘£ref be a vertex of îˆ´. In a ğœ†-extension of (îˆ³,îˆ´,ğ›±), the relative distance along the x-axis between a vertex v of îˆ´ and vertex ğ‘£ref should be ğ‘‘ğ‘£=ğ›±(ğ‘£ref)âˆ’ğ›±(ğ‘£). This can be achieved by adding an edge (ğ‘£,ğ‘£ref) with weight ğ‘‘ğ‘£ and an edge (ğ‘£ref,ğ‘£) with weight âˆ’ğ‘‘ğ‘£. The first edge ensures that it is ğ‘¥(ğ‘£ref)â‰¤ğ‘¥(ğ‘£)+ğ‘‘ğ‘£, i.e., ğ‘¥(ğ‘£)â‰¥ğ‘¥(ğ‘£ref)âˆ’ğ‘‘ğ‘£ and the second edge ensures ğ‘¥(ğ‘£)â‰¤ğ‘¥(ğ‘£ref)âˆ’ğ‘‘. Together, this gives ğ‘¥(ğ‘£)=ğ‘¥(ğ‘£ref)âˆ’ğ‘‘ğ‘£. Let ğ·ğœ†îˆ³,ğ›± be ğ·ğœ†îˆ³ augmented by the edges {(ğ‘£,ğ‘£ref),(ğ‘£ref,ğ‘£):âˆ€ğ‘£âˆˆîˆ´} with weights as described above.

To decide existence of ğœ†-extension and in affirmative construct the corresponding drawing we compute the shortest distance labeling in ğ·ğœ†îˆ³,ğ›±. Observe that this network can contain negative cycles and therefore no shortest distance labeling. Unfortunately, ğ·ğœ†îˆ³,ğ›± is not planar, and thus we cannot use the embedding-based algorithm of Mozes and Wulff-Nilsen. However, since all newly introduced edges have ğ‘£ref as one endpoint, ğ‘£ref is an apex of ğ·ğœ†îˆ³, i.e., removing ğ‘£ref from ğ·ğœ†îˆ³,ğ›± makes it planar. Therefore ğ·ğœ†îˆ³,ğ›± can be recursively separated by separators of size ğ‘‚(ğ‘›âˆš). The ğ‘‚(ğ‘›4/3logğ‘›)-time shortest-path algorithm by Henzinger et al. [22] relies not on planarity but only on ğ‘‚(ğ‘›âˆš)-sized separators [19, page 869]. So, run this algorithm to compute the shortest distance labeling of ğ·ğœ†îˆ³,ğ›±.

Theorem 3
Let (îˆ³,îˆ´,ğ›±) be a partial ğœ†-drawing. In ğ‘‚(ğ‘›4/3logğ‘›) time it can be determined whether (îˆ³,îˆ´,ğ›±) has a ğœ†-extension and in the affirmative the corresponding drawing can be computed within the same running time.

Simultaneous Drawings
In the simultaneous ğœ†-drawing problem, we are given a tuple (îˆ³1,îˆ³2) of two embedded level-planar graphs that share a common subgraph îˆ³1âˆ©2=îˆ³1âˆ©îˆ³2. We assume w.l.o.g. that ğº1 and ğº2 share the same right boundary and that the embeddings of îˆ³1 and îˆ³2 coincide on îˆ³1âˆ©2. The task is to determine whether there exist ğœ†-drawings ğ›¤1,ğ›¤2 of îˆ³1,îˆ³2, respectively, so that ğ›¤1 and ğ›¤2 coincide on the shared graph îˆ³1âˆ©2. The approach is the following. Start by computing the ğœ†-rightmost drawings of îˆ³1 and îˆ³2. Then, as long as these drawings do not coincide on îˆ³1âˆ©2 add necessary constraints to ğ·ğœ†îˆ³1 and ğ·ğœ†îˆ³2. This process terminates after a polynomial number of iterations, either by finding a simultaneous ğœ†-drawing, or by determining that no such drawing exist.

Finding the necessary constraints works as follows. Suppose that ğ›¤1,ğ›¤2 are the ğœ†-rightmost drawings of îˆ³1,îˆ³2, respectively. Because both îˆ³1 and îˆ³2 have the same right boundary they both contain vertex ğ‘£right. We define the coordinates in the distance labelings of ğ·ğœ†îˆ³1 and ğ·ğœ†îˆ³2 in terms of this reference vertex.

Now suppose that for some vertex v of îˆ³1âˆ©2 the x-coordinates in ğ›¤1 and ğ›¤2 differ, i.e., it is ğ›¤1(ğ‘£)â‰ ğ›¤2(ğ‘£). Assume ğ›¤1(ğ‘£)<ğ›¤2(ğ‘£) without loss of generality. Because ğ›¤1 is a rightmost drawing, there exists no drawing of îˆ³1 where v has an x-coordinate greater than ğ›¤1(ğ‘£). In particular, there exist no simultaneous drawings where v has an x-coordinate greater than ğ›¤1(ğ‘£). Therefore, we must search for a simultaneous drawing where ğ›¤2(ğ‘£)â‰¤ğ›¤1(ğ‘£). We can enforce this constraint by adding an edge (ğ‘£right,ğ‘£) with weight ğ›¤1(ğ‘£) into ğ·ğœ†îˆ³2. We then attempt to compute the drawing ğ›¤2 of îˆ³2 defined by the shortest distance labeling in ğ·ğœ†îˆ³2. This attempt produces one of two possible outcomes. The first possibility is that there now exists a negative cycle in ğ·ğœ†îˆ³2. This means that there exists no drawing ğ›¤2 of ğº2 with ğ›¤2(ğ‘£)â‰¤ğ›¤(ğ‘£). Because ğ›¤1 is a rightmost drawing, this means that no simultaneous drawings of îˆ³1 and îˆ³2 exist. The algorithm then terminates and rejects this instance. The second possibility is that we obtain a new drawing ğ›¤2. This drawing is rightmost among all drawings that satisfy the added constraint ğ›¤2(ğ‘£)â‰¤ğ›¤1(ğ‘£). In this case there are again two possibilities. Either we have ğ›¤1(ğ‘£)=ğ›¤2(ğ‘£) for each vertex v in îˆ³1âˆ©2. In this case ğ›¤1 and ğ›¤2 are simultaneous drawings and the algorithm terminates. Otherwise there exists at least one vertex w in îˆ³1âˆ©2 with ğ›¤1(ğ‘¤)â‰ ğ›¤2(ğ‘¤). We then repeat the procedure just described for adding a new constraint.

We repeat this procedure of adding other constraints. To bound the number of iterations, recall that we only consider compact drawings, i.e., drawings whose width is at most (ğœ†âˆ’1)(ğ‘›âˆ’1). In each iteration the x-coordinate of at least one vertex is decreased by at least one. Therefore, each vertex is responsible for at most (ğœ†âˆ’1)(ğ‘›âˆ’1) iterations. The total number of iterations is therefore bounded by ğ‘›(ğœ†âˆ’1)(ğ‘›âˆ’1)âˆˆğ‘‚(ğœ†ğ‘›2).

Note that due to the added constraints ğ·ğœ†îˆ³1 and ğ·ğœ†îˆ³2 are generally not planar. However, all newly inserted arcs are incident to ğ‘£right, so ğ‘£right is an apex of ğ·ğœ†îˆ³ğ‘– for ğ‘–=1,2. As in the previous section, we apply the ğ‘‚(ğ‘›4/3logğ‘›)-time shortest-path algorithm by Henzinger et al. to compute the shortest distance labelings. This gives the following.

Theorem 4
Let îˆ³1,îˆ³2 be embedded level-planar graphs that share a common subgraph îˆ³1âˆ©2. In ğ‘‚(ğœ†ğ‘›10/3logğ‘›) time it can be determined whether îˆ³1,îˆ³2 admit simultaneous ğœ†-drawings and if so, such drawings can be computed within the same running time.

Complexity of the General Case
So far, we have considered ğœ†-DRAWABILITY problem for proper level graphs, i.e., level graphs where all edges have length one. In this section, we consider the general case, where edges may have arbitrary lengths. We say that an edge with length two or more is long. One approach would be to try to adapt the flow model from Sect. 3 to this more general case. By subdividing long edges, any level graph G can be transformed into a proper level graph ğºâ€². Observe that two edges in ğºâ€² created by subdividing the same long edge must have the same slope in order to yield a fixed-slope drawing of G. In the context of our flow model, this means that the amount of flow across the corresponding slope arcs must be the same. Our problem then becomes an instance of the integer equal flow problem. In this problem, we are given a flow network along with disjoint sets ğ‘…1,ğ‘…2,â€¦,ğ‘…ğ‘¡ of arcs. The task is to find the maximum flow from s to t such that the amount of flow across arcs in the same set ğ‘…ğ‘– is the same. This problem was introduced and shown to be NP-hard by Sahni [41]. The problem remains NP-hard in special cases [18, 42] and the integrality gap of the fractional LP can be arbitrarily large [34].

In this section we show that ğœ†-DRAWABILITY NP-complete even for ğœ†=2, biconnected graphs where all edges have length one or two. To this end, we present a reduction from rectilinear planar monotone 3-SAT [12]. An instance of this problem consists of a set of variables X and a set of clauses C. A clause is positive (negative) when it consists of only positive (negative) literals. We say that the instance is monotone when each clause is either positive or negative. The corresponding variable-clause graph consists of the vertices ğ‘‹âˆªğ¶ and each undirected edge {ğ‘¥,ğ‘} where ğ‘¥âˆˆğ‘‹ is a variable that appears in clause ğ‘âˆˆğ¶. The variable-clause graph admits a planar drawing such that (i) the variables are aligned along a virtual horizontal line â„“ğ‘‹, (ii) positive clauses are drawn as vertices above â„“ğ‘‹, and symmetrically (iii)negative clauses are drawn as vertices below â„“ğ‘‹. See Fig. 6.

Fig. 6
figure 6
An instance of planar monotone 3-SAT

Full size image
Our reduction works by first replacing every vertex that corresponds to a variable by a variable gadget and every vertex that corresponds to a positive (negative) clause by a positive (negative) clause gadget. All three gadgets consist of fixed and movable parts. The fixed parts only admit one level-planar two-slope drawing, whereas the movable parts admit two or more drawings depending on the choice of slope for some edges. Second, the gadgets are connected by a common fixed frame. All fixed parts of the gadgets are connected to the common frame in order to provide a common point of reference. The movable parts of the gadgets then interact in such a way that any level-planar two-slope drawing induces a solution to the underlying planar monotone 3-SAT instance.

Fig. 7
figure 7
The variable gadget drawn in the â€œtrueâ€ configuration (a) and the â€œfalseâ€ configuration (b)

Full size image
The variable gadget consists of a number of connectors arranged around a fixed horizontal line that connects all variable gadgets along the virtual line of variables â„“ğ‘‹. See Fig. 7, where the fixed structure is shaded in gray. Vertices drawn as squares are fixed, i.e., they cannot change their position relative to other vertices drawn as squares. Vertices drawn as circles are movable, i.e., they can change their position relative to vertices drawn as squares. The line of variables â„“ğ‘‹ extends from the the square vertices on the left and right boundaries of the drawing. Every connector consists of two pins: the movable assignment pin and the fixed reference pin. The variable gadget in Fig. 7 features four connectors: two above the horizontal line and two below the horizontal line. Assignment pins are shaded in yellow and reference pins are shaded in gray. The relative position of the assignment pin and the reference pin of one connector encodes the truth assignment of the underlying variable. Moreover, the reference pin allows the fixed parts of the clause gadgets to be connected to the variable gadgets and thereby to the common frame. Comparing Fig. 7a and b, observe how the relative position of the two pins of each connector changes depending on the truth assignment of the underlying variable. The key structure of the variable gadget is that the position of the assignment pins of one variable gadget are coordinated by long edges. In Fig. 7, long edges are drawn as thick lines. Changing the slope of these long edges moves all assignment pins above the horizontal line in one direction and all assignment pins below the horizontal line in the reverse direction. In this way, all connectors encode the same truth assignment of the underlying variable. Note that we can introduce as many connectors as needed for any one variable.

The positive clause gadget consists of a fixed boundary, a movable wiggle and three assignment pin endings. See Fig. 8, where the fixed boundary is shaded in gray, the wiggle is highlighted in blue and the assignment pin endings are highlighted in yellow.

Fig. 8
figure 8
The positive clause gadget when the drawing when at least one variable is assigned to true (aâ€“c). No planar drawing exists when all variables are assigned to false (d), because this leads to intersections, e.g., at the vertices marked in red

Full size image
Fig. 9
figure 9
The negative clause gadget when at least one variable is assigned to false (aâ€“c). No drawing exists when all variables are assigned to true (d), because this leads to intersections, e.g., at the vertices marked in red. Note the symmetry to the positive clause gadget in Fig. 8

Full size image
The fixed boundary is connected to the reference pin of the variable gadget that is rightmost among the connected variable gadgets. Because the variable gadgets are fixed to the common frame, the boundary of the positive clause gadget is also connected to the common frame. The assignment pin endings are connected to assignment pins of connectors of the corresponding variable gadgets. The idea of the positive clause gadget is that the wiggle has to wiggle through the space bounded by the assignment pin endings on the left and the fixed boundary on the right. Recall that the assignment pins change their horizontal position depending on the truth assignment of their underlying variables. The positive clause gadget is designed so that the wiggle can always be drawn, except for the case when all variables are assigned to false. See Fig. 8aâ€“c, which shows the three possible situations when exactly one variable is assigned to true. In any case where at least one variable is assigned to true the wiggle can be drawn in one of the three ways shown. However, as shown in Fig. 8d, the wiggle cannot be drawn in the case where all variables are assigned to false. The reason for this is that the the assignment pin endings get so close to the fixed boundary that they leave too little space for the wiggle to be drawn. This means that some vertices must intersect, for example those shown in red in Fig. 8d.

The negative clause gadgets works very similarly. It is drawn below the horizontal line of variables and it forces at least one of the incident variable gadgets to be configured as false. See Fig. 9 which shows admissible drawings (aâ€“c) and that the case when all incident variables are configured as true cannot occur (d). Note that this uses the design of the variable gadget that the assignment and reference pins below the horizontal line are closer when the variable is assigned to true (i.e., the inverse situation compared to the situation above the horizontal line).

It is evident that any level-planar two-slope drawing of the resulting graph induces a solution of the underlying planar monotone 3-SAT problem and vice versa. Note that the variable gadgets become biconnected when embedded into the common frame and that the clause gadgets are biconnected by design. Furthermore, all long edges have length two. We therefore conclude the following.

Theorem 5
ğœ†-DRAWABILITY is NP-complete even for ğœ†=2 and biconnected graphs where all edges have length one or two.

Conclusion
In this paper we studied ğœ†-drawings, i.e., level-planar drawings with ğœ† slopes. We model ğœ†-drawings of proper level-planar graphs as integer flow networks. This lets us compute ğœ†-drawings and extend connected partial ğœ†-drawings in ğ‘‚(ğ‘›log3ğ‘›) time. We extend the duality between integer flows in a primal graph and shortest distances in its dual to obtain a more powerful distance model. This distance model lets us find ğœ†-drawings in ğ‘‚(ğ‘›log2ğ‘›/loglogğ‘›) time, extend not-necessarily-connected partial ğœ†-drawings in ğ‘‚(ğ‘›4/3logğ‘›) time and find simultaneous ğœ†-drawings in ğ‘‚(ğœ†ğ‘›10/3logğ‘›) time.

In the non proper case, testing the existence of a 2-drawing becomes NP-hard, even for biconnected graphs with maximum edge length two. This leaves little room to extend our polynomial-time algorithms for more general classes of level-planar graphs with fixed embedding.

An interesting problem that remains open is that of finding ğœ†-drawings when the embedding is not fixed. For orthogonal drawings, the SPQR-tree played a key role in going from optimizing a given fixed embedding [43] to optimizing across all possible embeddings of a graph [7]. A recent SPQR-tree-like embedding representation for level planarity [11] might enable a similar leap for ğœ†-drawings.