Automated affective computing in the wild setting is a challenging problem in computer vision. Existing annotated databases of facial expressions in the wild are small and mostly cover discrete emotions (aka the categorical model). There are very limited annotated facial databases for affective computing in the continuous dimensional model (e.g., valence and arousal). To meet this need, we collected, annotated, and prepared for public distribution a new database of facial emotions in the wild (called AffectNet). AffectNet contains more than 1,000,000 facial images from the Internet by querying three major search engines using 1,250 emotion related keywords in six different languages. About half of the retrieved images were manually annotated for the presence of seven discrete facial expressions and the intensity of valence and arousal. AffectNet is by far the largest database of facial expression, valence, and arousal in the wild enabling research in automated facial expression recognition in two different emotion models. Two baseline deep neural networks are used to classify images in the categorical model and predict the intensity of valence and arousal. Various evaluation metrics show that our deep neural network baselines can perform better than conventional machine learning methods and off-the-shelf facial expression recognition systems.
SECTION 1Introduction
Affect is a psychological term used to describe the outward expression of emotion and feelings. Affective computing seeks to develop systems and devices that can recognize, interpret, and simulate human affects through various channels such as face, voice, and biological signals [1]. Face and facial expressions are undoubtedly one of the most important nonverbal channels used by the human being to convey internal emotion.

There have been tremendous efforts to develop reliable automated Facial Expression Recognition (FER) systems for use in affect-aware machines and devices. Such systems can understand human emotion and interact with users more naturally. However, current systems have yet to reach the full emotional and social capabilities necessary for building rich and robust Human Machine Interaction (HMI). This is mainly due to the fact that HMI systems need to interact with humans in an uncontrolled environment (aka wild setting) where the scene lighting, camera view, image resolution, background, users head pose, gender, and ethnicity can vary significantly. More importantly, the data that drives the development of affective computing systems and particularly FER systems lack sufficient variations and annotated samples that can be used in building such systems.

There are several models in the literature to quantify affective facial behaviors: 1) categorical model, where the emotion/affect is chosen from a list of affective-related categories such as six basic emotions defined by Ekman et al. [2], 2) dimensional model, where a value is chosen over a continuous emotional scale, such as valence and arousal [3] and 3) Facial Action Coding System (FACS) model, where all possible facial actions are described in terms of Action Units (AUs) [4]. FACS model explains facial movements and does not describe the affective state directly. There are several methods to convert AUs to affect space (e.g., EMFACS [5] states that the occurrence of AU6 and AU12 is a sign of happiness). In the categorical model, mixed emotions cannot adequately be transcribed into a limited set of words. Some researchers tried to define multiple distinct compound emotion categories (e.g., happily surprised, sadly fearful) [6] to overcome this limitation. However, still the set is limited, and the intensity of the emotion cannot be defined in the categorical model. In contrast, the dimensional model of affect can distinguish between subtly different displays of affect and encode small changes in the intensity of each emotion on a continuous scale, such as valence and arousal. Valence refers to how positive or negative an event is, and arousal reflects whether an event is exciting/agitating or calm/soothing [3]. Fig. 1 shows samples of facial expressions represented in the 2D space of valence and arousal. As it is shown, there are several different kinds of affect and small changes in the same emotion that cannot be easily mapped into a limited set of terms existing in the categorical model.


Fig. 1.
Sample images in valence arousal circumplex.

Show All

The dimensional model of affect covers both intensity and different emotion categories in the continuous domain. Nevertheless, there are relatively fewer studies on developing automated algorithms in measuring affect using the continuous dimensional model (e.g., valence and arousal). One of the main reasons is that creating a large database to cover the entire continuous space of valence and arousal is expensive and there are very limited annotated face databases in the continuous domain. This paper contributes to the field of affective computing by providing a large annotated face database of the dimensional as well as the categorical models of affect.

The majority of the techniques for automated affective computing and FER are based on supervised machine learning methodologies. These systems require annotated image samples for training. Researchers have created databases of human actors/subjects portraying basic emotions [7], [8], [9], [10], [11]. Most of these databases mainly contain posed expressions acquired in a controlled lab environment. However, studies show that posed expressions can be different from unposed expressions in configuration, intensity, and timing [12], [13]. Some researchers captured unposed facial behavior while the subject is watching a short video [14], [15], engaged in laboratory-based emotion inducing tasks [16], or interacted with a computer-mediated tutoring system [17]. Although a large number of frames can be obtained by these approaches, the diversity of these databases is limited due to the number of subjects, head position, and environmental conditions.

Recently, databases of facial expression and affect in the wild received much attention. These databases are either captured from movies or the Internet, and annotated with categorical model [18], [19], [20], dimensional model [21], and FACS model [22]. However, they only cover one model of affect, have a limited number of subjects, or contain few samples of certain emotions such as disgust. Therefore, a large database, with a large amount of subject variations in the wild condition that covers multiple models of affect (especially the dimensional model) is a need.

To address this need, we created a database of facial Affect from the InterNet (called AffectNet) by querying different search engines (Google, Bing, and Yahoo) using 1,250 emotion related tags in six different languages (English, Spanish, Portuguese, German, Arabic, and Farsi). AffectNet contains more than one million images with faces and extracted facial landmark points. Twelve human experts manually annotated 450,000 of these images in both categorical and dimensional (valence and arousal) models and tagged the images that have any occlusion on the face. Fig. 1 shows sample images from AffectNet and their valence and arousal annotations.

To calculate the agreement level between the human labelers, 36,000 images were annotated by two human labelers. AffectNet is by far the largest database of facial affect in still images which covers both categorical and dimensional models. The cropped region of the facial images, the facial landmark points, and the affect labels will be publicly available to the research community.1 Considering the lack of in-the-wild large facial expressions datasets and more specifically annotated face datasets in the continuous domain of valence and arousal, AffectNet is a great resource which will enable further progress in developing automated methods for facial behavior computing in both the categorical and continuous dimensional spaces.

The rest of this paper is organized as follows. Section 2 reviews the existing databases and state-of-the-art methods for facial expression recognition with emphasis on the dimensional model and in the wild setting databases. Section 3 explains the process of collecting AffectNet images from the Internet and annotating the categorical and dimensional models. Section 4 presents two different baselines for automatic recognition of categorical emotions and prediction of dimensional valence and arousal in the continuous space using AffecNet images. Finally Section 5 concludes the paper.

SECTION 2Related Work
2.1 Existing Databases
Early databases of facial expressions such as JAFFE [7], Cohn-Kanade [8], [9], MMI [10], and MultiPie [11] were captured in a lab-controlled environment where the subjects portrayed different facial expressions. This approach resulted in a clean and high-quality database of posed facial expressions. However, posed expressions may differ from daily life unposed (aka spontaneous) facial expressions. Thus, capturing spontaneous expression became a trend in the affective computing community. Examples of these environments are recording the responses of participants’ faces while watching a stimuli (e.g., DISFA [14], AM-FED [15]) or performing laboratory-based emotion inducing tasks (e.g., Belfast [16]). These databases often capture multi-modal affects such as voice, biological signals, etc. and usually a series of frames are captured that enable researchers to work on temporal and dynamic aspects of expressions. However, the diversity of these databases is limited due to the number of subjects, head pose variation, and environmental conditions.

Hence there is a demand to develop systems that are based on natural, unposed facial expressions. To address this demand, recently researchers paid attention to databases in the wild. Dhall et al. [18] released Acted Facial Expressions in the Wild (AFEW) from 54 movies by a recommender system based on subtitles. The video clips were annotated with six basic expressions plus neutral. AFEW contains 330 subjects aged 1-77 years and addresses the issue of temporal facial expressions in the wild. A static subset (SFEW [27]) is created by selecting some frames of AFEW. SFEW covers unconstrained facial expressions, different head poses, age range, occlusions, and close to real world illuminations. However, it contains only 700 images, and there are only 95 subjects in the database.

The Facial Expression Recognition 2013 (FER-2013) database was introduced in the ICML 2013 Challenges in Representation Learning [19]. The database was created using the Google image search API that matched a set of 184 emotion-related keywords to capture the six basic expressions as well as the neutral expression. Images were resized to 48 × 48 pixels and converted to grayscale. Human labelers rejected incorrectly labeled images, corrected the cropping if necessary, and filtered out some duplicate images. The resulting database contains 35,887 images most of which are in the wild settings. FER-2013 is currently the biggest publicly available facial expression database in the wild settings, enabling many researchers to train machine learning methods such as Deep Neural Networks (DNNs) where large amounts of data are needed. In FER-2013, the faces are not registered, a small number of images portray disgust (547 images), and unfortunately most of facial landmark detectors fail to extract facial landmarks at this resolution and quality. In addition, only the categorical model of affect is provided with FER-2013.

The Affectiva-MIT Facial Expression Dataset (AM-FED) database [15] contains 242 facial videos (160K frames) of people watching Super Bowl commercials using their webcam. The recording conditions were arbitrary with different illumination and contrast. The database was annotated frame-by-frame for the presence of 14 FACS action units, head movements, and automatically detected landmark points. AM-FED is a great resource to learn AUs in the wild. However, there is not a huge variance in head pose (limited profiles), and there are only a few subjects in the database.

The FER-Wild [20] database contains 24,000 images that are obtained by querying emotion-related terms from three search engines. The OpenCV face recognition was used to detect faces in the images, and 66 landmark points were found using Active Appearance Model (AAM) [28] and a face alignment algorithm via regression local binary features [29], [30]. Two human labelers annotated the images into six basic expressions and neutral. Comparing with FER-2013, FER-Wild images have a higher resolution with facial landmark points necessary to register the images. However, still a few samples portray some expressions such as disgust and fear and only the categorical model of affect is provided with FER-Wild.

The EmotioNet [22] consists of one million images of facial expressions downloaded from the Internet by selecting all the words derived from the word “feeling” in WordNet [31]. Face detector [32] was used to detect faces in these images and the authors visually inspected the resultant images. These images were then automatically annotated with AUs and AU intensities by an approach based on Kernel Subclass Discriminant Analysis (KSDA) [33]. The KSDA-based approach was trained with Gabor features centered on facial landmark with a Radial Basis Function (RBF) kernel. Images were labeled as one of the 23 (basic or compound) emotion categories defined in [6] based on AUs. For example, if an image has been annotated as having AUs 1, 2, 12 and 25, it is labeled as happily surprised. A total of 100,000 images (10 percent of the database) were manually annotated with AUs by experienced coders. The proposed AU detection approach was trained on CK+ [9], DISFA [14], and CFEE [34] databases, and the accuracy of the automated annotated AUs was reported about 80 percent on the manually annotated set. EmotioNet is a novel resource of FACS model in the wild with a large amount of subject variation. However, it lacks the dimensional model of affect, and the emotion categories are defined based on annotated AUs and not manually labeled.

On the other hand, some researchers developed databases of the dimensional model in the continuous domain. These databases, however, are limited since the annotation of continuous dimensions is more expensive and necessitate trained annotators. Examples of these databases are Belfast [16], RECOLA [25], Affectiva-MIT Facial Expression Dataset (AM-FED) [15], and recently published Aff-Wild Database [21] which is the only database of dimensional model in the wild.

The Belfast database [16] contains recordings (5s to 60s in length) of mild to moderate emotional responses of 60 participants to a series of laboratory-based emotion inducing tasks (e.g., surprise response by setting off a loud noise when the participant is asked to find something in a black box). The recordings were labeled by information on self-report of emotion, the gender of the participant/experimenter, and the valence in the continuous domain. The arousal dimension was not annotated in Belfast database. While the portrayed emotions are natural and spontaneous, the tasks have taken place in a relatively artificial setting of a laboratory where there was a control on lighting conditions, head poses, etc.

The Database for Emotion Analysis using Physiological Signals (DEAP) [26] consists of spontaneous reactions of 32 participants in response to one-minute long music video clip. The EEG, peripheral physiological signals, and frontal face videos of participants were recorded, and the participants rated each video in terms of valence, arousal, like/dislike, dominance, and familiarity. Correlations between the EEG signal frequencies and the participants ratings were investigated, and three different modalities, i.e., EEG signals, peripheral physiological signals, and multimedia features on video clips (such as lighting key, color variance, etc.) were used for binary classification of low/high arousal, valence, and liking. DEAP is a great database to study the relation of biological signals and dimensional affect, however, it has only a few subjects and the videos are captured in lab controlled settings.

The RECOLA benchmark [25] contains videos of 23 dyadic teams (46 participants) that participated in a video conference completing a task which required collaboration. Different multi-modal data of the first five minutes of interaction, i.e., audio, video, ECG and EDA) were recorded continuously and synchronously. Six annotators measured arousal and valence. The participants reported their arousal and valence through the Self-Assessment Manikin (SAM) [35] questionnaire before and after the task. RECOLA is a great database of the dimensional model with multiple cues and modalities, however, it contains only 46 subjects and the videos were captured in the lab controlled settings.

Audio-Visual Emotion recognition Challenge (AVEC) series of competitions [36], [37], [38], [39], [40], [41] provided a benchmark of automatic audio, video and audiovisual emotion analysis in continuous affect recognition. AVEC 2011, 2012, 2013, and 2014 used videos from the SEMAINE [42] database videos. Each video is annotated by a single rater for every dimension using a two-axis joystick. AVEC 2015 and 2016 used the RECOLA benchmark in their competitions. Various continuous affect recognition dimensions were explored in each challenge year such as valence, arousal, expectation, power, and dominance, where the prediction of valence and arousal are studied in all challenges.

The Aff-Wild Database [21] is by far the largest database for measuring continuous affect in the valence-arousal space “in-the-wild”. More than 500 videos from YouTube were collected. Subjects in the videos displayed a number of spontaneous emotions while watching a particular video, performing an activity, and reacting to a practical joke. The videos have been annotated frame-by-frame by three human raters, utilizing a joystick-based tool to rate valence and arousal. Aff-Wild is a great database of dimensional modeling in the wild that considers the temporal changes of the affect, however, it has a small subject variance, i.e., it only contains 500 subjects.

Table 1 summarizes the characteristics of the reviewed databases in all three models of affect, i.e., categorical model, dimensional model, and Facial Action Coding System (FACS).

TABLE 1 The Summary and Characteristics of Reviewed Databases in Affect Recognition

2.2 Evaluation Metrics
There are various evaluation metrics in the literature to measure the reliability of annotation and automated affective computing systems. Accuracy, F1-score [49], Cohens kappa [50], Krippendorfs Alpha [51], ICC [52], area under the ROC curve (AUC), and area under Precision-Recall curve (AUC-PR) [53] are well-defined widely used metrics for evaluation of the categorical and FACS-based models. Since, the dimensional model of affect is usually evaluated in a continuous domain, different evaluation metrics are necessary. In the following, we review several metrics that are used in the literature for evaluation of dimensional model.

Root Mean Square Error (RMSE) is the most common evaluation metric in a continuous domain which is defined as
RMSE=1n∑i=1n(θ^i−θi)2−−−−−−−−−−−−√,(1)
View Sourcewhere θ^i and θi are the prediction and the ground truth of ith sample, and n is the number of samples in the evaluation set. RMSE-based evaluation can heavily weigh the outliers [54], and it is not able to provide the covariance of prediction and ground-truth to show how they change with respect to each other. Pearsons correlation coefficient is therefore proposed in some literature [24], [36], [37] to overcome this limitation
CC=COV{θ^,θ}σθ^σθ=E[(θ^−μθ^)(θ−μθ)]σθ^σθ.(2)
View Source

Concordance Correlation Coefficient (CCC) is another metric [40], [41] which combines the Pearsons correlation coefficient (CC) with the square difference between the means of two compared time series
ρc=2ρσθ^σθσ2θ^+σ2θ+(μθ^−μθ)2,(3)
View Sourcewhere ρ is the Pearson correlation coefficient between two time-series (e.g., prediction and ground-truth), σ2θ^ and σ2θ are the variance of each time series, and μθ^ and μθ are the mean value of each. Unlike CC, the predictions that are well correlated with the ground-truth but shifted in value are penalized in proportion to the deviation in CCC.

The value of valence and arousal are [−1,+1] and their signs are essential in many emotion-prediction applications. For example, if the ground-truth valence is +0.3, prediction of +0.7 is far better than prediction of −0.1, since +0.7 indicates a positive emotion similar to the ground-truth (despite both predictions have the same RMSE). Sign Agreement Metric (SAGR) is another metric that is proposed in [24] to evaluate the performance of a valence and arousal prediction system. SAGR is defined as
SAGR=1n∑i=1nδ(sign(θ^i),sign(θi)),(4)
View SourceRight-click on figure for MathML and additional features.where δ is the Kronecker delta function, defined as
δ(a,b)={1,0,a=ba≠b(5)
View Source

The above discussed metrics are used to evaluate the categorical and dimensional baselines on AffectNet in Section 4.

2.3 Existing Algorithms
Affective computing is now a well-established field, and there are many algorithms and databases for developing automated affect perception systems. Since it is not possible to include all those great works, we only give a brief overview and cover the state-of-the-art methods that are applied on the databases explained in Section 2.1.

Conventional algorithms of affective computing from faces use hand-crafted features such as pixel intensities [55], Gabor filters [56], Local Binary Patterns (LBP) [44], and Histogram of Oriented Gradients (HOG) [14]. These hand-crafted features often lack enough generalizability in the wild settings where there is a high variation in scene lighting, camera view, image resolution, background, subjects head pose and ethnicity.

An alternative approach is to use Deep Neural Networks (DNN) to learn the most appropriate feature abstractions directly from the data and handle the limitations of hand-crafted features. DNNs have been a recent successful approach in visual object recognition [57], human pose estimation [58], face verification [59] and many more. This success is mainly due to the availability of computing power and existing big databases that allow DNNs to extract highly discriminative features from the data samples. There have been enormous attempts on using DNNs in automated facial expression recognition and affective computing [20], [43], [46], [47], [48] that are especially very successful in the wild settings.

Table 2 shows a list of the state-of-the-art algorithms and their performance on the databases listed in Table 1. As shown in the table, the majority of these approaches have used DNNs to learn a better representation of affect, especially in the wild settings. Even some of the approaches, such as the winner of the AVEC 2015 challenge [46], trained a DNN with hand-crafted features and still could improve the prediction accuracy.

TABLE 2 State-of-the-Art Algorithms and Their Performance on the Databases Listed in Table 1

SECTION 3AffectNet
Affect from the InterNet is the largest database of the categorical and dimensional models of affect in the wild (as shown in Table 1). The database is created by querying emotion related keywords from three search engines and annotated by expert human labelers. In this section, the process of querying the Internet, processing facial images and extracting facial landmarks, and annotating facial expression, valence, and arousal of affect are discussed.

3.1 Facial Images from the Web
Emotion-related keywords were combined with words related to gender, age, or ethnicity, to obtain nearly 362 strings in the English language such as “joyful girl”, “blissful Spanish man”, “furious young lady”, “astonished senior”. These keywords are then translated into five other languages: Spanish, Portuguese, German, Arabic and Farsi. The direct translation of queries in English to other languages did not accurately result in the intended emotions since each language and culture has differing words and expressions for different emotions. Therefore, the list of English queries was provided to native non-English speakers who were proficient in English, and they created a list of queries for each emotion in their native language and inspected the quality of the results visually. The criteria for high-quality queries were those that returned a high percentage of human faces showing the intended queried emotions rather than drawings, graphics, or non-human objects. A total of 1,250 search queries were compiled and used to crawl the search engines in our database. Since a high percentage of results returned by our query terms already contained neutral facial images, no individual query was performed to obtain additional neutral face.

Three search engines (Google, Bing, and Yahoo) were queried with these 1,250 emotion related tags. Other search engines such as Baidu and Yandex were considered. However, they either did not produce a large number of facial images with intended expressions or they did not have available APIs for automatically querying and pulling image URLs into the database. Additionally, queries were combined with negative terms (e.g., “drawing”, “cartoon”, “animation”, “birthday”, etc.) to avoid non-human objects as much as possible. Furthermore, since the images of stock photo websites are posed unnaturally and contain watermarks mostly, a list of popular stock photo websites was compiled and the results returned from the stock photo websites were filtered out.

A total of ∼1,800,000 distinct URLs returned for each query were stored in the database. The OpenCV face recognition was used to obtain bounding boxes around each face. A face alignment algorithm via regression local binary features [29], [30] was used to extract 66 facial landmark points. The facial landmark localization technique was trained using the annotations provided from the 300 W competition [60]. More than 1M images containing at least one face with extracted facial landmark points were kept for further processing.

The average image resolution of faces in AffectNet are 425×425 with STD of 349×349 pixels. We used Microsoft cognitive face API to extract these facial attributes on 50,000 randomly selected images from the database. According to MS face API, 49 percent of the faces are men. The average estimated age of the faces is 33.01 years with the standard deviation of 16.96 years. In particular, 10.85, 3.9, 30.19, 26.86, 14.46, and 13.75 percent of the faces are in age ranges [0, 10), [10, 20), [20, 30), [30, 40), [40, 50) and [50, -), respectively. MS face API detected forehead, mouth, and eye occlusions in 4.5, 1.08, and 0.49 percent of the images, respectively. Also, 9.63 percent of the faces wear glasses, 51.07 and 41.4 percent of the faces have eye and lip make-ups, respectively. In terms of head pose, the average estimated pitch, yaw, roll are 0.0, −0.7, and −1.19 degrees, respectively.

3.2 Annotation
Crowd-sourcing services like Amazon Mechanical Turk are fast, cheap and easy approaches for labeling large databases. The quality of labels obtained from crowd-sourcing services, however, varies considerably among the annotators. Due to these issues and the fact that annotating the valence and arousal requires a deep understanding of the concept, we avoided crowd-sourcing facilities and instead hired 12 full-time and part-time annotators at the University of Denver to label the database. A total of 450,000 images were given to these expert annotators to label the face in the images into both discrete categorical and continuous dimensional (valence and arousal) models. Due to time and budget constraints each image was annotated by one annotator.

A software application was developed to annotate the categorical and dimensional (valence and arousal) models of affect. Fig. 2 shows a screen-shot of the annotation application. A comprehensive tutorial including the definition of the categorical and dimensional models of affect with some examples of each category, valence and arousal was given to the annotators. Three training sessions were provided to each annotator, in which the annotator labeled the emotion category, valence and arousal of 200 images and the results were reviewed with the annotators. Necessary feedback was given on both the categorical and dimensional labels. In addition, the annotators tagged the images that have any occlusion on the face. The occlusion criterion was defined as if any part of the face was not visible. If the person in the images wore glasses, but the eyes were visible without any shadow, it was not considered as occlusion.


Fig. 2.
A screen-shot of the software application used to annotate categorical and dimensional (valence and arousal) models of affect and the osculation tag if existing. Only one detected face in each image is annotated (shown in the green bounding box).

Show All

3.2.1 Categorical Model Annotation
Eleven discrete categories were defined in the categorical model of AffectNet as: Neutral, Happy, Sad, Surprise, Fear, Anger, Disgust, Contempt, None, Uncertain, and Non-face. The None (“None of the eight emotions”) category is the type of expression/emotions (such as sleepy, bored, tired, seducing, confuse, shame, focused, etc.) that could not be assigned by annotators to any of the six basic emotions, contempt or neutral. However, valence and arousal could be assigned to these images. The Non-face category was defined as images that: 1) Do not contain a face in the image; 2) Contain a watermark on the face; 3) The face detection algorithm fails and the bounding box is not around the face; 4) The face is a drawing, animation, or painted; and 5) The face is distorted beyond a natural or normal shape, even if an expression could be inferred. If the annotators were uncertain about any of the facial expressions, images were tagged as uncertain. When an image was annotated as Non-face or uncertain, valence and arousal were not assigned to the image.

The annotators were instructed to select the proper expression category of the face, where the intensity is not important as long as the face depicts the intended emotion. Table 3 shows the number of images in each category. Table 4 indicates the percentage of annotated categories for queried emotion terms. As shown, the happy emotion had the highest hit-rate (48 percent), and the rest of the emotions had hit-rates less than 20 percent. About 15 percent of all query results were in the No-Face category, as many images from the web contain watermarks, drawings, etc. About 15 percent of all queried emotions resulted in neutral faces. Among other expressions, disgust, fear, and contempt had the lowest hit-rate with only 2.7, 4, and 2.4 percent hit-rates, respectively. As one can see, the majority of the returned images from the search engines were happy or neutral faces. The authors believe that this is because people tend to publish their images with positive expressions rather than negative expressions. Fig. 3 shows a sample image in each category and its intended queries (in parentheses).


Fig. 3.
Samples of queried images from the web and their annotated tags. The queried expression is written in parentheses.

Show All

TABLE 3 Number of Annotated Images in Each Category

TABLE 4 Percentage of Annotated Categories for Queried Emotion Terms (%)

3.2.2 Dimensional (Valence & Arousal) Annotation
The definition of valence and arousal dimensions was adapted from [3] and was given to annotators in our tutorial as: “Valence refers to how positive or negative an event is, and arousal reflects whether an event is exciting/agitating or calm/soothing”. A sample circumplex with estimated positions of several expressions, borrowed from [61], was provided in the tutorial as a reference for the annotators. The provided circumplex in the tutorial contained more than 34 complex emotions categories such as suspicious, insulted, impressed, etc., and used to train annotators. The annotators were instructed to consider the intensity of valence and arousal during the annotation. During the annotation process, the annotators were supervised closely and constant necessary feedback was provided when they were uncertain about some images.

To model the dimensional affect of valence and arousal, a 2D Cartesian coordinate system was used where the x-axis and y-axis represent the valence and arousal, respectively. Similar to Russell's circumplex space model [3], our annotation software did not allow the value of valence and arousal outside of the circumplex. This allows us to convert the Cartesian coordinates to polar coordinates with 0≤r≤1 and 0≤θ<360. The annotation software showed the value of valence and arousal to the annotators when they selected a point in the circumplex. This helped the annotators to pick more precise locations of valence and arousal with a higher confidence.

A predefined estimated region of valence and arousal was defined for each categorical emotion in the annotation software (e.g., for happy emotion the valence is in (0.0, 1.0], and the arousal is in [−0.2, 0.5]). If the annotators select a value of valence and arousal outside of the selected emotion's region, the software indicates a warning message. The annotators were able to proceed, and they were instructed to do so, if they were confident about the value of valence and arousal. The images with the warning messages were marked in the database, for further review by the authors. This helped to avoid mistakes in the annotation of the dimensional model of affect.

Fig. 4 shows the histogram (number of samples in each range/area) of annotated images in a 2D Cartesian coordinate system. As illustrated, there are more samples in the center and the right middle (positive valence and small positive arousal) of the circumplex, which confirms the higher number of Neutral and Happy images in the database compared to other categories in the categorical model.2


Fig. 4.
Histogram (number of frames in each range/area) of valence and arousal annotations (Best viewed in color).

Show All

3.3 Annotation Agreement
In order to measure the agreement between the annotators, 36,000 images were annotated by two annotators. The annotations were performed fully blind and independently, i.e., the annotators were not aware of the intended query or other annotator's response. The results showed that the annotators agreed on 60.7 percent of the images. Table 5 shows the agreement between two annotators for different categories. As it is shown, the annotators highly agreed on the Happy and No Face categories, and the highest disagreement occurred in the None category. Visually inspecting some of the images in the None category, the authors believe that the images in this category contain very subtle emotions and they can be easily confused with other categories (the last two example of Fig. 3 show images in the None category).

TABLE 5 Agreement between Two Annotators in Categorical Model of Affect (%)

Table 6 shows various evaluation metrics between the two annotators in the continuous dimensional model of affect. These metrics are defined in Section 2.2. We calculated these metrics in two scenarios: 1) the annotators agreed on the category of the image; 2) on all images that are annotated by two annotators. As Table 6 shows, when the annotators agreed on the category of the image, the annotations have a high correlation and sign agreement (SAGR). According to Table 5, this occurred on only 60.7 percent images. However, there is less correlation and SAGR on overall images, since the annotators had a different perception of emotions expressed in the images. It can also be seen that the annotators agreed on valence more than arousal. The authors believe that this is because the perception of valence (how positive or negative the emotion is) is easier and less subjective than arousal (how excited or calm the subject is) especially in still images. Comparing the metrics in the existing dimensional databases (shown in Table 2) with the agreement of human labelers on AffectNet, suggest that AffectNet is a very challenging database and even human annotations have more RMSE than automated methods on existing databases.

TABLE 6 Annotators’ Agreement in Dimensional Model of Affect
Table 6- 
Annotators’ Agreement in Dimensional Model of Affect
SECTION 4Baseline
In this section, two baselines are proposed to classify images in the categorical model and predict the value of valence and arousal in the continuous domain of dimensional model. Since deep Convolutional Neural Networks (CNNs) have been a successful approach to learn appropriate feature abstractions directly from the image and there are many samples in AffectNet necessary to train CNNs, we proposed two simple CNN baselines for both categorical and dimensional models. We also compared the proposed baselines with conventional approaches (Support Vector Machines [62] and Support Vector Regressions [63]) learned from hand-crafted features (HOG). In the following sections, we first introduce our training, validation and test sets, and then show the performance of each proposed baselines.

4.1 Test, Validation, and Training Sets
Test Set. The subset of the annotated images that are annotated by two annotators is reserved for the test set. To determine the value of valence and arousal in the test set, since there are two responses for one image in the continuous domain, one of the annotations is picked randomly. To select the category of image in the categorical model, if there was a disagreement, a favor was given to the intended query, i.e., if one of the annotators labeled the image as the intended query, the image was labeled with the intended query in the test set. This happened in 29.5 percent of the images with disagreement between the annotators. On the rest of the images with disagreement, one of the annotations was assigned to the image randomly. Since the test set is a random sampling of all images, it is heavily imbalanced. In other words, there are more than 11,000 images with happy expression while it contains only 1,000 images with contemptuous expression.

Validation Set. Five hundred samples of each category is selected randomly as a validation set. The validation set is used for hyper-parameter tuning, and since it is balanced, there is no need for any skew normalization.

Training Set. The rest of images are considered as training examples. The training examples, as shown in Table 3, are heavily imbalanced.

4.2 Categorical Model Baseline
Facial expression data is usually highly skewed. This form of imbalance is commonly referred to as intrinsic variation, i.e., it is a direct result of the nature of expressions in the real world. This happens in both the categorical and dimensional models of affect. For instance, Caridakis et al. [64] reported that a bias toward quadrant 1 (positive arousal, positive valence) exists in the SAL database. The problem of learning from imbalanced data sets has two challenges. First, training data with an imbalanced distribution often causes learning algorithms to perform poorly on the minority class [65]. Second, the imbalance in the test/validation data distribution can affect the performance metrics dramatically. Jeni et al. [53] studied the influence of skew on imbalanced validation set. The study showed that with exception of area under the ROC curve (AUC), all other studied evaluation metrics, i.e., Accuracy, F1-score, Cohens kappa [50], Krippendorfs Alpha [51], and area under Precision-Recall curve (AUC-PR) are affected by skewed distributions dramatically. While AUC is unaffected by skew, precision-recall curves suggested that AUC may mask poor performance. To avoid or minimize skew-biased estimates of performance, the study suggested to report both skew-normalized scores and the original evaluation.

We used AlexNet [57] architecture as our deep CNN baseline. AlexNet consists of five convolution layers, followed by max-pooling and normalization layers, and three fully-connected layers. To train our baseline with an imbalanced training set, four approaches are studied in this paper as Imbalanced learning, Down-Sampling, Up-Sampling, and Weighted-Loss. The imbalanced learning approach was trained with the imbalanced training set without any change in the skew of the dataset. To train the down-sampling approach, we selected a maximum of 15,000 samples from each class. Since there are less than 15,000 samples for some classes such as Disgust, Contempt, and Fear, the resulting training set is semi-balanced. To train the up-sampling approach, we heavily up-sampled the under-represented classes by replicating their samples so that all classes had the same number of samples as the class with maximum samples, i.e., Happy class.

The weighted-loss approach weighted the loss function for each of the classes by their relative proportion in the training dataset. In other words, the loss function heavily penalizes the networks for misclassifying examples from under-represented classes, while penalizing networks less for misclassifying examples from well-represented classes. The entropy loss formulation for a training example (X,l) is defined as
E=−∑i=1KHl,ilog(pi^),(6)
View SourceRight-click on figure for MathML and additional features.where Hl,i denotes row l penalization factor of class i, K is the number of classes, and pi^ is the predictive softmax with values [0,1] indicating the predicted probability of each class as
pi^=exp(xi)∑Kj=1exp(xj).(7)
View SourceRight-click on figure for MathML and additional features.

Equation (6) can be re-written as
E=−∑iHl,ilog(exp(xi)∑jexp(xj))=−∑iHl,ixi+∑iHl,ilog(∑jexp(xj))=log(∑jexp(xj))∑iHl,i−∑iHl,ixi.(8)
View Source

The derivate with respect to the prediction xk is
∂E∂xk=∂∂xk[log(∑jexp(xj))∑iHl,i]−∂∂xk[∑iHl,ixi]=(∑iHl,i)1∑jexp(xj)∂∂xk∑jexp(xj)−Hl,k=(∑iHl,i)exp(xk)∑jexp(xj)−Hl,k=(∑iHl,i)pk^−Hl,k.(9)
View Source

When H=I, the identity, the proposed weighted-loss approach gives the traditional cross-entropy loss function. We used the implemented Infogain loss in Caffe [66] for this purpose. For simplicity, we used a diagonal matrix defined as
Hij={fifmin,0,if i=jotherwise(10)
View Sourcewhere fi is the number of samples of the ith class and fmin is the number of samples in the most under-represented class, i.e., Disgust class in this situation.

Before training the network, the faces were cropped and resized to 256×256 pixels. No facial registration was performed at this baseline. To augment the data, five crops of 224×224 and their horizontal flips were extracted from the four corners and the center of the image at random during the training phase. The networks were trained for 20 epochs using a batch size of 256. The base learning rate was set to 0.01, and decreased step-wise by a factor of 0.1 every 10,000 iterations. We used a momentum of 0.9.

Table 7 shows the top-1 and top-2 F1-Scores for the imbalanced learning, down-sampling, up-sampling, and weighted-loss approaches on the test set. Since the test set is imbalanced, both the skew-normalized and the original scores are reported. The skew normalization is performed by random under-sampling of the classes in the test set. This process is repeated 200 times, and the skew-normalized score is the average of the score on multiple trials. As it is shown, the weighted-loss approach performed better than other approaches in the skew-normalized fashion. The improvement is significant in under-represented classes, i.e., Contempt, Fear, and Disgust. The imbalanced approach performed worst in the Contempt and Disgust categories since there were a few training samples of these classes compared with other classes. The up-sampling approach also did not classify the Contempt and Disgust categories well, since the training samples of these classes were heavily up-sampled (almost 20 times), and the network was over-fitted to these samples. Hence the network lost its generalization and performed poorly on these classes of the test set.

TABLE 7 F1-Scores of Four Different Approaches of Training AlexNet

The confusion matrix of the weighted-loss approaches is shown in Table 8. The weighted-loss approach classified the samples of Contempt and Disgust categories with an acceptable accuracy but did not perform well in Happy and Neutral. This is because the network was not penalized enough for misclassifying examples from these classes. We believe that a better formulation of the weight matrix H based on the number of samples in the mini-batches or other data-driven approaches can improve the recognition of well-represented classes.

TABLE 8 Confusion Matrix of Weighted-Loss Approach on the Test Set

Table 9 shows accuracy, F1-score, Cohens kappa, Krippendorfs Alpha, area under the ROC curve (AUC), and area under the Precision-Recall curve (AUC-PR) on the test sets. Except for the accuracy, all the metrics are calculated in a binary-class manner where the positive class contains the samples labeled by the given category, and the negative class contains the rest. The reported result in Table 9 is the average of these metrics over eight classes. The accuracy is defined in a multi-class manner in which the number of correct predictions is divided by the total number of samples in the test set. The skew-normalization is performed by balancing the distribution of classes in the test set using random under-sampling and averaging over 200 trials. Since the validation set is balanced, there is no need for skew-normalization.

TABLE 9 Evaluation Metrics and Comparison of CNN Baselines, SVM and MS Cognitive on Categorical Model of Affect

We compared the performance of CNN baseline with a Support Vector Machine (SVM) [62]. To train SVM, the faces in the images were cropped and resized to 256×256 pixels. HOG [67] features were extracted with the cell size of 8. We applied PCA retaining 95 percent of the variance to reduce the HOG features dimensionality from 36,864 to 6,697 features. We used a linear kernel SVM in Liblinear package [68] (which is optimized for large-scale linear classification and regression). Table 9 shows the evaluation metrics of SVM. Reported AUC and AUCPR values for SVM are calculated using the LibLinear's resulting decision values. We calculated the scores of predictions using a posterior-probability transformation sigmoid function. Comparing the performance of SVM with the CNN baselines on AffectNet, indicates that CNN models perform better than conventional SVM and HOG features in all metrics.

We also compared the baseline with an available off-the-shelf expression recognition system (Microsoft Cognitive Services emotion API [69]). The MS cognitive system had an excellent performance on Neutral and Happy categories with an accuracy of 0.94 and 0.85, respectively. However, it performed poorly on other classes with an accuracy of 0.25, 0.27 and 0.04 in the Fear, Disgust and Contempt categories. Table 9 shows the evaluation metrics on the MS cognitive system. Comparing the performance of the MS cognitive with the simple baselines on AffectNet indicates that AffectNet is a challenging database and a great resource to further improve the performance of facial expression recognition systems.

Fig. 5 shows nine samples of randomly selected misclassified images of the weighted-loss approach and their corresponding ground-truth. As the figure shows, it is really difficult to assign some of the emotions to a single category. Some of the faces have partial similarities in facial features to the misclassified images, such as nose wrinkled in disgust, or eyebrows raised in surprise. This emphasizes the fact that classifying facial expressions in the wild is a challenging task and, as mentioned before, even human annotators agreed on only 60.7 percent of the images.

Fig. 5. - 
Samples of miss-classified images. Their corresponding ground-truth is given in parentheses.
Fig. 5.
Samples of miss-classified images. Their corresponding ground-truth is given in parentheses.

Show All

4.3 Dimensional Model (Valence and Arousal) Baseline
Predicting dimensional model in the continuous domain is a real-valued regression problem. We used AlexNet [57] architecture as our deep CNN baseline to predict the value of valence and arousal. Particularly, two separate AlexNets were trained where the last fully-connected layer was replaced with a linear regression layer containing only one neuron. The output of the neuron predicted the value of valence/arousal in continuous domain [−1,1]. A euclidean (L2) loss was used to measure the distance between the predicted value (y^n) and actual value of valence/arousal (yn) as
E=12N∑n=1N||y^n−yn||22.(11)
View SourceRight-click on figure for MathML and additional features.

The faces were cropped and resized to 256×256 pixels. The base learning rate was fixed and set to 0.001 during the training process. We used a momentum of 0.9. Training was continued until a plateau was reached in the euclidean error of the validation set (approximately 16 epochs with a mini-batch size of 256). Fig. 6 shows the value of training and validation losses over 16K iterations (about 16 epochs).

Fig. 6. - 
Euclidean error of training valence and arousal.
Fig. 6.
Euclidean error of training valence and arousal.

Show All

We also compared Support Vector Regression (SVR) [63] with our DNN baseline for predicting valence and arousal in AffectNet. In our experiments, first, the faces in the images were cropped and resized to 256×256 pixels. Histogram of Oriented Gradient (HOG) [67] features were extracted with the cell size of 8. Afterward, we applied PCA retaining 95 percent of the variance of these features to reduce the dimensionality. Two separate SVRs were trained to predict the value of valence and arousal. Liblinear [68] package was used to implement SVR baseline.

Table 10 shows the performances of the proposed baseline and SVR on the test set. As shown, the CNN baseline can predict the value of valence and arousal better than SVR. This is because the high variety of samples in AffectNet allows the CNN to extract more discriminative features than hand-crafted HOG, and therefore it learned a better representation of dimensional affect.

TABLE 10 Baselines’ Performances of Predicting Valence and Arousal on Test Set

The RMSE of CNN baseline (AlexNet) between the predicted valence and arousal and the ground-truth are shown in Fig. 7. As illustrated, the CNN baseline has a lower error rate in the center of circumplex. In particular, predicting low-valence mid-arousal and low-arousal mid-valence areas were more challenging. These areas correspond to the expressions of contempt, bored, and sleepy. It should be mentioned that predicting valence and arousal in the wild is a challenging task, and as discussed in Section 3.3, the disagreement between two human annotators has RMSE = 0.367 and RMSE = 0.481 for valence and arousal, respectively.


Fig. 7.
RMSE of predicted valence and arousal using AlexNet and Euclidean (L2) loss (Best viewed in color).

Show All

SECTION 5Conclusion
The analysis of human facial behavior is a very complex and challenging problem. The majority of the techniques for automated facial affect analysis are mainly based on machine learning methodologies, and their performance highly depends on the amount and diversity of annotated training samples. Recently, databases of facial expression and affect in the wild received much attention. However, existing databases of facial affect in the wild only cover one model of affect, have a limited number of subjects, or contain few samples of certain emotions.

The Internet is a vast source of facial images, most of which are captured in uncontrolled conditions. These images are often taken in the wild under natural conditions. In this paper, we introduced a new publicly available database of a facial Affect from the InterNet (called AffectNet) by querying different search engines using emotion related tags in six different languages. AffectNet contains more than 1M images with faces and extracted landmark points. Twelve human experts manually annotated 450,000 of these images in both the categorical and dimensional (valence and arousal) models and tagged the images that have any occlusion on the face.

The agreement level of human labelers on a subset of AffectNet showed that expression recognition and predicting valence and arousal in the wild is a challenging task. The two annotators agreed on 60.7 percent of the category of facial expressions, and there was a large disagreement on the value of valence and arousal (RMSE = 0.34 and 0.36) between the two annotators.

Two simple deep neural network baselines were examined to classify the facial expression images and predict the value of valence and arousal in the continuous domain of dimensional model. Evaluation metrics showed that simple deep neural network baselines trained on AffectNet can perform better than conventional machine learning methods and available off-the-shelf expression recognition systems. AffectNet is by far the largest database of facial expression, valence and arousal in the wild, enabling further progress in the automatic understanding of facial behavior in both categorical and continuous dimensional space. The interested investigators can study categorical and dimensional models in the same corpus, and possibly co-train them to improve the performance of their affective computing systems. It is highly anticipated that the availability of this database for the research community, along with the recent advances in deep neural networks, can improve the performance of automated affective computing systems in recognizing facial expressions and predicting valence and arousal.