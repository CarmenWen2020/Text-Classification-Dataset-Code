We study the following basic machine learning task: Given a fixed set of input points in R
d
for a
linear regression problem, we wish to predict a hidden response value for each of the points. We can
only afford to attain the responses for a small subset of the points that are then used to construct
linear predictions for all points in the dataset. The performance of the predictions is evaluated by the
total square loss on all responses (the attained as well as the remaining hidden ones). We show that
a good approximate solution to this least squares problem can be obtained from just dimension d
many responses by using a joint sampling technique called volume sampling. Moreover, the least
squares solution obtained for the volume sampled subproblem is an unbiased estimator of optimal
solution based on all n responses. This unbiasedness is a desirable property that is not shared by
other common subset selection techniques.
Motivated by these basic properties, we develop a theoretical framework for studying volume
sampling, resulting in a number of new matrix expectation equalities and statistical guarantees which
are of importance not only to least squares regression but also to numerical linear algebra in general.
Our methods also lead to a regularized variant of volume sampling, and we propose the first efficient
algorithm for volume sampling which makes this technique a practical tool in the machine learning
toolbox. Finally, we provide experimental evidence which confirms our theoretical findings.
Keywords: volume sampling, linear regression, row sampling, active learning, optimal design
1. Introduction
As an introductory case, consider linear regression in one dimension. We are given n non-zero points
xi
. Each point has a hidden real response (or target value) yi
. Assume that obtaining the responses is
expensive and the learner can afford to request the responses yi for only a small number of indices i.
After receiving the requested responses, the learner determines an approximate linear least squares
solution. In the one dimensional homogeneous case, this is just a single weight. How many response
values does the learner need to request so that the total square loss of its approximate solution on
all n points is â€œcloseâ€ to the total loss of the optimal linear least squares solution found with the
knowledge of all responses? We will show here that just one response suffices if the index i is chosen
proportional to x
2
i
. When the learner uses the approximate solution w
âˆ—
i =
yi
xi
, then its expected loss
equals 2 times the loss of the optimum w
âˆ—
that is computed based on all responses (See Figure 1).
Moreover, the approximate solution w
âˆ—
i
is an unbiased estimator for the optimum w
âˆ—
:
Ei
X
j
(xj
yi
xi
âˆ’ yj )
2

= 2
X
j
(xjw
âˆ— âˆ’ yj )
2
and Ei

yi
xi

= w
âˆ—
, when P(i) âˆ¼ x
2
i
.
âˆ—. This paper is an expanded version of two conference papers (Derezinski and Warmuth, 2017, 2018). Â´

DEREZINSKI AND Â´ WARMUTH
We will extend these formulas to higher dimensions and to sampling more responses by making use of
a joint sampling distribution called volume sampling. We next break down our contributions into four
parts.
x
y
xi
Figure 1: The expected loss of w
âˆ—
i =
yi
xi
(blue line) based on one response yi
is twice
the loss of the optimum w
âˆ—
(green line).
Least squares with dimension many responses. Consider
the case when the points xi
lie in R
d
. Let X denote a full
rank n Ã— d matrix that has the n transposed points x
>
i
as
rows, and let y âˆˆ R
n be the vector of responses. Now the
goal is to minimize the (total) square loss,
L(w) = Xn
i=1
(x
>
i w âˆ’ yi)
2 = kXw âˆ’ yk
2
,
over all linear weight vectors w âˆˆ R
d
. Let wâˆ— denote
the optimal such weight vector. We want to minimize
the square loss based on a small number of responses we
attained for a subset of rows. Again, the learner is initially
given the fixed set of n rows (i.e. fixed design), but none
of the responses. It is then allowed to choose a random
subset of d indices, S âŠ† {1..n}, and obtains the responses for the corresponding d rows. The
learner proceeds to find the optimal linear least squares solution wâˆ—
(S) for the subproblem (XS, yS).
where XS is the subset of d rows of X indexed by S and yS the corresponding d responses from
the response vector y. As a generalization of the one-dimensional distribution that chooses an
index based on the squared length, set S of size d is chosen proportional to the squared volume of
the parallelepiped spanned by the rows of XS. This squared volume equals det(X>
S XS). Using
elementary linear algebra, we will show that volume sampling the set S assures that wâˆ—
(S) is a good
approximation to wâˆ—
in the following sense: In expectation, the square loss (on all n row response
pairs) of wâˆ—
(S) is equal d + 1 times the square loss of wâˆ—
(when X is in general position):
E[L(wâˆ—
(S))] = (d + 1)L(wâˆ—
), when P(S) âˆ¼ det(X>
S XS).
Furthermore, we will show that for any sampling procedure that attains less than d responses, the
ratio between the expected loss and the loss of the optimum cannot be bounded by a constant.
Unbiased pseudoinverse estimator. There is a direct connection between solving linear least squares
problems and the pseudoinverse X+ of matrix X: For an nâˆ’dimensional response vector y, the
optimal solution is wâˆ— = argminw ||Xw âˆ’ y||2 = X+y. Similarly wâˆ—
(S) = (XS)
+yS is the
solution for the subproblem (XS, yS). We propose a new implementation of volume sampling
called reverse iterative sampling which enables a novel proof technique for obtaining elementary
expectation formulas for pseudoinverses based on volume sampling.
x
>
i
n
d
S
s XS
(XS)
+
X IS ISX X+ (ISX)
+
Figure 2: Shapes of the matrices. The indices of S may not be consecutive.
2
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
Suppose that our goal is to estimate the pseudoinverse X+ based on the pseudoinverse of a subset
of rows. Recall that for a subset S âŠ† {1..n} of s row indices (where the size s is fixed and s â‰¥ d),
we let XS be the submatrix of the s rows indexed by S (see Figure 2). Consider a version of X in
which all but the rows of S are zero. This matrix equals ISX, where the selection matrix IS is an
n-dimensional diagonal matrix with (IS)ii = 1 if i âˆˆ S and 0 otherwise.
For the set S of fixed size s â‰¥ d row indices chosen proportional to det(X>
S XS), we can prove
the following two expectation formulas (for the second equality, X must be in general position):
E[(ISX)
+] = X+ and E[ (X>
S XS)
âˆ’1
| {z }
(ISX)+(ISX)+>
] = n âˆ’ d + 1
s âˆ’ d + 1
(X>X)
âˆ’1
| {z }
X+X+>
.
Note that (ISX)
+ has the d Ã— n shape of X+ where the s columns indexed by S contain (XS)
+ and
the remaining n âˆ’ s columns are zero. The expectation of this matrix is X+ even though (XS)
+ is
clearly not a submatrix of X+. This expectation formula now implies that for any size s â‰¥ d, if S of
size s is drawn by volume sampling, then wâˆ—
(S) is an unbiased estimator1
for wâˆ—
, i.e.
E[wâˆ—
(S)] = E[(XS)
+yS] = E[(ISX)
+y] = E[(ISX)
+] y = X+y = wâˆ—
.
The second expectation formula can be viewed as a second moment of the pseudoinverse estimator
(ISX)
+, and it can be used to compute a useful notion of matrix variance with applications in random
matrix theory:
E[(ISX)
+(ISX)
+>] âˆ’ E[(ISX)
+]E[(ISX)
+]
> =
n âˆ’ s
s âˆ’ d + 1
X+X+>.
Regularized volume sampling. We also develop a new regularized variant of volume sampling, which
extends reverse iterative sampling to selecting subsets of size smaller than d, and leads to a useful
extension of the above matrix variance formula. Namely, for any Î» â‰¥ 0, our Î»-regularized procedure
for sampling subsets S of size s satisfies
E

(X>
S XS + Î»I)
âˆ’1


n âˆ’ dÎ» + 1
s âˆ’ dÎ» + 1
(X>X + Î»I)
âˆ’1
,
where dÎ»
def = tr(X(X>X + Î»I)
âˆ’1X>) â‰¤ d is a standard notion of statistical dimension. Crucially,
the above bound holds for subset sizes s â‰¥ dÎ», which can be much smaller than the dimension d.
Under the additional assumption that response vector y is generated by a linear transformation
distorted with bounded white noise, the expected bound on (X>
S XS + Î»I)
âˆ’1
leads to strong variance
bounds for the ridge regression estimator. Specifically, we prove that when y = Xwe + Î¾, with
Î¾ having mean zero and bounded variance Var[Î¾]  Ïƒ
2
I, then if S is sampled according to Î»regularized volume sampling with Î» â‰¤
Ïƒ
2
kwe k
2 , we can obtain the following bound on the mean
squared prediction error (MSPE):
ESEÎ¾

1
n
kX(wâˆ—
Î»
(S) âˆ’ we )k
2

â‰¤
Ïƒ
2dÎ»
s âˆ’ dÎ» + 1
,
1. For size s = d volume sampling, the fact that E[wâˆ—
(S)] = wâˆ—
can be found in an early paper (Ben-Tal and Teboulle,
1990). They give a direct proof based on Cramerâ€™s rule.
3  
DEREZINSKI AND Â´ WARMUTH
where wâˆ—
Î»
(S) = (X>
S XS + Î»I)
âˆ’1X>
S yS is the ridge regression estimator for the subproblem
(XS, yS). Our new lower bounds show that the above upper bound for regularized volume sampling
is essentially optimal with respect to the choice of a subsampling procedure.
Algorithms and experiments. The only known polynomial time algorithm for size s > d volume
sampling was recently proposed by Li et al. (2017) with time complexity O(n
4
s). In this paper
we give two new algorithms using our general framework of reverse iterative sampling: one with
deterministic runtime of O((nâˆ’s+d)nd), and a second one that with high probability finishes in
time O(nd2
). Thus both algorithms improve on the state-of-the-art by a factor of at least n
2
and
make volume sampling nearly as efficient as the comparable i.i.d. sampling technique called leverage
score sampling. Our experiments on real datasets confirm the efficiency of our algorithms and show
that for small sample sizes s, volume sampling is more effective than leverage score sampling for the
task of subset selection for linear regression.
1.1 Related Work
Volume sampling is a type of determinantal point process (DPP) (Kulesza and Taskar, 2012). DPPâ€™s
have been given a lot of attention in the literature with many applications to machine learning,
including recommendation systems (Gartrell et al., 2016) and clustering (Kang, 2013). Many exact
and approximate methods for efficiently generating samples from this distribution have been proposed
(Deshpande and Rademacher, 2010; Kulesza and Taskar, 2011), making it a useful tool in the design
of randomized algorithms. Most of those methods focus on sampling s â‰¤ d elements. In this paper,
we study volume sampling sets of size s â‰¥ d, which was proposed by Avron and Boutsidis (2013)
and motivated with applications in graph theory, linear regression, matrix approximation and more.
The problem of selecting a subset of the rows of the input matrix for solving a linear regression
task has been extensively studied in statistics literature under the terms optimal design (Fedorov,
1972) and pool-based active learning (Sugiyama and Nakajima, 2009). Various criteria for subset
selection have been proposed, like A-optimality and D-optimality. For example, A-optimality seeks
to minimize tr((X>
S XS)
âˆ’1
), which is combinatorially hard to optimize exactly. We show that for
size s â‰¥ d volume sampling, E[(X>
S XS)
âˆ’1
] = nâˆ’d+1
sâˆ’d+1 (X>X)
âˆ’1
, which provides an approximate
randomized solution of the sampled inverse covariance matrix rather than just its trace.
In the field of computational geometry a variant of volume sampling was used to obtain optimal
bounds for low-rank matrix approximation. In this task, the goal is to select a small subset of rows of
a matrix X âˆˆ R
nÃ—d
(much fewer than the rank of X, which is bounded by d), so that a good low-rank
approximation of X can be constructed from those rows. Deshpande et al. (2006) showed that volume
sampling of size s < d index sets obtains optimal multiplicative bounds for this task and polynomial
time algorithms for size s < d volume sampling were given in Deshpande and Rademacher (2010)
and Guruswami and Sinop (2012). We show in this paper that for linear regression, fewer than rank
many rows do not suffice to obtain multiplicative bounds. This is why we focus on volume sampling
sets of size s â‰¥ d (recall that, for simplicity, we assume that X is full rank).
Computing approximate solutions to linear regression has been explored in the domain of
numerical linear algebra (see Mahoney (2011) for an overview). Here, multiplicative bounds on the
loss of the approximate solution can be achieved via two approaches. The first approach relies on
sketching the input matrix X and the response vector y by multiplying both by the same suitably
chosen random matrix. Algorithms which use sketching to generate a smaller input matrix for a
given linear regression problem are computationally efficient (Sarlos, 2006; Clarkson and Woodruff,
4
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
2013), but they require all of the responses from the original problem to generate the sketch and are
thus not suitable for the goal of using as few response values as possible. The second approach is
based on subsampling the rows of the input matrix and only asking for the responses of the sampled
rows. The learner optimally solves the sampled subproblem2
and then uses the obtained weight
vector for its prediction on all rows. The selected subproblem is known under the term â€œb-agnostic
minimal coresetâ€ in (Boutsidis et al., 2013; Drineas et al., 2008) since it is selected without knowing
the response vector (denoted as the vector b). The second approach coincides with the goals of this
paper but the focus here is different in a number of ways. First, we focus on the smallest sample
size for which a multiplicative loss bound is possible: Just d volume sampled rows are sufficient to
achieve a multiplicative bound with a fixed factor, while d âˆ’ 1 are not sufficient. A second focus
here is the efficiency and the combinatorics of volume sampling. The previous work is mostly based
on i.i.d. sampling using the statistical leverage scores (Drineas et al., 2012). As we show in this
paper, leverage scores are the marginals of volume sampling and any i.i.d. sampling method requires
sample size â„¦(d log d) to achieve multiplicative loss bounds for linear regression. On the other hand,
the rows obtained from volume sampling are selected jointly and this makes the chosen subset more
informative and brings the required sample size down to d. Third, we focus on the fact that the
estimators produced from volume sampling are unbiased and therefore can be averaged to get more
accurate estimators. Using our methods, averaging immediately leads to an unbiased estimator with
expected loss 1 +  times the optimum based on sampling d
2/ responses in total. We leave it as an
open problem to construct a 1 +  factor unbiased estimator from sampling only O(d/) responses.
If unbiasedness is not a concern, then such an estimator has recently been found (Chen and Price,
2017).
1.2 Outline of the Paper
In the next section, we define volume sampling as an instance of a more general procedure we call
reverse iterative sampling, and we use this methodology to prove closed form matrix expressions
for the expectation of the pseudoinverse estimator (ISX)
+ and its square (ISX)
+(ISX)
+>, when
S is sampled by volume sampling. Central to volume sampling is the Cauchy-Binet formula for
determinants. As a side, we produce a number of short self-contained proofs for this formula and
show that leverage scores are the marginals of volume sampling. Then in Section 3 we formulate the
problem of solving linear regression from a small number of responses, and state the upper bound for
the expected square loss of the volume sampled least squares estimator (Theorem 8), followed by a
discussion and related lower bounds. In Section 3.3, we prove Theorem 8 and an additional related
matrix expectation formula. We next discuss in Section 3.4 how unbiased estimators can easily
be averaged for improving the expected loss and discuss open problems for constructing unbiased
estimators. A new regularized variant of volume sampling is proposed in Section 4, along with
the statistical guarantees it offers for computing subsampled ridge regression estimators. Next, we
present efficient volume sampling algorithms in Section 5, based on the reverse iterative sampling
paradigm, which are then experimentally evaluated in Section 6. Finally, Section 7 concludes the
paper by suggesting a future research direction.
2. Note that those methods typically require additional rescaling of the subproblem, whereas the techniques proposed in
this paper do not require any rescaling.
5
DEREZINSKI AND Â´ WARMUTH
2. Reverse Iterative Sampling
Let n be an integer dimension. For each subset S âŠ† {1..n} of size s we are given a matrix formula
F(S). Our goal is to sample set S of size s using some sampling process and then develop concise
expressions for ES:|S|=s
[F(S)]. Examples of formula classes F(S) will be given below.
{1..n}
S
Sâˆ’i
P(Sâˆ’i|S)
size
n
nâˆ’1
s
sâˆ’1
d
Figure 3: Reverse iterative sampling.
We represent the sampling by a directed acyclic graph
(DAG), with a single root node corresponding to the full
set {1..n}. Starting from the root, we proceed along the
edges of the graph, iteratively removing elements from the
set S (see Figure 3). Concretely, consider a DAG with levels
s = n, n âˆ’ 1, ..., d. Level s contains
n
s

nodes for sets
S âŠ† {1..n} of size s. Every node S at level s > d has s
directed edges to the nodes S âˆ’ {i} (also denoted Sâˆ’i) at the
next lower level. These edges are labeled with a conditional
probability vector P(Sâˆ’i
|S), where the event S occurs if the
sampling process visits node S as it traces a (directed) path in
the DAG from the root node {1..n} to a node at level d. Such
paths have n âˆ’ d edges. It is natural to assign probabilities
to shorter paths as well going from any node to a node at a lower level. The probability of such a
path is again the product of its edge probabilities. It also follows that the probability P(S) of visiting
node S (via a path from the root) is the sum of the probabilities of all paths from root to S. Finally,
the probability P({1..n}) of the root node is 1 and more generally, the total probability of all nodes
at each layer is 1.
We associate a formula F(S) with each set node S in the DAG. The following key equality lets
us compute expectations.
Lemma 1 If for all S âŠ† {1..n} of size greater than d we have
F(S) = X
iâˆˆS
P(Sâˆ’i
|S)F(Sâˆ’i),
then for any s âˆˆ {d..n}: ES:|S|=s
[F(S)] = P
S:|S|=s P(S)F(S) = F({1..n}).
Proof Suffices to show that expectations at successive layers s and s âˆ’ 1 are equal for s > d:
X
S:|S|=s
P(S) F(S) =
X
S:|S|=s
P(S)
X
iâˆˆS
P(Sâˆ’i
|S) F(Sâˆ’i) =
X
S:|S|=s
X
iâˆˆS
P(S)P(Sâˆ’i
|S)F(Sâˆ’i)
=
X
T:|T|=sâˆ’1
X
j /âˆˆT
P(T+j )P(T|T+j )
| {z }
P(T)
F(T).
Note that the r.h.s. of the first line has one summand per edge leaving level s, and the r.h.s. of the
second line has one summand per edge arriving at level s âˆ’ 1. Now the last equality holds because
the edges leaving level s are exactly those arriving at level s âˆ’ 1, and the summand for each edge in
both expressions is equivalent.
 
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
2.1 Volume Sampling
Given a tall full rank matrix X âˆˆ R
nÃ—d
and a sample size s âˆˆ {d..n}, volume sampling chooses
subset S âŠ† {1..n} of size s with probability proportional to squared volume spanned by the columns
of submatrix3 XS and this squared volume equals det(X>
S XS). The following theorem uses the
above DAG setup to compute the normalization constant for this distribution. Note that all subsets S
of volume 0 will be ignored, since they are unreachable in the proposed sampling procedure.
Theorem 2 Let X âˆˆ R
nÃ—d
, where d â‰¤ n and det(X>X) > 0. For any set S of size s > d for
which det(X>
S XS) > 0, define the probability of the edge from S to Sâˆ’i
for i âˆˆ S as:
P(Sâˆ’i
|S)
def
=
det(X>
Sâˆ’iXSâˆ’i
)
(sâˆ’d) det(X>
S XS)
=
1âˆ’x
>
i
(X>
S XS)
âˆ’1xi
sâˆ’d
, (reverse iterative volume sampling)
where x
>
i
is the i-th row of X. In this case P(Sâˆ’i
|S) is a proper probability distribution. If
det(X>
S XS) = 0, then simply set P(Sâˆ’i
|S) to 1
s
. With these definitions, P
S:|S|=s P(S) = 1 for all
s âˆˆ {d..n} and the probability of all paths from the root to any subset S of size at least d is
P(S) = det(X>
S XS)

nâˆ’d
sâˆ’d

det(X>X)
. (volume sampling)
The rewrite of the ratio
det(X>
Sâˆ’i
XSâˆ’i
)
det(X>
S XS)
as 1 âˆ’ x
>
i
(X>
S XS)
âˆ’1xi
is Sylvesterâ€™s Theorem for determinants. Incidentally, this is the only property of determinants used in this section.
The theorem also implies a generalization of the Cauchy-Binet formula to size s â‰¥ d sets:
X
S:|S|=s
det(X>
S XS) = 
n âˆ’ d
s âˆ’ d

det(X>X). (1)
When s = d, then the binomial coefficient is 1 and the above becomes the vanilla Cauchy-Binet
formula. The below proof of the theorem thus results in a minimalist proof of this classical formula
as well. The proof uses the reverse iterative sampling (Figure 3) and the fact that all paths from the
root to node S have the same probability. For the sake of completeness we also give a more direct
inductive proof of the above generalized Cauchy-Binet formula in Appendix A.
Proof First, for any node S s.t. s > d and det(X>
S XS) > 0, the probabilities out of S sum to 1:
X
iâˆˆS
P(Sâˆ’i
|S) = X
iâˆˆS
1 âˆ’ tr((X>
S XS)
âˆ’1xix
>
i
)
s âˆ’ d
=
s âˆ’ tr((X>
S XS)
âˆ’1X>
S XS)
s âˆ’ d
=
s âˆ’ d
s âˆ’ d
= 1.
It remains to show the formula for the probability P(S) of all paths ending at node S. If
det(X>
S XS) = 0, then one edge on any path from the root to S has probability 0. This edge goes
from a superset of S with positive volume to a superset of S that has volume 0. Since all paths have
probability 0, P(S) = 0 in this case.
Now assume det(X>
S XS) > 0 and consider any path from the root {1..n} to S. There are
(n âˆ’ s)! such paths all going through sets with positive volume. The fractions of determinants in the
3. For sample size s = d, the rows and columns of XS have the same length and det(X>
S XS) is also the squared volume
spanned by the rows XS.
 
DEREZINSKI AND Â´ WARMUTH
probabilities along each path telescope and the additional factors accumulate to the same product. So
the probability of all paths from the root to S is the same and the total probability into S is
(n âˆ’ s)!
(n âˆ’ d). . .(s âˆ’ d + 1)
det(X>
S XS)
det(X>X)
=
1

nâˆ’d
sâˆ’d

det(X>
S XS)
det(X>X)
.
An immediate consequence of the above sampling procedure is the following composition
property of volume sampling, which states that this distribution is closed under subsampling. We
also give a direct proof to highlight the combinatorics of volume sampling.
Corollary 3 For any X âˆˆ R
nÃ—d and n â‰¥ t > s â‰¥ d, the following hierarchical sampling procedure:
T
tâˆ¼ X (size t volume sampling from X),
S
sâˆ¼ XT (size s volume sampling from XT )
returns a set S which is distributed according to size s volume sampling from X.
Proof We start with the Law of Total Probability and then use the probability formula for volume
sampling from the above theorem. Here P(T âˆ© S) means the probability of all paths going through
node T at level t and ending up at the final node S at level s. If S 6âŠ† T, then P(T âˆ© S) = 0.
P(S) = X
T: SâŠ†T
P(T âˆ©S)
z }| {
P(S | T) P(T)
=
X
T: SâŠ†T
det(X>
S XS)

tâˆ’d
sâˆ’d

âœ˜âœ˜âœ˜âœ˜âœ˜âœ˜
det(X>
T XT )
âœ˜âœ˜âœ˜âœ˜âœ˜âœ˜
det(X>
T XT )

nâˆ’d
tâˆ’d

det(X>X)
=

n âˆ’ s
t âˆ’ s

det(X>
S XS)

tâˆ’d
sâˆ’d

nâˆ’d
tâˆ’d

det(X>X)
=
det(X>
S XS)

nâˆ’d
sâˆ’d

det(X>X)
.
Note that for all sets T containing S, the probability P(T âˆ© S) is the same, and there are
nâˆ’s
tâˆ’s

such
sets.
The main competitor of volume sampling is i.i.d. sampling of the rows of X w.r.t. the statistical
leverage scores. For an input matrix X âˆˆ R
nÃ—d
, the leverage score of the i-th row x
>
i
of X is defined
as
li
def
= x
>
i
(X>X)
âˆ’1xi
.
Recall that this quantity appeared in the definition of conditional probability P(Sâˆ’i
|S) in Theorem
2, where the leverage score was computed w.r.t. the submatrix XS. In fact, there is a more basic
relationship between leverage scores and volume sampling: If set S is sampled according to size
s = d volume sampling, then the leverage score li of row i is the marginal probability P(i âˆˆ S) of
selecting i-th row into S. A general formula for the marginals of size s volume sampling is given in
the following proposit       
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
Proposition 4 Let X âˆˆ R
nÃ—d be a full rank matrix and s âˆˆ {d..n}. If S âŠ† {1..n} is sampled
according to size s volume sampling, then for any i âˆˆ {1..n},
P(i âˆˆ S) = s âˆ’ d
n âˆ’ d
+
n âˆ’ s
n âˆ’ d
li
z }| {
x
>
i
(X>X)
âˆ’1xi
.
Proof Instead of P(i âˆˆ S) we will first compute P(i /âˆˆ S):
P(i /âˆˆ S) = X
S:|S|=s,i /âˆˆS
det(X>
S XS)

nâˆ’d
sâˆ’d

det(X>X)
=
X
S:|S|=s,i /âˆˆS
P
T âŠ†S:|T|=d
det(X>
T XT )

nâˆ’d
sâˆ’d

det(X>X)
=

nâˆ’dâˆ’1
sâˆ’d

det(X>
âˆ’iXâˆ’i)
z X }| {
T:|T|=d,i /âˆˆT
det((Xâˆ’i)
>
T
(Xâˆ’i)T )

nâˆ’d
sâˆ’d

det(X>X)
=
n âˆ’ s
n âˆ’ d

1 âˆ’ x
>
i
(X>X)
âˆ’1xi

,
where we used Cauchy-Binet twice and the fact that every set T : |T| = d, i /âˆˆ T appears in

nâˆ’dâˆ’1
sâˆ’d

sets S : |S| = s, i /âˆˆ S. Now, the marginal probability follows from the fact that
P(i âˆˆ S) = 1 âˆ’ P(i /âˆˆ S).
2.2 Expectation Formulas for Volume Sampling
All expectations in the remainder of the paper are w.r.t. volume sampling. We use the short-hand
E[F(S)] for expectation with volume sampling where the size of the sampled set is fixed to s. The
expectation formulas for two choices of F(S) are proven in Theorems 5 and 6. By Lemma 1 it
suffices to show F(S) = P
iâˆˆS P(Sâˆ’i
|S)F(Sâˆ’i) for volume sampling. We also present a related
expectation formula (Theorem 7), which is proven later using different techniques.
Recall that XS is the submatrix of rows indexed by S âŠ† {1..n}. We also use a version of X in
which all but the rows of S are zeroed out. This matrix equals ISX where IS is an n-dimensional
diagonal matrix with (IS)ii = 1 if i âˆˆ S and 0 otherwise (see Figure 2).
Theorem 5 Let X âˆˆ R
nÃ—d be a tall full rank matrix (i.e. n â‰¥ d). For s âˆˆ {d..n}, let S âŠ† {1..n}
be a size s volume sampled set over X. Then
E[(ISX)
+] = X+.
For the special case of s = d, this fact was known in the linear algebra literature (Ben-Tal and
Teboulle, 1990; Ben-Israel, 1992). It was shown there using elementary properties of the determinant
such as Cramerâ€™s rule.4 The proof methodology developed here based on reverse iterative volume
4. Using the composition property of volume sampling (Corollary 3), the s > d case of the theorem can be reduced to
the s = d case. However, in this paper we give a different self-contained proof for Theorem      
DEREZINSKI AND Â´ WARMUTH
sampling is very different. We believe that this fundamental formula lies at the core of why volume
sampling is important in many applications. In this work, we focus on its application to linear
regression. However, Avron and Boutsidis (2013) discuss many problems where controlling the
pseudoinverse of a submatrix is essential. For those applications, it is important to establish variance
bounds for the above expectation and volume sampling once again offers very concrete guarantees.
We obtain them by showing the following formula, which can be viewed as a second moment for this
estimator.
Theorem 6 Let X âˆˆ R
nÃ—d be a full rank matrix and s âˆˆ {d..n}. If size s volume sampling over X
has full support, then
E[ (X>
S XS)
âˆ’1
| {z }
(ISX)+(ISX)+>
] = n âˆ’ d + 1
s âˆ’ d + 1
(X>X)
âˆ’1
| {z }
X+X+>
.
In the case when volume sampling does not have full support, then the matrix equality â€œ=â€ above is
replaced by the positive-definite inequality â€œâ€.
The condition that size s volume sampling over X has full support is equivalent to det(X>
S XS) > 0
for all S âŠ† {1..n} of size s. Note that if size s volume sampling has full support, then size t > s
also has full support. So full support for the smallest size d (often phrased as X being in general
position) implies that volume sampling w.r.t. any size s â‰¥ d has full support.
The above theorem immediately gives an expectation formula for the Frobenius norm k(ISX)
+kF
of the estimator:
E

k(ISX)
+k
2
F

= E[tr((ISX)
+(ISX)
+>)] = n âˆ’ d + 1
s âˆ’ d + 1
kX+k
2
F
. (2)
This norm formula was shown by Avron and Boutsidis (2013), with numerous applications. Theorem
6 can be viewed as a much stronger pre-trace version of the known norm formula. Also our proof
techniques are quite different and much simpler. Note that if size s volume sampling for X does not
have full support, then (2) becomes an inequality.
We now mention a second application of the above theorem in the context of linear regression for
the case when the response vector y is modeled as a noisy linear transformation, i.e., y = Xwe + Î¾
for some we âˆˆ R
d
and a random noise vector Î¾ âˆˆ R
n
(detailed discussion in Section 4). In this
case the matrix (X>
S XS)
âˆ’1
can be interpreted as the covariance matrix of least-squares estimator
wâˆ—
(S) (for a fixed set S) and Theorem 6 gives an exact formula for the covariance matrix of wâˆ—
(S)
under volume sampling. In Section 4, we give an extended version of this result which provides even
stronger guarantees for regularized least-squares estimators under this model (Theorem 16).
Note that except for the above application, all results in this paper hold for arbitrary response
vectors y. By combining Theorems 5 and 6, we can also obtain a covariance-type formula5
for the
pseudoinverse matrix estimator:
E[((ISX)
+ âˆ’ E[(ISX)
+]) ((ISX)
+ âˆ’ E[(ISX)
+])>]
= E[(ISX)
+(ISX)
+>] âˆ’ E[(ISX)
+] E[(ISX)
+]
>
=
n âˆ’ d + 1
s âˆ’ d + 1
X+X+> âˆ’ X+X+> =
n âˆ’ s
s âˆ’ d + 1
X+X+>. (3)
5. This notion of â€œcovarianceâ€ is used in random matrix theory, i.e. for a random matrix M, we analyze E[(M âˆ’
E[M])(M âˆ’ E[M])>]. See for example Tropp (2012).
10  
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
We now give the background for a third matrix expectation formula for volume sampling.
Pseudoinverses can be used to compute the projection matrix onto the span of columns of matrix X,
which is defined as follows:
PX
def
= X
X+
z }| {
(X>X)
âˆ’1X> .
Applying Theorem 5 leads us immediately to the following unbiased matrix estimator for the
projection matrix:
E[X(ISX)
+] = X E[(ISX)
+] = XX+ = PX.
Note that this matrix estimator X(ISX)
+ is closely connected to linear regression: It can be used to
transform the response vector y into the prediction vector yb(S) of subsampled least squares solution
wâˆ—
(S) as follows:
yb(S) = X (ISX)
+y
| {z }
wâˆ—(S)
.
In this case, volume sampling once again provides a covariance-type matrix expectation formula.
Theorem 7 Let X âˆˆ R
nÃ—d be a full rank matrix. If matrix X is in general position and S âŠ† {1..n}
is sampled according to size d volume sampling, then
E[ (X(ISX)
+)
2
| {z }
(ISX)+>X>X(ISX)+
] âˆ’ PX = d (I âˆ’ PX).
If X is not in general position, then the matrix equality â€œ=â€ is replaced by the positive-definite
inequality â€œâ€.
Note that this third expectation formula is limited to sample size s = d. It is a direct consequence of
Theorem 8 given in the next section which relates the expected loss of a subsampled least squares
estimator to the loss of the optimum least squares estimator. Unlike the first two formulas given in
theorems 5 and 6, its proof does not rely on the methodology of Lemma 1, i.e., on showing that the
expectations at all levels of a certain DAG associated with the sampling process are the same. We
defer the proof of this third expectation formula to the end of Section 3.3. No extension of this third
formula to sample size s > d is known.
Proof of Theorem 5 We apply Lemma 1 with F(S) = (ISX)
+. It suffices to show F(S) =
P
iâˆˆS P(Sâˆ’i
|S)F(Sâˆ’i) for P(Sâˆ’i
|S) = 1âˆ’x>
i
(X>
S XS)âˆ’1xi
sâˆ’d
, i.e.:
(ISX)
+ =
X
iâˆˆS
1 âˆ’ x
>
i
(X>
S XS)
âˆ’1xi
s âˆ’ d
(ISâˆ’iX)
+
| {z }
(X>
Sâˆ’i
XSâˆ’i
)âˆ’1(ISâˆ’iX)>
.
We first apply Sherman-Morrison to (X>
Sâˆ’iXSâˆ’i
)
âˆ’1 = (X>
S XS âˆ’ xix
>
i
)
âˆ’1 on the r.h.s. of the
above:
X
i
1 âˆ’ x
>
i
(X>
S XS)
âˆ’1xi
s âˆ’ d

(X>
S XS)
âˆ’1 +
(X>
S XS)
âˆ’1xix
>
i
(X>
S XS)
âˆ’1
1 âˆ’ x
>
i
(X>
S XS)âˆ’1xi

((ISX)
> âˆ’ xie
>
i
).
11
DEREZINSKI AND Â´ WARMUTH
Next we expand the last two factors into 4 terms. The expectation of the first (X>
S XS)
âˆ’1
(ISX)
> is
(ISX)
+ (which is the l.h.s.) and the expectations of the remaining three terms times s âˆ’ d sum to 0:
âˆ’
X
iâˆˆS
(1 âˆ’ x
>
i
(X>
S XS)
âˆ’1xi) (X>
S XS)
âˆ’1xie
>
i +âœ˜âœ˜âœ˜âœ˜âœ˜ (X>
S XS)
âˆ’1
âœš
âœš
âœš
X âœšâœš
iâˆˆS
xix
>
i
(X>
S XS)
âˆ’1
(ISX)
>
âˆ’
X
iâˆˆS
(X>
S XS)
âˆ’1xi (x
>
i
(X>
S XS)
âˆ’1xi)e
>
i = 0.
In Appendix B we give an alternate proof using a derivative argument.
Proof of Theorem 6 Choose F(S) = sâˆ’d+1
nâˆ’d+1 (X>
S XS)
âˆ’1
P
. By Lemma 1 it suffices to show F(S) =
iâˆˆS P(Sâˆ’i
|S)F(Sâˆ’i) for volume sampling:
s âˆ’ d + 1
âœ­âœ­âœ­âœ­âœ­ n âˆ’ d + 1
(X>
S XS)
âˆ’1 =
X
iâˆˆS
1 âˆ’ x
>
i
(X>
S XS)
âˆ’1xi
âœ˜s âˆ’âœ˜âœ˜d
âœ˜s âˆ’âœ˜âœ˜d
âœ­âœ­âœ­âœ­âœ­ n âˆ’ d + 1
(X>
Sâˆ’iXSâˆ’i
)
âˆ’1
.
To show this we apply Sherman-Morrison to (X>
Sâˆ’iXSâˆ’i
)
âˆ’1 on the r.h.s.:
X
iâˆˆS
(1 âˆ’ x
>
i
(X>
S XS)
âˆ’1xi)

(X>
S XS)
âˆ’1 +
(X>
S XS)
âˆ’1xix
>
i
(X>
S XS)
âˆ’1
1 âˆ’ x
>
i
(X>
S XS)âˆ’1xi

= (s âˆ’ d)(X>
S XS)
âˆ’1 +âœ˜âœ˜âœ˜âœ˜âœ˜ (X>
S XS)
âˆ’1
âœš
âœš
âœš
X âœšâœš
iâˆˆS
xix
>
i
(X>
S XS)
âˆ’1 = (s âˆ’ d + 1) (X>
S XS)
âˆ’1
.
If some denominators 1 âˆ’ x
>
i
(X>
S XS)
âˆ’1xi are zero, then we only sum over i for which the denominators are positive. In this case the above matrix equality becomes a positive-definite inequality .
3. Linear Regression with Smallest Number of Responses
Our main motivation for studying volume sampling came from asking the following simple question.
Suppose we want to solve a d-dimensional linear regression problem with an input matrix X of n
rows in R
d
and a response vector y âˆˆ R
n
, i.e. find w âˆˆ R
d
that minimizes the least squares loss
kXw âˆ’ yk
2 on all n rows. We use L(w) to denote this loss. The optimal weight vector minimizes
L(w), i.e.
wâˆ— def = argmin
wâˆˆRd
L(w) = X+y.
Computing it requires access to the input matrix X and the response vector y. Assume we are
given X but the access to response vector y is restricted. We are allowed to pick a random subset
S âŠ† {1..n} of fixed size s for which the responses yS for the submatrix XS are revealed to us, and
then must produce a weight vector w(X, S, yS) âˆˆ R
d
from a subset of row indices S of the input
matrix X and the corresponding responses yS. Our goal in this paper is to find a distribution on the
subsets S of size s and a weight function w(X, S, yS) s.t.6
âˆ€ (X, y) âˆˆ R
nÃ—d Ã— R
nÃ—1
: E [L(w(X, S, yS))] â‰¤ (1 + c)L(wâˆ—
),
6. Since the learner is given X, it is natural to define the optimal multiplicative constant specialized for each X:
cX,s = minc minP (Â·),w(Â·) maxy EP [L(w(X, S, yS))] â‰¤ (1 + c)L(wâˆ—
), where the domain for distribution P(Â·)
and weight function w(Â·) are sets of size s. Showing specialized bounds for cX,s is left for future research.
12
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
where c must be a fixed constant (that is independent of X and y). Throughout the paper we use
the one argument shorthand w(S) for the weight function w(X, S, yS). We assume that attaining
response values is expensive and ask the question: What is the smallest number of responses (i.e.
smallest size of S) for which such a multiplicative bound is possible? We will use volume sampling
to show that attaining d response values is sufficient and show that less than d responses is not.
L(Â·)
L(wâˆ—
)
E[L(wâˆ—
(S))]
L(wâˆ—
(Si))
L(wâˆ—
(Sj ))
wâˆ—
(Si) wâˆ— w (Sj )
âˆ— = E[wâˆ—
(S)]
d L(wâˆ—
)
Figure 4: Unbiased estimator wâˆ—
(S) in expectation suffers loss (d + 1)L(wâˆ—
).
Before we state our main upper bound based on
volume sampling, we make the following key observation: If for the subproblem (XS, yS) there is a
weight vector w(S) that has loss zero, then the algorithm has to predict with such a consistent weight
vector. This is because in that case the responses yS
can be extended to a response vector y for all of X s.t.
L(wâˆ—
) = 0. Thus since we aim for a multiplicative
loss bound, we force the algorithm to predict with the
optimum solution wâˆ—
(S)
def = (XS)
+yS whenever the
subproblem (XS, yS) has loss 0. In particular, when
|S| = d and XS has full rank, then there is a unique
consistent solution wâˆ—
(S) for the subproblem and the
learner must use the weight function w(S) = wâˆ—
(S).
Theorem 8 If the input matrix X âˆˆ R
nÃ—d
is in general position, then for any response vector
y âˆˆ R
n
, the expected square loss (on all n rows of X) of the optimal solution wâˆ—
(S) for the
subproblem (XS, yS), with the d-element set S obtained from volume sampling, is given by
E[L(wâˆ—
(S))] = (d + 1) L(wâˆ—
).
If X is not in general position, then the expected loss is upper-bounded by (d + 1) L(wâˆ—
).
There are no range restrictions on the n points and response values in this bound. Also, as discussed
in the introduction, this bound is already non-obvious for dimension 1, when the multiplicative factor
is 2 (See Figure 1 for a visualization). Note that if there is a bias term in dimension 1, then the factor
becomes 3.
In dimension d, it is instructive to look at the case when the square loss of the optimum solution
is zero, i.e. there is a weight vector wâˆ— âˆˆ R
d
s.t. Xwâˆ— = y. In this case the response values of any d
linearly independent rows of X determine the optimum solution and the multiplicative loss formula
of the theorem clearly holds. The formula specifies how noise-free case generalizes gracefully to
the noisy case in that for volume sampling, the expected square loss of the solution obtained from d
row response pairs is always by a factor of at most d + 1 larger than the square loss of the optimum
solution. Moreover, since E[wâˆ—
(S)] = wâˆ—
and the loss function L(Â·) is convex, we have by Jensenâ€™s
inequality that
E

L(wâˆ—
(S))

â‰¥ L

E[wâˆ—
(S)]

= L(wâˆ—
).
The above theorem now states that the gap E[L(wâˆ—
(S))] âˆ’ L(wâˆ—
) in Jensenâ€™s inequality (which
coincides with the â€œregretâ€ of the estimator) equals d L(wâˆ—
), when the expectation is w.r.t. size d
volume sampling and X is in general position (See Figure 4 for a schematic). As we will show in
Section 3.4, this gap also equals the variance E[kXwâˆ—
(S) âˆ’ Xwâˆ—k
2
] of the predictions since the
estimator is unbiased. In summary:
1   
DEREZINSKI AND Â´ WARMUTH
E

L(wâˆ—
(S))

âˆ’ L(
E[wâˆ—(S)]
z}|{
wâˆ—
)
| {z }
regret
= d L(wâˆ—
)
| {z }
gap in Jensenâ€™s
= E

kXwâˆ—
(S) âˆ’ Xwâˆ—
k
2

| {z }
variance
.
We now make a number of observations and present some lower bounds that highlight the upper
bound of the above theorem. Then, in Section 3.3 we prove the theorem and a matrix expectation
formula implied by it.
3.1 When X is not in General Position
The above theorem gives an equality for the expected loss of a volume-sampled solution. However,
this equality is only guaranteed to hold when matrix X is in general position. We give a minimal
example problem where the matrix X is not in general position and the equality of Theorem 8 turns
into a strict inequality. This shows that for the equality, the general position assumption is necessary.
If we apply even an infinitesimal additive perturbation to the matrix X of the example problem,
then the resulting matrix X is in general position and the equality holds. Note that even though the
optimum loss L(wâˆ—
) does not change significantly under such a perturbation, the expected sampling
loss E[L(wâˆ—
(S))] has to jump sufficiently to close the gap in the inequality. In our minimal example
problem, n = 3 and d = 2, and
X =
ï£«
ï£­
1 1
1 1
1 0
ï£¶
ï£¸ , y =
ï£«
ï£­
1
0
0
ï£¶
ï£¸ .
We have three 2-element subsets to sample from: S1 = {1, 2}, S2 = {2, 3}, S3 = {1, 3}. Notice
that the first two rows of X are identical, which means that the probability of sampling set S1 is
0 in the volume sampling process. The other two subsets, S2 and S3, form identical submatrices
XS2 = XS3
. Therefore they are equally probable. The optimal weight vectors for these sets are
wâˆ—
(S2) = (0, 0)> and wâˆ—
(S3) = (0, 1)>. Also wâˆ— = (0,
1
2
)
> and the expected loss is bounded as:
E[L(wâˆ—
(S))] = 1
2
1
z }| {
L(wâˆ—
(S2)) +1
2
1
z }| {
L(wâˆ—
(S3))
| {z }
1
<
3
z }| {
(d + 1)
1/2
z }| {
L(wâˆ—
)
| {z }
3/2
.
Now consider a slightly perturbed input matrix
X =
ï£«
ï£­
1 1 + 
1 1
1 0
ï£¶
ï£¸ ,
where  > 0 is arbitrarily small (We keep the response vector y the same). Now, there is no d Ã— d
submatrix that is singular, so the upper bound from Theorem 8 must be tight. The reason is that
even though subset S1 still has very small probability, its loss is very large, so the expectation
is significantly affected by this component, no matter how small  is. We see this directly in the
calculations. Let wâˆ—
and wâˆ—
(Si) be the corresponding solutions for the perturbed problem and its
subproblems. The volumes of the subproblems and their losses are:
det(X>
S1XS1
) = 
2 L(wâˆ—
(S1)) = 
âˆ’2
det(X>
S2XS2
) = 1 L(wâˆ—
(S2)) = 1
det(X>
S3XS3
) = (1 + )
2 L(wâˆ—
(S3)) = (1 + )
âˆ’2
L(wâˆ—
) = 1
2(1 +  + 
2)
.
14    
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
Note that for each subproblem, the product of volume times loss is equal to 1. Now the expected loss
can be easily computed, and we can see that the gap in the bound disappears (the denominator is the
normalizing constant for volume sampling):
E[L(wâˆ—
(S))] = 1 + 1 + 1

2 + 1 + (1 + )
2
= (d + 1) L(wâˆ—
).
3.2 Lower Bounds and the Importance of Joint Sampling
The factor d + 1 in Theorem 8 cannot, in general, be improved when selecting only d responses:
Proposition 9 For any d, there exists a least squares problem (X, y) with d + 1 rows in R
d
such
that for every d-element index set S âŠ† {1 .. d +1}, we have
L(wâˆ—
(S)) = (d + 1) L(wâˆ—
).
Proof Choose the input vectors xi (and rows x
>
i
) as the d + 1 corners of any simplex in R
d
centered
at the origin and choose all d + 1 responses as the same non-zero value Î±. For any Î±, the optimal
solution wâˆ— will be the all-zeros vector with loss
L(wâˆ—
) = (d + 1) Î±
2
.
On the other hand, taking any size d subset of indices S âŠ† {1 .. d +1}, the subproblem solution
wâˆ—
(S) will only produce loss on the left out input vector xi
, indexed with i 6âˆˆ S. To obtain the
prediction on xi
, we use a simple geometric argument. Observe that since the simplex is centered,
we can write the origin of R
d
in terms of the corners of the simplex as
0 =
X
k
xk = xi + d xÂ¯âˆ’i
, where xÂ¯âˆ’i
def
=
1
d
X
k6=i
xk.
Thus, the left out input vector xi equals âˆ’d xÂ¯âˆ’i
. The prediction of wâˆ—
(S) on this vector is
ybi = x
>
i wâˆ—
(S) = âˆ’d

1
d
X
k6=i
x
>
k

wâˆ—
(S) = âˆ’
X
k6=i
x
>
k wâˆ—
(S) = âˆ’dÎ±.
It follows that the loss of wâˆ—
(S) equals
L(wâˆ—
(S)) = (ybi âˆ’ yi)
2 = (âˆ’dÎ± âˆ’ Î±)
2 = (d + 1)2Î±
2 = (d + 1)L(wâˆ—
).
Moreover, it is easy to show that no deterministic algorithm for selecting d rows (without knowing
the responses) can guarantee a multiplicative loss bound with a factor less than n/d (Boutsidis et al.,
2013). For the sake of completeness, we show this here for d = 1:
Proposition 10 For any nÃ—1 input matrix X of all 1â€™s and any deterministic algorithm that chooses
some singleton set S = {i}, there is a response vector y for which the loss of the subproblem and
the optimal loss are related as follows:
L(wâˆ—
(S)) = n L(wâˆ—
).
15
DEREZINSKI AND Â´ WARMUTH
Proof If the response vector y is the vector of n 1â€™s except for a single 0 at index i, then we have
L(
0
z }| {
wâˆ—
({i})
| {z }
nâˆ’1
) = n L(
nâˆ’1
n
z}|{
wâˆ—
)
| {z }
nâˆ’1
n
.
Note that for the 1-dimensional example used in the proof, volume sampling would pick the
set S uniformly. For this distribution, the multiplicative factor drops from n down to 2, that is
E[L(wâˆ—
(S))] = 1
n
(n âˆ’ 1) + nâˆ’1
n
1 = 2 L(wâˆ—
).
The importance of joint sampling. Three properties of volume sampling play a crucial role in
achieving a multiplicative loss bound:
a) Randomness. No deterministic algorithm guarantees such a bound (see Proposition 10).
b) The chosen submatrices must have full rank. Choosing any rank deficient submatrix with
positive probability, does not allow for a multiplicative bound (see Propositions 11 and 12).
c) Jointness. No i.i.d. sampling procedure can achieve a multiplicative loss bound with O(d)
responses (see Corollary 13).
By jointly selecting subset S, volume sampling ensures that the corresponding input vectors xi
are well spread out in the input space R
d
. In particular, volume sampling does not put any probability
mass on sets S such that the rank of submatrix XS is less than d. Intuitively, selecting rank deficient
row subsets should not be effective, since such a choice leads to an under-determined least squares
problem. We make this simple statement more precise by showing that any randomized algorithm,
that with positive probability selects a rank deficient row subset, cannot achieve a multiplicative loss
bound. Intuitively if the algorithm picks a rank deficient subset then it is not clear how it should select
the weight vector w(S) given input matrix X, subset S and responses yS. We reasoned before that
w(S) must have loss 0 on the subproblem (XS, yS). However if rank(XS) < d, then the choice
of the weight vector w(S) with loss 0 is not unique and this causes positive loss for some response
vector y.
Proposition 11 If for any input matrix X, the algorithm samples a rank deficient subset S of rows
with positive probability, then the expected loss of the algorithm cannot be bounded by a constant
times the optimum loss for all response vectors y.
Note that this means in particular that if X has rank d, then sampling d âˆ’ 1 size subsets with positive
probability does not allow for a constant factor approximation.
Proof Let S be a rank deficient subset chosen with probability P(S) > 0. Since in our setup the
bound has to hold for all response vectors y we can imagine an adversary choosing a worst-case
y. This adversary gives all rows of XS the response value zero. Let w(S) be the plane produced
by the algorithm when choosing S and receiving the responses 0 for XS. Let i âˆˆ {1..n} s.t.
x
>
i
6âˆˆ row-span(XS) and let wâˆ— be any weight vector that gives response value 0 to all rows of XS
and response value x
>
i w(S) + Y to xi
. The adversary chooses y as Xwâˆ—
, i.e. it gives all points xj
not indexed by S and different from xi
the response values x
>
j wâˆ—
as well. Now wâˆ— has total loss 0
but w(S) has loss Y
2 on xi and the algorithmâ€™s expected total loss is â‰¥ P(S) Y
2
.
16
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
We now strengthen the above proposition in that whenever the sample S is rank deficient then
the loss of the optimum is zero while the loss of the algorithm is positive. However note that this
proposition is weaker than the above in that it only holds for specific input matrices.
Proposition 12 Let d â‰¤ n and let X be any input matrix of rank d consisting of n standard basis
row vectors in R
d
. Then for any randomized learning algorithm that with probability p selects a
subset S s.t. rank(XS) < d and any weight function w(Â·), there is a response vector y, satisfying:
L(wâˆ—
) = 0, and L(w(S)) > 0 with probability at least p.
Proof Let Q = {1, 2, . . . , 2
n}. The adversarial response vector y is constructed by carefully
selecting one of the weight vectors wâˆ— âˆˆ Qd
, and setting the response vector y to Xwâˆ—
. This ensures
that L(wâˆ—
) = 0 and since X consists of standard basis row vectors, the components of y lie in Q as
well. Note that if the learner does not discover wâˆ—
exactly, it will incur positive loss. Let H be the
set of all rank deficient sets in X, i.e. those that lack at least one of the standard basis vectors:
H = {S âŠ† {1..n} : rank(XS) < d}.
Suppose that given matrix X, the learner uses weight function w(S, yS). (Note that for the sake of
concreteness we stopped using the single argument shorthand for the weight function during this
proof.) We will count the number of possible inputs to this function, when S is a rank deficient index
set of the rows of X and the response vector yS is consistent with some wâˆ— âˆˆ Qd
. For any fixed
rank deficient set S, let t be the number of distinct basis vectors appearing in XS. Clearly t â‰¤ d âˆ’ 1.
Fix a subset T âŠ† S of size t s.t. XT contains all t basis vectors of XS exactly once (Thus the basis
vectors in XS\T are all duplicates). Since y âˆˆ Qn
, the components of yS also lie in Q and yS is
determined by the responses of yT . Clearly there are at most |Q|
dâˆ’1
choices for yT . It follows that
the number of possible input pairs (S, yS) for function w(Â·, Â·) under the above restrictions can be
bounded as



n
(S, yS) : [S âˆˆ H] and [yS = XSwâˆ—
for wâˆ— âˆˆ Q
d
]
o

 â‰¤ |H|
|{z}
<2n
max
SâˆˆH
|{XSwâˆ—
: wâˆ— âˆˆ Q
d
}|
| {z }
â‰¤|Q|
dâˆ’1
< 2
n
|Q|
dâˆ’1 = |Q
d
|.
So for every weight function w(Â·, Â·), there exists wâˆ— âˆˆ Qd
that is not present in the set {w(S, yS) :
S âˆˆ H}. Selecting y = Xwâˆ—
for the adversarial response vector, we guarantee that the learner picks
the wrong solution for every rank deficient set S and therefore receives positive loss w.p. at least p.
Using Proposition 12, we show that any i.i.d. row sampling distribution (like for example leverage
score sampling) requires â„¦(d log d) samples to get any multiplicative loss bound, either with high
probability or in expectation.
Corollary 13 Let d â‰¤ n and let X be any input matrix of rank d consisting of n standard basis
row vectors in R
d
. Then for any randomized learning algorithm which selects a random multiset
S âŠ† {1..n} of size |S| â‰¤ (d âˆ’ 1) ln(d) via i.i.d. sampling from any distribution and uses any weight
function w(S), there is a response vector y satisfying:
L(wâˆ—
) = 0, and L(w(S)) > 0 with probability at least 1/2.
17
DEREZINSKI AND Â´ WARMUTH
Proof Any i.i.d. sample of size at most (d âˆ’ 1) ln(d) with probability at least 1/2 does not contain
all of the unique standard basis vectors (Coupon Collector Problem7
). Thus, with probability at least
1/2 submatrix XS has rank less than d. Now, for any such algorithm we can use Proposition 12
to select a consistent adversarial response vector y such that with probability at least 1/2 the loss
L(w(S)) is positive.
Note that the corollary requires X to be of a restricted form that contains a lot of duplicate rows. It is
open whether this corollary still holds when X is an arbitrary full rank matrix.
3.3 Proof of the Loss Expectation Formula
First, we discuss several key connections between linear regression and volume, which are used
in the proof. Note that the loss L(wâˆ—
) suffered by the optimum weight vector can be written as
kyb âˆ’ yk
2
, the squared Euclidean distance between prediction vector yb = Xwâˆ—
and the response
vector y. Since yb is minimizing the distance from y to the subspace of R
n
spanning the feature
vectors {f1, . . . ,fd} (columns of X), it has to be the projection of y onto that subspace (see Figure
5). We denote this projection as PX y, as defined in Section 2.2. Note that PX is a linear mapping
from R
n onto the column span of the matrix X such that
for u âˆˆ span(X) u = PX y â‡” PX (u âˆ’ y) = 0 â‡” X>(u âˆ’ y) = 0. (4)
We next give a second geometric interpretation of the length kybâˆ’yk
2
. Let P be the parallelepiped
formed by the d column/feature vectors of the input matrix X. Furthermore, consider the extended
input matrix produced by adding the response vector y to X as an extra column:
Xe
def = (X, y) âˆˆ R
nÃ—(d+1)
. (5)
y
y
f1
f2
L(w*)
Figure 5: Prediction vector yb is a projection of y
onto the span of feature vectors fi
.
Using the â€œbase Ã— heightâ€ formula we can relate the
volume of P to the volume of Pe, the parallelepiped
formed by the d + 1 columns of Xe . Observe that Pe
has P as one of its faces, with the response vector y
representing the edge that protrudes from that face.
Hence the volume of Pe is the product of the volume
of P and the distance between y and span(X). This
distance equals kyb âˆ’ yk, since as discussed above, yb
is the projection of y onto span(X). Thus we have
det(Xe >Xe ) = det(X>X)L(wâˆ—
). (6)
Next, we present a proposition whose corollary is key to proving Theorem 8. Suppose that we
select one test row from the input matrix and use the remaining n âˆ’ 1 row response pairs as the
training set. The proposition relates the loss of the obtained solution on the test row to the total
leave-one-out loss an all rows.
Proposition 14 For any index i âˆˆ {1..n}, let wâˆ—
(âˆ’i) be the solution to the reduced linear regression
problem (Xâˆ’i
, yâˆ’i). Then
7. This was proven for uniform sampling in Theorem 1.24 of Auger and Doerr (2011). It can be shown that uniform
sampling is the best case for Coupon Collector Problem (Holst, 2001), so the bound holds for any i.i.d. sampling.
18
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
L(wâˆ—
(âˆ’i)) âˆ’ L(wâˆ—
) =
det(X>X)âˆ’det(X>
âˆ’iXâˆ’i
)
det(X>X)
z }| {
x
>
i
(X>X)
âˆ’1xi `i(wâˆ—
(âˆ’i)),
where `i(w)
def = (x
>
i w âˆ’ yi)
2
is the square loss of w on the i-th point.
An algebraic proof of this proposition essentially appears in the proof of Theorem 11.7 in CesaBianchi and Lugosi (2006). For the sake of completeness we give a new geometric proof of this
proposition in Appendix C using basic properties of volume, thus stressing the connection to volume
sampling.
Note that if matrix X has exactly n = d + 1 rows and the training matrix Xâˆ’i
is full rank, then
wâˆ—
(âˆ’i) has loss zero on all training rows. In this case we obtain a simpler relationship than the
proposition.
Corollary 15 If X has d + 1 rows and rank(Xâˆ’i) = d, then defining Xe as in (5), we have
det(Xe >Xe ) = det(X>
âˆ’iXâˆ’i) `i(wâˆ—
(âˆ’i)).
Proof By Proposition 14 and the fact that L(wâˆ—
(âˆ’i)) = `i(wâˆ—
(âˆ’i)), we have
det(X>X) L(wâˆ—
) = det(X>
âˆ’iXâˆ’i) `i(wâˆ—
(âˆ’i)).
The corollary now follows from the â€œbase Ã— heightâ€ formula for volume.
We are now ready to present the proof of Theorem 8. Recall that our goal is to find the expected
loss E[L(wâˆ—
(S))], where S is a size d volume sampled set.
Proof of Theorem 8 First, we rewrite the expectation as follows:
E[L(wâˆ—
(S))] = X
S,|S|=d
P(S)L(wâˆ—
(S)) = X
S,|S|=d
P(S)
Xn
j=1
`j (wâˆ—
(S))
=
X
S,|S|=d
X
j /âˆˆS
P(S) `j (wâˆ—
(S)) = X
T,|T|=d+1
X
jâˆˆT
P(Tâˆ’j ) `j (wâˆ—
(Tâˆ’j )). (7)
We now use Corollary 15 on the matrix XT and test row x
>
j
(assuming rank(XTâˆ’j
) = d):
P(Tâˆ’j ) `j (wâˆ—
(Tâˆ’j )) =
det(X>
Tâˆ’j
XTâˆ’j
)
det(X>X)
`j (wâˆ—
(Tâˆ’j )) = det(Xe >
T Xe T )
det(X>X)
. (8)
Since the summand does not depend on the index j âˆˆ T, the inner summation in (7) becomes a
multiplication by d + 1. This lets us write the expected loss as:
E[L(wâˆ—
(S))] = d + 1
det(X>X)
X
T,|T|=d+1
det(Xe >
T Xe T )
(1) = (d + 1)det(Xe >Xe )
det(X>X)
(2) = (d + 1)L(wâˆ—
), (9)
where (1) follows from the Cauchy-Binet formula and (2) is an application of the â€œbase Ã— heightâ€
formula. If X is not in general position, then for some summands in (8), rank(XTâˆ’j
) < d and
19
DEREZINSKI AND Â´ WARMUTH
P(Tâˆ’j ) = 0. Thus the left-hand side of (8) is 0, while the right-hand side is non-negative, so (9)
becomes an inequality, completing the proof of Theorem 8.
Lifting expectations to matrix form. We can now show the matrix expectation formula of Theorem
7 as a corollary to the loss expectation formula of Theorem 8. The key observation is that the loss
formula holds for arbitrary response vector y, which allows us to â€œliftâ€ it to the matrix form.
Proof of Theorem 7 Note, that the loss of least squares estimator can be written in terms of the
projection matrix PX:
L(wâˆ—
) = ky âˆ’ ybk
2 = k(I âˆ’ PX)yk
2 = y
>(I âˆ’ PX)
2y
(âˆ—)
= y
>(I âˆ’ PX) y,
where in (âˆ—) we used the following property of a projection matrix: P2
X = PX. Writing the loss
expectation of the subsampled estimator in the same form, we obtain:
E[L(wâˆ—
(S))] = E[ky âˆ’ yb(S)k
2
] = E[k(I âˆ’ X(ISX)
+)yk
2
]
= E[y
>(I âˆ’ X(ISX)
+)
2 y] = y
>E[(I âˆ’ X(ISX)
+)
2
] y.
Crucially, we are able to extract the response vector y out of the expectation formula, which allows
us to write the formula from Theorem 8 as follows:
y
> E[(I âˆ’ X(ISX)
+)
2
] y = y
>(d + 1)(I âˆ’ PX) y, âˆ€ y âˆˆ R
n
.
We now use the following elementary fact: If for two symmetric matrices A and B, we have
y
>Ay = y
>By, âˆ€y âˆˆ R
n
, then A = B.
8 This gives the matrix expectation formula:
E[(I âˆ’ X(ISX)
+)
2
] = (d + 1)(I âˆ’ PX).
Expanding square on the l.h.s. of the above and applying Theorem 5, we obtain the covariance-type
equivalent form stated in Theorem 7:
I âˆ’ 2
PX
z }| {
E[X(ISX)
+] +E[(X(ISX)
+)
2
] = (d + 1)(I âˆ’ PX)
â‡â‡’ E[(X(ISX)
+)
2
] âˆ’ PX = d (I âˆ’ PX).
3.4 Averaging Unbiased Estimators and the Open Problem for Worst-case Responses
As discussed at the beginning of Section 3, our goal is to find a way to sample a small index set S and
construct a weight function w(S) which uses responses yS so that E[L(w(S))] â‰¤ (1 + c) L(wâˆ—
),
where the multiplicative factor 1 + c is bounded for all input matrices X and all response vectors
y. Recall that L(Â·) denotes the square loss on all rows and wâˆ—
is the optimal solution based on all
responses. We show in the previous subsections that the smallest size of S for which this goal can be
achieved is d (There is no sampling procedure for sets of size less than d and weight function w(S)
for which this factor is finite). We also prove that when sets S of size d are drawn proportional to
8. Similarly, if y
>Ay â‰¤ y
>By, âˆ€y âˆˆ R
n
, then the positive-definite inequality A  B holds for the matrices.
20
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
the squared volume of XS (i.e. det(X>
S XS)), then E[L(wâˆ—
(S))] â‰¤ (d + 1)L(wâˆ—
), where the factor
d + 1 is optimal for some X and y. Here wâˆ—
(S) denotes the linear least squares solution for the
subproblem (XS, yS).
A natural more general goal is to get arbitrarily close to the optimum loss. That is, for any ,
what is the smallest sample size |S| = s for which there is a sampling distribution over subsets
S and a weight function w(S) built from X and yS, such that E[L(w(S))] â‰¤ (1 + )L(wâˆ—
). A
related bound for i.i.d. leverage score sampling states that a sample size of O(d log d +
d

) suffices to
achieve a 1 +  factor with high probability (Hsu, 2017; Derezinski, 2018), however this does not Â´
imply multiplicative bounds in expectation.
9
We conjecture that some form of volume sampling can be used to achieve the 1 +  factor
with sample size O(
d

), in expectation. How close can we get with the techniques presented in
this paper? We showed that size d volume sampling achieves a factor of 1 + d, but we do not
know how to generalize this proof to sample size larger than d. However, one unique property of
the volume-sampled estimator wâˆ—
(S) that can be useful here is that it is an unbiased estimator
of wâˆ—
. As we shall see now, this basic property has many benefits. For any unbiased estimator
(i.e. E[w(S)] = wâˆ—
) and optimal prediction vector yb = Xwâˆ—
, consider the following rudimentary
version of a bias-variance decomposition:
E kX w(S) âˆ’ yk
2
| {z }
L(w(S))
= E kX w(S) âˆ’ yb + yb âˆ’ yk
2 = E kX w(S) âˆ’ ybk
2 + kyb âˆ’ yk
2
| {z }
L(wâˆ—)
. (10)
The unbiasedness of the estimator assures that the cross term (X
wâˆ—
z }| {
E[w(S)] âˆ’yb)
>(yb âˆ’ y) is 0.
Therefore a 1 + c factor loss bound is equivalent to a c factor variance bound, i.e.
loss bound
z }| {
E[L(w(S))] â‰¤ (1 + c)L(wâˆ—
) â‡â‡’
variance bound
z }| {
E kX w(S) âˆ’ ybk
2 â‰¤ c L(wâˆ—
). (11)
To reduce the variance of any unbiased estimator w(S) (i.e. E[w(S)] = wâˆ—
) with sample size s, we
can draw k independent samples S1, . . . , Sk of size s each and predict with the average estimator
1
k
Pk
j=1 w(Sj ). If the loss bound from (11) holds for w(S), then the average estimator satisfies
E

L
1
k
X
j
w(Sj )


â‰¤

1 +
c
k

L(wâˆ—
).
Setting k = c/, we need t = s c/ responses to get a 1 +  approximation. We showed that size
s = d volume sampling achieves factor c = d. So with our current proof techniques, we need
t = d
2/ responses to get a 1 +  factor approximation, for  âˆˆ (0, d].
10
9. Also, the weight vectors produced from i.i.d. leverage score sampling are not unbiased.
10. Thus when averaging the estimators of k = t/d independent volume sampled sets of size d,
E

L

1
k
X
j
w
âˆ—
(Sj )

âˆ’ L(w
âˆ—
)
| {z }
regret
=
d
2L(wâˆ—
)
t
| {z }
prediction variance
, when X is in general position.
21
DEREZINSKI AND Â´ WARMUTH
The basic open problem for worst-case responses is the following: Is there a size O(d/)
unbiased estimator that achieves a 1 +  factor approximation?11 By the above averaging method
this is equivalent to the following question: Is there a size O(d) unbiased estimator that achieves a
constant factor? This is because once we have an unbiased estimator that achieves a constant factor,
then by averaging 1/ copies, we get the 1 + O() factor. Ideally the special unbiased estimators
resulting from a version of volume sampling can achieve this feat. We conclude this section with
our favorite open problem: Is there a version of O(d) size volume sampling that achieves a constant
factor approximation?
In the next section we make some minimal statistical assumptions on the response vector which
let us prove much stronger bounds: We assume that the response vector is linear plus bounded noise
of mean zero. In particular we show that with this noise model, O(d) size volume sampling achieves
a constant factor approximation.
4. Regularized Volume Sampling for Learning with Noisy Responses
Algorithm 1 Î»-regularized v. sampling
S â† {1..n}
while |S| > s
âˆ€iâˆˆS : hi â†
det(X>
Sâˆ’i
XSâˆ’i+Î»I)
det(X>
S XS+Î»I)
Sample i âˆ hi out of S
S â† S âˆ’ {i}
end
return S
Volume sampling, as defined in Section 2.1, has certain
fundamental limitations. Namely, it is undefined whenever
matrix X is not full rank or if we wish to sample a subset S
of size smaller than the dimension d. Motivated by these
limitations, we propose a regularized variant, called Î»regularized volume sampling, which we define through a
generalization of the reverse iterative sampling procedure:
P(Sâˆ’i
| S) âˆ
det(X>
Sâˆ’iXSâˆ’i + Î»I)
det(X>
S XS + Î»I)
. (12)
The normalization factor of this conditional probability (i.e. the sum of (12) over i âˆˆ S) can be
computed using Sylvesterâ€™s theorem:
X
iâˆˆS
det(X>
Sâˆ’iXSâˆ’i + Î»I)
det(X>
S XS + Î»I)
=
X
iâˆˆS

1 âˆ’ x
>
i
(X>
S XS + Î»I)
âˆ’1xi

= |S| âˆ’ tr
XS(X>
S XS + Î»I)
âˆ’1X>
S
)
= |S| âˆ’ d + Î» tr
(X>
S XS + Î»I)
âˆ’1

. (13)
Note that in the special case of no regularization (i.e. Î» = 0) the last trace vanishes and (13) is equal
to |S| âˆ’ d, so we recover volume sampling from Section 2.1. However, when Î» > 0, then the last
term is non-zero and depends on the entire matrix XS. This makes regularized volume sampling
more complicated and certain equalities proven in previous sections for Î» = 0 no longer hold. In
particular, the analogous closed form of the sampling probability P(S) given in Theorem 2 is not
recovered because the paths from node {1..n} to node S in the graph of Figure 3 do not all have the
same probability. However, the proof technique we developed for reverse iterative sampling can still
be applied, resulting in the following extension of the variance formula of Theorem 6:
11. In a recent paper (Chen and Price, 2017) a 1 +  factor approximation has been achieved with O(d/) examples (for
 âˆˆ (0, 1]), but the guarantee holds with high probability (and not in expectation) and the estimator is not unbiased.   
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
Theorem 16 For any X âˆˆ R
nÃ—d
, Î» â‰¥ 0, let S be sampled according to Î»-regularized size s volume
sampling from X. Then,
E

(X>
S XS + Î»I)
âˆ’1


n âˆ’ dÎ» + 1
s âˆ’ dÎ» + 1
(X>X + Î»I)
âˆ’1
for any s â‰¥ dÎ»
def = tr(X(X>X + Î»I)
âˆ’1X>).
Constant dÎ» is a common notion of statistical dimension often referred to as the effective degrees
of freedom. If Î»i are the eigenvalues of X>X, then dÎ» =
Pd
i=1
Î»i
Î»i+Î»
. Note that dÎ» is decreasing
with Î» and, when X is full rank, d0 = d. Thus, unlike Theorem 6, the above result offers meaningful
bounds for sampling sets S of size smaller than d.
Proof To obtain Theorem 16, we use essentially the same methodology as described in Lemma
1, except in the regularized case equality is replaced with inequality. Recall that using Sylvesterâ€™s
theorem we can compute the unnormalized conditional probability from (12) as:
hi =
det(X>
Sâˆ’iXSâˆ’i + Î»I)
det(X>
S XS + Î»I)
= 1 âˆ’ x
>
i
(X>
S XS + Î»I)
âˆ’1xi
.
From now on, we will use ZÎ»(S) = X>
S XS + Î»I as a shorthand in the proofs. Next, letting
M =
P
iâˆˆS
hi
, we compute unnormalized expectation by applying the Sherman-Morrison formula:
M E

(X>
Sâˆ’iXSâˆ’i + Î»I)
âˆ’1
| S

=
X
iâˆˆS
hiZÎ»(Sâˆ’i)
âˆ’1 =
X
iâˆˆS
hi

ZÎ»(S)
âˆ’1 +
ZÎ»(S)
âˆ’1xix
>
i ZÎ»(S)
âˆ’1
1 âˆ’ x
>
i ZÎ»(S)
âˆ’1xi

= M ZÎ»(S)
âˆ’1 + ZÎ»(S)
âˆ’1
X
iâˆˆS
xix
>
i

ZÎ»(S)
âˆ’1
= M ZÎ»(S)
âˆ’1 + ZÎ»(S)
âˆ’1
(ZÎ»(S) âˆ’ Î»I)ZÎ»(S)
âˆ’1
= M ZÎ»(S)
âˆ’1 + ZÎ»(S)
âˆ’1 âˆ’ Î»ZÎ»(S)
âˆ’2
 (M + 1) ZÎ»(S)
âˆ’1
.
Finally, the normalization factor M (which we already computed in (13)) can be lower-bounded
using the Î»-statistical dimension dÎ» of matrix X:
M =
X
iâˆˆS
(1 âˆ’ x
>
i ZÎ»(S)
âˆ’1xi) = s âˆ’ d + Î» tr(ZÎ»(S)
âˆ’1
) â‰¥ s âˆ’

dâˆ’Î» tr(ZÎ»({1..n})
âˆ’1
)
| {z }
dÎ»

.
Putting the bounds together, we obtain that:
E

(X>
Sâˆ’iXSâˆ’i + Î»I)
âˆ’1
| S


s âˆ’ dÎ» + 1
s âˆ’ dÎ»
(X>
S XS + Î»I)
âˆ’1
.
To prove Theorem 16 it remains to chain the conditional expectations along the sequence of subsets
obtained by Î»-regularized volume sampling:
E

ZÎ»(S)
âˆ’1


 Yn
t=s+1
t âˆ’ dÎ» + 1
t âˆ’ dÎ»
!
ZÎ»({1..n})
âˆ’1 =
n âˆ’ dÎ» + 1
s âˆ’ dÎ» + 1
(X>X + Î»I)
âˆ’1
.
2         
DEREZINSKI AND Â´ WARMUTH
4.1 Ridge Regression with Noisy Responses
We apply the above result to obtain statistical guarantees for subsampling with regularized estimators.
Given a matrix X âˆˆ R
nÃ—d
, we consider the task of fitting a linear model to a vector of responses
y = Xwe + Î¾, where we âˆˆ R
d
and the noise Î¾ âˆˆ R
n
is a mean zero random vector with covariance
matrix Var[Î¾]  Ïƒ
2
I for some Ïƒ > 0. A classical solution to this task is the ridge estimator:
wâˆ—
Î» = argmin
wâˆˆRd
kXw âˆ’ yk
2 + Î»kwk
2 = (X>X + Î»I)
âˆ’1X>y.
As a consequence of Theorem 16, we show that if S is sampled with Î»-regularized volume sampling
from X, then the ridge estimator for the subproblem (XS, yS)
wâˆ—
Î»
(S) = (X>
S XS + Î»I)
âˆ’1X>
S yS
has strong generalization properties with respect to the full problem (X, y) in terms of the mean
squared prediction error (MSPE) and mean squared error (MSE).
Theorem 17 Let X âˆˆ R
nÃ—d and we âˆˆ R
d
, and suppose that y = Xwe + Î¾, where Î¾ is a mean
zero vector with Var[Î¾]  Ïƒ
2
I. Let S be sampled according to Î»-regularized size s â‰¥ dÎ» volume
sampling from X and wâˆ—
Î»
(S) be the Î»-ridge estimator of we computed from subproblem (XS, yS).
Then, if Î» â‰¤
Ïƒ
2
kwe k
2 , we have
(mean squared prediction error) ESEÎ¾
h
1
n
kX(wâˆ—
Î»
(S) âˆ’ we )k
2
i
â‰¤
Ïƒ
2dÎ»
s âˆ’ dÎ» + 1
,
(mean squared error) ESEÎ¾

kwâˆ—
Î»
(S) âˆ’ we k
2

â‰¤
Ïƒ
2n tr((X>X + Î»I)
âˆ’1
)
s âˆ’ dÎ» + 1
.
Next, we present two lower bounds for MSPE of a subsampled ridge estimator which show that
the statistical guarantees achieved by regularized volume sampling are nearly optimal for s  dÎ»
and better than standard approaches for s = O(dÎ»). In particular, we show that non-i.i.d. nature
of volume sampling is essential if we want to achieve good generalization when the number of
responses is close to dÎ». Namely for certain data matrices, any i.i.d. subsampling procedure (such as
i.i.d. leverage score sampling) requires at least dÎ» ln(dÎ») responses to achieve MSPE below Ïƒ
2
. In
contrast volume sampling obtains that bound for any matrix with 2dÎ» responses.
Theorem 18 For any p â‰¥ 1 and Ïƒ â‰¥ 0, there is d â‰¥ p such that for any sufficiently large n divisible
by d, there exists a matrix X âˆˆ R
nÃ—d
such that
dÎ»(X) â‰¥ p for any 0 â‰¤ Î» â‰¤ Ïƒ
2
,
and for each of the following two statements there is a vector we âˆˆ R
d
for which the corresponding
regression problem y = Xwe + Î¾ with Var[Î¾] = Ïƒ
2
I satisfies that statement:
a) For any subset S âŠ† {1..n} of size s,
EÎ¾
h
1
n
kX(wâˆ—
Î»
(S) âˆ’ we )k
2
i
â‰¥
Ïƒ
2dÎ»
s + dÎ»
;
24  
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
b) For multiset S âŠ† {1..n} of size s â‰¤ (dÎ»âˆ’1) ln(dÎ»), sampled i.i.d. from any distribution over
{1..n},
ESEÎ¾
h
1
n
kX(wâˆ—
Î»
(S) âˆ’ we )k
2
i
â‰¥ Ïƒ
2
.
Proof of Theorem 17 Standard analysis for the ridge regression estimator follows by performing
bias-variance decomposition of the error, and then selecting Î» so that bias can be appropriately
bounded. We will recall this calculation for a fixed subproblem (XS, yS). First, we compute the bias
of the ridge estimator for a fixed set S (recall the shorthand ZÎ»(S) = X>
S XS + Î»I):
BiasÎ¾[wâˆ—
Î»
(S)] = E[wâˆ—
Î»
(S)] âˆ’ we = EÎ¾ [ZÎ»(S)
âˆ’1X>
S yS] âˆ’ we
= ZÎ»(S)
âˆ’1X>
S
(XSwe +âœ˜E âœ˜âœ˜ Î¾[Î¾S
]) âˆ’ we
= (ZÎ»(S)
âˆ’1X>
S XS âˆ’ I)we = âˆ’Î» ZÎ»(S)
âˆ’1we .
Similarly, the covariance matrix of wâˆ—
Î»
(S) is given by:
VarÎ¾[wâˆ—
Î»
(S)] = ZÎ»(S)
âˆ’1X>
S VarÎ¾[Î¾S
]XSZÎ»(S)
âˆ’1
 Ïƒ
2ZÎ»(S)
âˆ’1X>
S XSZÎ»(S)
âˆ’1 = Ïƒ
2
(ZÎ»(S)
âˆ’1 âˆ’ Î» ZÎ»(S)
âˆ’2
).
Mean squared error of the ridge estimator for a fixed subset S can now be bounded by:
EÎ¾

kwâˆ—
Î»
(S) âˆ’ we k
2

= tr(VarÎ¾[wâˆ—
Î»
(S)]) + kBiasÎ¾[wâˆ—
Î»
(S)]k
2
â‰¤ Ïƒ
2
tr(ZÎ»(S)
âˆ’1âˆ’ Î»ZÎ»(S)
âˆ’2
) + Î»
2
tr(ZÎ»(S)
âˆ’2we we
>)
â‰¤ Ïƒ
2
tr(ZÎ»(S)
âˆ’1
) + Î»tr(ZÎ»(S)
âˆ’2
)(Î»kwe k
2âˆ’ Ïƒ
2
) (14)
â‰¤ Ïƒ
2
tr(ZÎ»(S)
âˆ’1
), (15)
where in (14) we applied Cauchy-Schwartz inequality for matrix trace, and in (15) we used the
assumption that Î» â‰¤
Ïƒ
2
kwe k
2 . Thus, taking expectation over the sampling of set S, we get
ESEÎ¾

kwâˆ—
Î»
(S) âˆ’ we k
2

â‰¤ Ïƒ
2ES

tr(ZÎ»(S)
âˆ’1
)

(Theorem 16) â‰¤ Ïƒ
2 n âˆ’ dÎ» + 1
s âˆ’ dÎ» + 1
tr(ZÎ»({1..n})
âˆ’1
) (16)
â‰¤
Ïƒ
2 n tr((X>X + Î»I)
âˆ’1
)
s âˆ’ dÎ» + 1
.
Next, we bound the mean squared prediction error. As before, we start with the standard bias-variance
decomposition for fixed set S:
EÎ¾

kX(wâˆ—
Î»
(S)âˆ’we )k
2

= tr(VarÎ¾[Xwâˆ—
Î»
(S)]) + kX(EÎ¾[wâˆ—
Î»
(S)] âˆ’ we )k
2
â‰¤ Ïƒ
2
tr(X(ZÎ»(S)
âˆ’1âˆ’Î» ZÎ»(S)
âˆ’2
)X>) + Î»
2
tr(ZÎ»(S)
âˆ’1X>XZÎ»(S)
âˆ’1we we
>)
â‰¤ Ïƒ
2
tr(XZÎ»(S)
âˆ’1X>) + Î» tr(XZÎ»(S)
âˆ’2X>)(Î»kwe k
2 âˆ’ Ïƒ
2
)
â‰¤ Ïƒ
2
tr(XZÎ»(S)
âˆ’1X>).
25        
DEREZINSKI AND Â´ WARMUTH
Once again, taking expectation over subset S, we have
ESEÎ¾
h
1
n
kX(wâˆ—
Î»
(S) âˆ’ we )k
2
i
â‰¤
Ïƒ
2
n
ES

tr(XZÎ»(S)
âˆ’1X>)

=
Ïƒ
2
n
tr(X ES[ZÎ»(S)
âˆ’1
] X>)
(Theorem 16) â‰¤
Ïƒ
2
n
n âˆ’ dÎ» + 1
s âˆ’ dÎ» + 1
tr(XZÎ»({1..n})
âˆ’1X>) â‰¤
Ïƒ
2dÎ»
s âˆ’ dÎ» + 1
. (17)
The key part of proving both bounds is the application of Theorem 16. For MSE, we only used the
trace version of the inequality (see (16)), however to obtain the bound on MSPE we used the more
general positive semi-definite inequality in (17).
Proof of Theorem 18 Let d = dpe + 1 and n â‰¥ dÏƒ
2
ed(d âˆ’ 1) be divisible by d. We define
X
def = [I, ..., I]
> âˆˆ R
nÃ—d
, we
> def = [aÏƒ, ..., aÏƒ] âˆˆ R
d
for some a > 0. For any Î» â‰¤ Ïƒ
2
, the Î»-statistical dimension of X is
dÎ» = tr(X ZÎ»({1..n})
âˆ’1X>) â‰¥
dÏƒ
2
ed(d âˆ’ 1)
dÏƒ
2e(d âˆ’ 1) + Î»
â‰¥
d(d âˆ’ 1)
d âˆ’ 1 + 1
â‰¥ p.
Let S âŠ† {1..n} be any set of size s, and for i âˆˆ {1..d} let si
def
= |{i âˆˆ S : xi = ei}|. The prediction
variance of estimator wâˆ—
Î»
(S) is equal to
tr
VarÎ¾[Xwâˆ—
Î»
(S)]

= Ïƒ
2
tr(X(ZÎ»(S)
âˆ’1âˆ’ Î»ZÎ»(S)
âˆ’2
)X>)
=
Ïƒ
2n
d
X
d
i=1

1
si + Î»
âˆ’
Î»
(si + Î»)
2

=
Ïƒ
2n
d
X
d
i=1
si
(si + Î»)
2
.
The prediction bias of estimator wâˆ—
Î»
(S) is equal to
kX(EÎ¾[wâˆ—
Î»
(S)] âˆ’ we )k
2 = Î»
2we
>ZÎ»(S)
âˆ’1X>XZÎ»(S)
âˆ’1we
=
Î»
2a
2Ïƒ
2n
d
tr
ZÎ»(S)
âˆ’2

=
Î»
2a
2Ïƒ
2n
d
X
d
i=1
1
(si + Î»)
2
.
Thus, MSPE of estimator wâˆ—
Î»
(S) is given by:
EÎ¾
h
1
n
kX(wâˆ—
Î»
(S) âˆ’ we )k
2
i
=
1
n
tr
VarÎ¾[Xwâˆ—
Î»
(S)]

+
1
n
kX(EÎ¾[wâˆ—
Î»
(S)] âˆ’ we )k
2
=
Ïƒ
2
d
X
d
i=1

si
(si + Î»)
2
+
a
2Î»
2
(si + Î»)
2

=
Ïƒ
2
d
X
d
i=1
si + a
2Î»
2
(si + Î»)
2
.
Next, we find the Î» that minimizes this expression. Taking the derivative with respect to Î» we get:
âˆ‚
âˆ‚Î»
Ïƒ
2
d
X
d
i=1
si + a
2Î»
2
(si + Î»)
2
!
=
Ïƒ
2
d
X
d
i=1
2si(Î» âˆ’ a
âˆ’2
)
(si + Î»)
3
.     
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
Thus, since at least one si has to be greater than 0, for any set S the derivative is negative for
Î» < aâˆ’2
and positive for Î» > aâˆ’2
, and the unique minimum of MSPE is achieved at Î» = a
âˆ’2
,
regardless of which subset S is chosen. So, as we are seeking a lower bound, we can focus on the
case of Î» = a
âˆ’2
.
Proof of part a. Let a = 1. As shown above, we can assume that Î» = 1. In this case the formula
simplifies to:
EÎ¾
h
1
n
kX(wâˆ—
Î»
(S) âˆ’ we )k
2
i
=
Ïƒ
2
d
X
d
i=1
si + 1
(si + 1)2
=
Ïƒ
2
d
X
d
i=1
1
si + 1
(âˆ—)
â‰¥
Ïƒ
2
s
d + 1
=
Ïƒ
2d
s + d
â‰¥
Ïƒ
2dÎ»
s + dÎ»
,
where (âˆ—) follows by applying Jensenâ€™s inequality to convex function Ï†(x) = 1
x+1 .
Proof of part b. Let a =
âˆš
2d. As shown above, we can assume that Î» = 1/(2d). Suppose that
multiset S is sampled i.i.d. from some distribution over set {1..n}. Similarly as in Corollary 13, we
exploit the Coupon Collectorâ€™s problem, i.e. that if |S| â‰¤ (d âˆ’ 1) ln(d), then with probability at least
1/2 there is i âˆˆ {1..d} such that si = 0 (i.e., one of the unit vectors ei was never selected). Thus,
MSPE can be lower-bounded as follows:
ESEÎ¾
h
1
n
kX(wâˆ—
Î»
(S) âˆ’ we )k
2
i
â‰¥
1
2
Ïƒ
2
d
si + a
2Î»
2
(si + Î»)
2
=
Ïƒ
2
2d
2dÎ»2
Î»2
= Ïƒ
2
.
5. Efficient Algorithms for Volume Sampling
In this section we propose algorithms for efficiently performing volume sampling. This addresses
the question posed by Avron and Boutsidis (2013), asking for a polynomial-time algorithm for
the case when the size of set S is s > d. Deshpande and Rademacher (2010) gave an algorithm
for the case when s = d, which was later improved by Guruswami and Sinop (2012), running in
time O(nd3
). Recently, Li et al. (2017) offered an algorithm for arbitrary s, which has complexity
O(n
4
s). We propose two new methods, which use our reverse iterative sampling technique to achieve
faster running times for volume sampling of any size s. Both algorithms apply to the more general
setting of Î»-regularized volume sampling (described in Section 4), and produce standard volume
sampling as a special case for Î» = 0 and s â‰¥ d. The first algorithm has a deterministic runtime
of O((nâˆ’s+d)nd), whereas the second one is an accelerated version which with high probability
finishes in time O(nd2
). Thus, we obtain a direct improvement over Li et al. (2017) by a factor of
at least n
2
, and in the special case of s = d, by a factor of d over the algorithm of Guruswami and
Sinop (2012).
Our algorithms implement reverse iterative sampling from Theorem 2. We start with the full
index set S = {1..n}. In one step of the algorithm, we remove one row from set S. After removing
q rows, we are left with the index set of size n âˆ’ q that is distributed according to volume sampling
for row set size n âˆ’ q, and we proceed until our set S has the desired size s. The primary cost of the
procedure is updating the conditional distribution P(Sâˆ’i
|S) at every step. It is convenient to store it
using the unnormalized weights defined in (12) which, via Sylvesterâ€™s theorem, can be computed as
hi = 1 âˆ’ x
>
i
(X>
S XS + Î»I)
âˆ’1xi (For the sake of generality we state the methods for Î»-regularized
27
DEREZINSKI AND Â´ WARMUTH
volume sampling). Doing this naively, we would first compute (X>
S XS + Î»I)
âˆ’1 which takes O(nd2
)
time12. After that for each i, we would multiply this matrix by xi
in time O(d
2
) to get the hiâ€™s. The
overall runtime of this naive method becomes:
nâˆ’s
z }| {
# of steps Ã— (
O(nd2
)
z }| {
compute (X>
S XS + Î»I)
âˆ’1 +
â‰¤n
z }| {
# of weights Ã—
O(d
2
)
z }| {
compute hi ) = O((n âˆ’ s)nd2
).
Both the computation of matrix inverse and the weights hi can be made more efficient. First, the
matrix (X>
S XS + Î»I)
âˆ’1
can be computed from the one obtained in the previous step by using the
Sherman-Morrison formula. This lets us update it in O(d
2
) time instead of O(nd2
). Furthermore,
we propose two strategies for dealing with the cost of maintaining the weights:
a) Update all hiâ€™s at every step using Sherman-Morrison;
b) Use rejection sampling and only compute the hiâ€™s needed for the rejection trials (This avoids
computing all hiâ€™s, but makes the computation of each needed hi more expensive).
As we can see, there is a trade-off between those strategies. In the following lemma, we will show
that updating the value of hi
, given its value in the previous step only costs O(d) time as opposed
to O(d
2
). However, the number of hiâ€™s that need to be computed for rejection sampling (explained
shortly) can be far smaller.
Lemma 19 For any matrix X âˆˆ R
nÃ—d
, set S âŠ† {1..n} and two distinct indices i, j âˆˆ S, we have
1 âˆ’ x
>
j
(X>
Sâˆ’iXSâˆ’i+ Î»I)
âˆ’1xj = hj âˆ’ (x
>
j v)
2
,
where hj = 1 âˆ’ x
>
j
(X>
S XS + Î»I)
âˆ’1xj and v = âˆš
1
hi
(X>
S XS + Î»I)
âˆ’1xi
.
Proof Letting ZÎ»(S) = X>
S XS + Î»I, we have
hj âˆ’ (x
>
j v)
2 = 1 âˆ’ x
>
j ZÎ»(S)
âˆ’1xj âˆ’
(x
>
j ZÎ»(S)
âˆ’1xi)
2
1 âˆ’ x
>
i ZÎ»(S)
âˆ’1xi
= 1 âˆ’ x
>
j ZÎ»(S)
âˆ’1xj âˆ’
x
>
j ZÎ»(S)
âˆ’1xix
>
i ZÎ»(S)
âˆ’1xj
1 âˆ’ x
>
i ZÎ»(S)
âˆ’1xi
= 1 âˆ’ x
>
j

ZÎ»(S)
âˆ’1 +
ZÎ»(S)
âˆ’1xix
>
i ZÎ»(S)
âˆ’1
1 âˆ’ x
>
i ZÎ»(S)
âˆ’1xi

xj
(âˆ—)
= 1 âˆ’ x
>
j
(X>
Sâˆ’iXSâˆ’i + Î»I)
âˆ’1xj ,
where (âˆ—) follows from the Sherman-Morrison formula.
Thus the overall time complexity of reverse iterative sampling when using the first strategy goes
down by a factor of d compared to the naive version (except for an initialization cost which stays at
O(nd2
)).
Theorem 20 Algorithm RegVol produces an index set S of rows distributed according to Î»-regularized
size s volume sampling over X in time O((nâˆ’s+d)nd).
12. We are primarily interested in the case where n â‰¥ d and we state our time bounds under that assumption. However,
when Î» > 0, our techniques can be easily adapted to the case of n < d.
28
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
Proof Using Lemma 19 for hi and the Sherman-Morrison formula for Z, the following invariants
hold at the beginning of the while loop:
hi = 1 âˆ’ x
>
i
(X>
S XS + Î»I)
âˆ’1xi and Z = (X>
S XS + Î»I)
âˆ’1
.
Runtime: Computing the initial Z = (X>X + Î»I)
âˆ’1
takes O(nd2
), as does computing the initial
values of hj â€™s. Inside the while loop, updating hj â€™s takes O(|S|d) = O(nd) and updating Z takes
O(d
2
). The overall runtime becomes O(nd2 + (n âˆ’ s)nd) = O((n âˆ’ s + d)nd).
Algorithm 2 RegVol(X, s, Î»)
1: Z â† (X>X + Î»I)
âˆ’1
2: âˆ€iâˆˆ{1..n} hi â† 1 âˆ’ x
>
i Zxi
3: S â† {1..n}
4: while |S| > s
5: Sample i âˆ hi out of S
6: S â† S âˆ’ {i}
7: v â† Zxi/
âˆš
hi
8: âˆ€jâˆˆS hj â† hj âˆ’ (x
>
j v)
2
9: Z â† Z + vv>
10: end
11: return S
Algorithm 3 FastRegVol(X, s, Î»)
1: Z â† (X>X + Î»I)
âˆ’1
2: S â† {1..n}
3: while |S| > max{s, 2d}
4: repeat
5: Sample i uniformly out of S
6: hi â† 1 âˆ’ x
>
i Zxi
7: Sample A âˆ¼ Bernoulli(hi)
8: until A = 1
9: S â† S âˆ’ {i}
10: Z â† Z + h
âˆ’1
i Zxix
>
i Z
11: end
12: if s < 2d, S â† RegVol(XS, s, Î») end
13: return S
Next we present algorithm FastRegVol, which is based on the rejection sampling strategy. Our
key observation is that updating the full conditional distribution P(Sâˆ’i
|S) is wasteful, since the
distribution changes very slowly throughout the procedure. Moreover, the unnormalized weights hi
,
which are computed in the process are all bounded by 1. Thus, to sample from the correct distribution
at any given iteration, we can employ rejection sampling as follows:
1: Sample i uniformly from set S,
2: Compute hi
,
3: Accept with probability hi
,
4: Otherwise, draw another sample.
Note that this rejection sampling can be employed locally, within each iteration of the algorithm.
Thus, one rejection does not revert us back to the beginning of the algorithm. Moreover, if the
probability of acceptance is high, then this strategy requires computing only a small number of
weights per iteration of the algorithm, as opposed to updating all of them. This turns out to be
the case for a majority of the steps of the algorithm, except at the very end (for s â‰¤ 2d), were the
conditional probabilities start changing more drastically. At that point, it becomes more efficient to
use the first algorithm, RegVol.
Theorem 21 For any Î», s â‰¥ 0, and Î´ âˆˆ (0, 1), algorithm FastRegVol samples according to Î»regularized size s volume sampling, and with probability at least 1 âˆ’ Î´ runs in time
O

n + log
n/d
log
1/Î´

d
2

.
  
DEREZINSKI AND Â´ WARMUTH
Proof We analyze the efficiency of rejection sampling in FastRegVol. Let Rt be a random variable
corresponding to the number of trials needed in the repeat loop from line 4 in FastRegVol at the
point when |S| = t. Note that conditioning on the algorithmâ€™s history, Rt
is distributed according to
geometric distribution Ge(qt) with success probability:
qt =
1
t
X
iâˆˆS

1 âˆ’ x
>
i
(X>
S XS + Î»I)
âˆ’1xi

â‰¥
t âˆ’ d
t
â‰¥
1
2
.
Thus, even though variables Rt are not themselves independent, they can be upper-bounded by a
sequence of independent variables Rbt âˆ¼ Ge(
tâˆ’d
t
). The expectation of the total number of trials in
FastRegVol, RÂ¯ =
P
t Rt
, can thus be bounded as follows:
E[RÂ¯] â‰¤
Xn
t=2d
E[Rbt
] = Xn
t=2d
t
t âˆ’ d
â‰¤ 2n.
Next, we will obtain a similar bound with high probability instead of in expectation. Here, we
will have to use the fact that the variables Rbt are independent, which means that we can upper-bound
their sum with high probability using standard concentration bounds for geometric distribution. For
example, using Corollary 2.2 from Janson (2018) one can immediately show that with probability
at least 1 âˆ’ Î´ we have RÂ¯ = O(n ln Î´
âˆ’1
). However, more careful analysis shows an even better
dependence on Î´.
Lemma 22 Let Rbt âˆ¼ Ge(
tâˆ’d
t
) be independent random variables. Then, w.p. at least 1 âˆ’ Î´,
Xn
t=2d
Rbt = O

n + log
n/d
log
1/Î´

.
Each trial of rejection sampling requires computing one weight hi
in time O(d
2
). The overall time
complexity of FastRegVol thus includes computation and updating of matrix Z (in time O(nd2
)),
rejection sampling which takes O
n + log
n
d

log
1
Î´
 d
2

time, and (if s < 2d) the RegVol
portion, taking O(d
3
).
Proof of Lemma 22 As observed by Janson (2018), tail-bounds for the sum of geometric random
variables depend on the minimum acceptance probability among those variables. Note that for the
vast majority of Rbtâ€™s the acceptance probability is very close to 1, so intuitively we should be able
to take advantage of this to improve our tail bounds. To that end, we partition the variables into
groups of roughly similar acceptance probability and then separately bound the sum of variables
in each group. Let J = log(n
d
) (w.l.o.g. assume that J is an integer). For 1 â‰¤ j â‰¤ J, let
Ij = {d2
j
, d2
j + 1, .., d2
j+1} represent the j-th partition. We use the following notation for each
partition:
RÂ¯
j
def
=
X
tâˆˆIj
Rt
, Âµj
def
= E[RÂ¯
j ], rj
def = min
tâˆˆIj
t âˆ’ d
t
, Î³j
def
=
log(Î´
âˆ’1
)
d2
jâˆ’2
+       
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
Now, we apply Theorem 2.3 of Janson (2018) to RÂ¯
j , obtaining
P(RÂ¯
j â‰¥ Î³jÂµj ) â‰¤ Î³
âˆ’1
j
(1 âˆ’ rj )
(Î³jâˆ’1âˆ’ln Î³j )Âµj
(1)
â‰¤ (1 âˆ’ rj )
Î³jÂµj/4
(2)
â‰¤ 2
âˆ’jÎ³jd2
jâˆ’2
,
where (1) follows since Î³j â‰¥ 3, and (2) holds because Âµj â‰¥ d2
j
and rj â‰¥ 1 âˆ’ 2
âˆ’j
. Moreover, for
the chosen Î³j we have
jÎ³jd2
jâˆ’2 = j log(Î´
âˆ’1
) + 3jd2
jâˆ’2 â‰¥ log(Î´
âˆ’1
) + j = log(2j
Î´
âˆ’1
).
Let A denote the event that RÂ¯
j â‰¤ Î³jÂµj for all j â‰¤ J. Applying union bound, we get
P(A) â‰¥ 1 âˆ’
X
J
j=1
P(RÂ¯
j â‰¥ Î³jÂµj ) â‰¥ 1 âˆ’
X
J
j=1
2
âˆ’ log(2j
Î´âˆ’1
) = 1 âˆ’
X
J
j=1
Î´
2
j
â‰¥ 1 âˆ’ Î´.
If A holds, then we obtain the desired bound:
Xn
t=2d
Rbt â‰¤
X
J
j=1
Î³jÂµj â‰¤
X
J
j=1

log(Î´
âˆ’1
)
d2
jâˆ’2
+ 3
d2
j+1 = 8J log(Î´
âˆ’1
) + 6X
J
j=1
d2
j
= O

log
n/d
log
1/Î´
+ n

.
6. Experiments
In this section we experimentally evaluate the proposed volume sampling algorithms in terms of
runtime and in the task of subsampling for linear regression. We use regularization both for sampling
and for prediction, as discussed in Section 4. The list of implemented algorithms is:
a) Regularized volume sampling (algorithms FastRegVol and RegVol),
b) Leverage score sampling13 (LSS) â€“ a popular i.i.d. sampling technique (Mahoney, 2011),
where examples are selected w.p. P(i) = (x
>
i
(X>X)
âˆ’1xi)/d.
Dataset n Ã— d RegVol FastRegVol LSS
cadata 21kÃ—8 33.5s 0.9s 0.1s
MSD 464kÃ—90 >24hr 39s 12s
cpusmall 8kÃ—12 1.7s 0.4s 0.07s
abalone 4kÃ—8 0.5s 0.2s 0.03s
Table 1: List of regression datasets with runtime comparison
between RegVol and FastRegVol. We also provide the runtime
for i.i.d. sampling with exact leverage scores (LSS).
The experiments were performed
on several benchmark linear regression datasets from the libsvm repository
(Chang and Lin, 2011). Table 1 lists those
datasets along with running times for sampling dimension many columns with each
method. Dataset MSD was too big for
RegVol to finish in reasonable time, however FastRegVol finished in less than 40
seconds. In Figure 6 we plot the runtime against varying values of n (using portions of the datasets), to
compare how FastRegVol and RegVol scale with respect to the data size. We observe that FastRegVol
exhibits linear dependence on n, thus it is much better suited for running on large datasets.
13. Regularized variants of leverage scores have also been considered in context of kernel ridge regression Alaoui and
Mahoney (2015). However, in our experiments regularizing leverage scores did not provide any improvements.
  
DEREZINSKI AND Â´ WARMUTH
0 2000 4000 6000 8000 10000
Data Size n
0
2
4
6
8
Time (seconds)
cadata
RegVol
FastRegVol
1000 2000 3000 4000 5000 6000
Data Size n
0
10
20
30
Time (seconds)
MSD
RegVol
FastRegVol
1000 2000 3000 4000 5000 6000 7000 8000
Data Size n
0
0.5
1
1.5
Time (seconds)
cpusmall
RegVol
FastRegVol
1500 2000 2500 3000 3500 4000
Data Size n
0.1
0.2
0.3
0.4
Time (seconds)
abalone
RegVol
FastRegVol
Figure 6: Comparison of runtime between FastRegVol and RegVol on four libsvm regression datasets (Chang
and Lin, 2011), with the methods ran on data subsets of varying size (n).
6.1 Subset Selection for Ridge Regression
We applied volume sampling to the task of subset selection for linear regression, by evaluating the
subsampled ridge estimator wâˆ—
Î»
(S) using the average loss over the full dataset, i.e.,
Average Loss:
1
n
kXwâˆ—
Î»
(S) âˆ’ yk
2
, where wâˆ—
Î»
(S) = (X>
S XS + Î»I)
âˆ’1X>
S yS.
We evaluated the estimators for a range of subset sizes and values of Î», when the subsets are
sampled according to Î»-regularized volume sampling14 and leverage score sampling. The results
were averaged over 20 runs of each experiment. For clarity, Figure 7 shows the results only with one
value of Î» for each dataset, chosen so that the subsampled ridge estimator performed best (on average
over all samples of preselected size s). Note that for leverage scores we did the appropriate rescaling
of the instances before solving for wâˆ—
Î»
(S) for the sampled subproblems (see Mahoney (2011) for
details). Volume sampling does not require any rescaling. The results on all datasets show that when
only a small number of responses s is obtainable, then regularized volume sampling offers better
estimators than leverage score sampling (as predicted by Theorems 17 and 18). The lower bound
from Theorem 18b can be observed for dataset cpusmall, where d = 12 and d log d â‰ˆ 30.
7. Conclusions
Volume sampling is a joint sampling procedures that produces more diverse samples than i.i.d.
sampling. We developed a method for proving exact matrix expectation formulas for volume
sampling giving further credence to the fact that this is a fundamental sampling procedure. We also
made significant progress on finding an efficient implementation of this sampling procedure: Our
14. Our experiments suggest that using the same Î» for sampling and for computing the ridge estimator works best.
32
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
Figure 7: Comparison of loss of the subsampled ridge estimator when using regularized volume sampling vs
using leverage score sampling on four datasets.
new reverse iterative volume sampling algorithm runs in time O(nd2
). Note that this running time is
within a constant factor of i.i.d. sampling with exact leverage scores and is a remarkable feat since
volume sampling was only recently shown to be polynomial (that is O(n
4
s) in Li et al. (2017)).
A final long ranging question is how to generalize volume sampling and the exact matrix
expectation formulas to higher order tensors.
Acknowledgments
Thanks to Daniel Hsu and Wojciech KotÅ‚owski for many valuable discussions. This research was
supported by NSF grant IIS-1619271.
Appendix A. Inductive Proof of Cauchy-Binet
The most common form of the Cauchy-Binet equation deals with two real
P
n Ã— d matrices A, B:
S : |S|=d
det(A>
S BS) = det(A>B). It is easy to generalize volume sampling and Theorem 2 to
this â€œasymmetricâ€ version. Here we give an alternate inductive proof.
For i âˆˆ {1..n}, let ai
, bi denote the i-th row of A, B, respectively. For S âŠ† {1..n}, AS consists
of all rows indexed by S, and Aâˆ’i
, all except for the i-th row.
Theorem 23 For A, B âˆˆ R
nÃ—d and n âˆ’ 1 â‰¥ s â‰¥ d :
det(A>B) = 1

nâˆ’d
sâˆ’d

X
S : |S|=s
det(A>
S BS).
3 
DEREZINSKI AND Â´ WARMUTH
Proof S is a size s subset of a set of size n. We rewrite the range restriction n âˆ’ 1 â‰¥ s â‰¥ d for size
s as 1 â‰¤ nâˆ’s â‰¤ nâˆ’d and induct on n âˆ’ s. For the base case, nâˆ’s = 1 or s = nâˆ’1, we need to
show that
det(A>B) = 1
n âˆ’ d
Xn
i=1
det(A>
âˆ’iBâˆ’i).
This clearly holds if det(A>B) = 0. Otherwise, by Sylvesterâ€™s Theorem
Xn
i=1
det(
A>Bâˆ’aib>
i
z }| {
A>
âˆ’iBâˆ’i )
det(A>B)
=
Xn
i=1
(1 âˆ’ a
>
i
(A>B)
âˆ’1bi) = n âˆ’
d
z }| {
tr((A>B)
âˆ’1A>B).
Induction: Assume 2 â‰¤ n âˆ’ s â‰¤ n âˆ’ d.
det(A>B)
base
case
=
1
n âˆ’ d
Xn
i=1
det(A>
âˆ’iBâˆ’i)
ind.
step
=
1
n âˆ’ d
Xn
i=1
X
S : |S|=s, i /âˆˆS
1

nâˆ’1âˆ’d
sâˆ’d
 det(A>
S BS)
=
n âˆ’ s
n âˆ’ d
1

nâˆ’1âˆ’d
sâˆ’d

| {z }
1
(
nâˆ’d
sâˆ’d)
X
S : |S|=s
det(A>
S BS).
Note that for the induction step, S is a subset of size s from a set of size n âˆ’ 1 and we have the range
restriction 1 â‰¤ nâˆ’1âˆ’s â‰¤ nâˆ’1âˆ’d. Clearly, nâˆ’1âˆ’s is one smaller than nâˆ’s. For the last equality,
notice that each set S : |S| = s is counted n âˆ’ s times in the double sum.
Appendix B. Alternate Proof of Theorem 5
We make use of the following derivative for determinants by Petersen and Pedersen (2012):
For symmetric C:
âˆ‚ det(X>CX)
âˆ‚X
= 2 det(X>CX)CX(X>CX)
âˆ’1
.
The proof begins with generalized Cauchy-Binet for size s volume sampling:
X
S
det(X>ISX) = 
n âˆ’ d
s âˆ’ d

det(X>X).
Now, we take a derivative w.r.t. X on both sides
X
S
2 det(X>ISX) (ISX)
+> =

n âˆ’ d
s âˆ’ d

2 det(X>X) X+>
â‡â‡’ X
S
det(X>ISX)

nâˆ’d
sâˆ’d

det(X>X)
(ISX)
+>
| {z }
E[(ISX)+>]
= X+>.   
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION
Appendix C. Proof of Proposition 14
The main idea behind the proof is to construct variants of the input matrix X and relate their volumes.
We use the following standard properties of the determinant:
Proposition 24 For any matrix M, det(M>M) = det(Mf>Mf) where Mf is produced from M
through the following operations:
a) Mf equals M except that column mj is replaced by mj + Î±mi
, where mi
is another column
of M;
b) Mf equals M except that two rows are swapped.
Recall that our goal is to prove the following formula for any X, y and i âˆˆ {1..n}:
det(X>X)

L(wâˆ—
(âˆ’i)) âˆ’ L(wâˆ—
)

=

det(X>X) âˆ’ det(X>
âˆ’iXâˆ’i)

`i(wâˆ—
(âˆ’i)).
By Proposition 24b, we can assume w.l.o.g. that i = n, i.e. that the test row in Proposition 14 is the
last row of X. As discussed in Section 3.3, the columns of X are the feature vectors, denoted by
f1, . . . ,fd. Moreover, the optimal prediction vector on the full dataset, yb = Xwâˆ—
, is a projection of
y onto the subspace spanned by the features/columns of X, denoted as yb = PX y. Let us define a
vector y as
y
> def = ( yb
>
âˆ’n
, yn), (18)
where ybâˆ’n
def
= Xâˆ’nwâˆ—
(âˆ’n) is the optimal prediction vector for the training problem (Xâˆ’n, yâˆ’n).
Note, that if rank(Xâˆ’n) < d, then wâˆ—
(âˆ’n) may not be unique, but we can pick any weight vector as
long as it minimizes the loss on the training set {1..nâˆ’1}. Next, we show the following lemma:
Lemma 25 The best achievable loss for the problem (X, y) can be decomposed as follows:
L(wâˆ—
) = L(wâˆ—
(âˆ’n)) âˆ’ `n(wâˆ—
(âˆ’n)) + ky âˆ’ ybk
2
. (19)
Proof First, we will show that y is the projection of y onto the subspace spanned by all features
and the unit vector en âˆˆ R
n
(where n corresponds to the test row). That is, we want to show that
y = P(X,en) y. Denote ye as that projection. Observe that yen = yn, because if this was not true,
we could construct a vector ye + (yn âˆ’ yen)en that is closer to y than ye and lies in span(X, en).
Thus, the projection does not incur any loss along the n-th dimension and can be reduced to the
remaining n âˆ’ 1 dimensions, which corresponds to solving the training problem (Xâˆ’n, yâˆ’n). Using
the definition of y in (18), this shows that ye = P(X,en) y equals y.
Next, we will show that yb is the projection of y onto span(X), i.e. that PX y = yb. By the
linearity of projection, we have
PX y = PX(y âˆ’ y + y)
= PX(y âˆ’ y) + PX y
= PX(y âˆ’ y) + yb.
We already showed that y = P(X,en) y. Therefore, the vector y âˆ’ y is orthogonal to the column
vectors of X, and thus PX(y âˆ’ y) = 0. This shows that PX y = yb.
  
DEREZINSKI AND Â´ WARMUTH
Finally, note that since y is the projection of y onto span(X, en) and yb âˆˆ span(X, en), vector
y âˆ’ y is orthogonal to vector y âˆ’ yb and by the Pythagorean Theorem we have
kyb âˆ’ yk
2 = ky âˆ’ yk
2 + ky âˆ’ ybk
2
.
Using the definition of y in (18), we have
ky âˆ’ yk
2 = kybâˆ’n âˆ’ yâˆ’nk
2 = L(wâˆ—
(âˆ’n)) âˆ’ `n(wâˆ—
(âˆ’n)),
concluding the proof of the lemma.
Proof of Proposition 14 We construct a matrix X, adding vector y as an extra column to matrix X:
X
def = (X , y) =
ï£«
ï£¬ï£¬ï£­
Xâˆ’n ybâˆ’n
x
>
n
yn
ï£¶
ï£·ï£·ï£¸ . (20)
Applying â€œbase Ã— heightâ€ and Lemma 25, we compute the volume spanned by X:
det(X
>X) = det(X>X) ky âˆ’ ybk
2 = det(X>X) (L(wâˆ—
) âˆ’ L(wâˆ—
(âˆ’n)) + `n(wâˆ—
(âˆ’n))). (21)
Next, we use the fact that volume is preserved under elementary column operations (Proposition 24a).
Note, that prediction vector ybâˆ’n is a linear combination of the columns of Xâˆ’n, with the coefficients
given by wâˆ—
(âˆ’n). Therefore, looking at the block structure of X (see (20)), we observe that
performing column operations on the last column of X with coefficients given by negative wâˆ—
(âˆ’n),
we can zero out that column except for its last element:
y âˆ’ X wâˆ—
(âˆ’n) = r en,
where r
def
= yn âˆ’ x
>
n wâˆ—
(âˆ’n) (see transformation (a) in (22)). Now, we consider two cases, depending
on whether or not r equals zero. If r 6= 0, then we further transform the matrix by a second
transformation (b), which zeros out the last row (the test row) using column operations. The entire
sequence of operations, resulting in a matrix we call X0, is shown below:
X =
ï£«
ï£¬ï£¬ï£­
Xâˆ’n ybâˆ’n
x
>
n
yn
ï£¶
ï£·ï£·ï£¸
(a) â†’
ï£«
ï£¬ï£¬ï£­
Xâˆ’n 0
x
>
n
r
ï£¶
ï£·ï£·ï£¸
(b) â†’
ï£«
ï£¬ï£¬ï£­
Xâˆ’n 0
0 r
ï£¶
ï£·ï£·ï£¸ = X0. (22)
Note, that due to the block-diagonal structure of X0, its volume can be easily described by the â€œbase
Ã— heightâ€ formula:
det(X
>
0 X0) = det(X>
âˆ’nXâˆ’n) r
2 = det(X>
âˆ’nXâˆ’n) `n(wâˆ—
(âˆ’n)). (23)
Since det(X
>X) = det(X
>
0 X0), we can combine (21) and (23) to obtain the desired result.
Finally, if r = 0 we cannot perform transformation (b). However, in this case matrix X has
volume 0, and moreover, `n(wâˆ—
(âˆ’n)) = r
2 = 0, so once again we have
det(X
>X) = 0 = det(X>
âˆ’nXâˆ’n) `n(wâˆ—
(âˆ’n)),
which concludes the proof of Proposition 14.
36
REVERSE ITERATIVE VOLUME SAMPLING FOR LINEAR REGRESSION