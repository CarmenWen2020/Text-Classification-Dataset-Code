Sleep apnea (SA) is a common respiratory disorder, especially among obese people. It is caused by either the relaxation of the upper respiratory tract muscles or the failure of the neural signal to reach the muscles responsible for breathing, both of which interrupt the patient’s sleep–wake cycles. The traditional method for diagnosing this disorder, based on polysomnography, is complicated, vexing, expensive, time-consuming, and requires both sleep centers and specialized staff capable of connecting electrodes to the patient’s body. This paper proposes an SA prediction system based on merging five soft computing algorithms, specifically, combining the multi-verse optimizer (MVO) with an artificial neural network (ANN) to leverage measurements from heart rate, SpO2, and chest movement sensors. The most substantial novelty of this research is the hybridization of MVO and ANN (MVO-ANN), which improves the ANN performance by selecting the best learning rate and number of neurons in hidden ANN layers. This enables highly accurate prediction of sleep apnea events. This work’s experimental results reveal that the MVO-ANN performs better than other algorithms, with mean absolute errors of 0.042, 0.202, and 0.166 for training, testing, and validation of the ANN. In addition, the SA prediction system achieved an accuracy of 98.67%, a sensitivity of 96.71%, and a specificity of 99.24%. These results provide good evidence that the proposed method can reliably predict respiratory events in people suffering from SA.

Introduction
Sleep apnea (SA) is among the most prevalent sleeping disorders associated with breathing. It can be described as the repetitive cessation of airflow to the lungs during sleep. A pause of airflow to the lungs that lasts at least 10 s is called a sleep apnea event (SAE), with events accompanied by decreased oxygen saturation in the blood provoking sleep–wake cycles during sleep and fragmenting sleep, preventing patients from getting sufficient sleep. Sleep apnea affects a small proportion (1–2%) of children, a slightly bigger proportion (2–15%) of adults, and more than 20% of seniors, with these numbers constantly increasing [1]. Despite the many consequences associated with SA, the American Academy of Sleep Medicine estimates that 80% of people with the disorder remain undiagnosed [2]. There are three types of SA: obstructive SA (OSA), central SA, and mixed SA. Obstructive SA is caused by the relaxation of the upper airway muscles of the respiratory tract [3], which causes the airway to narrow and prevents the patient from obtaining enough air, as Fig. 1 illustrates. This type is widespread among obese people [4].

Fig. 1
figure 1
Upper airway muscles during a normal breathing, b hypopnea, and c obstructive sleep apnea

Full size image
Central SA is known as the failure of the neural signal to reach the muscles responsible for breathing [5]. Studies have found that OSA critically induces central SA by invoking breathing instability or narrowing the upper airway. Central SA has also been clinically associated with atrial fibrillation, heart failure, and chronic opioid use [6]. Finally, mixed SA describes a mixture of OSA and central SA factors occurring during a single SAE, that is, an SAE featuring a central pause followed by an obstructive pause.

Symptoms of SA include loud snoring, excessive daytime sleepiness, interrupted breathing events, waking from sleep accompanied by choking or gasping, waking with a dry mouth, waking with a headache, failure to concentrate (potentially causing accidents), night sweating, mood changes (e.g., irritability and depression), and decreased libido. This disorder affects all of the body’s organs, ultimately causing or contributing to problems including a weakened immune system, increased heart rate (HR), cardiovascular disease [7], high blood pressure [8], heart attacks, heart failure, type 2 diabetes [9], hormonal changes, enzymatic secretions [10], memory impairment, metabolic problems [11], a sore throat, damaged brain cells [12], certain types of cancer (e.g., lung cancer) [13], reduced life expectancy [10], and, in some cases of OSA, nocturnal death [2]. There are also several eye disorders associated with OSA, namely, floppy eyelid syndrome, optic neuropathy, glaucoma, non-arteritis anterior ischemic optic neuropathy, and papilledema secondary to raised intracranial pressure [14].

There are two main approaches to diagnosing SA. The first method uses polysomnography (PSG) and is the gold-standard method for detecting SAEs [15]; however, PSG is a complicated testing process because it requires various sensors (see Fig. 2) to be attached to the patient’s body overnight to collect different bio-signals via electroencephalogram (EEG), electromyogram, electrooculogram (EOG), electrocardiogram (ECG), pulse oximeters, position sensors, nasal airflow sensors [16], and thermistors. Additionally, two auxiliary belts detect chest and abdominal movements [17], and a camera records the patient’s sleep. In some countries, people wait several months for the opportunity to be tested using PSG [1], and the average cost of the test can reach $1018 [18]. Besides requiring a sleep laboratory and sleep technicians, PSG is time-consuming and not portable. Given the apparent substantial motivation to address these limitations, we have tried to simplify the method for detecting SAEs and diagnosing SA. The severity of the apnea is measured by an apnea–hypopnea index (AHI), which evaluates the mean number of events occurring in the context of total sleep time.

Fig. 2
figure 2
A graphic representation of the polysomnography test’s wire connections

Full size image
The second method for SA diagnosis, the home sleep apnea test (HSAT), can be performed at the patient’s home and requires fewer sensors than PSG. This test’s sensors include a pulse oximeter, nasal airflow sensor, and abdominal and chest belts. The HSAT measures severity level according to a respiratory event index (REI), which measures events in the context of total recording time. Although several trials and studies have tried to simplify the detection of SA, few have focused on predicting SAEs. Several methods have highlighted the utility of the SpO2 sensor for detecting OSA events [15, 19,20,21,22,23], but the American Academy of Sleep Medicine does not recommend using only this signal for detection [24] because sometimes SAEs occur without any notable change in oxygen saturation. Therefore, methods using SpO2 must include another sensor to ensure a more reliable model. While some studies have considered the effect of the tracheal sound [25, 26], their approaches preclude collecting sound from overweight people. Several studies have used only EEG, ECG, and EOG signals. However, collecting these signals is a complex process; not only is the processing and feature extraction complicated, but none of them use wireless communication to send the data collected, instead being based on wired connections [12, 23, 27,28,29], which can irritate patients during the test. Other projects have used imaging systems that require a camera to be positioned in front of a patient’s face at a fixed angle [30] or fixed an accelerometer sensor to the patient’s chest, although the latter method is only useful for detecting central SA [31]. Elsewhere, the authors of [16] used raw nasal airflow signals with a convolutional neural network (CNN) for detection. However, the invasive sensor renders the test rather uncomfortable. Elsewhere, the authors of [18] tested a combination of SpO2 and HR sensors with an artificial neural network (ANN).

Although various previous studies have tried to simplify examination methods and use the fewest sensors to diagnose respiratory events, there exist multiple gaps in the literature. For example, many of these previous studies focused on detection, not considering predicting respiratory events before they happen. Additionally, few studies have investigated central SA. In contrast, the current study highlights central SA by employing a flex sensor that is fixed on the patient’s chest to detect chest movements stopping and indicate the patient’s breathing patterns. Meanwhile, studies that collect ECG, EOG, and EEG signals complicate signal collection because the electrodes connected to different parts of the body do not use wireless techniques to send signals, increasing the number of wires that are connected to a patient’s body and making them feel uncomfortable when moving in their sleep. Pre-processing signals further complicates such procedures.

Having considered the limitations of previous studies, this research considers the design and implementation of a small low-cost and high-reliability sleep apnea system (SAS) that combines three sensors (i.e., SpO2, HR, and flex sensor) with Bluetooth low-energy 4.0 (BLE 4.0) to send recorded data to the monitoring unit (MU). The most substantial novelty of this research is the hybridization of the multi-verse optimizer (MVO) and artificial neural network (ANN) mechanisms as MVO-ANN, an approach that improves the ANN performance by selecting the best learning rate and number of neurons in hidden ANN layers. This enables highly accurate prediction of SAEs. Importantly, an ANN is flexible and can manage a large amount of data without any manual intervention [5, 32]. The accuracy, sensitivity, and specificity of the SAS have been confirmed by a series of statistical analyses that demonstrate that the device achieves data collection accuracy of 99.94% when compared with the benchmark (BM) device (Alice PDx PHILIPS Respironics) [41]. Figure 3 illustrates the research process as a flow chart.

Fig. 3
figure 3
Flow chart illustrating the research process

Full size image
This paper’s contributions can be summarized as follows:

1.
An easy-to-install, small, and lightweight device was designed and implemented to predict and detect SAEs. Only a few sensors (i.e., HR, SpO2, and flex) were included, reducing stress on the patient because they are only attached to the patient’s body in the form of a hand-wearable device. Additionally, the proposed hand-wearable device was demonstrated to be convenient, not hindering patient movement during sleep because it does not use a wired connection, instead transmitting data wirelessly from the patient to the MU over BLE 4.0.

2.
Using the ANN technique, SAEs were accurately predicted before they happened, and using the MVO algorithm improved the ANN’s performance in terms of learning rate and number of neurons in the ANN’s hidden layers.

Related works
In the past decade, many studies have focused on diagnosing SA, using various vital signals to detect respiratory events. Notably, Erdenebayar et al. [33] proposed methods for automatically detecting SAEs using deep learning approaches, conducting a study dependent on a single ECG lead. The detected signal was pre-processed, normalized, and segmented at 10-s intervals. Six deep learning approaches were designed and implemented to automatically detect SAEs, including deep neural network (DNN), one-dimensional CNN, two-dimensional CNN, recurrent neural networks, long short-term memory (LSTM), and gated recurrent unit (GRU). Data were collected from 86 patients, with 69 included in the training set and 17 included in the test set. The most accurate performance was observed for the gated recurrent unit (99%) and one-dimensional CNN (98.5%). This study also distinguished OSA and hypopnea using ECG signals. However, the study could not recognize other SA types (i.e., central SA and mixed SA), and the ECG signal could be impure due to changes in sleeping position, coughing during sleep, and loud snoring.

Meanwhile, Ferduła et al. [1] developed a method for detecting SAEs that did not require specialist equipment or sleep experts to analyze bio-signals. That study was divided into three stages: recognition of apnea and hypopnea, recognition of sleep stage, and determination of each stage’s duration. All of these measurements used a pulse oximeter sensor with ANN, with the data used to train the neural network collected from eight patients. The neural network was trained, validated, and tested using the “Levenberg–Marquardt (LM)” algorithm from the MATLAB Neural Network Toolbox with 32 input neurons and 10 hidden layers. However, that study did not consider other SA types or report SAE detection accuracy. Elsewhere, the authors of [34] proposed a method for estimating SA severity level by adopting deep learning algorithms. Their model comprised an accelerometer fixed over a suprasternal notch that detected respiratory movements, and they collected data from 69 participants during PSG. Twenty-one features were extracted from the accelerometer signal to classify deep learning, detect SAEs, and determine AHI. The authors combined CNN with an LSTM layer and a fully connected layer to create a classifier for measuring AHI, with the output’s performance assessment indicating 81% sensitivity, 87% specificity, and 84% accuracy. Certain limitations were acknowledged; for example, the AHI was estimated according to total recording time, and the classifier could not recognize event type.

The authors of [35] described a method for detecting SAEs based on EEG signals, conducting a study using only CNN to extract features of the EEG signals to determine apnea or non-apnea events with DNN. The method was trained and tested on 25 patients, with the results suggesting that the approach could detect events using online data collection. However, this method only detected normal breathing and respiratory events, precluding estimation of all event types. Additionally, the EEG signal is considerably complex to process. Elsewhere, Sankar et al. [36] suggested a method for detecting SAEs involving adopting respiratory signals using a supervised neural network. The output is classified into normal respiration, apnea events, and motion artifices. Five different backpropagation algorithms for training were adopted, including LM, scaled conjugate gradient, the Broyden–Fletcher–Goldfarb–Shanno algorithm, one step secant, and Powell–Beale restarts for classifying the three outputs. Respiratory data were collected from the MIT-BIH database and included 1,200 data points. The best performance was observed for LM algorithms with 4 input neurons, 20 hidden layers, 3 output neurons, and a maximum of 100 epochs, with accuracy reaching 98.7%. One limitation was the inconvenience of collecting respiratory signals due to the sensor locations.

Meanwhile, the authors of [37] suggested a method using an EEG signal and three different classifiers for apnea detection. The EEG signal was pre-processed with the Infinite Impulse Response bandpass filter and the Hilbert Huang Transform for smoothing and sub-band division of the signals. Next, the signal was analyzed by the support vector machine (SVM), K-nearest neighbors, and ANN to determine apnea events. Data from 18 patients were collected from the MIT-BIH database to train, test, and measure the performance. The best accuracy was observed for the SVM (99%). However, the study was limited by the complexity of the EEG signal analysis and the demand for signal recording for several electrodes on the scalp. Elsewhere, Wang et al. [38] proposed a method for detecting apnea events using a single ECG lead. To detect SAEs, they adopted five algorithms: linear discriminant analysis, SVM, logistic regression, non-time-window multilayer perceptron (MLP), and time window MLP (TW-MLP). The researchers focused on TW-MLP with one hidden layer, using the FIR filter and the Hamilton algorithm for feature extraction. The data were collected from the PhysioNet database, and the TW-MLP algorithm demonstrated the best performance: 87.3% accuracy, 85.1% sensitivity, and 88.7% specificity. However, this approach could not differentiate between apnea and hypopnea.

The authors of [39] proposed a novel approach to detecting respiratory events that involved using a wearable device that connected around the neck or was attached to the chest using adhesive tape. The device recorded various signals: chest bio-impedance, ECG (two leads), and patient motion (using an accelerometer). The algorithm implemented to automatically detect SAEs was LSTM. Data from 25 participants were collected for the training network. Although the device’s performance was sub-optimal (58.4% sensitivity, 76.2% specificity, and 72.8% accuracy), this study included all three types of SA. However, several sensors were needed to use the wearable device, which could be tedious for the patient. The authors of [40] presented a method for detecting SAEs among infants that implemented FPGA. The system combined two sensors: polyvinylidene fluoride for breathing and a pulse oximeter for measuring oxygen saturation. The proposed method implemented the Feedforward network as a classifier with five hidden layers, and the network output used “1” to denote apnea and “0” to indicate normal breathing. The data for the training network was derived from the PhysioNet database, and the classifier surpassed 85% accuracy.

Finally, the authors of [41] described a method for detecting SAEs that depended on deep learning approaches, combining CNN and LSTM. They used the ECG signal as input after measuring the signal’s RR interval. Data from 35 patient recordings of ECG signals (from the PhysioNet database) were used to train and test the method, and the classifier recognized the presence or absence of SAEs, reaching 96.94% specificity, 98.97% sensitivity, and 99.80% accuracy.

After reviewing the limitations of these previous studies, the current research project involved developing solutions to address these shortcomings, which has involved designing and implementing a small hand-worn device that is affordable and portable. By reducing the number of sensors connected to the patient’s body by using only two parts––namely, the pulse oximeter, which measures HR and SpO2, and the flex sensor, which is attached to the patient’s chest with medical plaster tape to measure the chest movement––this SAS reduces the amount of stress on the patient during the examination period. Finally, the SAS uses BLE 4.0 to send the data collected to the MU, where artificial intelligence techniques are used to recognize and predict respiratory events.

Development of the proposed system
Studying previous works to find solutions to complications associated with diagnosing SA and encountering the limitations of existing approaches motivated this project. Accordingly, this research’s SAS works to predict respiratory events before they occur and is characterized by its small size and combination of three sensors. Additionally, it is hand-worn and utilizes BLE 4.0, enabling it to send the data measured from the patient’s body to the MU. The schematic diagram of the SAS includes the transmitter unit and MU (see Fig. 4). The transmitter unit comprises a pulse oximeter sensor (MAX 30,101) that can measure SpO2 and HR, a flex sensor, an Arduino Nano microcontroller based on the Atmega 328p chip, and BLE 4.0 (HM-10 model), which sends the recorded data from the sensors to the MU, as Fig. 4a shows. The transmitter unit is powered by a lithium-ion battery (3.7 V/4000 mAh) that can support 17 h of continuous monitoring, which can adequately monitor the participant for seven hours of sleep. Meanwhile, the MU comprises BLE 4.0, an Arduino UNO microcontroller based on the Atmega 328p chip, and a laptop, as Fig. 4b shows. Figure 4c depicts the transmitter device. Because the laptop powers the components of the MU (i.e., BLE 4.0 and Arduino UNO), it requires no battery source. The laptop also enables the MU to utilize ANN techniques. Table 1 presents the specifications of the sensors and hardware adopted by the transmitter and the MU, with the results obtained from the SAS compared with those of other approaches to confirm the SAS’s performance.

Fig. 4
figure 4
Schematic diagrams of a the sleep apnea system’s transmitter unit and b the sleep apnea system’s monitoring unit, and c a snapshot of the sleep apnea system’s transmitter unit

Full size image
Table 1 The specifications of the sensors and hardware adopted by the transmitter unit and the monitoring unit
Full size table
Experimental configuration
The data were collected from 10 participants over the course of seven hours of sleep per participant, six of whom suffered from SA, and four of whom were healthy. A total of 252,000 samples (84,000 samples from each of the three sensors, i.e., HR, SpO2, and flex) were collected, meaning 25,200 samples (8400 samples from each of the three sensors) were collected from each participant. The HR, SpO2, and flex for each participant were sampled at a frequency of 1 Hz. This frequency was selected because (i) several previous works have adopted it, following [42,43,44], (ii) the HSAT device measures the parameters with a sampling frequency of 1 Hz, enabling fair comparisons of the performance metrics with HSAT, and, (iii) although an ideal sample frequency has yet to be established [44], Nigro et al. [45] observed that a minimum data sampling rate of 0.25 Hz can adequately avoid loss of oximetry resolution through sleep tests. However, we considered a sampling frequency four times greater than that suggested by [45]. Therefore, adopting a sampling frequency of 1 Hz to collect data from the three sensors did not influence the performance of the proposed SAS during the sleep test.

The conditions for compliance with the standards of ethical conduct of the Helsinki Declaration were met (Finland 1964), with written informed consent acquired before beginning the experiment after a thorough explanation of the research to the volunteer. Searching for these subjects took approximately four months. Despite the numerous people suffering from SA, 80% of those affected do not receive a diagnosis. This is partly due to the limited number of patients with scientific knowledge of sleep testing, limited sleep center availability, the high costs of sleep centers, and certain doctors not having sufficient experience to address such pathologies. The current research selected six patients (out of 10 participants) with respiratory disorders, who were examined and diagnosed to suffer from obesity, with substantial fatty tissue around the neck, nighttime bottlenecks, and loud snoring. Additionally, they ranged in age from 50 to 53 years and suffered from chronic diseases, including hypertension.

These participants were examined using an HSAT device comprising a pulse oximeter, nasal airflow sensor, thermistor, and two belts to measure breathing effort (one around the abdomen and another around the chest). Installing the HSAT device on the patient took between 15 and 20 min. In contrast, it took about 3–5 min to attach the developed SAS and configure the MU. The six volunteers with SA recorded average REIs of around 60 events per hour, potentially indicating severe levels of SA.

Upon linking the testing devices to the patient’s body, the SAS and the BM device (i.e., HSAT) recorded measurements at the same time after finishing connecting the two devices. The BM device recorded chest and abdominal movement, HR, SpO2, and airflow through the nose and mouth; these data were recorded on an SD card to be analyzed later by the doctor to determine the frequency of SAEs. The SAS data measured SpO2, HR, and chest movement. The measured data were sent to the MU via BLE 4.0. The MU’s laptop utilized ANN procedures to predict respiratory events.

The first SA patient produced an average REI of 56 events per hour, which included 52 SAEs and 4 hypopnea events, with the maximum duration for apnea reaching 90 s and the average SAE lasting approximately 39 s. The lowest level of oxygen observed in the blood was 70%.

The second SA patient experienced more severe interruptions than the first, recording an average REI of 70 events per hour. However, the nature of the respiratory events most likely indicated hypopnea; 40 events characterize hypopnea, and hypopnea events can reach 60 s (apnea events only reach 35 s). The minimum level of oxygen in the blood during sleep was 78%. Figure 5a shows the second patient preparing for the examination.

Fig. 5
figure 5
Experiment preparation: a patient while preparing for the examination and b connection of the home sleep apnea test and the developed sleep apnea system to the patient

Full size image
The third SA patient, who also suffered from severe respiratory interruptions, recorded an average REI of 65 events per hour, with 35 events indicative of hypopnea and the other 30 indicative of apnea. The maximum duration of events was 52 s for apnea and 97 s for hypopnea. Figure 5b shows the third patient during the connection of the HSAT and the SAS. Notably, these six participants had already been diagnosed with SA and needed positive airway pressure devices to achieve adequate sleeping time and rest during sleep. Meanwhile, the four healthy participants (ranging in age between 18 and 27 years) did not suffer from any SA symptoms, recording levels of oxygen in the blood exceeding 96%.

Data collection
Data were collected from the 10 participants, and the data were divided into training (70%), test (15%), and validation of the ANN (15%). As mentioned, a total of 252,000 data points were collected for the 10 participants (25,200 for each participant) using the SAS. To ensure the device’s validity, these data were compared with the BM device by conducting a set of statistical analyses. Figure 6a (first experiment), Fig. 6b (second experiment), Fig. 6c (third experiment), and Fig. 6d (fourth experiment) compare the oxygen saturation of four persons suffering from SA with that of the healthy volunteers. This information represents a period of approximately 10 min, during which there were 13 consecutive SAEs.

Fig. 6
figure 6figure 6
Comparing the oxygen saturation between a healthy participant and a sleep apnea patient: a first experiment, b second experiment, c third experiment, and d fourth experiment

Full size image
Figure 7a (first experiment), Fig. 7b (second experiment), Fig. 7c (third experiment), and Fig. 7d (fourth experiment) compare the HR variability between the four patients suffering from SA and the four healthy volunteers; again, this information represents a period of only ten minutes, with the figures making clear that the HR of the SA patient is consistently higher than that of the healthy subject. People with SA demonstrate higher HRs than normal persons due to the effectiveness of the parasympathetic system, which seeks to compensate for the lack of oxygen in the blood by increasing blood flow [46].

Fig. 7
figure 7
Comparing the heart rate variability between a healthy participant and a sleep apnea patient: a first experiment, b second experiment, c third experiment, and d fourth experiment

Full size image
The flex sensor records chest movements after the sensor is attached to the chest, with this flex sensor recording the chest’s rise and fall, representing the movement that results from the breathing process, an oscillatory movement that is depicted in Fig. 8a (first experiment), Fig. 8b (second experiment), Fig. 8c (third experiment), and Fig. 8d (fourth experiment). The figures show certain peaks, which reflect either the patient’s movement during sleep––meaning fluctuations of sleep––or deep breathing, which produces amplified readings that are recorded in the form of peaks.

Fig. 8
figure 8
Chest movements obtained from a flex sensor: a first experiment, b second experiment, c third experiment, and d fourth experiment

Full size image
Artificial neural network hybridized with soft-computing algorithms
This research adopted an ANN to predict patient SAEs. The measured data (i.e., the biomedical parameters HR, SpO2, and chest movement) were split into three groups: training, validation, and testing. A total of 252,000 samples were recorded, representing 84,000 samples for each of the three parameters. This means that 8400 samples for each of the three parameters were collected from each participant. For each parameter, 70% (5880 of 8400) of samples were used for training, 15% (1260 of 8400) were used for testing, and 15% (1260 of 8400) were used for validation. Choosing these three parameters and the percentages of the measured samples allocated to the different sets follows the approach adopted by many earlier articles, e.g., [47,48,49]. The number of neurons in the hidden layer and the ANN learning rate were key factors in designing the ANN architecture. Although several earlier researchers adopted a trial-and-error method to select these key factors [50,51,52,53,54,55], this trial-and-error method is not always secure, featuring considerable computational complexity and being prone to errors [56]. Additionally, the trial-and-error method can lead to a large number of neurons in the hidden layer, potentially overfitting the data [57]. Thus, the method cannot be considered an optimal solution, and an effective soft-computing algorithm should be hybridized with an ANN to select the learning rate and number of neurons in the ANN’s hidden layers.

Choosing an efficient algorithm is not an easy task and poses another challenge, requiring various soft-computing algorithms—namely, Particle Swarm Optimization (PSO), Gravitational Search Algorithm (GSA), Backtracking Search Algorithm (BSA), Crow Search Algorithm (CSA), and MVO—were hybridized with the ANN to choose the one that provided a fast convergence and a low minimum mean square error (MSE) with minimal iterations. The optimization algorithms are sets of processes that iteratively compare several solutions until arriving at an optimal or suitable solution. The algorithms were executed for 40 swarms and 100 iterations, with 40 swarms chosen because, according to [58], it provides an appropriate MSE. The MVO-ANN algorithm (Fig. 9) was observed to produce a lower MSE than the other algorithms during the training process (see Fig. 10). The number of neurons in each hidden layer (see Table 2) was obtained automatically after the training process for each soft-computing algorithm without any manual intervention. Additionally, the MVO-ANN featured faster convergence than the other soft-computing algorithms, reaching the minimum error after 28 iterations. In contrast, the BSA-ANN recorded the highest MSE of the five algorithms. Table 2 presents the learning rate, the number of neurons in the first and second hidden layer of the ANN, and the MSE at a specific iteration for each of the five algorithms.

Fig. 9
figure 9
The multi-verse-optimizer–artificial-neural-network algorithm

Full size image
Fig. 10
figure 10
The minimum standard error of the adopted soft-computing algorithms with respect to iteration

Full size image
Table 2 The performance of five soft-computing algorithms hybridized with the ANN
Full size table
The mathematical formulae for the MVO algorithm were presented in [59] and are reproduced as Eq. (1) through Eq. (5). The equations were followed to obtain the optimal number of neurons in the first and second hidden layers and obtain a learning rate capable of achieving the MSE.

𝜗𝑗𝑖={𝜗𝑗𝑘𝜗𝑗𝑖𝑟𝑎𝑛1<𝑁𝑂𝑅(𝑢𝑖)𝑟𝑎𝑛2≥𝑁𝑂𝑅(𝑢𝑖)
(1)
where 𝜗𝑗𝑘 represents the jth factor of kth universe chosen by a roulette wheel selection mechanism, 𝜗𝑗𝑖 represents the jth factor of ith universe, ran1 and ran2 are the random numbers that are disseminated between 0 and 1, and NOR(ui) is the normalized inflation rate of the ith universe, which ith universe (ui) can be formulated according to Eq. (2).

𝑢𝑖=⎡⎣⎢⎢⎢⎢⎢⎢⎢⎢𝜗11𝜗12...𝜗1𝑛𝜗21……𝜗𝑝1𝜗22……𝜗𝑝2...𝜗2𝑛……𝜗𝑝𝑛⎤⎦⎥⎥⎥⎥⎥⎥⎥⎥
(2)
where n is the number of candidate universes and 𝑝 is the number of parameters.

𝜗𝑗𝑖=⎧⎩⎨⎪⎪{𝑌𝑗+𝑇𝑅×((𝑈𝑅𝑗−𝐿𝑅𝑗)×𝑟𝑎𝑛4+𝑙𝑜𝑗)𝑌𝑗−𝑇𝑅×((𝑈𝑅𝑗−𝐿𝑅𝑗)×𝑟𝑎𝑛4+𝑙𝑜𝑗)𝑟𝑎𝑛3<0.5𝑟𝑎𝑛3≥0.5}𝜗𝑗𝑖𝑟𝑎𝑛2<𝑊𝑃𝑟𝑎𝑛2≥𝑊𝑃
(3)
where Yj denotes the jth boundary of the best universe framed up until this point, TR is the coefficient that denotes the traveling distance rate, WP is the coefficient that indicates the wormhole existence probability, LRj and URj are the lower and upper bounds of the jth variable, and ran2, ran3, and ran4 are the random numbers that are scattered between 0 and 1.

The WP and TR can be calculated using Eqs. (4) and (5):

𝑊𝑃=(maximum−minimum𝑡)×𝜏+minimum
(4)
𝑇𝑅=1−𝜏1/𝛽𝑡1/𝛽
(5)
where the values of maximum and minimum of the wormhole existence probability in Eq. (4) were adopted as 1 and 0.2 in the current work. These values were selected following the recommendations of [59,60,61,62].

Meanwhile, τ and t represent the present and maximum iterations (100 maximum iterations and 1 present iteration implemented in this paper). In Eq. (5), the parameter β is the exploitation precision over the iterations, which equals 6 in the current research. The larger the value of this parameter (i.e., β), the quicker and more accurate the local search will be.

The MVO-ANN algorithm (Fig. 9) proved capable of producing an MSE of 0.11 at 28 iterations, as Fig. 10 shows, meaning that the performance of an ANN can be improved in terms of computational complexity and MSE, allowing the ANN to successfully predict SA. The MVO-ANN algorithm was consequently used for the current research, with the number of neurons in the first hidden layer equaling 20, the number in the second hidden layer equaling 18, and the learning rate recorded as 0.751 (see Table 2). These values could be used in the ANN, and the ANN could be run until reaching the MSE between the actual and predicted SAE.

Artificial neural network structure
After determining the numbers of neurons in the first and second hidden layers and the learning rate, the ANN architecture could be designed, as Fig. 11 shows. The parameters of the ANN are listed in Table 3, with the network’s output denoted by “0”, which describes normal or healthy breathing, “1”, which denotes hypopnea, and “2”, which indicates apnea.

Fig. 11
figure 11
Architecture of the adopted artificial neural network

Full size image
Table 3 Adopted parameters of the artificial neural network
Full size table
Results and discussions
This section presents the results concerning the measurement accuracy of the proposed SAS relative to the BM device and the ANN’s capacity to predict respiratory events. These results emphasize the results obtained from the MVO-ANN algorithm because it performed better than the other methods (i.e., GSA-ANN, BSA-ANN, CSA-ANN, and PSO-ANN) in terms of MSE. As shown in Fig. 9, the MSE of MVO-ANN reached 0.11, the lowest among these networks. The results presented in this section are divided into three parts.

Measurements accuracy results
To validate the performance of the proposed SAS, the HR and SpO2 measurements obtained from both the proposed SAS and the BM device were investigated for accuracy. Accuracy was measured according to Eq. (6), and the accuracy of the proposed SAS––compared against the BM device––was observed to reach 99.94%. This high accuracy suggests that the HR and SpO2 measurements recorded by the proposed SAS were comparable to the measurements recorded by the BM device.

Accuracymeasu.=(1−measured−actualactual)×100%
(6)
where measured denotes the measurement data recorded by the proposed SAS and actual indicates the measurement data recorded by the BM device.

Artificial neural network performance results
The data collected using the SAS were divided into training (70%), testing (15%), and validation (15%) of the performance of the MVO-ANN algorithm in terms of MSE and correlation coefficient (R2). These performances are presented in Figs. 12 and 13.

Fig. 12
figure 12
The mean standard error of the multi-verse-optimizer–artificial-neural-network algorithm for a training, b testing, and c validation

Full size image
Fig. 13
figure 13
The correlation coefficient of the multi-verse-optimizer–artificial-neural-network algorithm for a training, b testing, and c validation

Full size image
In Fig. 12, the goal of the ANN was set to 1 × 10–3, and the ANN stopped running either when the goal was accomplished or when it reached the optimal MSE. The ANN was able to reach its goal by increasing the number of epochs required to reach more than 2000 at the expense of increasing the ANN run-time to 200 s (compared to 12 s when 100 epochs were adopted). However, the results show that the adopted epochs yielded a satisfactory error and that there was no need to increase the epochs beyond 100, with Fig. 12 specifically showing that the number of epochs for MVO-ANN was set to 100 to evaluate the performance of the ANN and demonstrate that the network’s performance did not reach the goal in terms of MSE (i.e., 1 × 10–3) during either training, testing, or validation. The best MSE performance was found for 0.018 of training, 0.021 of testing, and 0.024 of validation, with Fig. 12a (training) demonstrating better results than those derived during testing and validation at 100 epochs and Fig. 12b (testing) indicating that the results obtained that were better than those obtained during validation. Nonetheless, 12c suggests convincing validation results.

The ANN’s performance can also be investigated in terms of training, testing, and validation time, with processing time considered an important factor in real-time implementation. Training, validation, and testing times during the offline phase were 12 s, 9 s, and 8 s when the MVO-ANN was considered. In contrast, the corresponding times when MVO-ANN was not applied were 18 s, 17 s, and 13 s. One of the benefits of adopting the MVO-ANN is reducing the ANN’s processing time during the offline phase by reducing the number of neurons in its hidden layers. This means that there is no need to be concerned about the time characteristic. Hence, following offline training of the ANN, the new sensor measurements are received by the MU. These correspond to real-time estimations of SA events.

Figure 13 presents the correlation coefficient of the ANN for training, testing, and validation. The correlation coefficient is a good indicator of the amount of agreement between the actual value and the estimated value. That is, it can demonstrate concordance between a patient’s actual conditions (i.e., normal breathing, hypopnea, and apnea) and the values estimated by the MVO-ANN. The actual values were measured by plotting the proposed SAS on the x-axis (target) and plotting the estimated values obtained from the hybrid MVO-ANN on the y-axis (output). The ANN’s output was denoted by the numbers “0” (normal or healthy breathing), “1” (hypopnea), and “2” (apnea). Figure 13a–c represent the correlation coefficients of the ANN: 0.981 for training, 0.978 for testing, and 0.976 for validation. These results presented in Fig. 13 provide strong evidence for the MVO-ANN algorithm’s ability to accurately predict patient breathing conditions.

Error results
The MVO-ANN algorithm’s performance was also measured according to error, as Fig. 14 illustrates. Figure 14a–c indicate more substantial errors in some positions relative to others, likely due to the movement of sensors while the patient was sleeping. Figure 14a suggests that the error rates obtained from the training set were lower than those obtained from the testing and validation sets, with the error ranging between 0 and 1.35. Figure 14b shows that the measured testing error varied between 0 and 2.25, while Fig. 14c demonstrates that errors during validation decreased, ranging between 0 and 1.4. Table 4 presents the MAE, MSE, and root MSE (RMSE) values of the ANN for training, testing, and validation.

Fig. 14
figure 14
Mean standard error of the multi-verse-optimizer–artificial-neural-network algorithm for a training, b testing, and c validation

Full size image
Table 4 Error measurements of the multi-verse-optimizer–artificial-neural-network algorithm
Full size table
Histogram results
Figure 15 represents the amount of error associated with the MVO-ANN network in the form of histograms for the training, testing, and validation data. Outliers can be used to determine the quality of specific data, with Fig. 15a indicating that the training data’s errors accumulated most at the zero point (2452) and Fig. 15b, c indicating that the testing and validation data also featured considerable accumulation (395 and 385) at the zero point, with limited errors outside of points near zero, with the validation data producing only a very small amount of errors between − 1 and 1.

Fig. 15
figure 15
Histogram of the multi-verse-optimizer–artificial-neural-network algorithm for a training, b testing, and c validation

Full size image
Cumulative distribution function plot results
The cumulative distribution function is presented in Fig. 16. It investigates the ANN’s measure of error, with the red curve referring to training, the blue curve referring to testing (featuring a greater degree of error), and the black curve referring to validation. The training curve demonstrably features the smallest error. The training error was 1.32, the testing error was 1.4, and the validation error was 2.32. Figure 16 demonstrates that 95% of the prediction error associated with the training curve was below 0.19. Meanwhile, 95% of the prediction error for the testing curve was below 0.8, and 95% of the prediction error for the validation curve was below 0.81. Thus, Fig. 16 indicates that the probability of detecting respiratory events was comparable for testing and validating at the 95% level.

Fig. 16
figure 16
The cumulative distribution function of the multi-verse-optimizer–artificial-neural-network algorithm

Full size image
Predicting sleep apnea events
As Sect. 7 indicated, the output of the MOV-ANN indicates one of three cases, which are denoted by “0” (normal or healthy breathing), “1” (hypopnea), and “2” (apnea). A healthy case indicates that the participant does not suffer from sleep apnea. The apnea case indicates that the patient has SA. However, hypopnea indicates a condition that is less severe than SA. This means that the hypopnea case can be utilized to predict SA before it happens. Figure 17 shows the correlation between SAEs predicted by the MVO-ANN (the black line) and the actual cases indicated during the validation process (healthy, hypopnea, and apnea as a blue line). The figure also specifically indicates the three distinct cases identified by the ANN’s output: healthy (green line), hypopnea (yellow line), and apnea (red line), revealing that the predictions draw level with the pattern of actual cases alongside the samples, indicating a good fit based on the scale of the plot. That is, Fig. 17 reveals close agreement between prediction and actual cases in terms of validating the ANN.

Fig. 17
figure 17
Actual and predicted sleep apnea events

Full size image
Sleep apnea system performance evaluation
The SAS’s performance––in terms of detecting and predicting SAEs––was evaluated using a statistical analysis that considered accuracy, sensitivity, and specificity. These statistical markers were selected to measure the reliability of the proposed SAS in relation to the methods and results of previous studies. Accuracy, sensitivity, and specificity were measured according to the following equations:

accuracy=(𝑇𝑃+𝑇𝑁)(𝐹𝑃+𝑇𝑁+𝑇𝑃+𝐹𝑁)×100%
(7)
specificity=𝑇𝑁(𝑇𝑁+𝐹𝑃)×100%
(8)
sensitivity=𝑇𝑃(𝑇𝑃+𝐹𝑁)×100%
(9)
where TP denotes true positive (the number of normal events that are recorded as normal), TN denotes true negative (the number of abnormal events that are recorded as abnormal), FP denotes false positive (the number of abnormal events that are recorded as normal), and FN denotes false negative (the number of normal events recorded as abnormal).

Applying Eqs. (7), (8), and (9) to the proposed SAS revealed an accuracy of 98.67%, a sensitivity of 96.71%, and a specificity of 99.24%.

Comparison with the results of previous research
This section compares the performance of the proposed SAS with the results presented in previous research concerning adopted algorithms, numbers of hidden layers, neurons, numbers of participants, sensitivity, specificity, and accuracy (see Table 5). Most of the results presented in this paper were comparable to or outperformed the findings reported by previous studies, likely because those previous papers considered artificial techniques. Notably, the SAS performed slightly better than other approaches in terms of specificity. Measurement accuracy is a key factor in the design of a medical device, and, promisingly, the proposed SAS achieved a relatively high accuracy of 98.67%, outperforming most of the existing methods considered. The proposed SAS also features several benefits in comparison to other approaches. Not only does it adopt low-power sensors (pulse oximeter and flex), it is small and lightweight, easy to set up, and inexpensive, adopting BLE wireless communication allows rapid diagnosis and free movement during sleep, and the low-power components mean that the SAS is capable of long-term monitoring. Although a trade-off between measurement accuracy and the benefits provided by the proposed SAS was necessary, the device’s accuracy can be improved to approach the BM (i.e., HSAT). However, this might come at the expense of increasing the system’s cost and complexity as a result of adding other sensors, such as oronasal airflow sensors, position sensors, EEG, or ECG. Future research could consider such modifications.

Table 5 Comparison between previous research and current work
Full size table
Conclusions
The current research involved collecting data using a new SAS featuring three sensors: HR, SpO2, and flex. These parameters were measured and transmitted from the patient’s body to the MU via BLE 4.0 to predict the frequency and severity of SAEs. The measurements were comfortable for the sleeping patients because they could move freely. A total of 25,200 data samples were gathered from 10 volunteers, six of whom were suffering from SA and four of whom were healthy. The data collected from the patients for the three sensors were used to train (70%), test (15%), and validate (15%) the ANN. Five hybrid algorithms (GSA-ANN, BSA-ANN, CSA-ANN, PSO-ANN, and MVO-ANN) were considered to determine which featured the best hidden-layer neuron count and which featured a learning rate producing the lowest MSE. Identifying such an algorithm aimed to enable accurate prediction of respiratory events before they happen, and the results indicated that the MVO-ANN algorithm performed better in terms of error (MSE = 0.11).

Slight errors in the results were probably due to the movement of the pulse oximeter sensor that was attached to the patient’s finger, movement of which can promote sudden changes in HR or SpO2 readings. Nonetheless, the results obtained for the proposed SAS indicate that it can reliably predict respiratory events, with the experimental results suggesting the device achieved 98.67% accuracy, 96.71% sensitivity, and 99.24% specificity.

From a technical perspective, future research should seek to use other algorithms to reduce error and increase the degree of correspondence between real and predicted respiratory events. Using certain strategies for reducing the energy consumption of the SAS and increasing its battery life is critical to increasing patient monitoring time, which was only 17 h in the current study. In terms of treatment, positive airway pressure (PAP) devices are among the best non-surgical treatments for people suffering from SA. These devices provide continuous positive pressure to open the airway and prevent it from blocking. However, using the device continuously can produce various side effects, including congestion, dryness, sneezing, runny nose, sore throat, and irritated eyes. Given that the proposed SAS can predict respiratory events before they occur, it could be used to develop a device that can control the PAP device. Designing this type of “smart” PAP device would reduce the side effects associated with using such devices.

Keywords
Artificial neural network
Heart rate
Prediction
SpO2
Sleep apnea
Soft computing algorithm
