Assessing equity in treatment of a subpopulation often involves assigning numerical “scores” to all individuals in the full population such that similar individuals get similar scores; matching via propensity scores or appropriate covariates is common, for example. Given such scores, individuals with similar scores may or may not attain similar outcomes independent of the individuals’ memberships in the subpopulation. The traditional graphical methods for visualizing inequities are known as “reliability diagrams” or “calibrations plots,” which bin the scores into a partition of all possible values, and for each bin plot both the average outcomes for only individuals in the subpopulation as well as the average outcomes for all individuals; comparing the graph for the subpopulation with that for the full population gives some sense of how the averages for the subpopulation deviate from the averages for the full population. Unfortunately, real data sets contain only finitely many observations, limiting the usable resolution of the bins, and so the conventional methods can obscure important variations due to the binning. Fortunately, plotting cumulative deviation of the subpopulation from the full population as proposed in this paper sidesteps the problematic coarse binning. The cumulative plots encode subpopulation deviation directly as the slopes of secant lines for the graphs. Slope is easy to perceive even when the constant offsets of the secant lines are irrelevant. The cumulative approach avoids binning that smooths over deviations of the subpopulation from the full population. Such cumulative aggregation furnishes both high-resolution graphical methods and simple scalar summary statistics (analogous to those of Kuiper and of Kolmogorov and Smirnov used in statistical significance testing for comparing probability distributions).

Introduction
Analysis of whether a subpopulation has had equitable treatment often assesses whether similar individuals attain similar outcomes irrespective of the individuals’ memberships in the subpopulation. To effect the comparison, each individual gets a real-valued “score” used to match that individual with other similar individuals (such matching could use propensity scores or a suitable covariate, for instance). Each individual also gets a real-valued outcome of the treatment. A formal assessment could then consider how much the average outcome for individuals with a given score that belong to the subpopulation deviates from the average outcome for all individuals from the full population that have that same score.

When there are only finitely many observations, questions of statistical significance arise; for example, if the scores are predicted probabilities and the outcomes are drawn from independent (but not necessarily identically distributed) Bernoulli distributions with parameters given by the predicted probabilities, then the average outcome for individuals with a given score fluctuates across different random samples defining the subpopulation being analyzed. In such scenarios, the average outcome for the observed subpopulation would be expected to deviate stochastically from the average for the full population. Furthermore, each individual in the sampled subpopulation may very well have a different score from all the others, requiring some aggregation of scores in order to average away the statistical noise. The conventional approach is to partition the scores into some number of bins and calculate averages separately for every bin, trading off resolution in the scores for increased confidence in the statistical estimates. The present paper proposes an alternative based on cumulative statistics that avoids the necessarily arbitrary binning (binning that typically follows heuristics discussed shortly); the cumulative approach yields graphical methods as well as scalar summary statistics that are similar to the Kolmogorov-Smirnov and Kuiper metrics familiar from statistical significance testing for comparing probability distributions.

More concretely, subpopulations commonly considered include those associated with protected classes (such as those defined by race, color, religion, gender, national origin, age, disability, veteran status, or genetic information) and those associated with biomedicine (such as diseased, infected, treated, or recovered). The present paper discusses generic methodology applicable to all cases, illustrating the methods via interesting subpopulations that are unlikely to court controversy via their consideration; this paper avoids giving examples based on subpopulations defined by sensitive classes of direct interest to hot-button issues. The illustrative examples presented below are deliberately anodyne (but hopefully still sufficiently engaging) to avoid distracting from the focus on the statistical methodology being proposed.

Mathematically speaking, we consider m real-valued observations 𝑅1, 𝑅2, ..., 𝑅𝑚 of the outcomes of independent trials with corresponding real-valued scores 𝑆1, 𝑆2, ..., 𝑆𝑚 (where the scores very well may determine the probability distributions of the trials; for example, if 0≤𝑆𝑖≤1, then 𝑅𝑖 could be the outcome of a Bernoulli trial whose probability of success is 𝑆𝑖). We view 𝑅1, 𝑅2, ..., 𝑅𝑚 (but not 𝑆1, 𝑆2, ..., 𝑆𝑚) as random. Without loss of generality, we order the scores (preserving the pairing of 𝑅𝑖 with 𝑆𝑖 for every i) such that 𝑆1≤𝑆2≤…≤𝑆𝑚, ordering any ties at random, perturbed so that 𝑆1<𝑆2<…<𝑆𝑚. We consider a subset of indices corresponding to members of a subpopulation of interest, say 𝑖1, 𝑖2, ..., 𝑖𝑛, with 𝑛<𝑚; without loss of generality, we order the indices such that 1≤𝑖1<𝑖2<…<𝑖𝑛≤𝑚. Each observation 𝑅𝑖 and score 𝑆𝑖 may also come with a positive weight 𝑊𝑖; however, we focus first on the simpler, more common case of uniform weighting, in which 𝑊1=𝑊2=…=𝑊𝑚, and generalize to arbitrary weights later (in section "Weighted sampling" below).

The classical methods require choosing some partitions of the real line into ℓ disjoint intervals with endpoints 𝐵1, 𝐵2, ..., 𝐵ℓ−1 and another (possibly the same) ℓ disjoint intervals with endpoints 𝐵̃ 1, 𝐵̃ 2, ..., 𝐵̃ ℓ−1 such that 𝐵1<𝐵2<…<𝐵ℓ−1 and 𝐵̃ 1<𝐵̃ 2<…<𝐵̃ ℓ−1. We can then form the averages for the subpopulation

𝑌𝑘=∑𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘𝑅𝑖𝑗#{𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘}
(1)
and for the full population

𝑌̃ 𝑘=∑𝑖:𝐵̃ 𝑘−1<𝑆𝑖≤𝐵̃ 𝑘𝑅𝑖#{𝑖:𝐵̃ 𝑘−1<𝑆𝑖≤𝐵̃ 𝑘}
(2)
for 𝑘=1, 2, ..., ℓ, under the convention that 𝐵0=𝐵̃ 0=−∞ and 𝐵ℓ=𝐵̃ ℓ=∞. We also calculate the average scores in the bins for the subpopulation

𝑋𝑘=∑𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘𝑆𝑖𝑗#{𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘}
(3)
and for the full population

𝑋̃ 𝑘=∑𝑖:𝐵̃ 𝑘−1<𝑆𝑖≤𝐵̃ 𝑘𝑆𝑖#{𝑖:𝐵̃ 𝑘−1<𝑆𝑖≤𝐵̃ 𝑘}
(4)
for 𝑘=1, 2, ..., ℓ, under the same convention that 𝐵0=𝐵̃ 0=−∞ and 𝐵ℓ=𝐵̃ ℓ=∞. A graphical method for assessing the deviation of the subpopulation from the full population is then to scatterplot the pairs (𝑋1,𝑌1), (𝑋2,𝑌2), ..., (𝑋ℓ,𝑌ℓ) in black and the pairs (𝑋̃ 1,𝑌̃ 1), (𝑋̃ 2,𝑌̃ 2), ..., (𝑋̃ ℓ,𝑌̃ ℓ) in gray. Comparing the black plotted points (possibly connected with black lines) to the gray plotted points (possibly connected with gray lines) then indicates how much the subpopulation deviates from the full population. Especially when assessing the calibration or reliability of probabilistic predictions, this graphical method is known as a “reliability diagram” or “calibration plot,” as reviewed, for example, by [1] and [2].

A full review of the literature is available in section "Introduction to assessing calibration" of Appendix A.

There are at least two common choices of the bins whose endpoints are 𝐵1, 𝐵2, ..., 𝐵ℓ−1 (and similarly for the bins whose endpoints are 𝐵̃ 1, 𝐵̃ 2, ..., 𝐵̃ ℓ−1). The first is to make 𝐵1, 𝐵2, ..., 𝐵ℓ−1 be equispaced. The second is to select 𝐵1, 𝐵2, ..., 𝐵ℓ−1 such that the number of scores from the subpopulation that fall in the kth bin, that is, #{𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘}, is the same for all k (aside from the rightmost bin, that for 𝑘=ℓ, if n is not perfectly divisible by ℓ). In both cases, the number ℓ of bins is a parameter that we can vary to trade-off higher-confidence estimates for finer resolution in detecting deviation as a function of score (and vice versa). Unfortunately, no choice can fully offset how the difference between the subpopulation and the full population is typically the primary interest, whereas the standard plot bins the subpopulation and the full population separately (potentially smoothing away information due to the discretization). Plotting the difference directly would solve this particular problem. Even then, however, no choice of bins can be optimal for all possible distributions of scores or for all possible distributions of deviations between the subpopulation and the full population. Binning will always discretize the distributions, smoothing away potentially important information.

Fortunately, binning so coarsely is unnecessary in the methods proposed below. The methods discussed below employ exactly one bin per score 𝑆𝑖𝑗, 𝑗=1, 2, ..., n, thus viewing the subpopulation on its own terms, dictated by the observations from the subpopulation. Employing only one bin per score would be nonsensical in the classical plots, as then the classical plots would trade-off all statistical confidence for the finest resolution possible. The cumulative methods sacrifice no resolution that is available in the observed data for the subpopulation.

For a simple illustrative example, Fig. 1 displays both the conventional reliability diagrams as well as the cumulative plot proposed below. A detailed description is available in section "Synthetic" below. The lowermost two rows of Fig. 1 are the classical diagrams, with 𝑚= 50,000 and 𝑛= 5000; there are ℓ=10 bins for each diagram in the second row and ℓ=50 for each diagram in the third row. In the lowermost two rows, the bins are equispaced along the scores in the leftmost plots, whereas each bin contains the same number of scores from 𝑆𝑖1, 𝑆𝑖2, ..., 𝑆𝑖𝑛 (or from 𝑆1, 𝑆2, ..., 𝑆𝑚) in the rightmost plots. The diagram of Fig. 2 plots the ordered pairs (𝑆1,𝑃1), (𝑆2,𝑃2), ..., (𝑆𝑚,𝑃𝑚) in gray and (𝑆𝑖1,𝑃𝑖1), (𝑆𝑖2,𝑃𝑖2), ..., (𝑆𝑖𝑛,𝑃𝑖𝑛) in black, where 𝑃1, 𝑃2, ..., 𝑃𝑚 are the expected values of 𝑅1, 𝑅2, ..., 𝑅𝑚, respectively; for this example, 𝑅1, 𝑅2, ..., 𝑅𝑚 are drawn independently from Bernoulli distributions with probabilities of success 𝑃1, 𝑃2, ..., 𝑃𝑚. Thus, Fig. 2 depicts the “ground-truth” expectations that the lowermost two rows of classical plots in Fig. 1 are trying to characterize. The gray points correspond to the full population, while the solid black points correspond to the subpopulation.

The topmost row of Fig. 1 displays both the cumulative plot introduced below as well as its ideal noiseless “ground-truth” constructed using the expected values 𝑃1, 𝑃2, ..., 𝑃𝑚 of the random observations 𝑅1, 𝑅2, ..., 𝑅𝑚. Leaving elucidation of the cumulative plots and their construction to section "Methods" below, we just point out here that the deviation of the subpopulation from the averages over the full population across an interval is equal to the slope of the secant line for the graph over that interval, aside from expected stochastic fluctuations detailed in section “Significance of stochastic fluctuations” below. Steep slopes correspond to substantial deviations across the ranges of scores where the slopes are steep, with the deviation over an interval exactly equal to the expected value of the slope of the secant line for the graph over that interval. The cumulative plot closely resembles its ideal ground-truth in Fig. 1, and the Kolmogorov-Smirnov and Kuiper metrics conveniently summarize the statistical significance of the overall deviation across all scores, in accord with sections "Scalar summary statistics" and “Significance of stochastic fluctuations” below.

The structure of the remainder of the present paper is as follows: Section "Methods" details the statistical methodology that section "Results and discussion" illustrates via numerical examples.Footnote1 Section "Results and discussion" also proposes avenues for further development. Section "Conclusion" then briefly summarizes the methods and numerical results. Appendix A describes methods for calibrating probabilistic predictions that are analogous to the cumulative methodology introduced in section "Methods" for assessing deviation of a subpopulation from the full population. Appendix A also contains a literature review, in section "Introduction to assessing calibration"; please consult section "Introduction to assessing calibration" for a discussion of related work. Appendix B warns about potentially tempting overinterpretations of the various plots. Table 1 gives a glossary of the notation used throughout except in the appendices, while Table 2 gives a glossary of the notation used in the appendices.

Fig. 1
figure 1
𝑛= 5000; Kuiper’s statistic is 0.2037/𝜎=34.34, Kolmogorov’s and Smirnov’s is 0.2033/𝜎=34.27. Figure 2 displays the ground-truth reliability diagram. The reliability diagram with 50 bins that each contain the same number of scores from the subpopulation is able to detect the notch around scores of 0.25; however, the oscillation of the bin frequencies for the subpopulation complicates disentangling real variations from statistical noise. The reliability diagrams that each have only 10 bins exhibit fewer random oscillations, but smear out the notch. In the reliability diagrams, the averages for the subpopulation are black, while the averages for the full population are gray. In the top row, the plot of cumulative deviation resolves the notch nicely while displaying minimal random fluctuations across the full range of scores. The scalar summary statistics of Kuiper and of Kolmogorov and Smirnov very successfully detect the statistically significant deviation of the subpopulation from the full population

Full size image
Fig. 2
figure 2
Ground-truth reliability diagram for Fig. 1

Full size image
Methods
This section formulates the cumulative statistics mathematically, with section "High-level strategy" proposing a workflow for large-scale analysis. Section "Graphical method" details the graphical methods. Section "Scalar summary statistics" details the scalar summary metrics. Section "Significance of stochastic fluctuations" discusses statistical significance for both the graphical methods and the summary statistics. Section "Weighted sampling" presents a generalization of these statistical methodologies to the case of weighted samples (beyond just equally or uniformly weighted).

Table 1 Notational conventions for all but the appendices
Full size table
Table 2 Notational conventions for the appendices
Full size table
High-level strategy
This subsection suggests a hybrid method for large-scale data analysis. When there are many data sets and subpopulations to assess, a two-step approach may be the most practical:

1.
A screening stage assigning a single scalar summary statistic to each pair of data set and subpopulation (where the size of the statistic measures the deviation of the subpopulation from the full population).

2.
A detailed drill-down for each pair of data set and subpopulation whose scalar summary statistic is large, drilling down into how the deviation of the subpopulation from the full population varies as a function of score.

The drill-down relies on graphically displaying the deviation of the subpopulation from the full population as a function of score; the scalar statistic for the first stage simply summarizes the overall deviation across all scores, as either the maximum absolute deviation of the graph or the size of the range of deviations in the graphical display. Thus, for each pair of data set and subpopulation, both stages leverage a graph; the first stage collapses the graph into a single scalar summary statistic. The following subsection constructs the graph.

Graphical method
This subsection details the construction of cumulative plots.

Two sequences will define the cumulative plot based on the notation set in the introduction. The cumulative sequence for the subpopulation is

𝐹𝑘=1𝑛∑𝑗=1𝑘𝑅𝑖𝑗
(5)
for 𝑘=1, 2, ..., n.

Facilitating comparison of the subpopulation with the full population, the average result for the full population in a bin around 𝑆𝑖𝑘 is

𝑅̃ 𝑖𝑘=∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝑅𝑖#{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘}
(6)
for 𝑘=1, 2, ..., n, where the thresholds for the bins are

𝐵𝑘=𝑆𝑖𝑘+𝑆𝑖𝑘+12
(7)
for 𝑘=0, 1, 2, ..., n, under the convention that 𝑆𝑖0=−∞ and 𝑆𝑖𝑛+1=∞ (so 𝐵0=−∞ and 𝐵𝑛=∞).

The cumulative sequence for the full population at the subpopulation’s subset of scores is

𝐹̃ 𝑘=1𝑛∑𝑗=1𝑘𝑅̃ 𝑖𝑗
(8)
for 𝑘=1, 2, ..., n, where 𝑅̃ 𝑖𝑗 is defined in (6).

Although the accumulation from lower scores might at first glance appear to overwhelm the contributions from higher scores, a plot of 𝐹𝑘−𝐹̃ 𝑘 as a function of k will display deviation of the subpopulation from the full population for any score solely in slopes that deviate significantly from 0; any problems accumulated from earlier, lower scores pertain only to the constant offset from 0, not to the slope deviating from 0. In fact, the increment in the expected difference 𝐹𝑗−𝐹̃ 𝑗 from 𝑗=𝑘−1 to 𝑗=𝑘 is

𝔼[(𝐹𝑘−𝐹̃ 𝑘)−(𝐹𝑘−1−𝐹̃ 𝑘−1)]=𝔼[𝑅𝑖𝑘]−𝔼[𝑅̃ 𝑖𝑘]𝑛;
(9)
thus, on a plot with the values for k spaced 1/n apart, the slope from 𝑗=𝑘−1 to 𝑗=𝑘 is

Δ𝑘=𝔼[𝑅𝑖𝑘]−𝔼[𝑅̃ 𝑖𝑘],
(10)
where the expected value of the average result 𝑅̃ 𝑖𝑘 in the bin around 𝑆𝑖𝑘 is equal to the average of the expected results, that is,

𝔼[𝑅̃ 𝑖𝑘]=∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝔼[𝑅𝑖]#{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘}
(11)
for 𝑘=1, 2, ..., n, and 𝑅̃ 𝑖𝑘 is defined in (6). The subpopulation deviates from the full population for the scores near 𝑆𝑖𝑘 when Δ𝑘 is significantly nonzero, that is, when the slope of the plot of 𝐹𝑘−𝐹̃ 𝑘 deviates significantly from horizontal over a significantly long range.

To emphasize: the deviation of the subpopulation from the full population over a contiguous range of 𝑆𝑖𝑘 is the slope of the secant line for the plot of 𝐹𝑘−𝐹̃ 𝑘 as a function of 𝑘𝑛 over that range, aside from expected random fluctuations.

Figure 1 presents a simple illustrative example, and many examples analyzing data from a popular data set in computer vision, “ImageNet,” are available in section "ImageNet". The leftmost plot in the topmost row of Fig. 1 graphs 𝐹𝑘−𝐹̃ 𝑘 versus k/n; the rightmost plot in the top row is the ideal noiseless “ground-truth” constructed using the precise expected values of the random observations 𝑅1, 𝑅2, ..., 𝑅𝑚 (as detailed in section "Synthetic", the exact expectations are available for constructing the ground-truth in the synthetic example corresponding to Fig. 1). Steep slopes correspond to substantial deviations across the ranges of scores where the slopes are steep, with the deviation over an interval exactly equal to the expected value of the slope of the secant line for the graph over that interval. The cumulative plot nicely matches its ideal ground-truth in Fig. 1.

The following subsection discusses metrics summarizing how much the graph deviates from 0 (needless to say, if the slopes of the secant lines are all nearly 0, then the whole graph cannot deviate much from 0). Section "Significance of stochastic fluctuations" then leverages these metrics in a discussion of the expected stochastic fluctuations mentioned above.

Scalar summary statistics
This subsection details the construction of scalar statistics which provide broad-brush summaries of the plots introduced in the previous subsection.

Two standard metrics for the overall deviation of the subpopulation from the full population over the full range of scores that account for expected random fluctuations are that due to Kolmogorov and Smirnov, the maximum absolute deviation

𝐺=max1≤𝑘≤𝑛|𝐹𝑘−𝐹̃ 𝑘|,
(12)
and that due to Kuiper, the size of the range of the deviations

𝐷=max0≤𝑘≤𝑛(𝐹𝑘−𝐹̃ 𝑘)−min0≤𝑘≤𝑛(𝐹𝑘−𝐹̃ 𝑘),
(13)
where 𝐹0=0=𝐹̃ 0; the following remark explains the reason for including 𝐹0 and 𝐹̃ 0 (a reason that often makes D modestly preferable to G). Under appropriate statistical models, G and D can form the basis for tests of statistical significance, the context in which they originally appeared; see, for example, Section 14.3.4 of [3]. For assessing statistical significance (rather than overall effect size), G and D should be rescaled larger by a factor proportional to 𝑛√; further discussion of the rescaling is available in the next subsection. The captions of the figures report the values of these summary statistics for all examples.

Remark 1
The statistic D from (13) has the same statistical power across all indices. Indeed, shifting the index in the definitions of 𝐹𝑘 and 𝐹̃ 𝑘 where the summation starts has no effect on the value of D, for the following reasons: Recall that an integral whose lower limit of integration is greater than the upper limit is simply the negative of the integral with the lower and upper limits of integration interchanged. Thus, the natural generalization when starting from arbitrary values of j the summations defining 𝐹𝑘 in (5) and 𝐹̃ 𝑘 in (8) is

𝐹(ℓ)𝑘=1𝑛∑𝑗:ℓ<𝑗≤𝑘𝑅𝑖𝑗−1𝑛∑𝑗:𝑘<𝑗≤ℓ𝑅𝑖𝑗
(14)
and

𝐹̃ (ℓ)𝑘=1𝑛∑𝑗:ℓ<𝑗≤𝑘𝑅̃ 𝑖𝑗−1𝑛∑𝑗:𝑘<𝑗≤ℓ𝑅̃ 𝑖𝑗
(15)
for 𝑘=0, 1, 2, ..., n; ℓ=0, 1, 2, ..., n, with the case ℓ=0 reducing to (5) and (8). Of course, the first summation in the right-hand side of (14) vanishes when 𝑘≤ℓ and the second summation vanishes when 𝑘≥ℓ; similarly, the first summation in the right-hand side of (15) vanishes when 𝑘≤ℓ and the second summation vanishes when 𝑘≥ℓ. Consideration of each case, for 𝑘<ℓ, for 𝑘=ℓ, and for 𝑘>ℓ, yields that

𝐹(ℓ)𝑘=𝐹(0)𝑘−𝐹(0)ℓ
(16)
and

𝐹̃ (ℓ)𝑘=𝐹̃ (0)𝑘−𝐹̃ (0)ℓ
(17)
for 𝑘=0, 1, 2, ..., n; ℓ=0, 1, 2, ..., n. The definition

𝐷(ℓ)=max0≤𝑘≤𝑛(𝐹(ℓ)𝑘−𝐹̃ (ℓ)𝑘)−min0≤𝑘≤𝑛(𝐹(ℓ)𝑘−𝐹̃ (ℓ)𝑘),
(18)
when combined with (16) and (17), then yields that

𝐷(ℓ)=𝐷(0)=𝐷
(19)
for ℓ=0, 1, 2, ..., n, where D is from (13). This shows that the statistic D has the same statistical power for any index, as the statistic is invariant to shifts in where the summation for the cumulative differences starts.

Significance of stochastic fluctuations
This subsection discusses statistical significance both for the graphical methods of section "Graphical method" and for the summary statistics of section "Scalar summary statistics".

The plot of 𝐹𝑘−𝐹̃ 𝑘 as a function of k/n automatically includes some “confidence bands” courtesy of the discrepancy 𝐹𝑘−𝐹̃ 𝑘 fluctuating randomly as the index k increments—at the very least, the “thickness” of the plot coming from the random fluctuations gives a sense of “error bars.” To give a rough indication of the size of the fluctuations of the maximum deviation expected under the hypothesis that the subpopulation does not deviate from the full population in the actual underlying distributions, the plots should include a triangle centered at the origin whose height above the origin is proportional to 1/𝑛√. Such a triangle can be a proxy for the classic confidence bands around an empirical cumulative distribution function introduced by Kolmogorov and Smirnov, as reviewed by [4]. Indeed, a driftless, purely random walk deviates from zero by roughly 𝑛√ after n steps, so a random walk scaled by 1/n deviates from zero by roughly 1/𝑛√. Identification of deviation between the subpopulation and the full population is reliable when focusing on long ranges (as a function of k/n) of steep slopes for 𝐹𝑘−𝐹̃ 𝑘; the triangle gives a sense of the length scale for variations that arise solely due to randomness even in the absence of any actual underlying deviation between the subpopulation and the full population. A simple illustrative example is available in Fig. 1, and many examples analyzing data from a popular data set in computer vision, “ImageNet,” are available in section "ImageNet".

In cases for which either 𝑅𝑖=0 or 𝑅𝑖=1 for each 𝑖=1, 2, ..., m, and for which the scores are nothing but the probabilities of success, that is, 𝑆𝑖 is the probability that 𝑅𝑖=1 (where 𝑖=1, 2, ..., m), the tip-to-tip height of the triangle centered at the origin should be 4/n times the standard deviation of the sum of independent Bernoulli variates with success probabilities 𝑆𝑖1, 𝑆𝑖2, ..., 𝑆𝑖𝑛, that is, 4∑𝑛𝑘=1𝑆𝑖𝑘(1−𝑆𝑖𝑘)‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾√/𝑛. This height will be representative to within a factor of 2‾√ or so provided that the subpopulation is a minority of the full population—see Remark 7 and section "Significance of stochastic fluctuations for assessing calibration" of Appendix A below. Needless to say, similar remarks pertain whenever the variance of 𝑅𝑖 is a known function of 𝑆𝑖 for each 𝑖=1, 2, ..., m.

In cases for which either 𝑅𝑖=0 or 𝑅𝑖=1 for each 𝑖=1, 2, ..., m, and for which there are many scores from the full population in the bin for each score from the subpopulation, that is, #{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘} is large for every 𝑘=1, 2, ..., n, the average of the outcomes for each bin will be a good approximation to the average of the underlying probabilities of success for that bin, that is,

∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝑅𝑖#{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘}≈∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝔼[𝑅𝑖]#{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘}=𝔼[𝑅̃ 𝑖𝑘]
(20)
for 𝑘=1, 2, ..., n, where 𝐵𝑘 is from (7), 𝔼[𝑅̃ 𝑖𝑘] is from (11), and 𝔼[𝑅𝑖] is the probability that the outcome is a success, that is, the probability that 𝑅𝑖=1. In such cases, the tip-to-tip height of the triangle at the origin should be 4/n times the standard deviation of the sum of independent Bernoulli variates with success probabilities 𝔼[𝑅̃ 𝑖1], 𝔼[𝑅̃ 𝑖2], ..., 𝔼[𝑅̃ 𝑖𝑛], that is, 4∑𝑛𝑘=1𝔼[𝑅̃ 𝑖𝑘](1−𝔼[𝑅̃ 𝑖𝑘])‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾√/𝑛 — and we may use (20) to approximate this height as four times

𝜎=1𝑛∑𝑘=1𝑛𝑅̃ 𝑖𝑘(1−𝑅̃ 𝑖𝑘)‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾⎷,
(21)
where 𝑅̃ 𝑖𝑘 is the left-hand side of (20), as seen from (6). The triangles in the figures all have this height when each 𝑅𝑖 is either 0 or 1, since the numerical results reported in the following section pertain to the case in which there are quite a few scores from the full population in the bin for each score from the subpopulation. When 𝑅𝑖 can take on more than two possible values, the figures instead use the empirical variance of the members from the full population for each bin from 𝐵𝑘−1 to 𝐵𝑘, that is, we replace (21) with

𝜎=1𝑛∑𝑘=1𝑛𝑉𝑖𝑘‾‾‾‾‾‾⎷,
(22)
where the empirical variance is

𝑉𝑖𝑘=∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘(𝑅𝑖−𝑅̃ 𝑖𝑘)2#{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘}
(23)
for 𝑘=1, 2, ..., n, with 𝑅̃ 𝑖𝑘 defined in (6); 𝑅̃ 𝑖𝑘 is also the left-hand side of (20).

[Rigorous justification of (20) is straightforward: the expected value of the left-hand side of (20) is the right-hand side of (20), and 0≤𝔼[𝑅𝑖]≤1 implies that 𝔼[𝑅𝑖](1−𝔼[𝑅𝑖])≤1/4, so the standard deviation of the left-hand side of (20) is

∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝔼[𝑅𝑖](1−𝔼[𝑅𝑖])‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾√#{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘}≤12#{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘}‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾√,
(24)
which converges to 0 as #{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘} increases.]

Remark 2
Interpreting the scalar summary statistics G and D from (12) and (13) is straightforward in these latter cases, using 𝜎 defined in (21) or (22). Indeed, under the null hypothesis that the subpopulation has no deviation from the average values of the full population at the corresponding scores, the expected value of 𝐺/𝜎 is less than or equal to the expected value of the maximum (over a subset of the unit interval [0, 1]) of the absolute value of the standard Brownian motion over [0, 1], in the limit 𝑛→∞ and #{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘}→∞ for all 𝑘=1, 2, ..., n. As reviewed below in Remark 7, the expected value of the maximum of the absolute value of the standard Brownian motion over the unit interval [0, 1] is 𝜋/2‾‾‾√≈1.25; and the discussion by [5] immediately following Formula 44 of the associated arXiv publicationFootnote2 shows that the probability distribution of the maximum of the absolute value of the standard Brownian motion over [0, 1] is sub-Gaussian, decaying past its mean 𝜋/2‾‾‾√≈1.25. So, values of 𝐺/𝜎 much greater than 1.25 imply that the subpopulation’s deviation from the full population is significant, while values of 𝐺/𝜎 close to 0 imply that G did not detect any statistically significant deviation. Similar remarks pertain to D, since 𝐺≤𝐷≤2𝐺.

Remark 3
Zooming in on the origin of the plot can reveal relative deviations (or small absolute deviations) that may be of interest beyond just the absolute deviations; Fig. 20 displays such zooming, while setting the height of the triangle at the origin based on only the scores and deviations appearing in the restricted domain of the plot, rather than on the full domain depicted in the other figures.

Weighted sampling
This subsection generalizes the methods of the preceding subsections to the case of weighted samples.

Specifically, some data sets include a weight for how much each observation should contribute to the data analysis. In the setting of section "Graphical method" above, such a data set would supplement the results 𝑅1, 𝑅2, ..., 𝑅𝑚 and scores 𝑆1, 𝑆2, ..., 𝑆𝑚 with positive weights 𝑊1, 𝑊2, ..., 𝑊𝑚. Section "Graphical method" will correspond to the special case that 𝑊1=𝑊2=…=𝑊𝑚 (admittedly, the “special” case is the standard in practice).

With weights, the cumulative sequence for the subpopulation, replacing (5), becomes

𝐹𝑘=∑𝑘𝑗=1𝑊𝑖𝑗𝑅𝑖𝑗∑𝑛𝑗=1𝑊𝑖𝑗
(25)
for 𝑘=1, 2, ..., n.

The average result for the full population in a bin around 𝑆𝑖𝑘, replacing (6), becomes

𝑅̃ 𝑖𝑘=∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝑊𝑖𝑅𝑖∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝑊𝑖
(26)
for 𝑘=1, 2, ..., n, where (7) defines 𝐵0, 𝐵1, ..., 𝐵𝑛, the thresholds for the bins.

The cumulative sequence for the full population at the subpopulation’s subset of scores, replacing (8), becomes

𝐹̃ 𝑘=∑𝑘𝑗=1𝑊𝑖𝑗𝑅̃ 𝑖𝑗∑𝑛𝑗=1𝑊𝑖𝑗
(27)
for 𝑘=1, 2, ..., n, where 𝑅̃ 𝑖𝑗 is defined in (26).

The cumulative sequence of weights is

𝐴𝑘=∑𝑘𝑗=1𝑊𝑖𝑗∑𝑛𝑗=1𝑊𝑖𝑗
(28)
for 𝑘=1, 2, ..., n.

In a plot of the weighted cumulative differences 𝐹1−𝐹̃ 1, 𝐹2−𝐹̃ 2, ..., 𝐹𝑛−𝐹̃ 𝑛 from (25) and (27) versus the cumulative weights 𝐴1, 𝐴2, ..., 𝐴𝑛 from (28), that is, in a plot where 𝐹1−𝐹̃ 1, 𝐹2−𝐹̃ 2, ..., 𝐹𝑛−𝐹̃ 𝑛 are the ordinates (vertical coordinates), and 𝐴1, 𝐴2, ..., 𝐴𝑛 are the corresponding abscissae (horizontal coordinates), the expected value of the slope from 𝐴𝑘−1 to 𝐴𝑘 is

Δ𝑘=𝔼[(𝐹𝑘−𝐹̃ 𝑘)−(𝐹𝑘−1−𝐹̃ 𝑘−1)]𝐴𝑘−𝐴𝑘−1=𝑊𝑖𝑘𝔼[𝑅𝑖𝑘]−𝑊𝑖𝑘𝔼[𝑅̃ 𝑖𝑘]𝑊𝑖𝑘=𝔼[𝑅𝑖𝑘]−𝔼[𝑅̃ 𝑖𝑘],
(29)
where the expected value of the weighted average result 𝑅̃ 𝑖𝑘 in the bin around 𝑆𝑖𝑘 is equal to the weighted average of the expected results, that is,

𝔼[𝑅̃ 𝑖𝑘]=∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝑊𝑖𝔼[𝑅𝑖]∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝑊𝑖
(30)
for 𝑘=1, 2, ..., n, and 𝑅̃ 𝑖𝑘 is defined in (26). Thus, Δ𝑘 defined in (29) is equal to the expected value of the deviation of the subpopulation from the full population for the scores near 𝑆𝑖𝑘, with 𝑊𝑖𝑘 canceling in the rightmost identity of (29). Hence, the subpopulation deviates from the full population for the scores near 𝑆𝑖𝑘 when Δ𝑘 is significantly nonzero, that is, when the slope of the plot of 𝐹𝑘−𝐹̃ 𝑘 versus 𝐴𝑘 deviates significantly from horizontal over a significantly long range.

To emphasize: the deviation of the subpopulation from the full population over a contiguous range of 𝑆𝑖𝑘 is the slope of the secant line for the plot of 𝐹𝑘−𝐹̃ 𝑘 as a function of 𝐴𝑘 over that range, aside from expected random fluctuations.

A simple illustrative example is available in Fig. 7 of section "Synthetic", and many examples analyzing data from the U.S. Census Bureau are available in section "American Community Survey of the U.S. Census Bureau".

The slope of line segments connecting the points in the plot of 𝐹𝑘−𝐹̃ 𝑘 versus 𝐴𝑘 is constant between successive values of k, and those successive values are spaced further apart on the horizontal axis when the weight 𝑊𝑖𝑘 is larger. A plotted line that is straight for a wide horizontal range is therefore indicative of a large weight. Moreover, setting the (major) ticks on the upper horizontal axis at the positions corresponding to equispaced values for k visually depicts the distribution of weights; including equispaced minor ticks on the same upper horizontal axis provides a comparison to the case of uniform weighting.

In cases for which either 𝑅𝑖=0 or 𝑅𝑖=1 for each 𝑖=1, 2, ..., m, and for which there are many scores from the full population in the bin for each score from the subpopulation, that is, #{𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘} is large for every 𝑘=1, 2, ..., n, the tip-to-tip height of the triangle at the origin should be four times

𝜎=∑𝑛𝑘=1(𝑊𝑖𝑘)2𝑅̃ 𝑖𝑘(1−𝑅̃ 𝑖𝑘)‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾√∑𝑛𝑘=1𝑊𝑖𝑘,
(31)
where 𝑅̃ 𝑖𝑘 is defined in (26); that is, we replace (21) with (31). When 𝑅𝑖 can take on more than two possible values, the figures instead use the empirical variance of the members from the full population for each bin from 𝐵𝑘−1 to 𝐵𝑘, that is, we replace (22) and (31) with

𝜎=∑𝑛𝑘=1(𝑊𝑖𝑘)2𝑉𝑖𝑘‾‾‾‾‾‾‾‾‾‾‾‾‾‾√∑𝑛𝑘=1𝑊𝑖𝑘,
(32)
where the empirical variance is

𝑉𝑖𝑘=∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝑊𝑖(𝑅𝑖−𝑅̃ 𝑖𝑘)2∑𝑖:𝐵𝑘−1<𝑆𝑖≤𝐵𝑘𝑊𝑖
(33)
for 𝑘=1, 2, ..., n, with 𝑅̃ 𝑖𝑘 defined in (26). The numerators of (31) and (32) include the square (𝑊𝑖𝑘)2, unlike the other formulae.

The scalar summary statistics due to Kuiper and to Kolmogorov and Smirnov of course use the same formulae (12) and (13) as in the unweighted (or uniformly weighted) case, except for replacing the definition of 𝐹𝑘 from (5) with the definition from (25) and the definition of 𝐹̃ 𝑘 from (8) with the definition from (27).

Remark 4
We can adapt to the case of weighted sampling the classical methods discussed in the introduction. As in the introduction, we choose some partitions of the real line into ℓ disjoint intervals with endpoints 𝐵1, 𝐵2, ..., 𝐵ℓ−1 and another (possibly the same) ℓ disjoint intervals with endpoints 𝐵̃ 1, 𝐵̃ 2, ..., 𝐵̃ ℓ−1 such that 𝐵1<𝐵2<…<𝐵ℓ−1 and 𝐵̃ 1<𝐵̃ 2<⋯<𝐵̃ ℓ−1, and then replace (1) with the weighted averages for the subpopulation

𝑌𝑘=∑𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘𝑊𝑖𝑗𝑅𝑖𝑗∑𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘𝑊𝑖𝑗
(34)
and replace (2) with the weighted averages for the full population

𝑌̃ 𝑘=∑𝑖:𝐵̃ 𝑘−1<𝑆𝑖≤𝐵̃ 𝑘𝑊𝑖𝑅𝑖∑𝑖:𝐵̃ 𝑘−1<𝑆𝑖≤𝐵̃ 𝑘𝑊𝑖
(35)
for 𝑘=1, 2, ..., ℓ, under the convention that 𝐵0=𝐵̃ 0=−∞ and 𝐵ℓ=𝐵̃ ℓ=∞. We also replace (3) with the weighted averages of the scores in the bins for the subpopulation

𝑋𝑘=∑𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘𝑊𝑖𝑗𝑆𝑖𝑗∑𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘𝑊𝑖𝑗
(36)
and replace (4) with the weighted averages for the full population

𝑋̃ 𝑘=∑𝑖:𝐵̃ 𝑘−1<𝑆𝑖≤𝐵̃ 𝑘𝑊𝑖𝑆𝑖∑𝑖:𝐵̃ 𝑘−1<𝑆𝑖≤𝐵̃ 𝑘𝑊𝑖
(37)
for 𝑘=1, 2, ..., ℓ, under the same convention that 𝐵0=𝐵̃ 0=−∞ and 𝐵ℓ=𝐵̃ ℓ=∞. The reliability diagram for assessing the deviation of the subpopulation from the full population is then the scatterplot of the pairs (𝑋1,𝑌1), (𝑋2,𝑌2), ..., (𝑋ℓ,𝑌ℓ) in black and the pairs (𝑋̃ 1,𝑌̃ 1), (𝑋̃ 2,𝑌̃ 2), ..., (𝑋̃ ℓ,𝑌̃ ℓ) in gray. Comparing the black plotted points (possibly connected with black lines) to the gray plotted points (possibly connected with gray lines) gives an indication of deviation of the subpopulation from the full population. Two natural choices of the bins whose endpoints are 𝐵1, 𝐵2, ..., 𝐵ℓ−1 (similar choices pertain to the bins whose endpoints are 𝐵̃ 1, 𝐵̃ 2, ..., 𝐵̃ ℓ−1) include {1} have 𝐵1, 𝐵2, ..., 𝐵ℓ−1 be equispaced, and {2} choose 𝐵1, 𝐵2, ..., 𝐵ℓ−1 such that

𝑈𝑘=∑𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘(𝑊𝑖𝑗)2‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾√∑𝑗:𝐵𝑘−1<𝑆𝑖𝑗≤𝐵𝑘𝑊𝑖𝑗
(38)
has a similar value for all 𝑘=1, 2, ..., ℓ. Remark 5 below details the procedure we followed in the second case; the plots entitled, “reliability diagram (‖𝑊‖2/‖𝑊‖1 is similar for every bin),” display this second possible choice of bins. The plots entitled simply, “reliability diagram,” display the first possible choice of bins. In the special case that the weights are uniform, that is, 𝑊1=𝑊2=⋯=𝑊𝑚, the second choice of bins results in every bin containing about the same number of scores, with 𝑈1≈𝑈2≈…≈𝑈ℓ≈ℓ/𝑛‾‾‾√, and similarly 𝑈̃ 1≈𝑈̃ 2≈…≈𝑈̃ ℓ≈ℓ/𝑚‾‾‾‾√, where

𝑈̃ 𝑘=∑𝑖:𝐵̃ 𝑘−1<𝑆𝑖≤𝐵̃ 𝑘(𝑊𝑖)2‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾√∑𝑖:𝐵̃ 𝑘−1<𝑆𝑖≤𝐵̃ 𝑘𝑊𝑖
(39)
for 𝑘=1, 2, ..., ℓ.

Remark 5
In the case of weighted sampling, the most useful reliability diagrams are usually those entitled, “reliability diagram (‖𝑊‖2/‖𝑊‖1 is similar for every bin).” These diagrams construct ℓ bins with endpoints 𝐵0, 𝐵1, ..., 𝐵ℓ such that 𝑈1≈𝑈2≈…≈𝑈ℓ, where 𝑈𝑘 is defined in (38). These diagrams also construct ℓ̃  bins with endpoints 𝐵̃ 0, 𝐵̃ 1, ..., 𝐵̃ ℓ̃  such that 𝑈̃ 1≈𝑈̃ 2≈…≈𝑈̃ ℓ̃ , where 𝑈̃ 𝑘 is defined in (39). The algorithmic details are as follows: Given a value U for which hopefully 𝑈𝑘≈𝑈 for all 𝑘=1, 2, ..., ℓ, we set 𝐵0=−∞ and, iterating from 𝑘=1 to 𝑘=ℓ, incrementally increase 𝐵𝑘 to the least value greater than 𝐵𝑘−1 such that 𝑈𝑘≤𝑈. If this causes the bin ℓ (the bin for the highest scores) to contain less than half as many subpopulation observations as bin ℓ−1, that is, #{𝑗:𝐵ℓ−1<𝑆𝑖𝑗≤𝐵ℓ}<#{𝑗:𝐵ℓ−2<𝑆𝑖𝑗≤𝐵ℓ−1}/2, then we merge bin ℓ with bin ℓ−1. In the aforementioned algorithm, we computed U via the formula

𝑈=∑⌊𝑛/ℓ¯⌋𝑗=1(𝑊𝑝𝑗)2‾‾‾‾‾‾‾‾‾‾‾‾√∑⌊𝑛/ℓ¯⌋𝑗=1𝑊𝑝𝑗,
(40)
where 𝑝1, 𝑝2, ..., 𝑝𝑛 are a uniformly random permutation of the integers 𝑖1, 𝑖2, ..., 𝑖𝑛, and ℓ¯ is the desired number of bins. Calculating U via the heuristic (40) worked well for all examples reported below, producing 𝑈1≈𝑈2≈…≈𝑈ℓ, with ℓ close to ℓ¯; the procedure yielding 𝑈̃ 1≈𝑈̃ 2≈…≈𝑈̃ ℓ̃  is similar (in fact, the implementation is identical, viewing the full population as a subpopulation of itself).

Results and discussion
This section illustrates via numerous examples the previous section’s methods, together with the traditional plots—so-called “reliability diagrams”—discussed in the introduction.Footnote3 Section "Synthetic" presents several (hopefully insightful) toy examples. Section "ImageNet" analyzes a popular, unweighted data set of images, ImageNet. Section "American Community Survey of the U.S. Census Bureau" analyzes a weighted data set, the most recent (year 2019) American Community Survey of the United States Census Bureau. Section "Future outlook" proposes directions for future developments.

The figures display the classical calibration plots (“reliability diagrams”) as well as both the plots of cumulative differences and the exact expectations in the absence of noise from random sampling when the exact expectations are known (as with synthetically generated data). The captions of the figures discuss the numerical results depicted.

The title, “subpopulation deviation is the slope as a function of k/n,” labels a plot of 𝐹𝑘−𝐹̃ 𝑘 from (5) and (8) as a function of k/n. In each such plot, the upper axis specifies k/n, while the lower axis specifies 𝑆𝑖𝑘 for the corresponding value of k. The title, “subpopulation deviation is the slope as a function of 𝐴𝑘,” labels a plot of 𝐹𝑘−𝐹̃ 𝑘 from (25) and (27) versus the cumulative weight 𝐴𝑘 from (28). In each such plot, the major ticks on the upper axis specify k/n, while the major ticks on the lower axis specify 𝑆𝑖𝑘 for the corresponding value of k; the points in the plot are the ordered pairs (𝐴𝑘,𝐹𝑘−𝐹̃ 𝑘) for 𝑘=1, 2, ..., n, with 𝐴𝑘 being the abscissa and 𝐹𝑘−𝐹̃ 𝑘 being the ordinate.

The titles, “reliability diagram,” “reliability diagram (equal number of subpopulation scores per bin),” and “reliability diagram (‖𝑊‖2/‖𝑊‖1 is similar for every bin),” label a plot of the pairs (𝑋1,𝑌1), (𝑋2,𝑌2), ..., (𝑋ℓ,𝑌ℓ) and (𝑋̃ 1,𝑌̃ 1), (𝑋̃ 2,𝑌̃ 2), ..., (𝑋̃ ℓ,𝑌̃ ℓ) from (1), (2), (3), and (4) or from (34), (35), (36), and (37) in the case of weighted sampling; the subpopulation’s pairs (𝑋1,𝑌1), (𝑋2,𝑌2), ..., (𝑋ℓ,𝑌ℓ) are in black, while the full population’s pairs (𝑋̃ 1,𝑌̃ 1), (𝑋̃ 2,𝑌̃ 2), ..., (𝑋̃ ℓ,𝑌̃ ℓ) are in gray.

To give a sense of the uncertainties in the classical, binned plots, we vary the number of bins and observe how the plotted values vary. Displaying the bin frequencies is another way to indicate uncertainties, as suggested, for example, by [6]. Still other possibilities could use kernel density estimation, as suggested, for example, by [7] and [8]. Such uncertainty estimates require selecting widths for the bins or kernel smoothing; varying the widths (as done in the present paper) avoids having to make what would otherwise be a rather arbitrary choice. A thorough survey of the various possibilities is available in Chapter 8 of [8].

As noted in the introduction, there are two canonical choices for the bins in the case of unweighted (or uniformly weighted) sampling: {1} make the average of 𝑆𝑖𝑘 (or 𝑆𝑖) in each bin be approximately equidistant from the average of 𝑆𝑖𝑘 (or 𝑆𝑖) in each neighboring bin or {2} make the number of 𝑆𝑖𝑘 (or 𝑆𝑖) in every bin (except perhaps for the last) be the same. The figures label the first, more conventional possibility with the short title, “reliability diagram,” and the second possibility with the longer title, “reliability diagram (equal number of subpopulation scores per bin).” As noted in Remark 4, there are two natural choices for the bins in the case of weighted sampling: {1} make the weighted average of 𝑆𝑖𝑘 (or 𝑆𝑖) in each bin be approximately equidistant from the weighted average of 𝑆𝑖𝑘 (or 𝑆𝑖) in each neighboring bin or {2} follow Remark 5 above. The figures label the first possibility with the short title, “reliability diagram,” and the second possibility with the longer title, “reliability diagram (‖𝑊‖2/‖𝑊‖1 is similar for every bin).”

Setting the number of bins together with any of these choices fully specifies the bins. As discussed earlier, we vary the number of bins, since there is no perfect setting—using fewer bins offers higher-confidence estimates, yet limits the resolution for detecting deviations and for assessing how the deviations vary as a function of 𝑆𝑖𝑘.

Synthetic
In this subsection, the examples draw observations at random from various statistical models so that the underlying “ground-truth” is available. To generate the corresponding figures, Figs. 1, 2, 3, 4, 5, 6, 7, and 8, we specify values for the scores 𝑆1, 𝑆2, ..., 𝑆𝑚 and for the indices 𝑖1, 𝑖2, ..., 𝑖𝑛. We also select probabilities 𝑃1, 𝑃2, ..., 𝑃𝑚 and then independently draw the outcomes 𝑅1, 𝑅2, ..., 𝑅𝑚 from the Bernoulli distributions with parameters 𝑃1, 𝑃2, ..., 𝑃𝑚, respectively. The first three examples, corresponding to Figs. 1, 2, 3, 4, 5, and 6, use unweighted (or, equivalently, uniformly weighted) data; the fourth example, corresponding to Figs. 7 and 8, uses weighted data, in which each pair of score 𝑆𝑖 and result 𝑅𝑖 comes with an additional positive scalar weight 𝑊𝑖. Appendix B illustrates the degenerate case of when deviation is absent, via further examples.

Fig. 3
figure 3
𝑛= 3300; Kuiper’s statistic is 0.01621/𝜎=2.243, Kolmogorov’s and Smirnov’s is 0.009983/𝜎=1.381. Figure 4 displays the ground-truth reliability diagram. Distinguishing random fluctuations from real variations is difficult in the reliability diagrams with 50 bins each. The reliability diagrams that each have only 10 bins could be misleading, as the depicted variations in the subpopulation’s outcomes are grossly lower than the actual underlying variations as a function of score. The plot of cumulative deviation is far from perfect, yet captures the exact expectations quite well qualitatively and tolerably well quantitatively. The scalar summary statistics have trouble detecting the significant deviation of the subpopulation from the full population. This illustrates a blind spot in the Kolmogorov–Smirnov and Kuiper statistics, namely, they have a hard time detecting oscillatory discrepancies that average away upon summation. Neither the Kolmogorov-Smirnov metric nor the Kuiper metric is very sensitive to high-frequency deviations whose mean is small

Full size image
Fig. 4
figure 4
Ground-truth reliability diagram for Fig. 3

Full size image
Fig. 5
figure 5
𝑛= 2500; Kuiper’s statistic is 0.05536/𝜎=6.586, Kolmogorov’s and Smirnov’s is 0.04554/𝜎=5.418. Figure 6 displays the ground-truth reliability diagram. The observed reliability diagrams fail to depict the underlying discontinuous jumps in the subpopulation’s expected outcomes as a function of the score. The plot of cumulative deviation succeeds in resolving some of the corresponding cusps, but does exhibit significant random fluctuations nearly as high as a quarter of the height of the triangle at the origin. The scalar summary statistics successfully detect the statistically significant deviation of the subpopulation from the full population

Full size image
Fig. 6
figure 6
Ground-truth reliability diagram for Fig. 5

Full size image
Fig. 7
figure 7
𝑛= 2500, with weighted sampling; Kuiper’s statistic is 0.03490/𝜎=3.318, Kolmogorov’s and Smirnov’s is 0.03490/𝜎=3.318. Figure 8 displays the ground-truth reliability diagram. The cumulative plot displays the distinguished observation from the subpopulation as a straight, steep jump at its score around 0.75; the constant slope of that steep jump shows that the corresponding high deviation between the subpopulation and the full population is due to a single highly weighted observation. This single observation has no effect on the slopes in the rest of the cumulative plot, whereas the few highly weighted observations dramatically (perhaps misleadingly?) alter the bins around scores of 0.75 in the observed reliability diagrams. The scalar summary statistics report statistically significant deviation of the subpopulation from the full population, though the steep jump in the cumulative plot reduces the effectiveness of the scalar statistics

Full size image
Fig. 8
figure 8
Ground-truth reliability diagram for Fig. 7

Full size image
The top rows of Figs. 1, 3, and 5 plot 𝐹𝑘−𝐹̃ 𝑘 from (5) and (8) as a function of k/n, with the rightmost plot displaying its noiseless expected value rather than using the random observations 𝑅1, 𝑅2, ..., 𝑅𝑚. The top row of Figure 7 plots 𝐹𝑘−𝐹̃ 𝑘 from (25) and (27) versus the cumulative weight 𝐴𝑘 from (28), with the rightmost plot displaying its noiseless expected value rather than using the random observations 𝑅1, 𝑅2, ..., 𝑅𝑚. Figs. 2, 4, 6, and 8 plot the pairs (𝑆1,𝑃1), (𝑆2,𝑃2), ..., (𝑆𝑚,𝑃𝑚) in gray, and plot the pairs (𝑆𝑖1,𝑃𝑖1), (𝑆𝑖2,𝑃𝑖2), ..., (𝑆𝑖𝑛,𝑃𝑖𝑛) in black, producing ground-truth diagrams that the lowermost two rows of plots from the associated Figs. 1, 3, 5, and 7 are trying to estimate using only the observations 𝑅1, 𝑅2, ..., 𝑅𝑚, without access to the underlying probabilities 𝑃1, 𝑃2, ..., 𝑃𝑚.

For the examples, we consider full populations which are mixtures of many subpopulations, including for each example one specific subpopulation that we analyze for deviations from the average over the full population. To make the models realistic, we assign expected outcomes to the members of the full population such that the expected outcomes span a continuous range which includes the expected outcomes attained by members of the subpopulation being analyzed for deviations. The reliability diagrams use gray points and gray connecting-lines to indicate the full population, and solid black points and black connecting-lines to indicate the specific subpopulation under consideration.

For the first example, corresponding to Figs. 1 and 2, we consider a mixture of subpopulations with a reasonably wide range of expected outcomes for most ranges of scores, except for a narrow notch around scores of 0.25 which lacks the significant subpopulation deviation. We select for the specific subpopulation analyzed for deviations a subpopulation with among the highest expected outcomes around every score. The scores are 𝑆𝑗=((𝑗−0.5)/𝑚)2 for 𝑗=1, 2, ..., m, thus more concentrated near 0 than near 1. For the indices 𝑖1, 𝑖2, ..., 𝑖𝑛 of the subpopulation, we start with the integer multiples of 20 and then add three levels of refinement increasingly focused around m/2, where m/2 corresponds to the middle of the notch. The total number of scores considered is 𝑚= 50,000, and (following the refinement) the number of subpopulation indices is 𝑛= 5000.

For the second example, corresponding to Figs. 3 and 4, we consider a mixture of subpopulations that includes one whose expected outcomes oscillate smoothly between the minimum and the maximum of the expected outcomes of all subpopulations as a function of the score; we analyze that particular one subpopulation for deviations from the full population. The scores are 𝑆𝑗=(𝑗−0.5)/𝑚 for 𝑗=1, 2, ..., m, hence equispaced between 0 and 1. The total number of scores considered is 𝑚= 50,000. For the indices 𝑖1, 𝑖2, ..., 𝑖𝑛 of the subpopulation, we raise to the power 4/3 each positive integer, then round to the nearest integer, and finally retain the lowest 𝑛= 3300 unique resulting integers.

For the third example, corresponding to Figs. 5 and 6, we consider a mixture of subpopulations similar to that for the second example, but this time selecting for analysis a subpopulation whose expected outcomes oscillate in discrete steps between the minimum and the maximum of the expected outcomes of all subpopulations as a function of the score. The scores are 𝑆𝑗=(𝑗−0.5)/𝑚)‾‾‾‾‾‾‾‾‾‾‾√ for 𝑗=1, 2, ..., m, thus less concentrated near 0 than near 1. For the indices 𝑖1, 𝑖2, ..., 𝑖𝑛 of the subpopulation, we generate a random permutation of the integers 1, 2, ..., m, retain the first n, and then sort them. The total number of scores considered is 𝑚= 50,000, and the number of subpopulation indices is 𝑛= 2500.

For the fourth example, corresponding to Figs. 7 and 8, we consider weighted samples (whereas the three previous examples all used unweighted or uniformly weighted data, in which all weights would be equal). We start by constructing the full population as a mixture of subpopulations whose probabilities of success oscillate between 0 and 0.2, and with the subpopulation being analyzed selected uniformly at random such that the probability of success for each observation is 0. The scores are 𝑆𝑗=(𝑗−0.5)/𝑚 for 𝑗=1, 2, ..., m, hence equispaced between 0 and 1. The total number of scores considered is 𝑚= 50,000, and the number of subpopulation indices is 𝑛= 2500. All observations just mentioned we weight equally with weight 1, and then introduce three outliers near the score 0.75: one being an observation from the subpopulation, altering its probability of success to 1 and its weight to 0.02n, and the other two being the two members from the full population not belonging to the subpopulation whose scores are adjacent to the score for the observation from the subpopulation, setting the probabilities of success for these two members to 0 and 1, both with the same weight 0.002m.

The captions of the figures comment on the numerical results displayed.

Remark 6
If (as in Figs. 7 and 8) the weight 𝑊𝑖 for some single observation is extraordinarily disproportionately high, then any bin containing that observation will be strongly biased toward only that individual observation, blind to the other observations in the bin. Such a phenomenon can lead to misleading behavior akin to Simpson’s Paradox of [9] in the canonical binned reliability diagrams; for instance, the subpopulation may very well attain results 𝑅𝑖1, 𝑅𝑖2, ..., 𝑅𝑖𝑛 that are less than all others in the full population except for the one disproportionately heavily weighted one, yet if the results 𝑅𝑖1, 𝑅𝑖2, ..., 𝑅𝑖𝑛 for the subpopulation are greater than the result 𝑅𝑖 corresponding to the one disproportionately large weight 𝑊𝑖, then any bin in reliability diagrams containing that heavily weighted observation will show that the subpopulation attains greater results than the weighted average in the full population. In contrast, a single heavily weighted observation affects only one subpopulation observation in the plots of cumulative differences, merely introducing a jump in the constant offset at the score corresponding to the one observation (and the jump will be disproportionately large only in proportion to the weight of the corresponding observation from the subpopulation). Figure 7 illustrates related behavior, and Fig. 22 below exhibits similar behavior for the data from the U.S. Census Bureau analyzed there. Comparing the subpopulation against the full population via cumulative differences is thus similar to subtracting off baseline rates for calibration (that is, similar to “de-trending”).

ImageNet
This subsection analyzes the standard training data set “ImageNet-1000” of [10]. Each of the thousand labeled classes in the data set forms a natural subpopulation to consider; each class considered consists of 𝑛= 1300 images of a particular noun (such as a “sidewinder/horned rattlesnake,” a “night snake,” or an “Eskimo Dog or Husky”). Some classes in the data set contain fewer than 1300 images, so that the total number of members of the data set is 𝑚= 1,281,167, but each subpopulation we analyze below corresponds to a class with 1300 images. The particular classes reported below are cherry-picked to illustrate a variety of problems that can afflict the classical reliability diagrams; not all classes exhibit such problems, nor are these all the classes that exhibit problems (many, many others have similar issues). The images are unweighted (or, equivalently, uniformly weighted), not requiring the methods of section "Weighted sampling" above. To generate the corresponding figures, we calculate the scores 𝑆1, 𝑆2, ..., 𝑆𝑚 using the pretrained ResNet18 classifier of [11] from the computer-vision module, “torchvision,” in the PyTorch software library of [12]; the score for an image can be either {1} the probability assigned by the classifier to the class predicted to be most likely or {2} the corresponding negative log-likelihood (that is, the negative of the natural logarithm of the probability), with the scores randomly perturbed by about one part in 108 to guarantee their uniqueness. For 𝑖=1, 2, ..., m, the result 𝑅𝑖 corresponding to a score 𝑆𝑖 is 𝑅𝑖=1 when the class predicted to be most likely is the correct class, and 𝑅𝑖=0 otherwise. The figures below omit display of reliability diagrams whose bins are equispaced with respect to the scores in the typical case that these reliability diagrams are so noisy as to be useless (the figures do display the diagrams when they are not too noisy). Figures 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, and 19 present several examples, listing in the captions the associated names of the classes for the subpopulations. Figure 20 illustrates the utility of the zooming proposed in Remark 3 above. In all figures, the plots of cumulative differences depict all observed phenomena clearly.

Fig. 9
figure 9
Eskimo Dog or Husky, with scores (𝑆1, 𝑆2, ..., 𝑆𝑚) being the negative log-likelihoods; 𝑛= 1300; Kuiper’s statistic is 0.08082/𝜎=6.363, Kolmogorov’s and Smirnov’s is 0.08082/𝜎=6.363. None of the reliability diagrams is able to smooth away the irrelevant variations while simultaneously capturing the severe deviation at the lowest negative log-likelihoods. The scalar summary statistics very successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 10
figure 10
Eskimo Dog or Husky, with scores being the probabilities; 𝑛= 1300; Kuiper’s statistic is 0.08082/𝜎=6.363, Kolmogorov’s and Smirnov’s is 0.06959/𝜎=5.478. As in Fig. 9, none of the reliability diagrams with the same number of subpopulation scores per bin is able to smooth away the irrelevant variations while simultaneously capturing the severe deviation at the highest probabilities (however, the reliability diagram with 10 bins that are equispaced in probabilities captures everything nicely). The scalar summary statistics very successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 11
figure 11
Night snake (Hypsiglena torquata), with scores being the negative log-likelihoods; 𝑛= 1300; Kuiper’s statistic is 0.1365/𝜎=11.35, Kolmogorov’s and Smirnov’s is 0.1365/𝜎=11.35. Bins equispaced across either the subpopulation’s observations or the scores (where the scores are negative log-likelihoods in this figure) cannot resolve the severe deviations at low scores without being overly noisy elsewhere. The scalar summary statistics extremely successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 12
figure 12
Night snake (Hypsiglena torquata), with scores being the probabilities; 𝑛= 1300; Kuiper’s statistic is 0.1365/𝜎=11.35, Kolmogorov’s and Smirnov’s is 0.1353/𝜎=11.24. As in Figure 11, uniform resolution in the binned plots (whether with respect to observations or to scores) is insufficient. The scalar summary statistics extremely successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 13
figure 13
Sunglasses, with scores being the probabilities; 𝑛= 1300; Kuiper’s statistic is 0.03597/𝜎=2.935, Kolmogorov’s and Smirnov’s is 0.03365/𝜎=2.745. The reliability diagrams with only 10 or 30 bins each fail to resolve the very high deviation for probabilities greater than 0.9 (unlike the diagram with 50 bins)—the smaller numbers of bins average away interesting behavior, without warning. The scalar summary statistics detect some statistically significant deviation, yet both are blind to the serious deviation for the highest scores that the plot of cumulative differences displays prominently; the steep drop at the highest scores in the cumulative plot has little to no effect on the Kolmogorov-Smirnov or Kuiper metrics, unfortunately

Full size image
Fig. 14
figure 14
Wild boar (Sus scrofa), with scores being the probabilities; 𝑛= 1300; Kuiper’s statistic is 0.07244/𝜎=6.688, Kolmogorov’s and Smirnov’s is 0.07149/𝜎=6.600. The behavior in the present figure at the highest probabilities is similar to that in Fig. 13—the reliability diagrams with only 10 or 30 bins each underplay the very high deviation for the highest probabilities, smoothing away big deviation without warning. As in Fig. 13, the scalar summary statistics detect statistically significant deviation, while both are blind to the significant deviation for the highest scores that the plot of cumulative differences highlights; the steep drop at the highest scores in the cumulative plot has essentially no impact on the Kolmogorov-Smirnov or Kuiper metrics, unfortunately

Full size image
Fig. 15
figure 15
Cheetah (Acinonyx jubatus), with scores being the negative log-likelihoods; 𝑛= 1300; Kuiper’s statistic is 0.02520/𝜎=4.043, Kolmogorov’s and Smirnov’s is 0.02520/𝜎=4.043. Only the reliability diagram with 50 bins detects the high deviation for negative log-likelihoods greater than 1.25; the diagrams with only 10 or 30 bins give no indication of the substantial deviation. 30 bins or less are clearly insufficient to resolve the significant deviation, but that is clear only upon comparison with the cumulative plot or with diagrams having many bins. The scalar summary statistics indicate statistically significant deviation of the subpopulation from the full population, in accord with the plot of cumulative differences

Full size image
Fig. 16
figure 16
Monarch (or milkweed) butterfly (Danaus plexippus), with scores being the negative log-likelihoods; 𝑛= 1300; Kuiper’s statistic is 0.01144/𝜎=2.856, Kolmogorov’s and Smirnov’s is 0.01144/𝜎=2.856. The deviation of the subpopulation below the full population that occurs for scores greater than 1.5 is apparent only in the cumulative plot or in the (very noisy) reliability diagrams whose bins are roughly equispaced along the scores. The scalar summary statistics detect somewhat significant deviation, but not as much as would be possible if the Kolmogorov-Smirnov and Kuiper metrics were to take fully into account the steep drop that occurs in the plot of cumulative differences

Full size image
Fig. 17
figure 17
Monarch (or milkweed) butterfly (Danaus plexippus), with scores being the probabilities; 𝑛= 1300; Kuiper’s statistic is 0.01144/𝜎=2.857, Kolmogorov’s and Smirnov’s is 0.009057/𝜎=2.261. Much like in Fig. 16, the deviation of the subpopulation below the full population that occurs for probabilities less than 0.1 is apparent only in the cumulative plot or in the very noisy reliability diagrams whose bins are roughly equispaced along the probabilities. The scalar summary statistics again detect somewhat significant deviation, though not as much as if the Kolmogorov-Smirnov and Kuiper metrics could better account for the steep drop that happens in the plot of cumulative differences

Full size image
Fig. 18
figure 18
Sidewinder/horned rattlesnake (Crotalus cerastes), with scores being the negative log-likelihoods; 𝑛= 1300; Kuiper’s statistic is 0.1343/𝜎=10.47, Kolmogorov’s and Smirnov’s is 0.1343/𝜎=10.47. The reliability diagrams whose bins each contain roughly the same number of subpopulation scores are either noisier or missing the severest deviations in comparison with the other reliability diagrams; so there do exist cases in which choosing bins that are nearly equispaced along the scores works better than choosing bins that each contain roughly the same number of subpopulation scores. The scalar summary statistics extremely successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 19
figure 19
Sidewinder/horned rattlesnake (Crotalus cerastes), with scores being the probabilities; 𝑛= 1300; Kuiper’s statistic is 0.1343/𝜎=10.47, Kolmogorov’s and Smirnov’s is 0.1340/𝜎=10.45. As in Figure 18, the reliability diagrams whose bins each contain roughly the same number of subpopulation scores either miss the severest deviations or are noisier compared to the other reliability diagrams for this example; so sometimes choosing bins that are approximately equispaced along the scores works better than choosing bins that each contain a similar number of subpopulation scores. The scalar summary statistics extremely successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 20
figure 20
Zooming in on the origin of some examples in which the scores are the negative log-likelihoods; the uppermost plots are for the Eskimo Dog or Husky of Fig. 9, the middlemost plots are for the night snake (Hypsiglena torquata) of Fig. 11, and the lowermost plots are for the sidewinder/horned rattlesnake (Crotalus cerastes) of Fig. 18; each plot on the right zooms in on the origin of the plot to its left, adjusting the height of the triangle at the origin, the number n of observations, and the Kuiper and Kolmogorov-Smirnov statistics to reflect the smaller range of scores on the horizontal axis

Full size image
American Community Survey of the U.S. Census Bureau
This subsection analyzes the latest (year 2019) microdata from the American Community Survey of the U.S. Census Bureau;Footnote4 specifically, we consider the full population to be the members from all counties in California put together, and consider the subpopulation to be the observations from an individual county. The sampling in this survey is weighted; we retain only those members whose weights (“WGTP” in the microdata) are nonzero, and discard any member whose household personal income (“HINCP”) is zero or for which the adjustment factor to income (“ADJINC”) is reported as missing. For the scores, we use the logarithm to base 10 of the adjusted household personal income (the adjusted income is “HINCP” times “ADJINC,” divided by one million when “ADJINC” omits its decimal point in the integer-valued microdata), randomly perturbing the scores by about one part in 108 to guarantee their uniqueness. The captions on the figures specify which variables from the data set we use for the results 𝑅1, 𝑅2, ..., 𝑅𝑚 (different figures consider different variables), with 𝑚= 134,094. Figures 21, 22, 23, 24, 24, 25, and 26 present the examples. In all figures, the cumulative plots display all significant features clearly.

Fig. 21
figure 21
San Joaquin County, reporting the number of related children in the household, with scores being log10 of the adjusted household income; 𝑛= 2282; Kuiper’s statistic is 0.2449/𝜎=9.120, Kolmogorov’s and Smirnov’s is 0.2429/𝜎=9.045. The lack of deviation between the subpopulation and the full population right near scores of 4.0 is difficult to discern in the reliability diagrams with 10 or 20 bins each. The reliability diagrams with around 100 bins each do display the lack of deviation near scores of 4.0, but the rest of these diagrams is really noisy. The cumulative plot nicely captures the lack of deviation near scores of 4.0. Overall, the scalar summary statistics detect highly statistically significant deviation

Full size image
Fig. 22
figure 22
Humboldt County, reporting whether no one in the household 14 or over speaks English very well, with scores being log10 of the adjusted household income; 𝑛= 583; Kuiper’s statistic is 0.1028/𝜎=6.062, Kolmogorov’s and Smirnov’s is 0.1028/𝜎=6.062. A single, highly weighted outlying observation from the subpopulation corrupts a bin at the highest scores in each reliability diagram. The cumulative plot includes this outlying observation, too, but displays the observation as an unmistakable steep jump in the plotted curve; the constant slope of that steep jump shows that the corresponding high deviation between the subpopulation and the full population is due to a single highly weighted observation. This single observation has no effect on the slopes in the rest of the cumulative plot, so this problematic observation corrupts only the reliability diagrams and not the plot of cumulative differences—an analogue of Simpson’s Paradox of [9] afflicts the reliability diagrams but not the cumulative plot. The scalar summary statistics report highly statistically significant deviation commensurate with all the plots, albeit slightly less due to the steep jump in the cumulative plot. These behaviors are analogous to those displayed in Fig. 7 above (see also Remark 6 above)

Full size image
Fig. 23
figure 23
Orange County, reporting whether the household has high-speed access to the internet, with scores being log10 of the adjusted household income; 𝑛= 10,680; Kuiper’s statistic is 0.02499/𝜎=6.013, Kolmogorov’s and Smirnov’s is 0.02484/𝜎=5.979. The severe deviation at the very lowest scores is misleadingly underestimated in the reliability diagrams with 10 or 20 bins each, even as compared to the diagrams with around 100 bins each. However, the diagrams with around 100 bins each are far too noisy for other scores. Only the plot of cumulative differences resolves the severe deviation at the lowest scores while being informative at the other scores, too. The scalar summary statistics indicate that the overall deviation is highly statistically significant

Full size image
Fig. 24
figure 24
Los Angeles County, reporting the number of people in the household, with scores being log10 of the adjusted household income; 𝑛= 35,364; Kuiper’s statistic is 0.06674/𝜎=9.605, Kolmogorov’s and Smirnov’s is 0.06495/𝜎=9.347. Discerning the analogue of the dip in the plot of cumulative differences at the highest scores is possible yet difficult in the reliability diagrams, while being unmistakable in the cumulative plot; the reliability diagrams with enough bins do reflect the corresponding deviation at the highest scores, but are hard to interpret without the accompanying cumulative plot. The scalar summary statistics report very highly statistically significant deviation, largely since the number of observations from this largest county in California is so large

Full size image
Fig. 25
figure 25
Napa County, reporting whether the household has access via a satellite dish to the internet, with scores being log10 of the adjusted household income; 𝑛= 679; Kuiper’s statistic is 0.02761/𝜎=2.259, Kolmogorov’s and Smirnov’s is 0.02695/𝜎=2.205. The intense deviation around scores of 4.6 is apparent in the reliability diagrams with 10 and 20 bins each, but the latter resolves the spike much better while being unfortunately too noisy for many other scores. The plot of cumulative differences resolves the sharp jump around scores of 4.6 without detracting from the display at other scores. The scalar summary statistics report only very mildly statistically significant deviation, unable to fully account for the high deviation around scores of 4.6

Full size image
Fig. 26
figure 26
Stanislaus County, reporting the number of related children in the household, with scores being log10 of the adjusted household income; 𝑛= 1624; Kuiper’s statistic is 0.1489/𝜎=4.500, Kolmogorov’s and Smirnov’s is 0.1467/𝜎=4.433. The reliability diagrams are all commensurate with each other, but that is clear only after careful comparison of them all. Making sense of the reliability diagrams in this case would seem to require generating multiple plots, with several different numbers of bins. The scalar summary statistics have little trouble detecting statistically significant deviation here

Full size image
Future outlook
This subsection suggests generalizations suitable for future research.

The present paper plots the cumulative differences between the results of a subpopulation and the results of the full population, accumulated as a function of a scalar real-valued score. If instead the scores to be accumulated are from a Euclidean or Hilbert space of more than one dimension, a natural generalization is to impose a total order on the scores via a space-filling curve such as the Peano or Hilbert curves, effectively replacing the space of more than one dimension with a one-dimensional ordering. Space-filling curves constructed via quad-trees in two-dimensional space or oct-trees in three-dimensional space can be especially efficient. Google’s S2 Geometry Library, which drives Google Maps, Foursquare, MongoDB, et al., employs a Hilbert curve.Footnote5

The present paper focuses on deviations of a subpopulation from the full population; comparing the subpopulation to the full population is always legitimate, as binning or interpolating from the scores of the full population to those of the subpopulation happens at a scale finer than the subpopulation’s sampling, and there is always at least one score in the full population corresponding to each score in the subpopulation (namely, the same score). In contrast, assessing deviations between two different subpopulations that do not have an explicit pairing for each score can be problematic. Indeed, the ranges of scores for the subpopulations may not even overlap—the scores for one subpopulation can all be significantly less than all the scores for another subpopulation, for instance. Binning or interpolating from one subpopulation to another can be ill-posed. And even when binning or interpolating from one subpopulation to a second subpopulation is well-posed, binning or interpolating from that second subpopulation to the first subpopulation can be ill-posed—the comparison may not be reflexively well-posed. In general, a partial ordering governs the comparisons—we can always analyze deviations of any subpopulation from any larger population containing the subpopulation, but cannot always reliably analyze deviations between two different subpopulations of the same larger population. Applications demanding direct comparison between different subpopulations are currently the subject of intensive investigation, far beyond the scope of the present paper except in the special case that the different subpopulations are paired for each score. One possibility for the general case is to bin both subpopulations being compared to the same finest binning such that both subpopulations have at least one score in each bin; however, interpreting significance in this general case can be tricky. Forthcoming work will treat the special case for which no score associated with any observation from either subpopulation being compared is exactly equal to the score for any other observation from the two subpopulations.

Conclusion
Plotting the cumulative differences between the outcomes for the subpopulation and those for the full population binned to the subpopulation’s scores avoids the arbitrary selection of widths for bins or smoothing kernels that the conventional reliability diagrams and calibration plots require. The plot of cumulative differences displays deviation directly as the slope of secant lines for the graph; such slope is easy to perceive independent of any irrelevant constant offset of a secant line. The graph of cumulative differences very directly enables detection and quantification of deviation between the subpopulation and full population, along with identification of the corresponding ranges of scores. The cumulative differences estimate the distribution of deviation fully nonparametrically, letting the data observations speak for themselves (or nearly for themselves—the triangle at the origin helps convey the scale of a driftless random walk’s expected random fluctuations). As seen in the figures, the graph of cumulative differences automatically adapts its resolving power to the distributions of deviations and scores for the subpopulation, not imposing any artificial grid of bins or set-width smoothing kernel, unlike the traditional reliability diagrams and calibration plots. The scalar metrics of Kuiper and of Kolmogorov and Smirnov conveniently summarize the overall statistical significance of deviations displayed in the graph.

