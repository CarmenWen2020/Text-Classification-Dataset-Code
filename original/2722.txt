Assessing equity in treatment of a subpopulation often involves assigning numerical â€œscoresâ€ to all individuals in the full population such that similar individuals get similar scores; matching via propensity scores or appropriate covariates is common, for example. Given such scores, individuals with similar scores may or may not attain similar outcomes independent of the individualsâ€™ memberships in the subpopulation. The traditional graphical methods for visualizing inequities are known as â€œreliability diagramsâ€ or â€œcalibrations plots,â€ which bin the scores into a partition of all possible values, and for each bin plot both the average outcomes for only individuals in the subpopulation as well as the average outcomes for all individuals; comparing the graph for the subpopulation with that for the full population gives some sense of how the averages for the subpopulation deviate from the averages for the full population. Unfortunately, real data sets contain only finitely many observations, limiting the usable resolution of the bins, and so the conventional methods can obscure important variations due to the binning. Fortunately, plotting cumulative deviation of the subpopulation from the full population as proposed in this paper sidesteps the problematic coarse binning. The cumulative plots encode subpopulation deviation directly as the slopes of secant lines for the graphs. Slope is easy to perceive even when the constant offsets of the secant lines are irrelevant. The cumulative approach avoids binning that smooths over deviations of the subpopulation from the full population. Such cumulative aggregation furnishes both high-resolution graphical methods and simple scalar summary statistics (analogous to those of Kuiper and of Kolmogorov and Smirnov used in statistical significance testing for comparing probability distributions).

Introduction
Analysis of whether a subpopulation has had equitable treatment often assesses whether similar individuals attain similar outcomes irrespective of the individualsâ€™ memberships in the subpopulation. To effect the comparison, each individual gets a real-valued â€œscoreâ€ used to match that individual with other similar individuals (such matching could use propensity scores or a suitable covariate, for instance). Each individual also gets a real-valued outcome of the treatment. A formal assessment could then consider how much the average outcome for individuals with a given score that belong to the subpopulation deviates from the average outcome for all individuals from the full population that have that same score.

When there are only finitely many observations, questions of statistical significance arise; for example, if the scores are predicted probabilities and the outcomes are drawn from independent (but not necessarily identically distributed) Bernoulli distributions with parameters given by the predicted probabilities, then the average outcome for individuals with a given score fluctuates across different random samples defining the subpopulation being analyzed. In such scenarios, the average outcome for the observed subpopulation would be expected to deviate stochastically from the average for the full population. Furthermore, each individual in the sampled subpopulation may very well have a different score from all the others, requiring some aggregation of scores in order to average away the statistical noise. The conventional approach is to partition the scores into some number of bins and calculate averages separately for every bin, trading off resolution in the scores for increased confidence in the statistical estimates. The present paper proposes an alternative based on cumulative statistics that avoids the necessarily arbitrary binning (binning that typically follows heuristics discussed shortly); the cumulative approach yields graphical methods as well as scalar summary statistics that are similar to the Kolmogorov-Smirnov and Kuiper metrics familiar from statistical significance testing for comparing probability distributions.

More concretely, subpopulations commonly considered include those associated with protected classes (such as those defined by race, color, religion, gender, national origin, age, disability, veteran status, or genetic information) and those associated with biomedicine (such as diseased, infected, treated, or recovered). The present paper discusses generic methodology applicable to all cases, illustrating the methods via interesting subpopulations that are unlikely to court controversy via their consideration; this paper avoids giving examples based on subpopulations defined by sensitive classes of direct interest to hot-button issues. The illustrative examples presented below are deliberately anodyne (but hopefully still sufficiently engaging) to avoid distracting from the focus on the statistical methodology being proposed.

Mathematically speaking, we consider m real-valued observations ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š of the outcomes of independent trials with corresponding real-valued scores ğ‘†1, ğ‘†2, ..., ğ‘†ğ‘š (where the scores very well may determine the probability distributions of the trials; for example, if 0â‰¤ğ‘†ğ‘–â‰¤1, then ğ‘…ğ‘– could be the outcome of a Bernoulli trial whose probability of success is ğ‘†ğ‘–). We view ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š (but not ğ‘†1, ğ‘†2, ..., ğ‘†ğ‘š) as random. Without loss of generality, we order the scores (preserving the pairing of ğ‘…ğ‘– with ğ‘†ğ‘– for every i) such that ğ‘†1â‰¤ğ‘†2â‰¤â€¦â‰¤ğ‘†ğ‘š, ordering any ties at random, perturbed so that ğ‘†1<ğ‘†2<â€¦<ğ‘†ğ‘š. We consider a subset of indices corresponding to members of a subpopulation of interest, say ğ‘–1, ğ‘–2, ..., ğ‘–ğ‘›, with ğ‘›<ğ‘š; without loss of generality, we order the indices such that 1â‰¤ğ‘–1<ğ‘–2<â€¦<ğ‘–ğ‘›â‰¤ğ‘š. Each observation ğ‘…ğ‘– and score ğ‘†ğ‘– may also come with a positive weight ğ‘Šğ‘–; however, we focus first on the simpler, more common case of uniform weighting, in which ğ‘Š1=ğ‘Š2=â€¦=ğ‘Šğ‘š, and generalize to arbitrary weights later (in section "Weighted sampling" below).

The classical methods require choosing some partitions of the real line into â„“ disjoint intervals with endpoints ğµ1, ğµ2, ..., ğµâ„“âˆ’1 and another (possibly the same) â„“ disjoint intervals with endpoints ğµÌƒ 1, ğµÌƒ 2, ..., ğµÌƒ â„“âˆ’1 such that ğµ1<ğµ2<â€¦<ğµâ„“âˆ’1 and ğµÌƒ 1<ğµÌƒ 2<â€¦<ğµÌƒ â„“âˆ’1. We can then form the averages for the subpopulation

ğ‘Œğ‘˜=âˆ‘ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜ğ‘…ğ‘–ğ‘—#{ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜}
(1)
and for the full population

ğ‘ŒÌƒ ğ‘˜=âˆ‘ğ‘–:ğµÌƒ ğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµÌƒ ğ‘˜ğ‘…ğ‘–#{ğ‘–:ğµÌƒ ğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµÌƒ ğ‘˜}
(2)
for ğ‘˜=1, 2, ..., â„“, under the convention that ğµ0=ğµÌƒ 0=âˆ’âˆ and ğµâ„“=ğµÌƒ â„“=âˆ. We also calculate the average scores in the bins for the subpopulation

ğ‘‹ğ‘˜=âˆ‘ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜ğ‘†ğ‘–ğ‘—#{ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜}
(3)
and for the full population

ğ‘‹Ìƒ ğ‘˜=âˆ‘ğ‘–:ğµÌƒ ğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµÌƒ ğ‘˜ğ‘†ğ‘–#{ğ‘–:ğµÌƒ ğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµÌƒ ğ‘˜}
(4)
for ğ‘˜=1, 2, ..., â„“, under the same convention that ğµ0=ğµÌƒ 0=âˆ’âˆ and ğµâ„“=ğµÌƒ â„“=âˆ. A graphical method for assessing the deviation of the subpopulation from the full population is then to scatterplot the pairs (ğ‘‹1,ğ‘Œ1), (ğ‘‹2,ğ‘Œ2), ..., (ğ‘‹â„“,ğ‘Œâ„“) in black and the pairs (ğ‘‹Ìƒ 1,ğ‘ŒÌƒ 1), (ğ‘‹Ìƒ 2,ğ‘ŒÌƒ 2), ..., (ğ‘‹Ìƒ â„“,ğ‘ŒÌƒ â„“) in gray. Comparing the black plotted points (possibly connected with black lines) to the gray plotted points (possibly connected with gray lines) then indicates how much the subpopulation deviates from the full population. Especially when assessing the calibration or reliability of probabilistic predictions, this graphical method is known as a â€œreliability diagramâ€ or â€œcalibration plot,â€ as reviewed, for example, by [1] and [2].

A full review of the literature is available in section "Introduction to assessing calibration" of Appendix A.

There are at least two common choices of the bins whose endpoints are ğµ1, ğµ2, ..., ğµâ„“âˆ’1 (and similarly for the bins whose endpoints are ğµÌƒ 1, ğµÌƒ 2, ..., ğµÌƒ â„“âˆ’1). The first is to make ğµ1, ğµ2, ..., ğµâ„“âˆ’1 be equispaced. The second is to select ğµ1, ğµ2, ..., ğµâ„“âˆ’1 such that the number of scores from the subpopulation that fall in the kth bin, that is, #{ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜}, is the same for all k (aside from the rightmost bin, that for ğ‘˜=â„“, if n is not perfectly divisible by â„“). In both cases, the number â„“ of bins is a parameter that we can vary to trade-off higher-confidence estimates for finer resolution in detecting deviation as a function of score (and vice versa). Unfortunately, no choice can fully offset how the difference between the subpopulation and the full population is typically the primary interest, whereas the standard plot bins the subpopulation and the full population separately (potentially smoothing away information due to the discretization). Plotting the difference directly would solve this particular problem. Even then, however, no choice of bins can be optimal for all possible distributions of scores or for all possible distributions of deviations between the subpopulation and the full population. Binning will always discretize the distributions, smoothing away potentially important information.

Fortunately, binning so coarsely is unnecessary in the methods proposed below. The methods discussed below employ exactly one bin per score ğ‘†ğ‘–ğ‘—, ğ‘—=1, 2, ..., n, thus viewing the subpopulation on its own terms, dictated by the observations from the subpopulation. Employing only one bin per score would be nonsensical in the classical plots, as then the classical plots would trade-off all statistical confidence for the finest resolution possible. The cumulative methods sacrifice no resolution that is available in the observed data for the subpopulation.

For a simple illustrative example, Fig. 1 displays both the conventional reliability diagrams as well as the cumulative plot proposed below. A detailed description is available in section "Synthetic" below. The lowermost two rows of Fig. 1 are the classical diagrams, with ğ‘š= 50,000 and ğ‘›= 5000; there are â„“=10 bins for each diagram in the second row and â„“=50 for each diagram in the third row. In the lowermost two rows, the bins are equispaced along the scores in the leftmost plots, whereas each bin contains the same number of scores from ğ‘†ğ‘–1, ğ‘†ğ‘–2, ..., ğ‘†ğ‘–ğ‘› (or from ğ‘†1, ğ‘†2, ..., ğ‘†ğ‘š) in the rightmost plots. The diagram of Fig. 2 plots the ordered pairs (ğ‘†1,ğ‘ƒ1), (ğ‘†2,ğ‘ƒ2), ..., (ğ‘†ğ‘š,ğ‘ƒğ‘š) in gray and (ğ‘†ğ‘–1,ğ‘ƒğ‘–1), (ğ‘†ğ‘–2,ğ‘ƒğ‘–2), ..., (ğ‘†ğ‘–ğ‘›,ğ‘ƒğ‘–ğ‘›) in black, where ğ‘ƒ1, ğ‘ƒ2, ..., ğ‘ƒğ‘š are the expected values of ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š, respectively; for this example, ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š are drawn independently from Bernoulli distributions with probabilities of success ğ‘ƒ1, ğ‘ƒ2, ..., ğ‘ƒğ‘š. Thus, Fig. 2 depicts the â€œground-truthâ€ expectations that the lowermost two rows of classical plots in Fig. 1 are trying to characterize. The gray points correspond to the full population, while the solid black points correspond to the subpopulation.

The topmost row of Fig. 1 displays both the cumulative plot introduced below as well as its ideal noiseless â€œground-truthâ€ constructed using the expected values ğ‘ƒ1, ğ‘ƒ2, ..., ğ‘ƒğ‘š of the random observations ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š. Leaving elucidation of the cumulative plots and their construction to section "Methods" below, we just point out here that the deviation of the subpopulation from the averages over the full population across an interval is equal to the slope of the secant line for the graph over that interval, aside from expected stochastic fluctuations detailed in section â€œSignificance of stochastic fluctuationsâ€ below. Steep slopes correspond to substantial deviations across the ranges of scores where the slopes are steep, with the deviation over an interval exactly equal to the expected value of the slope of the secant line for the graph over that interval. The cumulative plot closely resembles its ideal ground-truth in Fig. 1, and the Kolmogorov-Smirnov and Kuiper metrics conveniently summarize the statistical significance of the overall deviation across all scores, in accord with sections "Scalar summary statistics" and â€œSignificance of stochastic fluctuationsâ€ below.

The structure of the remainder of the present paper is as follows: Section "Methods" details the statistical methodology that section "Results and discussion" illustrates via numerical examples.Footnote1 Section "Results and discussion" also proposes avenues for further development. Section "Conclusion" then briefly summarizes the methods and numerical results. Appendix A describes methods for calibrating probabilistic predictions that are analogous to the cumulative methodology introduced in section "Methods" for assessing deviation of a subpopulation from the full population. Appendix A also contains a literature review, in section "Introduction to assessing calibration"; please consult section "Introduction to assessing calibration" for a discussion of related work. Appendix B warns about potentially tempting overinterpretations of the various plots. Table 1 gives a glossary of the notation used throughout except in the appendices, while Table 2 gives a glossary of the notation used in the appendices.

Fig. 1
figure 1
ğ‘›= 5000; Kuiperâ€™s statistic is 0.2037/ğœ=34.34, Kolmogorovâ€™s and Smirnovâ€™s is 0.2033/ğœ=34.27. Figure 2 displays the ground-truth reliability diagram. The reliability diagram with 50 bins that each contain the same number of scores from the subpopulation is able to detect the notch around scores of 0.25; however, the oscillation of the bin frequencies for the subpopulation complicates disentangling real variations from statistical noise. The reliability diagrams that each have only 10 bins exhibit fewer random oscillations, but smear out the notch. In the reliability diagrams, the averages for the subpopulation are black, while the averages for the full population are gray. In the top row, the plot of cumulative deviation resolves the notch nicely while displaying minimal random fluctuations across the full range of scores. The scalar summary statistics of Kuiper and of Kolmogorov and Smirnov very successfully detect the statistically significant deviation of the subpopulation from the full population

Full size image
Fig. 2
figure 2
Ground-truth reliability diagram for Fig. 1

Full size image
Methods
This section formulates the cumulative statistics mathematically, with section "High-level strategy" proposing a workflow for large-scale analysis. Section "Graphical method" details the graphical methods. Section "Scalar summary statistics" details the scalar summary metrics. Section "Significance of stochastic fluctuations" discusses statistical significance for both the graphical methods and the summary statistics. Section "Weighted sampling" presents a generalization of these statistical methodologies to the case of weighted samples (beyond just equally or uniformly weighted).

Table 1 Notational conventions for all but the appendices
Full size table
Table 2 Notational conventions for the appendices
Full size table
High-level strategy
This subsection suggests a hybrid method for large-scale data analysis. When there are many data sets and subpopulations to assess, a two-step approach may be the most practical:

1.
A screening stage assigning a single scalar summary statistic to each pair of data set and subpopulation (where the size of the statistic measures the deviation of the subpopulation from the full population).

2.
A detailed drill-down for each pair of data set and subpopulation whose scalar summary statistic is large, drilling down into how the deviation of the subpopulation from the full population varies as a function of score.

The drill-down relies on graphically displaying the deviation of the subpopulation from the full population as a function of score; the scalar statistic for the first stage simply summarizes the overall deviation across all scores, as either the maximum absolute deviation of the graph or the size of the range of deviations in the graphical display. Thus, for each pair of data set and subpopulation, both stages leverage a graph; the first stage collapses the graph into a single scalar summary statistic. The following subsection constructs the graph.

Graphical method
This subsection details the construction of cumulative plots.

Two sequences will define the cumulative plot based on the notation set in the introduction. The cumulative sequence for the subpopulation is

ğ¹ğ‘˜=1ğ‘›âˆ‘ğ‘—=1ğ‘˜ğ‘…ğ‘–ğ‘—
(5)
for ğ‘˜=1, 2, ..., n.

Facilitating comparison of the subpopulation with the full population, the average result for the full population in a bin around ğ‘†ğ‘–ğ‘˜ is

ğ‘…Ìƒ ğ‘–ğ‘˜=âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ‘…ğ‘–#{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜}
(6)
for ğ‘˜=1, 2, ..., n, where the thresholds for the bins are

ğµğ‘˜=ğ‘†ğ‘–ğ‘˜+ğ‘†ğ‘–ğ‘˜+12
(7)
for ğ‘˜=0, 1, 2, ..., n, under the convention that ğ‘†ğ‘–0=âˆ’âˆ and ğ‘†ğ‘–ğ‘›+1=âˆ (so ğµ0=âˆ’âˆ and ğµğ‘›=âˆ).

The cumulative sequence for the full population at the subpopulationâ€™s subset of scores is

ğ¹Ìƒ ğ‘˜=1ğ‘›âˆ‘ğ‘—=1ğ‘˜ğ‘…Ìƒ ğ‘–ğ‘—
(8)
for ğ‘˜=1, 2, ..., n, where ğ‘…Ìƒ ğ‘–ğ‘— is defined in (6).

Although the accumulation from lower scores might at first glance appear to overwhelm the contributions from higher scores, a plot of ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ as a function of k will display deviation of the subpopulation from the full population for any score solely in slopes that deviate significantly from 0; any problems accumulated from earlier, lower scores pertain only to the constant offset from 0, not to the slope deviating from 0. In fact, the increment in the expected difference ğ¹ğ‘—âˆ’ğ¹Ìƒ ğ‘— from ğ‘—=ğ‘˜âˆ’1 to ğ‘—=ğ‘˜ is

ğ”¼[(ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜)âˆ’(ğ¹ğ‘˜âˆ’1âˆ’ğ¹Ìƒ ğ‘˜âˆ’1)]=ğ”¼[ğ‘…ğ‘–ğ‘˜]âˆ’ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘˜]ğ‘›;
(9)
thus, on a plot with the values for k spaced 1/n apart, the slope from ğ‘—=ğ‘˜âˆ’1 to ğ‘—=ğ‘˜ is

Î”ğ‘˜=ğ”¼[ğ‘…ğ‘–ğ‘˜]âˆ’ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘˜],
(10)
where the expected value of the average result ğ‘…Ìƒ ğ‘–ğ‘˜ in the bin around ğ‘†ğ‘–ğ‘˜ is equal to the average of the expected results, that is,

ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘˜]=âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ”¼[ğ‘…ğ‘–]#{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜}
(11)
for ğ‘˜=1, 2, ..., n, and ğ‘…Ìƒ ğ‘–ğ‘˜ is defined in (6). The subpopulation deviates from the full population for the scores near ğ‘†ğ‘–ğ‘˜ when Î”ğ‘˜ is significantly nonzero, that is, when the slope of the plot of ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ deviates significantly from horizontal over a significantly long range.

To emphasize: the deviation of the subpopulation from the full population over a contiguous range of ğ‘†ğ‘–ğ‘˜ is the slope of the secant line for the plot of ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ as a function of ğ‘˜ğ‘› over that range, aside from expected random fluctuations.

Figure 1 presents a simple illustrative example, and many examples analyzing data from a popular data set in computer vision, â€œImageNet,â€ are available in section "ImageNet". The leftmost plot in the topmost row of Fig. 1 graphs ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ versus k/n; the rightmost plot in the top row is the ideal noiseless â€œground-truthâ€ constructed using the precise expected values of the random observations ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š (as detailed in section "Synthetic", the exact expectations are available for constructing the ground-truth in the synthetic example corresponding to Fig. 1). Steep slopes correspond to substantial deviations across the ranges of scores where the slopes are steep, with the deviation over an interval exactly equal to the expected value of the slope of the secant line for the graph over that interval. The cumulative plot nicely matches its ideal ground-truth in Fig. 1.

The following subsection discusses metrics summarizing how much the graph deviates from 0 (needless to say, if the slopes of the secant lines are all nearly 0, then the whole graph cannot deviate much from 0). Section "Significance of stochastic fluctuations" then leverages these metrics in a discussion of the expected stochastic fluctuations mentioned above.

Scalar summary statistics
This subsection details the construction of scalar statistics which provide broad-brush summaries of the plots introduced in the previous subsection.

Two standard metrics for the overall deviation of the subpopulation from the full population over the full range of scores that account for expected random fluctuations are that due to Kolmogorov and Smirnov, the maximum absolute deviation

ğº=max1â‰¤ğ‘˜â‰¤ğ‘›|ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜|,
(12)
and that due to Kuiper, the size of the range of the deviations

ğ·=max0â‰¤ğ‘˜â‰¤ğ‘›(ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜)âˆ’min0â‰¤ğ‘˜â‰¤ğ‘›(ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜),
(13)
where ğ¹0=0=ğ¹Ìƒ 0; the following remark explains the reason for including ğ¹0 and ğ¹Ìƒ 0 (a reason that often makes D modestly preferable to G). Under appropriate statistical models, G and D can form the basis for tests of statistical significance, the context in which they originally appeared; see, for example, Section 14.3.4 of [3]. For assessing statistical significance (rather than overall effect size), G and D should be rescaled larger by a factor proportional to ğ‘›âˆš; further discussion of the rescaling is available in the next subsection. The captions of the figures report the values of these summary statistics for all examples.

Remark 1
The statistic D from (13) has the same statistical power across all indices. Indeed, shifting the index in the definitions of ğ¹ğ‘˜ and ğ¹Ìƒ ğ‘˜ where the summation starts has no effect on the value of D, for the following reasons: Recall that an integral whose lower limit of integration is greater than the upper limit is simply the negative of the integral with the lower and upper limits of integration interchanged. Thus, the natural generalization when starting from arbitrary values of j the summations defining ğ¹ğ‘˜ in (5) and ğ¹Ìƒ ğ‘˜ in (8) is

ğ¹(â„“)ğ‘˜=1ğ‘›âˆ‘ğ‘—:â„“<ğ‘—â‰¤ğ‘˜ğ‘…ğ‘–ğ‘—âˆ’1ğ‘›âˆ‘ğ‘—:ğ‘˜<ğ‘—â‰¤â„“ğ‘…ğ‘–ğ‘—
(14)
and

ğ¹Ìƒ (â„“)ğ‘˜=1ğ‘›âˆ‘ğ‘—:â„“<ğ‘—â‰¤ğ‘˜ğ‘…Ìƒ ğ‘–ğ‘—âˆ’1ğ‘›âˆ‘ğ‘—:ğ‘˜<ğ‘—â‰¤â„“ğ‘…Ìƒ ğ‘–ğ‘—
(15)
for ğ‘˜=0, 1, 2, ..., n; â„“=0, 1, 2, ..., n, with the case â„“=0 reducing to (5) and (8). Of course, the first summation in the right-hand side of (14) vanishes when ğ‘˜â‰¤â„“ and the second summation vanishes when ğ‘˜â‰¥â„“; similarly, the first summation in the right-hand side of (15) vanishes when ğ‘˜â‰¤â„“ and the second summation vanishes when ğ‘˜â‰¥â„“. Consideration of each case, for ğ‘˜<â„“, for ğ‘˜=â„“, and for ğ‘˜>â„“, yields that

ğ¹(â„“)ğ‘˜=ğ¹(0)ğ‘˜âˆ’ğ¹(0)â„“
(16)
and

ğ¹Ìƒ (â„“)ğ‘˜=ğ¹Ìƒ (0)ğ‘˜âˆ’ğ¹Ìƒ (0)â„“
(17)
for ğ‘˜=0, 1, 2, ..., n; â„“=0, 1, 2, ..., n. The definition

ğ·(â„“)=max0â‰¤ğ‘˜â‰¤ğ‘›(ğ¹(â„“)ğ‘˜âˆ’ğ¹Ìƒ (â„“)ğ‘˜)âˆ’min0â‰¤ğ‘˜â‰¤ğ‘›(ğ¹(â„“)ğ‘˜âˆ’ğ¹Ìƒ (â„“)ğ‘˜),
(18)
when combined with (16) and (17), then yields that

ğ·(â„“)=ğ·(0)=ğ·
(19)
for â„“=0, 1, 2, ..., n, where D is from (13). This shows that the statistic D has the same statistical power for any index, as the statistic is invariant to shifts in where the summation for the cumulative differences starts.

Significance of stochastic fluctuations
This subsection discusses statistical significance both for the graphical methods of section "Graphical method" and for the summary statistics of section "Scalar summary statistics".

The plot of ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ as a function of k/n automatically includes some â€œconfidence bandsâ€ courtesy of the discrepancy ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ fluctuating randomly as the index k incrementsâ€”at the very least, the â€œthicknessâ€ of the plot coming from the random fluctuations gives a sense of â€œerror bars.â€ To give a rough indication of the size of the fluctuations of the maximum deviation expected under the hypothesis that the subpopulation does not deviate from the full population in the actual underlying distributions, the plots should include a triangle centered at the origin whose height above the origin is proportional to 1/ğ‘›âˆš. Such a triangle can be a proxy for the classic confidence bands around an empirical cumulative distribution function introduced by Kolmogorov and Smirnov, as reviewed by [4]. Indeed, a driftless, purely random walk deviates from zero by roughly ğ‘›âˆš after n steps, so a random walk scaled by 1/n deviates from zero by roughly 1/ğ‘›âˆš. Identification of deviation between the subpopulation and the full population is reliable when focusing on long ranges (as a function of k/n) of steep slopes for ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜; the triangle gives a sense of the length scale for variations that arise solely due to randomness even in the absence of any actual underlying deviation between the subpopulation and the full population. A simple illustrative example is available in Fig. 1, and many examples analyzing data from a popular data set in computer vision, â€œImageNet,â€ are available in section "ImageNet".

In cases for which either ğ‘…ğ‘–=0 or ğ‘…ğ‘–=1 for each ğ‘–=1, 2, ..., m, and for which the scores are nothing but the probabilities of success, that is, ğ‘†ğ‘– is the probability that ğ‘…ğ‘–=1 (where ğ‘–=1, 2, ..., m), the tip-to-tip height of the triangle centered at the origin should be 4/n times the standard deviation of the sum of independent Bernoulli variates with success probabilities ğ‘†ğ‘–1, ğ‘†ğ‘–2, ..., ğ‘†ğ‘–ğ‘›, that is, 4âˆ‘ğ‘›ğ‘˜=1ğ‘†ğ‘–ğ‘˜(1âˆ’ğ‘†ğ‘–ğ‘˜)â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆš/ğ‘›. This height will be representative to within a factor of 2â€¾âˆš or so provided that the subpopulation is a minority of the full populationâ€”see Remark 7 and section "Significance of stochastic fluctuations for assessing calibration" of Appendix A below. Needless to say, similar remarks pertain whenever the variance of ğ‘…ğ‘– is a known function of ğ‘†ğ‘– for each ğ‘–=1, 2, ..., m.

In cases for which either ğ‘…ğ‘–=0 or ğ‘…ğ‘–=1 for each ğ‘–=1, 2, ..., m, and for which there are many scores from the full population in the bin for each score from the subpopulation, that is, #{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜} is large for every ğ‘˜=1, 2, ..., n, the average of the outcomes for each bin will be a good approximation to the average of the underlying probabilities of success for that bin, that is,

âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ‘…ğ‘–#{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜}â‰ˆâˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ”¼[ğ‘…ğ‘–]#{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜}=ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘˜]
(20)
for ğ‘˜=1, 2, ..., n, where ğµğ‘˜ is from (7), ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘˜] is from (11), and ğ”¼[ğ‘…ğ‘–] is the probability that the outcome is a success, that is, the probability that ğ‘…ğ‘–=1. In such cases, the tip-to-tip height of the triangle at the origin should be 4/n times the standard deviation of the sum of independent Bernoulli variates with success probabilities ğ”¼[ğ‘…Ìƒ ğ‘–1], ğ”¼[ğ‘…Ìƒ ğ‘–2], ..., ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘›], that is, 4âˆ‘ğ‘›ğ‘˜=1ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘˜](1âˆ’ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘˜])â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆš/ğ‘› â€” and we may use (20) to approximate this height as four times

ğœ=1ğ‘›âˆ‘ğ‘˜=1ğ‘›ğ‘…Ìƒ ğ‘–ğ‘˜(1âˆ’ğ‘…Ìƒ ğ‘–ğ‘˜)â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾î€â·î€€î€€,
(21)
where ğ‘…Ìƒ ğ‘–ğ‘˜ is the left-hand side of (20), as seen from (6). The triangles in the figures all have this height when each ğ‘…ğ‘– is either 0 or 1, since the numerical results reported in the following section pertain to the case in which there are quite a few scores from the full population in the bin for each score from the subpopulation. When ğ‘…ğ‘– can take on more than two possible values, the figures instead use the empirical variance of the members from the full population for each bin from ğµğ‘˜âˆ’1 to ğµğ‘˜, that is, we replace (21) with

ğœ=1ğ‘›âˆ‘ğ‘˜=1ğ‘›ğ‘‰ğ‘–ğ‘˜â€¾â€¾â€¾â€¾â€¾â€¾î€â·î€€î€€,
(22)
where the empirical variance is

ğ‘‰ğ‘–ğ‘˜=âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜(ğ‘…ğ‘–âˆ’ğ‘…Ìƒ ğ‘–ğ‘˜)2#{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜}
(23)
for ğ‘˜=1, 2, ..., n, with ğ‘…Ìƒ ğ‘–ğ‘˜ defined in (6); ğ‘…Ìƒ ğ‘–ğ‘˜ is also the left-hand side of (20).

[Rigorous justification of (20) is straightforward: the expected value of the left-hand side of (20) is the right-hand side of (20), and 0â‰¤ğ”¼[ğ‘…ğ‘–]â‰¤1 implies that ğ”¼[ğ‘…ğ‘–](1âˆ’ğ”¼[ğ‘…ğ‘–])â‰¤1/4, so the standard deviation of the left-hand side of (20) is

âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ”¼[ğ‘…ğ‘–](1âˆ’ğ”¼[ğ‘…ğ‘–])â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆš#{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜}â‰¤12#{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜}â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆš,
(24)
which converges to 0 as #{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜} increases.]

Remark 2
Interpreting the scalar summary statistics G and D from (12) and (13) is straightforward in these latter cases, using ğœ defined in (21) or (22). Indeed, under the null hypothesis that the subpopulation has no deviation from the average values of the full population at the corresponding scores, the expected value of ğº/ğœ is less than or equal to the expected value of the maximum (over a subset of the unit interval [0, 1]) of the absolute value of the standard Brownian motion over [0, 1], in the limit ğ‘›â†’âˆ and #{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜}â†’âˆ for all ğ‘˜=1, 2, ..., n. As reviewed below in Remark 7, the expected value of the maximum of the absolute value of the standard Brownian motion over the unit interval [0, 1] is ğœ‹/2â€¾â€¾â€¾âˆšâ‰ˆ1.25; and the discussion by [5] immediately following Formula 44 of the associated arXiv publicationFootnote2 shows that the probability distribution of the maximum of the absolute value of the standard Brownian motion over [0, 1] is sub-Gaussian, decaying past its mean ğœ‹/2â€¾â€¾â€¾âˆšâ‰ˆ1.25. So, values of ğº/ğœ much greater than 1.25 imply that the subpopulationâ€™s deviation from the full population is significant, while values of ğº/ğœ close to 0 imply that G did not detect any statistically significant deviation. Similar remarks pertain to D, since ğºâ‰¤ğ·â‰¤2ğº.

Remark 3
Zooming in on the origin of the plot can reveal relative deviations (or small absolute deviations) that may be of interest beyond just the absolute deviations; Fig. 20 displays such zooming, while setting the height of the triangle at the origin based on only the scores and deviations appearing in the restricted domain of the plot, rather than on the full domain depicted in the other figures.

Weighted sampling
This subsection generalizes the methods of the preceding subsections to the case of weighted samples.

Specifically, some data sets include a weight for how much each observation should contribute to the data analysis. In the setting of section "Graphical method" above, such a data set would supplement the results ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š and scores ğ‘†1, ğ‘†2, ..., ğ‘†ğ‘š with positive weights ğ‘Š1, ğ‘Š2, ..., ğ‘Šğ‘š. Section "Graphical method" will correspond to the special case that ğ‘Š1=ğ‘Š2=â€¦=ğ‘Šğ‘š (admittedly, the â€œspecialâ€ case is the standard in practice).

With weights, the cumulative sequence for the subpopulation, replacing (5), becomes

ğ¹ğ‘˜=âˆ‘ğ‘˜ğ‘—=1ğ‘Šğ‘–ğ‘—ğ‘…ğ‘–ğ‘—âˆ‘ğ‘›ğ‘—=1ğ‘Šğ‘–ğ‘—
(25)
for ğ‘˜=1, 2, ..., n.

The average result for the full population in a bin around ğ‘†ğ‘–ğ‘˜, replacing (6), becomes

ğ‘…Ìƒ ğ‘–ğ‘˜=âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ‘Šğ‘–ğ‘…ğ‘–âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ‘Šğ‘–
(26)
for ğ‘˜=1, 2, ..., n, where (7) defines ğµ0, ğµ1, ..., ğµğ‘›, the thresholds for the bins.

The cumulative sequence for the full population at the subpopulationâ€™s subset of scores, replacing (8), becomes

ğ¹Ìƒ ğ‘˜=âˆ‘ğ‘˜ğ‘—=1ğ‘Šğ‘–ğ‘—ğ‘…Ìƒ ğ‘–ğ‘—âˆ‘ğ‘›ğ‘—=1ğ‘Šğ‘–ğ‘—
(27)
for ğ‘˜=1, 2, ..., n, where ğ‘…Ìƒ ğ‘–ğ‘— is defined in (26).

The cumulative sequence of weights is

ğ´ğ‘˜=âˆ‘ğ‘˜ğ‘—=1ğ‘Šğ‘–ğ‘—âˆ‘ğ‘›ğ‘—=1ğ‘Šğ‘–ğ‘—
(28)
for ğ‘˜=1, 2, ..., n.

In a plot of the weighted cumulative differences ğ¹1âˆ’ğ¹Ìƒ 1, ğ¹2âˆ’ğ¹Ìƒ 2, ..., ğ¹ğ‘›âˆ’ğ¹Ìƒ ğ‘› from (25) and (27) versus the cumulative weights ğ´1, ğ´2, ..., ğ´ğ‘› from (28), that is, in a plot where ğ¹1âˆ’ğ¹Ìƒ 1, ğ¹2âˆ’ğ¹Ìƒ 2, ..., ğ¹ğ‘›âˆ’ğ¹Ìƒ ğ‘› are the ordinates (vertical coordinates), and ğ´1, ğ´2, ..., ğ´ğ‘› are the corresponding abscissae (horizontal coordinates), the expected value of the slope from ğ´ğ‘˜âˆ’1 to ğ´ğ‘˜ is

Î”ğ‘˜=ğ”¼[(ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜)âˆ’(ğ¹ğ‘˜âˆ’1âˆ’ğ¹Ìƒ ğ‘˜âˆ’1)]ğ´ğ‘˜âˆ’ğ´ğ‘˜âˆ’1=ğ‘Šğ‘–ğ‘˜ğ”¼[ğ‘…ğ‘–ğ‘˜]âˆ’ğ‘Šğ‘–ğ‘˜ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘˜]ğ‘Šğ‘–ğ‘˜=ğ”¼[ğ‘…ğ‘–ğ‘˜]âˆ’ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘˜],
(29)
where the expected value of the weighted average result ğ‘…Ìƒ ğ‘–ğ‘˜ in the bin around ğ‘†ğ‘–ğ‘˜ is equal to the weighted average of the expected results, that is,

ğ”¼[ğ‘…Ìƒ ğ‘–ğ‘˜]=âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ‘Šğ‘–ğ”¼[ğ‘…ğ‘–]âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ‘Šğ‘–
(30)
for ğ‘˜=1, 2, ..., n, and ğ‘…Ìƒ ğ‘–ğ‘˜ is defined in (26). Thus, Î”ğ‘˜ defined in (29) is equal to the expected value of the deviation of the subpopulation from the full population for the scores near ğ‘†ğ‘–ğ‘˜, with ğ‘Šğ‘–ğ‘˜ canceling in the rightmost identity of (29). Hence, the subpopulation deviates from the full population for the scores near ğ‘†ğ‘–ğ‘˜ when Î”ğ‘˜ is significantly nonzero, that is, when the slope of the plot of ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ versus ğ´ğ‘˜ deviates significantly from horizontal over a significantly long range.

To emphasize: the deviation of the subpopulation from the full population over a contiguous range of ğ‘†ğ‘–ğ‘˜ is the slope of the secant line for the plot of ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ as a function of ğ´ğ‘˜ over that range, aside from expected random fluctuations.

A simple illustrative example is available in Fig. 7 of section "Synthetic", and many examples analyzing data from the U.S. Census Bureau are available in section "American Community Survey of the U.S. Census Bureau".

The slope of line segments connecting the points in the plot of ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ versus ğ´ğ‘˜ is constant between successive values of k, and those successive values are spaced further apart on the horizontal axis when the weight ğ‘Šğ‘–ğ‘˜ is larger. A plotted line that is straight for a wide horizontal range is therefore indicative of a large weight. Moreover, setting the (major) ticks on the upper horizontal axis at the positions corresponding to equispaced values for k visually depicts the distribution of weights; including equispaced minor ticks on the same upper horizontal axis provides a comparison to the case of uniform weighting.

In cases for which either ğ‘…ğ‘–=0 or ğ‘…ğ‘–=1 for each ğ‘–=1, 2, ..., m, and for which there are many scores from the full population in the bin for each score from the subpopulation, that is, #{ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜} is large for every ğ‘˜=1, 2, ..., n, the tip-to-tip height of the triangle at the origin should be four times

ğœ=âˆ‘ğ‘›ğ‘˜=1(ğ‘Šğ‘–ğ‘˜)2ğ‘…Ìƒ ğ‘–ğ‘˜(1âˆ’ğ‘…Ìƒ ğ‘–ğ‘˜)â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆšâˆ‘ğ‘›ğ‘˜=1ğ‘Šğ‘–ğ‘˜,
(31)
where ğ‘…Ìƒ ğ‘–ğ‘˜ is defined in (26); that is, we replace (21) with (31). When ğ‘…ğ‘– can take on more than two possible values, the figures instead use the empirical variance of the members from the full population for each bin from ğµğ‘˜âˆ’1 to ğµğ‘˜, that is, we replace (22) and (31) with

ğœ=âˆ‘ğ‘›ğ‘˜=1(ğ‘Šğ‘–ğ‘˜)2ğ‘‰ğ‘–ğ‘˜â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆšâˆ‘ğ‘›ğ‘˜=1ğ‘Šğ‘–ğ‘˜,
(32)
where the empirical variance is

ğ‘‰ğ‘–ğ‘˜=âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ‘Šğ‘–(ğ‘…ğ‘–âˆ’ğ‘…Ìƒ ğ‘–ğ‘˜)2âˆ‘ğ‘–:ğµğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµğ‘˜ğ‘Šğ‘–
(33)
for ğ‘˜=1, 2, ..., n, with ğ‘…Ìƒ ğ‘–ğ‘˜ defined in (26). The numerators of (31) and (32) include the square (ğ‘Šğ‘–ğ‘˜)2, unlike the other formulae.

The scalar summary statistics due to Kuiper and to Kolmogorov and Smirnov of course use the same formulae (12) and (13) as in the unweighted (or uniformly weighted) case, except for replacing the definition of ğ¹ğ‘˜ from (5) with the definition from (25) and the definition of ğ¹Ìƒ ğ‘˜ from (8) with the definition from (27).

Remark 4
We can adapt to the case of weighted sampling the classical methods discussed in the introduction. As in the introduction, we choose some partitions of the real line into â„“ disjoint intervals with endpoints ğµ1, ğµ2, ..., ğµâ„“âˆ’1 and another (possibly the same) â„“ disjoint intervals with endpoints ğµÌƒ 1, ğµÌƒ 2, ..., ğµÌƒ â„“âˆ’1 such that ğµ1<ğµ2<â€¦<ğµâ„“âˆ’1 and ğµÌƒ 1<ğµÌƒ 2<â‹¯<ğµÌƒ â„“âˆ’1, and then replace (1) with the weighted averages for the subpopulation

ğ‘Œğ‘˜=âˆ‘ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜ğ‘Šğ‘–ğ‘—ğ‘…ğ‘–ğ‘—âˆ‘ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜ğ‘Šğ‘–ğ‘—
(34)
and replace (2) with the weighted averages for the full population

ğ‘ŒÌƒ ğ‘˜=âˆ‘ğ‘–:ğµÌƒ ğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµÌƒ ğ‘˜ğ‘Šğ‘–ğ‘…ğ‘–âˆ‘ğ‘–:ğµÌƒ ğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµÌƒ ğ‘˜ğ‘Šğ‘–
(35)
for ğ‘˜=1, 2, ..., â„“, under the convention that ğµ0=ğµÌƒ 0=âˆ’âˆ and ğµâ„“=ğµÌƒ â„“=âˆ. We also replace (3) with the weighted averages of the scores in the bins for the subpopulation

ğ‘‹ğ‘˜=âˆ‘ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜ğ‘Šğ‘–ğ‘—ğ‘†ğ‘–ğ‘—âˆ‘ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜ğ‘Šğ‘–ğ‘—
(36)
and replace (4) with the weighted averages for the full population

ğ‘‹Ìƒ ğ‘˜=âˆ‘ğ‘–:ğµÌƒ ğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµÌƒ ğ‘˜ğ‘Šğ‘–ğ‘†ğ‘–âˆ‘ğ‘–:ğµÌƒ ğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµÌƒ ğ‘˜ğ‘Šğ‘–
(37)
for ğ‘˜=1, 2, ..., â„“, under the same convention that ğµ0=ğµÌƒ 0=âˆ’âˆ and ğµâ„“=ğµÌƒ â„“=âˆ. The reliability diagram for assessing the deviation of the subpopulation from the full population is then the scatterplot of the pairs (ğ‘‹1,ğ‘Œ1), (ğ‘‹2,ğ‘Œ2), ..., (ğ‘‹â„“,ğ‘Œâ„“) in black and the pairs (ğ‘‹Ìƒ 1,ğ‘ŒÌƒ 1), (ğ‘‹Ìƒ 2,ğ‘ŒÌƒ 2), ..., (ğ‘‹Ìƒ â„“,ğ‘ŒÌƒ â„“) in gray. Comparing the black plotted points (possibly connected with black lines) to the gray plotted points (possibly connected with gray lines) gives an indication of deviation of the subpopulation from the full population. Two natural choices of the bins whose endpoints are ğµ1, ğµ2, ..., ğµâ„“âˆ’1 (similar choices pertain to the bins whose endpoints are ğµÌƒ 1, ğµÌƒ 2, ..., ğµÌƒ â„“âˆ’1) include {1} have ğµ1, ğµ2, ..., ğµâ„“âˆ’1 be equispaced, and {2} choose ğµ1, ğµ2, ..., ğµâ„“âˆ’1 such that

ğ‘ˆğ‘˜=âˆ‘ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜(ğ‘Šğ‘–ğ‘—)2â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆšâˆ‘ğ‘—:ğµğ‘˜âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµğ‘˜ğ‘Šğ‘–ğ‘—
(38)
has a similar value for all ğ‘˜=1, 2, ..., â„“. Remark 5 below details the procedure we followed in the second case; the plots entitled, â€œreliability diagram (â€–ğ‘Šâ€–2/â€–ğ‘Šâ€–1 is similar for every bin),â€ display this second possible choice of bins. The plots entitled simply, â€œreliability diagram,â€ display the first possible choice of bins. In the special case that the weights are uniform, that is, ğ‘Š1=ğ‘Š2=â‹¯=ğ‘Šğ‘š, the second choice of bins results in every bin containing about the same number of scores, with ğ‘ˆ1â‰ˆğ‘ˆ2â‰ˆâ€¦â‰ˆğ‘ˆâ„“â‰ˆâ„“/ğ‘›â€¾â€¾â€¾âˆš, and similarly ğ‘ˆÌƒ 1â‰ˆğ‘ˆÌƒ 2â‰ˆâ€¦â‰ˆğ‘ˆÌƒ â„“â‰ˆâ„“/ğ‘šâ€¾â€¾â€¾â€¾âˆš, where

ğ‘ˆÌƒ ğ‘˜=âˆ‘ğ‘–:ğµÌƒ ğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµÌƒ ğ‘˜(ğ‘Šğ‘–)2â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆšâˆ‘ğ‘–:ğµÌƒ ğ‘˜âˆ’1<ğ‘†ğ‘–â‰¤ğµÌƒ ğ‘˜ğ‘Šğ‘–
(39)
for ğ‘˜=1, 2, ..., â„“.

Remark 5
In the case of weighted sampling, the most useful reliability diagrams are usually those entitled, â€œreliability diagram (â€–ğ‘Šâ€–2/â€–ğ‘Šâ€–1 is similar for every bin).â€ These diagrams construct â„“ bins with endpoints ğµ0, ğµ1, ..., ğµâ„“ such that ğ‘ˆ1â‰ˆğ‘ˆ2â‰ˆâ€¦â‰ˆğ‘ˆâ„“, where ğ‘ˆğ‘˜ is defined in (38). These diagrams also construct â„“Ìƒ  bins with endpoints ğµÌƒ 0, ğµÌƒ 1, ..., ğµÌƒ â„“Ìƒ  such that ğ‘ˆÌƒ 1â‰ˆğ‘ˆÌƒ 2â‰ˆâ€¦â‰ˆğ‘ˆÌƒ â„“Ìƒ , where ğ‘ˆÌƒ ğ‘˜ is defined in (39). The algorithmic details are as follows: Given a value U for which hopefully ğ‘ˆğ‘˜â‰ˆğ‘ˆ for all ğ‘˜=1, 2, ..., â„“, we set ğµ0=âˆ’âˆ and, iterating from ğ‘˜=1 to ğ‘˜=â„“, incrementally increase ğµğ‘˜ to the least value greater than ğµğ‘˜âˆ’1 such that ğ‘ˆğ‘˜â‰¤ğ‘ˆ. If this causes the bin â„“ (the bin for the highest scores) to contain less than half as many subpopulation observations as bin â„“âˆ’1, that is, #{ğ‘—:ğµâ„“âˆ’1<ğ‘†ğ‘–ğ‘—â‰¤ğµâ„“}<#{ğ‘—:ğµâ„“âˆ’2<ğ‘†ğ‘–ğ‘—â‰¤ğµâ„“âˆ’1}/2, then we merge bin â„“ with bin â„“âˆ’1. In the aforementioned algorithm, we computed U via the formula

ğ‘ˆ=âˆ‘âŒŠğ‘›/â„“Â¯âŒ‹ğ‘—=1(ğ‘Šğ‘ğ‘—)2â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆšâˆ‘âŒŠğ‘›/â„“Â¯âŒ‹ğ‘—=1ğ‘Šğ‘ğ‘—,
(40)
where ğ‘1, ğ‘2, ..., ğ‘ğ‘› are a uniformly random permutation of the integers ğ‘–1, ğ‘–2, ..., ğ‘–ğ‘›, and â„“Â¯ is the desired number of bins. Calculating U via the heuristic (40) worked well for all examples reported below, producing ğ‘ˆ1â‰ˆğ‘ˆ2â‰ˆâ€¦â‰ˆğ‘ˆâ„“, with â„“ close to â„“Â¯; the procedure yielding ğ‘ˆÌƒ 1â‰ˆğ‘ˆÌƒ 2â‰ˆâ€¦â‰ˆğ‘ˆÌƒ â„“Ìƒ  is similar (in fact, the implementation is identical, viewing the full population as a subpopulation of itself).

Results and discussion
This section illustrates via numerous examples the previous sectionâ€™s methods, together with the traditional plotsâ€”so-called â€œreliability diagramsâ€â€”discussed in the introduction.Footnote3 Section "Synthetic" presents several (hopefully insightful) toy examples. Section "ImageNet" analyzes a popular, unweighted data set of images, ImageNet. Section "American Community Survey of the U.S. Census Bureau" analyzes a weighted data set, the most recent (year 2019) American Community Survey of the United States Census Bureau. Section "Future outlook" proposes directions for future developments.

The figures display the classical calibration plots (â€œreliability diagramsâ€) as well as both the plots of cumulative differences and the exact expectations in the absence of noise from random sampling when the exact expectations are known (as with synthetically generated data). The captions of the figures discuss the numerical results depicted.

The title, â€œsubpopulation deviation is the slope as a function of k/n,â€ labels a plot of ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ from (5) and (8) as a function of k/n. In each such plot, the upper axis specifies k/n, while the lower axis specifies ğ‘†ğ‘–ğ‘˜ for the corresponding value of k. The title, â€œsubpopulation deviation is the slope as a function of ğ´ğ‘˜,â€ labels a plot of ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ from (25) and (27) versus the cumulative weight ğ´ğ‘˜ from (28). In each such plot, the major ticks on the upper axis specify k/n, while the major ticks on the lower axis specify ğ‘†ğ‘–ğ‘˜ for the corresponding value of k; the points in the plot are the ordered pairs (ğ´ğ‘˜,ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜) for ğ‘˜=1, 2, ..., n, with ğ´ğ‘˜ being the abscissa and ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ being the ordinate.

The titles, â€œreliability diagram,â€ â€œreliability diagram (equal number of subpopulation scores per bin),â€ and â€œreliability diagram (â€–ğ‘Šâ€–2/â€–ğ‘Šâ€–1 is similar for every bin),â€ label a plot of the pairs (ğ‘‹1,ğ‘Œ1), (ğ‘‹2,ğ‘Œ2), ..., (ğ‘‹â„“,ğ‘Œâ„“) and (ğ‘‹Ìƒ 1,ğ‘ŒÌƒ 1), (ğ‘‹Ìƒ 2,ğ‘ŒÌƒ 2), ..., (ğ‘‹Ìƒ â„“,ğ‘ŒÌƒ â„“) from (1), (2), (3), and (4) or from (34), (35), (36), and (37) in the case of weighted sampling; the subpopulationâ€™s pairs (ğ‘‹1,ğ‘Œ1), (ğ‘‹2,ğ‘Œ2), ..., (ğ‘‹â„“,ğ‘Œâ„“) are in black, while the full populationâ€™s pairs (ğ‘‹Ìƒ 1,ğ‘ŒÌƒ 1), (ğ‘‹Ìƒ 2,ğ‘ŒÌƒ 2), ..., (ğ‘‹Ìƒ â„“,ğ‘ŒÌƒ â„“) are in gray.

To give a sense of the uncertainties in the classical, binned plots, we vary the number of bins and observe how the plotted values vary. Displaying the bin frequencies is another way to indicate uncertainties, as suggested, for example, by [6]. Still other possibilities could use kernel density estimation, as suggested, for example, by [7] and [8]. Such uncertainty estimates require selecting widths for the bins or kernel smoothing; varying the widths (as done in the present paper) avoids having to make what would otherwise be a rather arbitrary choice. A thorough survey of the various possibilities is available in Chapter 8 of [8].

As noted in the introduction, there are two canonical choices for the bins in the case of unweighted (or uniformly weighted) sampling: {1} make the average of ğ‘†ğ‘–ğ‘˜ (or ğ‘†ğ‘–) in each bin be approximately equidistant from the average of ğ‘†ğ‘–ğ‘˜ (or ğ‘†ğ‘–) in each neighboring bin or {2} make the number of ğ‘†ğ‘–ğ‘˜ (or ğ‘†ğ‘–) in every bin (except perhaps for the last) be the same. The figures label the first, more conventional possibility with the short title, â€œreliability diagram,â€ and the second possibility with the longer title, â€œreliability diagram (equal number of subpopulation scores per bin).â€ As noted in Remark 4, there are two natural choices for the bins in the case of weighted sampling: {1} make the weighted average of ğ‘†ğ‘–ğ‘˜ (or ğ‘†ğ‘–) in each bin be approximately equidistant from the weighted average of ğ‘†ğ‘–ğ‘˜ (or ğ‘†ğ‘–) in each neighboring bin or {2} follow Remark 5 above. The figures label the first possibility with the short title, â€œreliability diagram,â€ and the second possibility with the longer title, â€œreliability diagram (â€–ğ‘Šâ€–2/â€–ğ‘Šâ€–1 is similar for every bin).â€

Setting the number of bins together with any of these choices fully specifies the bins. As discussed earlier, we vary the number of bins, since there is no perfect settingâ€”using fewer bins offers higher-confidence estimates, yet limits the resolution for detecting deviations and for assessing how the deviations vary as a function of ğ‘†ğ‘–ğ‘˜.

Synthetic
In this subsection, the examples draw observations at random from various statistical models so that the underlying â€œground-truthâ€ is available. To generate the corresponding figures, Figs. 1, 2, 3, 4, 5, 6, 7, and 8, we specify values for the scores ğ‘†1, ğ‘†2, ..., ğ‘†ğ‘š and for the indices ğ‘–1, ğ‘–2, ..., ğ‘–ğ‘›. We also select probabilities ğ‘ƒ1, ğ‘ƒ2, ..., ğ‘ƒğ‘š and then independently draw the outcomes ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š from the Bernoulli distributions with parameters ğ‘ƒ1, ğ‘ƒ2, ..., ğ‘ƒğ‘š, respectively. The first three examples, corresponding to Figs. 1, 2, 3, 4, 5, and 6, use unweighted (or, equivalently, uniformly weighted) data; the fourth example, corresponding to Figs. 7 and 8, uses weighted data, in which each pair of score ğ‘†ğ‘– and result ğ‘…ğ‘– comes with an additional positive scalar weight ğ‘Šğ‘–. Appendix B illustrates the degenerate case of when deviation is absent, via further examples.

Fig. 3
figure 3
ğ‘›= 3300; Kuiperâ€™s statistic is 0.01621/ğœ=2.243, Kolmogorovâ€™s and Smirnovâ€™s is 0.009983/ğœ=1.381. Figure 4 displays the ground-truth reliability diagram. Distinguishing random fluctuations from real variations is difficult in the reliability diagrams with 50 bins each. The reliability diagrams that each have only 10 bins could be misleading, as the depicted variations in the subpopulationâ€™s outcomes are grossly lower than the actual underlying variations as a function of score. The plot of cumulative deviation is far from perfect, yet captures the exact expectations quite well qualitatively and tolerably well quantitatively. The scalar summary statistics have trouble detecting the significant deviation of the subpopulation from the full population. This illustrates a blind spot in the Kolmogorovâ€“Smirnov and Kuiper statistics, namely, they have a hard time detecting oscillatory discrepancies that average away upon summation. Neither the Kolmogorov-Smirnov metric nor the Kuiper metric is very sensitive to high-frequency deviations whose mean is small

Full size image
Fig. 4
figure 4
Ground-truth reliability diagram for Fig. 3

Full size image
Fig. 5
figure 5
ğ‘›= 2500; Kuiperâ€™s statistic is 0.05536/ğœ=6.586, Kolmogorovâ€™s and Smirnovâ€™s is 0.04554/ğœ=5.418. Figure 6 displays the ground-truth reliability diagram. The observed reliability diagrams fail to depict the underlying discontinuous jumps in the subpopulationâ€™s expected outcomes as a function of the score. The plot of cumulative deviation succeeds in resolving some of the corresponding cusps, but does exhibit significant random fluctuations nearly as high as a quarter of the height of the triangle at the origin. The scalar summary statistics successfully detect the statistically significant deviation of the subpopulation from the full population

Full size image
Fig. 6
figure 6
Ground-truth reliability diagram for Fig. 5

Full size image
Fig. 7
figure 7
ğ‘›= 2500, with weighted sampling; Kuiperâ€™s statistic is 0.03490/ğœ=3.318, Kolmogorovâ€™s and Smirnovâ€™s is 0.03490/ğœ=3.318. Figure 8 displays the ground-truth reliability diagram. The cumulative plot displays the distinguished observation from the subpopulation as a straight, steep jump at its score around 0.75; the constant slope of that steep jump shows that the corresponding high deviation between the subpopulation and the full population is due to a single highly weighted observation. This single observation has no effect on the slopes in the rest of the cumulative plot, whereas the few highly weighted observations dramatically (perhaps misleadingly?) alter the bins around scores of 0.75 in the observed reliability diagrams. The scalar summary statistics report statistically significant deviation of the subpopulation from the full population, though the steep jump in the cumulative plot reduces the effectiveness of the scalar statistics

Full size image
Fig. 8
figure 8
Ground-truth reliability diagram for Fig. 7

Full size image
The top rows of Figs. 1, 3, and 5 plot ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ from (5) and (8) as a function of k/n, with the rightmost plot displaying its noiseless expected value rather than using the random observations ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š. The top row of Figure 7 plots ğ¹ğ‘˜âˆ’ğ¹Ìƒ ğ‘˜ from (25) and (27) versus the cumulative weight ğ´ğ‘˜ from (28), with the rightmost plot displaying its noiseless expected value rather than using the random observations ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š. Figs. 2, 4, 6, and 8 plot the pairs (ğ‘†1,ğ‘ƒ1), (ğ‘†2,ğ‘ƒ2), ..., (ğ‘†ğ‘š,ğ‘ƒğ‘š) in gray, and plot the pairs (ğ‘†ğ‘–1,ğ‘ƒğ‘–1), (ğ‘†ğ‘–2,ğ‘ƒğ‘–2), ..., (ğ‘†ğ‘–ğ‘›,ğ‘ƒğ‘–ğ‘›) in black, producing ground-truth diagrams that the lowermost two rows of plots from the associated Figs. 1, 3, 5, and 7 are trying to estimate using only the observations ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š, without access to the underlying probabilities ğ‘ƒ1, ğ‘ƒ2, ..., ğ‘ƒğ‘š.

For the examples, we consider full populations which are mixtures of many subpopulations, including for each example one specific subpopulation that we analyze for deviations from the average over the full population. To make the models realistic, we assign expected outcomes to the members of the full population such that the expected outcomes span a continuous range which includes the expected outcomes attained by members of the subpopulation being analyzed for deviations. The reliability diagrams use gray points and gray connecting-lines to indicate the full population, and solid black points and black connecting-lines to indicate the specific subpopulation under consideration.

For the first example, corresponding to Figs. 1 and 2, we consider a mixture of subpopulations with a reasonably wide range of expected outcomes for most ranges of scores, except for a narrow notch around scores of 0.25 which lacks the significant subpopulation deviation. We select for the specific subpopulation analyzed for deviations a subpopulation with among the highest expected outcomes around every score. The scores are ğ‘†ğ‘—=((ğ‘—âˆ’0.5)/ğ‘š)2 for ğ‘—=1, 2, ..., m, thus more concentrated near 0 than near 1. For the indices ğ‘–1, ğ‘–2, ..., ğ‘–ğ‘› of the subpopulation, we start with the integer multiples of 20 and then add three levels of refinement increasingly focused around m/2, where m/2 corresponds to the middle of the notch. The total number of scores considered is ğ‘š= 50,000, and (following the refinement) the number of subpopulation indices is ğ‘›= 5000.

For the second example, corresponding to Figs. 3 and 4, we consider a mixture of subpopulations that includes one whose expected outcomes oscillate smoothly between the minimum and the maximum of the expected outcomes of all subpopulations as a function of the score; we analyze that particular one subpopulation for deviations from the full population. The scores are ğ‘†ğ‘—=(ğ‘—âˆ’0.5)/ğ‘š for ğ‘—=1, 2, ..., m, hence equispaced between 0 and 1. The total number of scores considered is ğ‘š= 50,000. For the indices ğ‘–1, ğ‘–2, ..., ğ‘–ğ‘› of the subpopulation, we raise to the power 4/3 each positive integer, then round to the nearest integer, and finally retain the lowest ğ‘›= 3300 unique resulting integers.

For the third example, corresponding to Figs. 5 and 6, we consider a mixture of subpopulations similar to that for the second example, but this time selecting for analysis a subpopulation whose expected outcomes oscillate in discrete steps between the minimum and the maximum of the expected outcomes of all subpopulations as a function of the score. The scores are ğ‘†ğ‘—=(ğ‘—âˆ’0.5)/ğ‘š)â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾âˆš for ğ‘—=1, 2, ..., m, thus less concentrated near 0 than near 1. For the indices ğ‘–1, ğ‘–2, ..., ğ‘–ğ‘› of the subpopulation, we generate a random permutation of the integers 1, 2, ..., m, retain the first n, and then sort them. The total number of scores considered is ğ‘š= 50,000, and the number of subpopulation indices is ğ‘›= 2500.

For the fourth example, corresponding to Figs. 7 and 8, we consider weighted samples (whereas the three previous examples all used unweighted or uniformly weighted data, in which all weights would be equal). We start by constructing the full population as a mixture of subpopulations whose probabilities of success oscillate between 0 and 0.2, and with the subpopulation being analyzed selected uniformly at random such that the probability of success for each observation is 0. The scores are ğ‘†ğ‘—=(ğ‘—âˆ’0.5)/ğ‘š for ğ‘—=1, 2, ..., m, hence equispaced between 0 and 1. The total number of scores considered is ğ‘š= 50,000, and the number of subpopulation indices is ğ‘›= 2500. All observations just mentioned we weight equally with weight 1, and then introduce three outliers near the score 0.75: one being an observation from the subpopulation, altering its probability of success to 1 and its weight to 0.02n, and the other two being the two members from the full population not belonging to the subpopulation whose scores are adjacent to the score for the observation from the subpopulation, setting the probabilities of success for these two members to 0 and 1, both with the same weight 0.002m.

The captions of the figures comment on the numerical results displayed.

Remark 6
If (as in Figs. 7 and 8) the weight ğ‘Šğ‘– for some single observation is extraordinarily disproportionately high, then any bin containing that observation will be strongly biased toward only that individual observation, blind to the other observations in the bin. Such a phenomenon can lead to misleading behavior akin to Simpsonâ€™s Paradox of [9] in the canonical binned reliability diagrams; for instance, the subpopulation may very well attain results ğ‘…ğ‘–1, ğ‘…ğ‘–2, ..., ğ‘…ğ‘–ğ‘› that are less than all others in the full population except for the one disproportionately heavily weighted one, yet if the results ğ‘…ğ‘–1, ğ‘…ğ‘–2, ..., ğ‘…ğ‘–ğ‘› for the subpopulation are greater than the result ğ‘…ğ‘– corresponding to the one disproportionately large weight ğ‘Šğ‘–, then any bin in reliability diagrams containing that heavily weighted observation will show that the subpopulation attains greater results than the weighted average in the full population. In contrast, a single heavily weighted observation affects only one subpopulation observation in the plots of cumulative differences, merely introducing a jump in the constant offset at the score corresponding to the one observation (and the jump will be disproportionately large only in proportion to the weight of the corresponding observation from the subpopulation). Figure 7 illustrates related behavior, and Fig. 22 below exhibits similar behavior for the data from the U.S. Census Bureau analyzed there. Comparing the subpopulation against the full population via cumulative differences is thus similar to subtracting off baseline rates for calibration (that is, similar to â€œde-trendingâ€).

ImageNet
This subsection analyzes the standard training data set â€œImageNet-1000â€ of [10]. Each of the thousand labeled classes in the data set forms a natural subpopulation to consider; each class considered consists of ğ‘›= 1300 images of a particular noun (such as a â€œsidewinder/horned rattlesnake,â€ a â€œnight snake,â€ or an â€œEskimo Dog or Huskyâ€). Some classes in the data set contain fewer than 1300 images, so that the total number of members of the data set is ğ‘š= 1,281,167, but each subpopulation we analyze below corresponds to a class with 1300 images. The particular classes reported below are cherry-picked to illustrate a variety of problems that can afflict the classical reliability diagrams; not all classes exhibit such problems, nor are these all the classes that exhibit problems (many, many others have similar issues). The images are unweighted (or, equivalently, uniformly weighted), not requiring the methods of section "Weighted sampling" above. To generate the corresponding figures, we calculate the scores ğ‘†1, ğ‘†2, ..., ğ‘†ğ‘š using the pretrained ResNet18 classifier of [11] from the computer-vision module, â€œtorchvision,â€ in the PyTorch software library of [12]; the score for an image can be either {1} the probability assigned by the classifier to the class predicted to be most likely or {2} the corresponding negative log-likelihood (that is, the negative of the natural logarithm of the probability), with the scores randomly perturbed by about one part in 108 to guarantee their uniqueness. For ğ‘–=1, 2, ..., m, the result ğ‘…ğ‘– corresponding to a score ğ‘†ğ‘– is ğ‘…ğ‘–=1 when the class predicted to be most likely is the correct class, and ğ‘…ğ‘–=0 otherwise. The figures below omit display of reliability diagrams whose bins are equispaced with respect to the scores in the typical case that these reliability diagrams are so noisy as to be useless (the figures do display the diagrams when they are not too noisy). Figures 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, and 19 present several examples, listing in the captions the associated names of the classes for the subpopulations. Figure 20 illustrates the utility of the zooming proposed in Remark 3 above. In all figures, the plots of cumulative differences depict all observed phenomena clearly.

Fig. 9
figure 9
Eskimo Dog or Husky, with scores (ğ‘†1, ğ‘†2, ..., ğ‘†ğ‘š) being the negative log-likelihoods; ğ‘›= 1300; Kuiperâ€™s statistic is 0.08082/ğœ=6.363, Kolmogorovâ€™s and Smirnovâ€™s is 0.08082/ğœ=6.363. None of the reliability diagrams is able to smooth away the irrelevant variations while simultaneously capturing the severe deviation at the lowest negative log-likelihoods. The scalar summary statistics very successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 10
figure 10
Eskimo Dog or Husky, with scores being the probabilities; ğ‘›= 1300; Kuiperâ€™s statistic is 0.08082/ğœ=6.363, Kolmogorovâ€™s and Smirnovâ€™s is 0.06959/ğœ=5.478. As in Fig. 9, none of the reliability diagrams with the same number of subpopulation scores per bin is able to smooth away the irrelevant variations while simultaneously capturing the severe deviation at the highest probabilities (however, the reliability diagram with 10 bins that are equispaced in probabilities captures everything nicely). The scalar summary statistics very successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 11
figure 11
Night snake (Hypsiglena torquata), with scores being the negative log-likelihoods; ğ‘›= 1300; Kuiperâ€™s statistic is 0.1365/ğœ=11.35, Kolmogorovâ€™s and Smirnovâ€™s is 0.1365/ğœ=11.35. Bins equispaced across either the subpopulationâ€™s observations or the scores (where the scores are negative log-likelihoods in this figure) cannot resolve the severe deviations at low scores without being overly noisy elsewhere. The scalar summary statistics extremely successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 12
figure 12
Night snake (Hypsiglena torquata), with scores being the probabilities; ğ‘›= 1300; Kuiperâ€™s statistic is 0.1365/ğœ=11.35, Kolmogorovâ€™s and Smirnovâ€™s is 0.1353/ğœ=11.24. As in Figure 11, uniform resolution in the binned plots (whether with respect to observations or to scores) is insufficient. The scalar summary statistics extremely successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 13
figure 13
Sunglasses, with scores being the probabilities; ğ‘›= 1300; Kuiperâ€™s statistic is 0.03597/ğœ=2.935, Kolmogorovâ€™s and Smirnovâ€™s is 0.03365/ğœ=2.745. The reliability diagrams with only 10 or 30 bins each fail to resolve the very high deviation for probabilities greater than 0.9 (unlike the diagram with 50 bins)â€”the smaller numbers of bins average away interesting behavior, without warning. The scalar summary statistics detect some statistically significant deviation, yet both are blind to the serious deviation for the highest scores that the plot of cumulative differences displays prominently; the steep drop at the highest scores in the cumulative plot has little to no effect on the Kolmogorov-Smirnov or Kuiper metrics, unfortunately

Full size image
Fig. 14
figure 14
Wild boar (Sus scrofa), with scores being the probabilities; ğ‘›= 1300; Kuiperâ€™s statistic is 0.07244/ğœ=6.688, Kolmogorovâ€™s and Smirnovâ€™s is 0.07149/ğœ=6.600. The behavior in the present figure at the highest probabilities is similar to that in Fig. 13â€”the reliability diagrams with only 10 or 30 bins each underplay the very high deviation for the highest probabilities, smoothing away big deviation without warning. As in Fig. 13, the scalar summary statistics detect statistically significant deviation, while both are blind to the significant deviation for the highest scores that the plot of cumulative differences highlights; the steep drop at the highest scores in the cumulative plot has essentially no impact on the Kolmogorov-Smirnov or Kuiper metrics, unfortunately

Full size image
Fig. 15
figure 15
Cheetah (Acinonyx jubatus), with scores being the negative log-likelihoods; ğ‘›= 1300; Kuiperâ€™s statistic is 0.02520/ğœ=4.043, Kolmogorovâ€™s and Smirnovâ€™s is 0.02520/ğœ=4.043. Only the reliability diagram with 50 bins detects the high deviation for negative log-likelihoods greater than 1.25; the diagrams with only 10 or 30 bins give no indication of the substantial deviation. 30 bins or less are clearly insufficient to resolve the significant deviation, but that is clear only upon comparison with the cumulative plot or with diagrams having many bins. The scalar summary statistics indicate statistically significant deviation of the subpopulation from the full population, in accord with the plot of cumulative differences

Full size image
Fig. 16
figure 16
Monarch (or milkweed) butterfly (Danaus plexippus), with scores being the negative log-likelihoods; ğ‘›= 1300; Kuiperâ€™s statistic is 0.01144/ğœ=2.856, Kolmogorovâ€™s and Smirnovâ€™s is 0.01144/ğœ=2.856. The deviation of the subpopulation below the full population that occurs for scores greater than 1.5 is apparent only in the cumulative plot or in the (very noisy) reliability diagrams whose bins are roughly equispaced along the scores. The scalar summary statistics detect somewhat significant deviation, but not as much as would be possible if the Kolmogorov-Smirnov and Kuiper metrics were to take fully into account the steep drop that occurs in the plot of cumulative differences

Full size image
Fig. 17
figure 17
Monarch (or milkweed) butterfly (Danaus plexippus), with scores being the probabilities; ğ‘›= 1300; Kuiperâ€™s statistic is 0.01144/ğœ=2.857, Kolmogorovâ€™s and Smirnovâ€™s is 0.009057/ğœ=2.261. Much like in Fig. 16, the deviation of the subpopulation below the full population that occurs for probabilities less than 0.1 is apparent only in the cumulative plot or in the very noisy reliability diagrams whose bins are roughly equispaced along the probabilities. The scalar summary statistics again detect somewhat significant deviation, though not as much as if the Kolmogorov-Smirnov and Kuiper metrics could better account for the steep drop that happens in the plot of cumulative differences

Full size image
Fig. 18
figure 18
Sidewinder/horned rattlesnake (Crotalus cerastes), with scores being the negative log-likelihoods; ğ‘›= 1300; Kuiperâ€™s statistic is 0.1343/ğœ=10.47, Kolmogorovâ€™s and Smirnovâ€™s is 0.1343/ğœ=10.47. The reliability diagrams whose bins each contain roughly the same number of subpopulation scores are either noisier or missing the severest deviations in comparison with the other reliability diagrams; so there do exist cases in which choosing bins that are nearly equispaced along the scores works better than choosing bins that each contain roughly the same number of subpopulation scores. The scalar summary statistics extremely successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 19
figure 19
Sidewinder/horned rattlesnake (Crotalus cerastes), with scores being the probabilities; ğ‘›= 1300; Kuiperâ€™s statistic is 0.1343/ğœ=10.47, Kolmogorovâ€™s and Smirnovâ€™s is 0.1340/ğœ=10.45. As in Figure 18, the reliability diagrams whose bins each contain roughly the same number of subpopulation scores either miss the severest deviations or are noisier compared to the other reliability diagrams for this example; so sometimes choosing bins that are approximately equispaced along the scores works better than choosing bins that each contain a similar number of subpopulation scores. The scalar summary statistics extremely successfully detect the statistically highly significant deviation of the subpopulation from the full population

Full size image
Fig. 20
figure 20
Zooming in on the origin of some examples in which the scores are the negative log-likelihoods; the uppermost plots are for the Eskimo Dog or Husky of Fig. 9, the middlemost plots are for the night snake (Hypsiglena torquata) of Fig. 11, and the lowermost plots are for the sidewinder/horned rattlesnake (Crotalus cerastes) of Fig. 18; each plot on the right zooms in on the origin of the plot to its left, adjusting the height of the triangle at the origin, the number n of observations, and the Kuiper and Kolmogorov-Smirnov statistics to reflect the smaller range of scores on the horizontal axis

Full size image
American Community Survey of the U.S. Census Bureau
This subsection analyzes the latest (year 2019) microdata from the American Community Survey of the U.S. Census Bureau;Footnote4 specifically, we consider the full population to be the members from all counties in California put together, and consider the subpopulation to be the observations from an individual county. The sampling in this survey is weighted; we retain only those members whose weights (â€œWGTPâ€ in the microdata) are nonzero, and discard any member whose household personal income (â€œHINCPâ€) is zero or for which the adjustment factor to income (â€œADJINCâ€) is reported as missing. For the scores, we use the logarithm to base 10 of the adjusted household personal income (the adjusted income is â€œHINCPâ€ times â€œADJINC,â€ divided by one million when â€œADJINCâ€ omits its decimal point in the integer-valued microdata), randomly perturbing the scores by about one part in 108 to guarantee their uniqueness. The captions on the figures specify which variables from the data set we use for the results ğ‘…1, ğ‘…2, ..., ğ‘…ğ‘š (different figures consider different variables), with ğ‘š= 134,094. Figures 21, 22, 23, 24, 24, 25, and 26 present the examples. In all figures, the cumulative plots display all significant features clearly.

Fig. 21
figure 21
San Joaquin County, reporting the number of related children in the household, with scores being log10 of the adjusted household income; ğ‘›= 2282; Kuiperâ€™s statistic is 0.2449/ğœ=9.120, Kolmogorovâ€™s and Smirnovâ€™s is 0.2429/ğœ=9.045. The lack of deviation between the subpopulation and the full population right near scores of 4.0 is difficult to discern in the reliability diagrams with 10 or 20 bins each. The reliability diagrams with around 100 bins each do display the lack of deviation near scores of 4.0, but the rest of these diagrams is really noisy. The cumulative plot nicely captures the lack of deviation near scores of 4.0. Overall, the scalar summary statistics detect highly statistically significant deviation

Full size image
Fig. 22
figure 22
Humboldt County, reporting whether no one in the household 14 or over speaks English very well, with scores being log10 of the adjusted household income; ğ‘›= 583; Kuiperâ€™s statistic is 0.1028/ğœ=6.062, Kolmogorovâ€™s and Smirnovâ€™s is 0.1028/ğœ=6.062. A single, highly weighted outlying observation from the subpopulation corrupts a bin at the highest scores in each reliability diagram. The cumulative plot includes this outlying observation, too, but displays the observation as an unmistakable steep jump in the plotted curve; the constant slope of that steep jump shows that the corresponding high deviation between the subpopulation and the full population is due to a single highly weighted observation. This single observation has no effect on the slopes in the rest of the cumulative plot, so this problematic observation corrupts only the reliability diagrams and not the plot of cumulative differencesâ€”an analogue of Simpsonâ€™s Paradox of [9] afflicts the reliability diagrams but not the cumulative plot. The scalar summary statistics report highly statistically significant deviation commensurate with all the plots, albeit slightly less due to the steep jump in the cumulative plot. These behaviors are analogous to those displayed in Fig. 7 above (see also Remark 6 above)

Full size image
Fig. 23
figure 23
Orange County, reporting whether the household has high-speed access to the internet, with scores being log10 of the adjusted household income; ğ‘›= 10,680; Kuiperâ€™s statistic is 0.02499/ğœ=6.013, Kolmogorovâ€™s and Smirnovâ€™s is 0.02484/ğœ=5.979. The severe deviation at the very lowest scores is misleadingly underestimated in the reliability diagrams with 10 or 20 bins each, even as compared to the diagrams with around 100 bins each. However, the diagrams with around 100 bins each are far too noisy for other scores. Only the plot of cumulative differences resolves the severe deviation at the lowest scores while being informative at the other scores, too. The scalar summary statistics indicate that the overall deviation is highly statistically significant

Full size image
Fig. 24
figure 24
Los Angeles County, reporting the number of people in the household, with scores being log10 of the adjusted household income; ğ‘›= 35,364; Kuiperâ€™s statistic is 0.06674/ğœ=9.605, Kolmogorovâ€™s and Smirnovâ€™s is 0.06495/ğœ=9.347. Discerning the analogue of the dip in the plot of cumulative differences at the highest scores is possible yet difficult in the reliability diagrams, while being unmistakable in the cumulative plot; the reliability diagrams with enough bins do reflect the corresponding deviation at the highest scores, but are hard to interpret without the accompanying cumulative plot. The scalar summary statistics report very highly statistically significant deviation, largely since the number of observations from this largest county in California is so large

Full size image
Fig. 25
figure 25
Napa County, reporting whether the household has access via a satellite dish to the internet, with scores being log10 of the adjusted household income; ğ‘›= 679; Kuiperâ€™s statistic is 0.02761/ğœ=2.259, Kolmogorovâ€™s and Smirnovâ€™s is 0.02695/ğœ=2.205. The intense deviation around scores of 4.6 is apparent in the reliability diagrams with 10 and 20 bins each, but the latter resolves the spike much better while being unfortunately too noisy for many other scores. The plot of cumulative differences resolves the sharp jump around scores of 4.6 without detracting from the display at other scores. The scalar summary statistics report only very mildly statistically significant deviation, unable to fully account for the high deviation around scores of 4.6

Full size image
Fig. 26
figure 26
Stanislaus County, reporting the number of related children in the household, with scores being log10 of the adjusted household income; ğ‘›= 1624; Kuiperâ€™s statistic is 0.1489/ğœ=4.500, Kolmogorovâ€™s and Smirnovâ€™s is 0.1467/ğœ=4.433. The reliability diagrams are all commensurate with each other, but that is clear only after careful comparison of them all. Making sense of the reliability diagrams in this case would seem to require generating multiple plots, with several different numbers of bins. The scalar summary statistics have little trouble detecting statistically significant deviation here

Full size image
Future outlook
This subsection suggests generalizations suitable for future research.

The present paper plots the cumulative differences between the results of a subpopulation and the results of the full population, accumulated as a function of a scalar real-valued score. If instead the scores to be accumulated are from a Euclidean or Hilbert space of more than one dimension, a natural generalization is to impose a total order on the scores via a space-filling curve such as the Peano or Hilbert curves, effectively replacing the space of more than one dimension with a one-dimensional ordering. Space-filling curves constructed via quad-trees in two-dimensional space or oct-trees in three-dimensional space can be especially efficient. Googleâ€™s S2 Geometry Library, which drives Google Maps, Foursquare, MongoDB, et al., employs a Hilbert curve.Footnote5

The present paper focuses on deviations of a subpopulation from the full population; comparing the subpopulation to the full population is always legitimate, as binning or interpolating from the scores of the full population to those of the subpopulation happens at a scale finer than the subpopulationâ€™s sampling, and there is always at least one score in the full population corresponding to each score in the subpopulation (namely, the same score). In contrast, assessing deviations between two different subpopulations that do not have an explicit pairing for each score can be problematic. Indeed, the ranges of scores for the subpopulations may not even overlapâ€”the scores for one subpopulation can all be significantly less than all the scores for another subpopulation, for instance. Binning or interpolating from one subpopulation to another can be ill-posed. And even when binning or interpolating from one subpopulation to a second subpopulation is well-posed, binning or interpolating from that second subpopulation to the first subpopulation can be ill-posedâ€”the comparison may not be reflexively well-posed. In general, a partial ordering governs the comparisonsâ€”we can always analyze deviations of any subpopulation from any larger population containing the subpopulation, but cannot always reliably analyze deviations between two different subpopulations of the same larger population. Applications demanding direct comparison between different subpopulations are currently the subject of intensive investigation, far beyond the scope of the present paper except in the special case that the different subpopulations are paired for each score. One possibility for the general case is to bin both subpopulations being compared to the same finest binning such that both subpopulations have at least one score in each bin; however, interpreting significance in this general case can be tricky. Forthcoming work will treat the special case for which no score associated with any observation from either subpopulation being compared is exactly equal to the score for any other observation from the two subpopulations.

Conclusion
Plotting the cumulative differences between the outcomes for the subpopulation and those for the full population binned to the subpopulationâ€™s scores avoids the arbitrary selection of widths for bins or smoothing kernels that the conventional reliability diagrams and calibration plots require. The plot of cumulative differences displays deviation directly as the slope of secant lines for the graph; such slope is easy to perceive independent of any irrelevant constant offset of a secant line. The graph of cumulative differences very directly enables detection and quantification of deviation between the subpopulation and full population, along with identification of the corresponding ranges of scores. The cumulative differences estimate the distribution of deviation fully nonparametrically, letting the data observations speak for themselves (or nearly for themselvesâ€”the triangle at the origin helps convey the scale of a driftless random walkâ€™s expected random fluctuations). As seen in the figures, the graph of cumulative differences automatically adapts its resolving power to the distributions of deviations and scores for the subpopulation, not imposing any artificial grid of bins or set-width smoothing kernel, unlike the traditional reliability diagrams and calibration plots. The scalar metrics of Kuiper and of Kolmogorov and Smirnov conveniently summarize the overall statistical significance of deviations displayed in the graph.

