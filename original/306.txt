The high cost of maintaining radio map is a major hurdle for wide application of WLAN fingerprint-based indoor localization. The development of mobile crowd sensing provides new possibilities, however the features of normal users such as moving freely and non -professional bring new challenges. In this paper, a radio map self-updating algorithm is proposed to resolve three key problems: the localization accuracy, determination of fingerprints need to be updated, and capture of new fingerprints. First we design the localization matrix mechanism and periodic adaptive estimate algorithm to ensure the localization accuracy. Second we propose the fingerprint integrity assessment algorithm to detect the access points changed and the periodic adaptive estimate algorithm to decide the update period for each reference point. Finally we design the active fingerprint collecting mode to update the radio map efficiently. The algorithm proposed has been deployed for real-world testing over 30 days, our studies show that it detects the network changes in indoor environment correctly in 98% cases, and automatically judges the localization accuracy in 95% cases. Meanwhile, the localization accuracy is stable and improved by over 40% even after long terms of deployment, and the overhead of user terminals is reduced over 40%.


Index
Indoor localization
Mobile crowd sensing
Radio map
Self-updating

1. Introduction
The past decade has witnessed the conceptualization and development of various indoor localization techniques (WuZheng and Xiao, 2017), including Wireless Local Area Network (WLAN), Radio Frequency Identification (RFID), and inertial sensors (INSs), etc. Among various approaches, WLAN fingerprint-based indoor localization has become one of the most attractive solutions due to the wide deployment and availability of WLAN infrastructure (Wu et al., 2017). The basic idea is based on the assumption that each indoor spatial location can be identified by a unique measurable feature named as fingerprint, and one of the most typical fingerprints is the received signal strength indicator (RSSI) from access points (APs).

Typically, fingerprint-based approach is usually conducted in two phases: an offline phase followed by an online phase. In the first offline phase, a site survey is conducted to collect the detected RSSI vectors at many reference points (RPs) of known locations to form a radio map (Wu et al., 2017; Chen and Wang, 2015). Then during the online stage, user's location is determined by matching real-time fingerprint observation against those stored in the radio map (WuZheng and Liu, 2013). A key observation of this work is that site survey is time-consuming and labor-intensive. Furthermore, as RSSI may change due to the network changes (e.g., introduction or removal of APs, etc.) and prolonged environmental changes (e.g., variations of temperature, light, humidity and weather conditions, etc.), another costly site survey may be needed to keep the fingerprints in the radio map up-to-date (Chen and Wang, 2015).

In recent years, with the continuous development of mobile phones, on-board devices and wearable devices, the mobile crowd sensing (MCS) method has gradually been developed to solve the maintenance issues of radio map (Gallagher et al., 2010; Luo et al., 2018; Lim et al., 2013; Lin et al., 2015; Li et al., 2014; Yin et al., 2015; Wu et al., 2015; Wu, 2015; Khalajmehrabadi et al., 2017; Liu et al., 2019b). In this participatory sensing way, the tedious site survey is executed by normal users, which significantly saves time, labour and cost. As shown in Fig. 1, the location area L is represented by n RPs, and 
, where Li is the Cartesian coordinates of RPi. Accordingly, the radio map of L can be described as 
, and 
 is the fingerprint of RPi, where 
 and 
 is the value of RSSI received from jth AP in RPi. Then normal users U1, ... ,Us, ... ,UN replace professionals to maintain radio map, they are assigned to walk normally and upload the fingerprints detected, the fingerprints detected from Us can be defined as 
, where 
, , 
 and t is the number of fingerprints from Us. If the fingerprints of RPs received from users are different from recorded in FR, they are recorded in FR as new fingerprints. Meanwhile users can use location based services (LBSs), the radio map return location estimation Lus by the RSSI measurements 
 from Us.

Fig. 1

Fig. 1. The indoor localization model based on MCS.

Generally, based on the way to determine Lust, the radio map updating methods based on MCS can be grossly divided into two groups: active updating methods and passive ones. The active methods (Gallagher et al., 2010; Luo et al., 2018; Lim et al., 2013; Lin et al., 2015; Li et al., 2014; Yin et al., 2015) prompt users to report Lust explicitly, however, in reality, it increases the burden on users and brings inconvenience and privacy issue, moreover feedbacks from the users are likely to carry noise (Chen and Wang, 2015). Therefore the passive methods attract much attention gradually (Wu et al., 2015; Wu, 2015; Khalajmehrabadi et al., 2017; Liu et al., 2019b), namely, implicit RSSI collection are conducted during users' daily walk, then through INSs the trajectories of users along with the collected RSSI vectors can be jointly to update radio map. However, for normal users are free to move in location area and they don't know exactly how to collect new fingerprints, new challenges have been raised.

First, it is difficult to obtain new fingerprints of each RP in real time for the spatial and temporal distribution of users is not uniform, which seriously affect the accuracy of LBSs. Second, it is difficult to track the trajectory of normal users accurately by INSs, therefore the location of new fingerprints from users Lust are not quite accurate, and it is usually hard to directly decide what parts of the radio map need modification. Finally users need to record RSSI signals and INSs data during the whole process, so there is great redundancy information in new fingerprints and the overhead on users’ devices is increased significantly.

In response, in this paper a novel passive radio map updating algorithm is proposed to achieve accurate LBSs, and the main contributions are summarized as follows.

1)
Instead of improving the real-time performance of update algorithm directly, the localization matrix mechanism and periodic adaptive estimate algorithm are proposed to ensure the localization accuracy whether the network or environment changes, then the location of users can be calculated conveniently by existing radio map and location requests from users.

2)
The fingerprint integrity assessment algorithm (FIAA) is proposed to detect the APs changed, and localization result automatic verification algorithm (LAACA) is to decide the update period for each RP.

3)
The active fingerprint collecting mode is proposed to inform normal users how to collect new fingerprints effectively and accurately.

Experimental evaluation of our methods using Android phones shows that it detects network changes in indoor environment correctly in 98% cases, and automatically judges the localization accuracy in 95% cases. Meanwhile the localization accuracy is stable and improved by over 40% even after long terms of deployment, and the overhead of user terminals is reduced over 40%.

The remainder of this paper is organized as follows: Section II briefly summarizes previous works. Section III analyses the system architecture. Section IV analyzes how to update radio map when network changes. Section V discusses how to update radio map when environment changes. Section VI shows the experimental results and a performance evaluation of our methods. Finally, Section VII concludes this work.

2. Related work
2.1. Online localization algorithms
In WLAN fingerprint-based technique, the location of users is estimated by online localization algorithms.

Formally, in the online phase, a user Us uploads the online RSSI measurements 
 to radio map and request his location Lus.

During the online stage, the goal is to find the user's location 
. In summary, online localization algorithms are classified as deterministic and probabilistic algorithms. In deterministic algorithms, it is assumed that the received RSSI is a deterministic specification of the signal while in probabilistic algorithms the RSSI measurement is considered as a radon process. Considering the issues that might arise by complex computations the former are better fit for the mobile computing. In deterministic approaches such as the nearest neighborhood (NN) algorithm widely used (Khalajmehrabadi et al., 2017), the general form of localization results are achieved through selecting RPs whose fingerprints are the closest to online RSSI measurements as(1)
where d(Rus,Ri) defines a distance metric, and Euclidean distance is a typical distance metric, which can be defined as (Wu et al., 2015; Wu, 2015)(2)

Note that the dimension q detected between rusj and rij is not always consistent, and the usual way to do that in practice is the RSSI from AP only existing in one set is set to a minimum in another. In addition, K nearest neighborhood (KNN) and weighted KNN approach (WKNN) are proposed, and the localization results are usually the centroid of a set of K RPs with the least distances.

2.2. The characteristics of RSSI
The huge market demand of LBSs promotes research for the characteristics of RSSI in indoor environments, and many researches present some useful characteristics.

Firstly, researches (Liu et al., 2018, 2019a, 2019b; Lashkari et al., 2018; Piao et al., 2019) show that in modern buildings more and more APs can be detected due to wide use of WLAN, but not all APs provide valuable information. To ensure coverage of APs, in (Liu et al., 2018, 2019a, 2019b) the RSSIs of 6 APs in a RP with the highest values are recorded in radio map, and are listed in descending order 
. Considering a AP can't cover all RPs, once a AP is recorded from a RP, the RSSIs of this AP from all the RPs are needed recording in radio map, then 
, where k is the number of APs after eliminate duplicates from the APs set in all RPs.

Secondly, researches (Liu et al., 2019a, 2019b; Gallagher et al., 2010; Lashkari et al., 2018; Piao et al., 2019) show that compared with instant RSSI measurements, the average values of RSSIs recorded in stationary stage are rather accurate and objective in reflecting the features of a RP, and can improve the location errors caused by transient environment changes and weak APs interference.

Finally researches (Liu et al., 2019a, 2019b; Lashkari et al., 2018; Piao et al., 2019) show that RSSIs received from different APs in a RP are independent, irrelevant and don't interfere with each other.

2.3. The radio map updating algorithm based on MCS
MCS is a new sensing paradigm that takes advantage of use of phones that collect data efficiently (Abualsaud et al., 2018). Recently several researchers are motivated to maintain the radio map via MCS (Gallagher et al., 2010; Luo et al., 2018; Lim et al., 2013; Lin et al., 2015; Li et al., 2014; Yin et al., 2015; Wu et al., 2015; Wu, 2015; Khalajmehrabadi et al., 2017; Liu et al., 2019b). Focus on three key problems: the localization accuracy, determination of fingerprints need to be updated, and capture of new fingerprints, they have done a lot of conducive works, however they still have some limitations.

Firstly, a key observation is that whether the radio map is updated in time directly impacts the indoor LBSs accuracy. However in existing methods, due to the randomness features of users' activity there is no way to ensure the real-time performance. Based on the observations in (Liu et al., 2019a, 2019b; Gallagher et al., 2010; Wu et al., 2015), the changes affected location estimation indoor can be categorized into two main kinds: prolonged environmental and network changes. In response to prolonged environmental changes, existing methods (Yin et al., 2015; Wu et al., 2015; Wu, 2015; Khalajmehrabadi et al., 2017) update the fingerprint of a RP once a user reach this RP and upload the latest RSSI detected, however it is difficult to accurately determine whether users arrive or not a RP. On the other hand, the score and pending mechanisms are proposed in (Gallagher et al., 2010; Luo et al., 2018; Lim et al., 2013; Lin et al., 2015; Li et al., 2014) to detect network changes, but they further reduce the real-time performance due to the device and measurement noises. Our early work (Liu et al., 2019a) propose how to monitor environmental and network changes in real time, but it is for room localization and can't be applied directly to more accurate LBSs such as locating users to RPs.

Secondly, existing methods (Wu et al., 2015; Wu, 2015; Khalajmehrabadi et al., 2017) use regression or machine learning algorithms to model the relationship between signal fluctuation and distance in different RPs, and decide what parts of the radio map need modification, such as Gaussian process and decision tree. However, the complexity of offline training and online localization is relatively high. Our early works (Liu et al., 2019a, 2019b) make a preliminary study on these issues and have some improvements, but the RPs need to be distributed uniformly and the accuracy of location needs to be improved.

Finally, in existing passive methods, the location of new fingerprints provided by users are determined by pedestrian dead reckoning (Yin et al., 2015; Wu et al., 2015; Wu, 2015). However, due to measurement noises and accumulative errors in INSs, in practice it is difficult to track the trajectory of users accurately and determine whether users arrive or not a RP, which means new fingerprints of RPs from users are not quite accurate. Meanwhile users are informed to detect and record the RSSI and INSs vectors during the whole process (Yin et al., 2015; Wu et al., 2015; Wu, 2015), so the overhead imposed on their devices is quite high. Moreover researches (Liu et al., 2019a, 2019b; Gallagher et al., 2010) show that the spatial and temporal distribution of users is not uniform, and roughly follows power-law distribution, therefore the fingerprints provided by users are full of redundant information.

3. System architecture
Based on the above analysis, the network changes and prolonged environmental changes are the major factors that affected location estimation. In this paper two methods are proposed in response to indoor network and environment changes respectively.

First, for one of the RSSI vectors from rusj or rij will change, the distance metric d(Rus,Ri) calculated from (2) may increase significantly, and the impact affected by network changes is immediate and direct. As shown in Fig. 2, the locate matrix mechanism is proposed to realize the RSSI vectors automatic calibration between Ri and Rus, and ensure the location accuracy when network changes. Then once the locate matrix mechanism returns a location estimation Lus, the APs changed are determined by FIAA, and the radio map is updated by the active fingerprint collecting mode simply and effectively.

Fig. 2

Fig. 2. The radio map update process for net changes.

Second, the impact affected by environmental changes is a cyclical, slowly ramp. Therefore as shown in Fig. 3, the LAACA is proposed to verify the accuracy of localization estimation automatically. On this basis, the renewal period in each RP is determined by the periodic adaptive estimate algorithm proposed. Then in the renewal period of a RP, the RSSI values from latest localization request located in this RP is used as its new fingerprints, and if there exist no localization request in some RPs, the active fingerprint collecting mode is activated to obtain their new fingerprints.

Fig. 3

Fig. 3. The radio map update process for prolonged environmental changes in a RP.

In conclusion the traditional radio map is converted to locate matrix, each column corresponds to the fingerprint of a RP and its renewal period is calculated by the periodic adaptive estimate algorithm. During the online stage, once a user requests his location and receives a location estimate by the locate matrix mechanism, then if the network changes, the APs changed are detected by FIAA and updated by the active fingerprint collecting mode. Besides in response to prolonged environmental changes, in the renewal period of a RP, the latest request Rus located in this RP is used as its new fingerprints, otherwise the active fingerprint collecting mode is activated to obtain their new fingerprints.

4. The radio map update operations for network changes
In this section, the locate matrix mechanism, FIAA and active fingerprint collecting mode for network changes will be described in detail.

4.1. The locate matrix mechanism
In this subsection, we propose the locate matrix mechanism to replace traditional radio map. The specific process is as follows:

The primary aim is to establish radio map matrix expression. The radio map matrix Rm is the matrix representation of Ri in radio map FR, and defining the fingerprints of all RPs as its column vectors.(3)
 

As show in (3) above, where Ri is the RSSI values of RPi, and 
 is the value of RSSIs received from mth AP in RPi.

Then during the localization stage, when the server side receives the RSSI measurement Rs and needs to return the location estimation, it performs the following steps:

1)
Matrix expression. First the RSSI measurement Rusa is listed in descending order 
, then top k’ APs with the highest RSSI values are collected to ensure we can select at least 6 row vectors from radio map matrix Rm to build radio map matrix Rm’. Formally,

(4)
 
where Ri’ is the fingerprints of RPi from top k’ APs, and 
.
2)
Locate request matrix expression. According to top y APs the RSSI measurement RuSa is expressed by a matrix Rusa’. Formally, 
 
 
 
 
 (5)

Where Rsa’ is a n∗6 matrix, and n is the number of RPs.
3)
Initialization locate matrix. The locate matrix is defined and initialized as 
.

4)
The absolute value programming of locate matrix. Then we compute the absolute value of each element in locate matrix abs(RL).

5)
2-value programming of locate matrix. The threshold δ and binary processing are adopted to process locate matrix 2bw(abs(RL),δ). Formally,

(6)
 
where. 
 
 
 
6)
Generalize the summation for column vectors. Handle each column element and define  to compute their sums as output. Formally,

(7)
Then the column head with max sum is calculated and its corresponding coordinate of RPsi is returned to user as his current location Lus.

Compared with traditional algorithms, the locate matrix mechanism realizes the automatic calibration between users and radio map in the dimension of RSSI vectors, and improve the localization accuracy when network changes.

4.2. The fingerprint integrity assessment algorithm
In this subsection, the FIAA is proposed to monitor when the network changes. And the main idea is comparing and contrasting the RSSI vectors dimension of common APs received in users and recorded in radio map.

Formally, when the user sends 
 and requests his location, the serve side returns the Lsi by the locate matrix mechanism, and 
 is the fingerprint recorded in radio map, namely the APs set detected by user is , recorded in radio map is , note that the RSSI values in Rsa and Rsi are listed in descending order.

Considering the RSSI values from a user may not be accurate, then the network changes can be checked by following criteria:

1)
We define an undetermined data set Ru, and initialize a counter Count(uj) for all the APs in Ru. Formally 
, .

2)
, if , then rj is moved to Ru and .

3)
, If , then aj is added to Ru, and .

4)
Note that all the APs in Ru can not be used to build radio map matrix Rm’. When the 
, the APuj is judged to be removed, and when the 
, the APuj is judged to deployed.

4.3. The active fingerprint collecting mode
As above, when some APs are judged to be removed, we just delete the corresponding rows in the matrix Rm. Besides when a new AP deployed is detected, the active fingerprint collecting mode will be activated.

Specifically, the active fingerprint collecting mode is built around two principles: First the average values of RSSIs used to update radio map will provide the more accurate indoor location-based services. Second the locate matrix mechanism ensures the localization accuracy even network changes. The specific process is as follows.

First we detect the mobility of users' devices by algorithm in (Wu, 2015), this algorithm recognizes the users' motion status according to the acceleration data as long as they simply carry a mobile phone, and using only the 5 Hz acceleration sampling frequency and a 3-s window. In users’ side when they keep stationary more than 10 s, the active fingerprint collecting mode will be activated and the corresponding RSSI values are recorded. Second at this point the coordinates of these users can be calculated accurately by the locate matrix mechanism. Then the RSSI values and the corresponding location are uploaded to the radio map. Finally the average of all the RSSI values received in a RP from the AP changed are added to radio map as new fingerprints, and the active fingerprint collecting mode will be closed.

In conclusion, the main contributions of radio map update operations when network changes are as follows.

1)
The locate matrix mechanism ensures the localization accuracy even network changes, and calculates the location of new fingerprints conveniently.

2)
The FIAA is simple and monitors network changes accurately and reliably.

3)
The active fingerprint collecting mode simplifies the update operations and enhances the applicability.

5. The radio map update operations for environmental changes
Basing on analyses above, the localization accuracy in a RP will be reduced over time if prolonged environmental changes are not treated in a timely and appropriate manner. In this section, our design emphasis is to solve two problems.

1)
When the fingerprint of a RP in the radio map need to be updated.

2)
How to obtain new fingerprints of a RP timely and effectively.

5.1. The localization result automatic verification algorithm
As described above, due to environmental changes the RSSI fingerprint in a RP presents periodic change characteristics. Therefore the primary task is determine the renewal period.

Considering in a period the localization result is always correct and over a period the opposite is true. One important key to determine the renewal period is verify the accuracy of localization result accurately and effectively.

Based on principle that the neighbours of new fingerprints captured should be consistent with those calculated according to radio map, the LAACA is proposed to verify the accuracy of localization result automatically, as described next.

1)
When the server receives a new RSSI values Rs and needs to verify the accuracy of localization result Lsi, it activates the LAACA.

2)
In users sides the localization result Lsi is defined as anchor node. When some uses in stationary are located in this anchor node, the gyroscope and accelerometer in their mobile are activated to detect the RSSI values of its neighbours.

3)
Then the footstep counting is calculated from the acceleration and gyroscope reading data embedded in their mobile. In this paper, we adopt a simple algorithm proposed in (Anshul et al., 2012), which calculated step counting with 97 percent accuracy. The rationality is that the peaks of the sampling data curve presents periodic change characteristics, and the process procedure is introduced as Fig. 4.

Fig. 4
Fig. 4. The process procedure of footstep counting.

In the footstep counting algorithm, the parameter η is defined to limit users will move to the adjacent RPs. Lots of researches have calculated the normal human footstep is about 0.5m–1.2 m (Gallagher et al., 2010; Luo et al., 2018), here we chose lower limit values 0.5 to ensure users are out of anchor node, suppose the coverage of RP is a and the distance of two adjacent is b, then the value of the parameter η is determined as follows.(8)
 
 

4)
The next task is to monitor relative direction of users' motion by magnetometer. Due to the disturbance of field magnetic it is difficult to identify direction of users' motion remarkably accurate, here we transform the research strategy into normalize the direction and limit it to four directions (north, south, east, or west). The rationality is that in the northern hemisphere when users turn around the value from magnetometer in X-axis is almost the same and the values in Y-axis and Z-axis change regularly. Then we divide the magnetic values into corresponding ranges according to the direction, and the process procedure are introduced in Table 1.


Table 1. The direction normalization DETAILS (mgauss).

Travel Direction	Value in X-axis	Value in Y-axis	Value in Z-axis
North (↑)	+400	<-150	−50–50
East (→)	+400	−50–50	>150
South (↓)	+400	>150	−50–50
West (←)	+400	−50–50	<-150
5)
Then a simple clustering algorithm is proposed to get the RSSI vectors in the same RP together in a cluster.

First, in users’ side the RSSI vectors from k APs are recorded and uploaded to the server. Formally, the fingerprints from a user us are represented as 
. Note that if some APs in Rus cannot be detected, the RSSI vectors of them are set to −90 dBm.

Second, when the server receives the number of valid RSSI vectors from a AP in the same direction exceeds a threshold ε2, the average value of them is recorded in radio map. Otherwise it is set to −90 dBm.

6)
Now Rus is expanded to include the attributes of its adjacent regions. Formally we define a new fingerprint as 
, where 
 are the fingerprints of its adjacent regions in north, south, east, and west directions respectively.

7)
Finally we check the localization result for accuracy. First we check the valid RSSI vectors in Rus' are consistent with the fingerprints around Rsi in radio map, if so the next step is proceeded, otherwise the localization result is judged as incorrect.

Then considering the RSSI fingerprints Rus' are recorded in motion status, and are lacking in accuracy, the Spearman's rank correlation is introduced to get the similarity between Rus' and the fingerprints around Rsi in radio map.

Assuming that 
 and rv is corresponding fingerprint in radio map, and the number of valid RSSI vectors in rv and ru is w. Then the fingerprint sequences in rv and ru are listed in ascending order and the corresponding hierarchical ranks are described as
and 
. Then the Spearman's rank correlation 
 can be calculated as(9)
 
 
 
 
 

If the absolute value of 
 exceeds a threshold ε3, the localization result is judged as correct, otherwise it is incorrect.

In summary, the proposed LAACA has following advantages.

1)
The accumulated errors in INSs are reduced significantly by counting footstep in small-scale and normalizing the direction.

2)
The localization result is verified efficiently and automatically, by introducing the Spearman's rank correlation to qualitative analysis data in expanding fingerprints.

5.2. The periodic adaptive estimate algorithm
Then the periodic adaptive estimate algorithm is proposed to determinate the renewal period in each RP, and the specific study content is as follows.

1)
First the lower and upper bounds of renewal periodic in a RP are defined as TLi and TUi.

2)
Second, we see whether there are some LBSs in the RPi between TLi and TUi.

3)
Third, we check whether the latest localization result at t0 time in RPi is correct by the localization accuracy automatic check algorithm described above. If it's correct the lower bounds of renewal periodic TLi = t0, meanwhile the upper bounds of renewal periodic is increased as TUi++, and we will repeat the process above until TLi = TUi. Otherwise, TUi = t0, and we try to find the latest correct localization result at time t1, then the TLi = TUi = t1.

4)
Note that if in a RP there never exists any localization results, we define TLi = TUi = T, T is usually set to the minimum value of all known RPs.

5.3. The radio map update process
By above methods, the renewal periodic in each RP is determined, then the radio map update process is designed as follows.

Specifically, assuming the renewal periodic of RPi is Ti, then the new fingerprint in RPi can be calculated as following.

1)
If there exist some localization requests are located in RPi before its clock hands pointing to Ti, in radio map the RSSI vector from localization requests nearest to Ti is added as the new fingerprint in RPi.

2)
If there exist no localization request is located in RPi when its clock hands pointing to Ti, at this point the active fingerprint collecting mode is activated and the average of all the RSSI values received in a RP is added as new fingerprint.

In conclusion, the main contributions of radio map update operations when environmental changes are as follows.

1)
The LAACA verifies the accuracy of localization result automatically and effectively.

2)
The periodic adaptive estimate algorithm determines the renewal period in each RP automatically.

3)
The active fingerprint collecting mode updates the fingerprint of each RP at most once in a renewal period, and the determination of new fingerprints is simply and accurately.

6. Experiment results
In this section, our methods are deployed in the popular Android OS devices and extensive experiments are conducted on the second floor of a recently constructed shopping mall. First we introduce the experiments and parameters settings, then present the detailed evaluations.

6.1. Experimental methodology
We conduct experiments on the second floor of a commercial building covering construction area more than 3938 m2, and building area almost 2382 m2. Unit sizes of the shops range between 31 m2 and 147 m2 (see in Fig. 5). Specifically, the experimental areas contain many corridors and rooms, including clothing, shoe and cosmetics stores. In the environments there are up to 50 APs with 802.11b WLAN infrastructure in total, besides we chose two representative subareas A and B throughout the entire experimental period, and survey these test beds with a sampling grids density of about 1 m × 1 m, Further details about these two regions and the data collection are as shown in Table 2.

Fig. 5
Fig. 5. Layout of TB.


Table 2. Test bed details.

Areas	Size(m2)	AP deployed	RP numbers
Region A	664	8	629
Region B	628	8	598
During the experiments we recruit 120 volunteers for a month, including 4 research team members, 16 staff members, and 100 customers. Besides, in one experiment, research team members are ordered to take on the task of instructors and replacements, and account for no more than 10 percent. Then we implement the motion detection, orientation reckoning and step counting algorithms proposed on their own mobile phones using Android OS V7.0 or above (such as Redmi Note 9 Pro, OPPO Reno 5, etc.) for research team members and staff members, and provide testing mobile phones for customers. Meanwhile the radio map is constructed using MySQL, and a web server is designed to receive RSSI information and provide LBSs.

To extensively evaluate the performance of our methods, we additionally implement three typical types approaches for comparison, which have been proposed in (Yin et al., 2015), (Wu et al., 2015, 2017) and (Liu et al., 2019b). As an active updating approach, in (Yin et al., 2015) the radio map is updated by the score and pending mechanism defined in (Gallagher et al., 2010), which users can choose to accept or reject the location estimation, or suggest an alternative location based on their knowledge of the surroundings, it is more susceptible to the disturbances of the APs with weak signal strengths, and provides more simple and accurately LBSs. On the other hand, as a popular passive updating approach (Wu et al., 2015), propose AcMu, an automatic and continuous radio map updating service, and monitors moving trajectories of users using inertial sensors to update the fingerprints of RPs. Further optimization is carried out in (Wu et al., 2017), Once an enough amount of RPS, attached with estimated locations, are gathered, a map updating procedure by fingerprint spatial gradient is triggered to adapt the current radio map. Compared with other approaches, they are more effective in the feasibility and accuracy. Meanwhile in our early work (Liu et al., 2019b), a fuzzy map mechanism is proposed to monitor network changes, and on this basis a decision method of neighbours’ fingerprints is proposed to response environmental changes.

Here, we examine our methods in detail as follows.

1)
Some parameters need to be tested: a) The threshold δ in 2-value programming of locate matrix, and b) the parameters ε2 and ε3 in the clustering algorithm of RSSI fingerprints in the same RPs.

2)
The locate matrix mechanism need to be check whether can ensure the localization accuracy even network changes.

3)
The FIAA need to be check whether can monitor the network environment changes accurately in real time.

4)
The LAACA need to be check whether can verify the localization accuracy effectively.

5)
The active fingerprint collecting mode need to be check whether can reduce the workload in users' side.

6.2. Parameter optimization
In the 2-value programming of locate matrix, the optimal solution of threshold δ need be calculated to achieve the best localization results. In our test (see in Fig. 6), the value range of threshold δ allowed is 0 to 16 dBm, we can see that the average location error continues to decrease when δ is increased from 0 to 10 dBm, for the redundant information of some RPs is filtered effectively. Meanwhile the average location error continues to increase when we continues to increase δ when the value of δ exceeds 10 dBm, for parts of the RPs are missed, which are useful to localization results. In conclusion, the location accuracy can achieve optimal results when we set δ from 8 to 10 dBm, as appropriate. We repeat the experiments in different test environments, and results show the same findings. Further analysis shows the main cause is the values of RSSI in a RP fluctuate in a certain range (4-10dBm).

Fig. 6
Fig. 6. The average location error vs. threshold of ε1.

In the clustering algorithm of RSSI fingerprints in the same RPs, Fig. 7 has shown that when the number of valid RSSI vectors from a AP in the same direction exceeds 6 the improvement of clustering accuracy is limited even though the value continues to increase. And this discovery is consistent with the computer simulations results in (Lashkari et al., 2018).

Fig. 7
Fig. 7. The clustering accuracy vs. threshold of ε2.

6.3. Performance of the locate matrix mechanism
In this subsection, we test the performance of locate matrix mechanism proposed from two aspects: the accuracy and robustness of location.

For this, in region A we first randomly select 10 RPs and recruit 10 participants, the participants are instructed to move to these RPs and request LBSs every half an hour. Meanwhile these participants always suggest positive feedback whenever a localization result is calculated. Fig. 9 has shown that when two new APs are deployed, in the initial location stage, the locate matrix and fuzzy map mechanism can hold the average location error within a certain range, the error remains around 0.71 m steady using the locate matrix mechanism and 1.2 m using fuzzy map. Note that these 10 RPs selected are uniform distribution, if not the average location error will increase when using fuzzy map. By contrast, the average location error of ACMU in (Wu et al., 2015, 2017) is 4.4 m and approach in (Yin et al., 2015) reaches as high as 5.5 m. Moreover the minimal error of the ACMU in (Wu et al., 2015, 2017) may reach 1.3 m and approach in (Yin et al., 2015) is 1.4 m, but the convergence time respectively need about 30 rounds (15 h) and 35 rounds (17.5 h).

Fig. 9
Fig. 9. The average location error vs. different approaches when deploying new APs.

Second in region B existing two APs are removed and the tests are repeated. As illustrated in Fig. 10, the experimental shows similar results. Specifically, in the whole period of tests the average location error remains around 0.82 m steady using the locate matrix mechanism and 1.3 m using fuzzy map. By contrast the approach in (Yin et al., 2015) need about 20 times of sampling to decrease the error from 5.2 m to 1.8 m, and the minimal error may reach 1.4 m after 35 times. Besides the ACMU in (Wu et al., 2015, 2017) decrease the error from 4.1 m to 1.5 m after 20 times of sampling, and the minimal error may reach 1.4 m after about 30 times.

Fig. 10
Fig. 10. The average location error vs. different approaches when deployed APs are switched off.

Finally we test the robustness of locate matrix mechanism. In addition, the number of APs k recorded in fingerprints of RPs from region A and B is defined to 16. Then we gradually increased new APs and decreased existing APs in these two regions respectively. Then the results in Fig. 11 show that when new APs are increased, the localization accuracy in these two regions do not influence by network changes as long as the number of valid RSSI at a RP always more than 6, and more than 91% location error is less than 1 m. Moreover when decreasing existing APs, if the number of valid RSSI at a RP remains more than 6, the localization accuracy in this RP do not influence by network changes, and the localization accuracy will deteriorate significantly when the number of valid RSSI is less than 4. Considering the redundancy of APs in building the locate matrix mechanism proposed can provide satisfying LBSs.

Fig. 11
Fig. 11. The localization accuracy vs. valid RSSI values.

6.4. Performance of FIAA
In this subsection, we explore the FIAA proposed whether can monitor the network environment changes accurately in real time.

On the basis of experimental result above-mentioned (see in Fig. 12, we can see that.

1)
In region A, the FIAA can distinguish new APs deployed whenever the participants move to any one of 10 RPs rapidly and reliably.

2)
In region B the performance of recognition accuracy seems lower than in region A. Then further analyzes this phenomenon the concrete reason, we can see that when the participants move to one of 10 RPs, the FIAA can reliably distinguish existing APs closing whose valid values are recorded at this RP in radio map. Considering at the RP the AP whose RSSI information is not a valid value recorded in radio map has limited effects on location accuracy, so the results are acceptable.

Fig. 12
Fig. 12. The recognition accuracy of network changes using FIAA.

6.5. Performance of LAACA
Then we explore the LAACA proposed whether can verify the localization accuracy effectively, especially in the long-term deployment.

For this, in these two regions we total select 50 RPs and recruit 20 participants, the participants are instructed to have free activities within the scope of these RPs and request LBSs, once a localization result returned from server side, we respectively validate it by LAACA and on-site verification. These tests are started from the third day, and repeated at an interval of 3 days within one month.

As illustrated in Fig. 13, in the whole period of tests the quality of localization accuracy assessment by LAACA is high, and the accuracy rate is over 96%. Further analysis showed that the assessment accuracy of localization result in a RP is positively correlated with the number of fingerprints collected from its neighbours. That is if the participants collect enough fingerprints information the assessment accuracy of localization result using LAACA is satisfactory.

Fig. 13
Fig. 13. The assessment accuracy of localization result using LAACA.

6.6. Performance of the active fingerprint collecting mode
Then we test the active fingerprint collecting mode from two aspects: the localization accuracy and the overhead on user terminals.

First, 20 randomly distributed RPs are chosen from two regions, meanwhile 20 participants are recruited to detect fingerprints in each RP and request LBSs every three days. For a period the 1 month, as illustrated in Fig. 14, throughout the test period the average location error remains around 1 m steady. That is the active fingerprint collecting mode can update radio map in real time, especially in the long-term deployment.

Fig. 14
Fig. 14. The average location error vs. times.

Second we compare the location accuracy with algorithm in (Wu et al., 2015, 2017; Yin et al., 2015; Liu et al., 2019b). Fig. 15 shows the cumulative distribution function (CDF) by using the method proposed on the third day, and compare with algorithm in (Wu et al., 2015, 2017; Yin et al., 2015; Liu et al., 2019b), we can see that the 80th percentile accuracy is increased by over 40%, 50% and 100% separately. And Fig. 16 shows more than 40% improvement even after 30-days running.

Fig. 15
Fig. 15. CDF comparison on the third day.

Fig. 16
Fig. 16. CDF comparison on the 30th day.

Finally we use the update frequency in each RP as the indicator to test the active fingerprint collecting mode whether can reduce the workload in users’ side. As shown in Fig. 17, compared with other passive updating methods, the update frequency is reduced over 60% in (Wu et al., 2015, 2017), and 40% in (Liu et al., 2019b).

Fig. 17
Fig. 17. Comparison of the update frequency using different approaches.

7. Conclusion
On the basis of numerous research achievements, this paper does comparatively deep research on the maintenance issues of radio map and proposes a novel passive updating algorithm based on MCS. In our design the localization accuracy during update is guaranteed by the locate matrix mechanism and periodic adaptive estimate algorithm, the FIAA is designed to detect the APs changed and LAACA to decide the update period for each RP, the update mode of radio map adopts the active fingerprint collecting mode. Compared to traditional deterministic online localization algorithms, the calculation process is a little more complicated in the locate matrix mechanism, but the computational complexity is O(n) and is not increased significantly. To sum up, this algorithm achieves satisfactory localization result, and is easy to realize in mobile phones.

The radio map updating algorithms based on MCS rely on users' participation, in this paper the scope of users' activity is limited and always give positive help. In fact the characteristic of user activity indoor is complicated and it exhibits malicious activity from users, how to solve these problems effectively is the direction for future work.

