Abstract
Over the past few years, Micro Grids (MGs) have gained much popularity due to two-way communication in the power network with special emphasis on Distributed Energy Resources (DERs), which comprise of both Renewable Energy Sources (RESs) and Nonrenewable Energy Sources (NRESs). Currently, the main focus of researchers is to deal with the intermittent nature of RESs, which lead to the fluctuations in power production and dispatch. In this paper, direct energy trading among MGs is considered as an assuring solution for improving the grid stability, reducing power line losses and minimizing energy trading cost. The focus of this work is on energy transactions amongst multiple MGs within the same geographic region. In the proposed method, coalitions among MGs are made on the basis of the distance between them for energy transaction. Furthermore, an Energy Transaction Algorithm (ETA) is proposed for energy trading among MGs in the coalitions. Energy Storage System (ESS) is also integrated, which stores energy when an MG has surplus energy and utilizes the stored energy if it becomes energy deficient. Simulations are performed and the results demonstrate that energy transactions among MGs in the proposed method minimize the power line losses and energy trading cost up to 34.6% and 14%, respectively as compared to the existing method.

Previous
Next 
Keywords
Microgrid

Distributed energy management

Power line losses

Energy storage system

Energy trading

1. Introduction
Electricity has become the fundamental part of human life. Its demand is increasing exponentially due to the massive increase in population and technological advancements. The exponential increase in power demand resulted in serious environmental hazards. The engineering industries are pondering on the ways to produce and utilize energy resourcefully [24], [25]. Looking at the power consumption patterns, it is observed that at certain hours, power demand is higher than other times. These high demand hours bear the higher electricity cost and are known as On-peak timings. In contrast, Off-peak timings are the ones where electricity demand and price are lower. Hence, a day can be divided into two kinds of intervals: Off-peak and On-peak [42]. Both intervals have seasonal and geographical variations. In the summer season, On-peak intervals are observed during noon or afternoon; however, in winter or autumn seasons, these intervals are regarded as Off-peak intervals. In Conventional Grid (CG), utility companies meet the increasing electricity demand through spinning reserves or Peaking Power Plants (PPP). Moreover, the high electricity demand is met by conventional energy sources such as coal, oil, gas, etc., which are not environment-friendly and produce harmful emissions. Therefore, there is a need for some intelligent framework that can meet the increasing and varying electricity demand. Moreover, such a system also tends to eliminate the need for spinning reserves and PPP.

The concept of Smart Grid (SG) that revolutionized the power system came into view in the 20th century. SG integrates Information and Communication Technology (ICT) between the Utility Grid (UG) and end users. Also, it enables the bi-directional flow of both information and electricity between the main grid and consumers. SG has the capability to fully exploit the energy resources in the power system and eliminate the need for spinning reserves and PPP. Micro Grid (MG), which is a small scale local energy generation system, is the fundamental part of a SG. It facilitates the electricity consumers [18]. Moreover, it helps the people living in remote areas to have uninterrupted electricity access. It has two modes of operation: islanded mode and grid-connected mode. In the former mode, MG operates autonomously isolated from the main grid and facilitates the users connected to it. In the latter mode, MG and main grid are linked with each other at the Point of Common Coupling (PCC). It is the point at which the voltage of MG is equal to the voltage of the main grid. The connection of MG with the main grid is established through a Macro Station (MS), which is also known as a substation. The conventional power system requires a centralized transmission medium to transfer electricity from the generation side to the end users. In contrast, MGs are composed of Distributed Energy Resources (DERs), which are decentralized in nature. DER reduces the generation and transmission costs, and results in fewer line losses because it is located close to the serving load [19], [36]. In DER, Distributed Generation (DG) sources use Renewable Energy Sources (RESs) such as biomass, biogas, geothermal power, Photovoltaic (PV) panels and wind turbine, which fulfill 14% of the world's total energy demand [35]. Also, RESs are environment-friendly. However, they are intermittent in nature due to varying environmental conditions. In case of PV panels and wind turbines, energy generation depends upon solar irradiance and wind speed, respectively. Therefore, for the reliable operation of an MG, there is a need for connection with the main grid, which acts as a backup power source or some reliable power generation source for the MG operation [22].

In a power system, satisfying the electricity demand in an efficient manner is the basic objective. Instead of using spinning reserves or PPP to meet the electricity demand, it can be fulfilled through supply and demand-side management. In supply-side management, power can be balanced by reducing power line losses, increasing electricity generation and efficiently utilizing the energy resources. In demand-side management, power can be balanced by modifying the users' energy consumption patterns using Demand Response (DR) programs. In order to modify the energy consumption patterns, optimization techniques are utilized for appliance scheduling on the basis of the pricing signal provided by the utility company. The overall electricity bill is reduced due to scheduling. In addition, Peak to Average Ratio (PAR) is also minimized. The reduction in PAR directly benefits the utility companies by minimizing the need for spinning reserves or PPP. One of the main factors of power imbalance is power line losses, which are caused due to electricity transmission from power plants to the consumers through extensive networks.

This research work is an extension of [27]. The main focus is the establishment a next-generation power system, which comprises multiple MGs connected to the main grid for efficient energy management. The objectives of this paper are to meet the users' energy demand, alleviate power line losses and maximize the economic benefits. In order to meet the users' energy demand, a cooperative model is proposed. In the Proposed Method (PM), MGs trade energy with other MGs and the UG through a coalition. The coalition is defined as the temporary alliance between two or more groups or parties for their mutual benefits. The coalitions are formed among MGs on the basis of two constraints [5]. First, the distance between any two MGs in a coalition should be less than or equal to the distance threshold. Second, each coalition must be comprised of at least two MGs for energy trading. After the coalition's formation, MGs with surplus energy trade energy with the MGs having deficient energy. For energy trading among MGs, an Energy Transaction Algorithm (ETA) is proposed in which the power line losses and energy trading cost incurred during energy trading are calculated. Energy trading among MGs locally alleviates the power line losses. Besides, intra-coalition energy exchange brings economic benefits to the people. It is done by purchasing energy at a reduced price and selling it at an increased price as compared to the energy traded with the UG [9]. Moreover, Energy Storage System (ESS) is integrated to further improve the economic efficiency. The following are the main contributions of the underlying work.

•
A cooperative model, referred as PM, is proposed to minimize the power line losses.

•
An ETA is proposed for trading energy with other MGs, and with UG and MG.

•
Energy is traded between MGs present within the range of each other, and the UG and an MG.

•
A comparative analysis of Existing Method (EM) [48] and PM is performed for the minimization of both power losses and energy trading cost.

•
Effect on the socio-economic factor is analyzed due to ESS integration.

The paper is organized as follows. The literature review is discussed in Section 2. EM and PM are discussed in Section 3. Also, Noncooperative Energy Sharing Algorithm (NCESA) and proposed ETA are discussed in Sections 3.4 and 3.5, respectively. In Section 4, simulation results are demonstrated to evaluate the performance of the PM and ETA. Finally, the findings of the paper are concluded in Section 5.
1.1. Connection between supercomputing centers and electricity service providers
The Supercomputing Centers (SCs) aim to perform high-performance computing, which require excessive resources and computational power. For performing such high computing, large amount of power is required. For that purpose, Electricity Service Providers (ESPs) have to support efficient electricity generation, transmission and distribution. Both UGs and MGs are examples of ESPs. The coalition in MGs plays an important role in fulfilling the energy requirements of SCs. The MGs can supply surplus energy to the SCs at a reduced price as compared to the UG. Even if MGs do not have surplus energy, they can buy energy from the UG and then supply the energy to SCs, which is also feasible both for MGs and SCs. The authors in [15] present a qualitative research on the service contracts between SCs and ESPs. The contracts involve various parameters like variable energy tariffs, demand charges, etc. An investigative study is performed in [8], which involves the evaluation of the relationship and possible integration between SCs and respective ESPs. The authors in [39] carry out an extensive survey on integration of SCs and ESPs. The comparison between US based and European based grids is performed. For the comparison, demand management is taken into account. All works highlight the bright perspectives of integration of SCs and ESPs. The energy demand of SCs also

2. Literature review
Nonrenewable Energy Sources (NRES) are found in the conventional energy systems. The fossil fuel based resources emit greenhouse gases, which adds to the air pollution. Furthermore, the expense of maintenance is also substantial. In contrast, MGs are composed of RESs, which are eco-friendly and have a low maintenance cost. Due to two-way communication and power flow, MGs can trade energy with the UG according to the needs. In [40], the authors evaluated smart homes with Plugin Hybrid Electric Vehicles (PHEV), ESS, and DG. The goal is to reduce the overall energy purchasing cost. To cut the power expenditure, the authors utilized a dynamic pricing method for appliance scheduling. Moreover, the concept of net metering is incorporated for energy trading. A coordination method is presented to control the load according to the transformer's capacity limitations in order to minimize transformer overloading during low price intervals. Power line losses between MGs and between MG and UG, on the other hand, are not taken into account. In addition, the installation and maintenance expenses of the PV panel, ESS, and PHEV are not taken into account. The authors in [23] proposed a heuristic algorithm to tackle the electricity load requirements of IoT-enabled smart homes. Similarly, the authors in [1] proposed an optimized management system to deal with the integration of RESs and ESS in the smart homes. The proposed work achieved significant reduction in electricity billing. In [34], the authors introduced a Multi-Agent System (MAS) for optimum coordination among DERs in order to improve power network efficiency and dependability. The MAS manages and dispatches power flow in a distribution network made up of numerous MGs that are linked to the main grid via substations. The goals are to minimize power line losses on the distribution network, reduce the load on the main grid, and maximize profit. For the development of coalitions among MGs, transferable utility cooperative Game Theory (GT) is employed. Surplus energy is shared with other MGs in the same coalition in order to balance power amongst MGs. According to the simulation results, MAS's cooperative control outperforms noncooperative control. The authors, however, did not take into account the capacity of the substation voltage transformer and the distance threshold for establishing coalition and consumers' relation with related MG. The authors in [4] proposed a multi-agent based solution for energy management in integrated buildings and MGs. In the MGs, different RESs are used along with controllable loads. A coordinated system of DG and DR is used for the optimization of energy management system. Similarly, the authors in [12] proposed a stochastic predictive energy management system of multi MGs. The integration of MGs is done using a hierarchical control system. The proposed system ensures efficient energy management. However, it is confined to a set of predefined constraints and need to include more learning based methodologies so as to make it scalable.

Distributed RESs fulfill energy demands well; nevertheless, their variable nature impedes dependable operation. To meet the energy demand, one frequent approach is to deploy more generators and ESSs. Energy collaboration among MGs, on the other hand, is a compelling option. The authors in [41] investigated the effect of MGs' energy cooperation and ESS on total energy costs. They took into account two MGs with DG, ESS, and aggregated load. The offline algorithm demonstrated that energy cooperation and ESS integration alleviated the varying nature of RESs while lowering overall energy cost. The authors also proposed two online algorithms for real-time energy management of cooperative MGs to reduce the computational complexity. The importance of cooperation for energy management in MGs can also be visualized from [49], [33]. On the same grounds, the energy management in residential MGs is ensured in [7], [6]. The authors in [45] discussed the coalition formation among MGs using GT. The establishment of a coalition has the goal of maximizing economic profit. MGs build alliances based on mutual benefits. Due to the reduced distance between MGs, coalition formations enhance average payout and minimize power line losses. The primary benefit of MG coalition creation is local power transfer, which reduces power flow to and from the main grid and results in minimum line losses. According to simulation results, MG coalitions enhance the average payout of each MG by up to 31% and considerably minimize power line losses. In [14], the authors proposed an optimal coalition formation strategy for MGs known as Hierarchical Priority based Coalition (HRCoalition). The primary goal is to lower the grid network's total power line losses, reduce energy stress on the main grid, and maximize intra-coalition energy exchange. HRCoalition is used to build optimum coalitions based on distance threshold and physical connections between MGs. A greedy energy exchange method is utilized to trade energy within the established coalitions. Shapley Value (SV) is used to share the advantages received through the establishment of a coalition of MGs. Traditional coalition creation techniques are computationally less efficient than the suggested coalition strategy. Consumers' interactions with the corresponding MG, on the other hand, are not taken into account.

The authors of [48] suggested a Game Theoretic Coalition Formulation Strategy (GT-CFS), in which MGs created coalitions based on differences in power line losses per power unit. Power line losses on the distribution network are reduced as a result of coalitions established among MGs. MGs use SV to divide the average reward generated by coalition formation fairly. However, client interaction with their assigned MG is not taken into account. Moreover, the integration of ESS for storing surplus energy is neglected. Contrarily, the authors [10], [44] dealt with the integration of ESS in energy management platforms considering uncertainty and bilateral trading, respectively. Zhenyu et al. [46] used the firework algorithm to optimize the economic and environmental performance of MGs. The goals are to eliminate harmful emissions in the environment and to optimize MGs to reduce operational costs. In order to achieve the Pareto optimum point, the authors employed Gravitational Search Algorithm Operator (GSAO) to increase the quality of the obtained solution. The findings indicate that there is a trade-off between cost minimization and pollution reduction. The authors in [21] presented a scheduling method for optimizing the load associated with the UG. The goals of this article are to reduce power costs while balancing energy supply and demand.

In paper [3], the authors discussed the utilization of RESs in a residential area. The integration of DERs improves the reliability of the power system and decreases the harmful emissions. To tackle the intermittent nature of RESs, the authors formed an energy trading strategy as a repeated game. For performing simulations, 12 homes are considered having RESs, which are interconnected with each other as well as with the MG. Simulation results show that energy generation using RESs saved 20% of the total energy cost while reducing the carbon emissions. The authors in [16] proposed different operational modes for forming clusters of interconnected MGs. To tackle the uncertainties in creating a balance between collective and individual interests, chance constrained programming is used. The simulations proved that the proposed transactive energy approach is quite efficient. However, equal distribution of profits and cost saving is not ensured. The authors in [11] proposed a hierarchical stochastic energy management system to efficiently manage the operations of interconnected grids. Moreover, the uncertainties and unscheduled power exchange with the main grid are also minimized. However, the proposed work lacked in taking into account the communication and power line failures. The isolated mode of operation is also not dealt with. Daneshwar et al. [17] proposed a novel operational model for the interconnected MGs with 100% RESs in the transactive energy market. The novelty lies in the development of a free energy trading environment. However, only some specific parameters were used for modeling the system and more parameters need to be considered for better modeling. Mohammad et al. [20] discussed the MG's load demand management in grid-connected mode. The objective of this paper is to minimize the operational cost. A cooperative power sharing algorithm is used to trade energy within the grid network. Simulation results demonstrated that operational cost is minimized in the grid-connected mode as compared to the islanded mode in which no energy is traded within the grid. However, power line losses are not considered.

In [38], the authors aimed to reduce power line losses as well as energy trading costs. They presented a coalition game strategy based method for reducing needless power transfers between an MG and a UG. MGs create alliances to swap power in exchange for transmission fees. The exchange of power across MGs increases the overall network's cost efficiency and optimizes the average reward, which is shared among MGs via SV. The authors in [29] studied direct energy trading between Small Scale Electricity Suppliers (SSESs) and end users. The cooperation between SSESs and end users is formulated as a game. This game is solved through Coalitional Game Theory (CGT). The contribution of each SSES in a coalition is calculated through SV and the average payoff is distributed among SSESs according to their SV.

Chao et al. focused on reducing line losses of the entire grid [47]. A greedy CGT algorithm is used to make coalitions among MGs on the basis of power line losses. ESS is also considered for storing the surplus energy. Simulation results show that power line losses are reduced significantly. However, energy trading cost is not calculated. The authors in [30] investigated the optimum scheduling of several MGs coupled in a hierarchical design. The goal is the energy peak reduction of each feeder to lower total operating cost, increase overall energy system profit and minimize the power flow from the distribution grid. An Energy Management System (EMS) is utilized at the lowest level of the proposed hierarchical design to compute the local optimum scheduling of MGs. At the highest level, the MG of MGs Center (MMC) is employed, which generates a global ideal schedule for each MG in order to realize the minimum cost. If an MG has excess energy, it is shared with other MGs to enhance the total profit. When compared to the standard grid algorithm, the coordination technique reduces the overall system costs by 1.34 percent. Moreover, computational time is reduced significantly for obtaining the global schedule. However, power line losses are not calculated.

The authors in [51], [31] studied the operations of ESS in MGs. Due to the intermittent nature of RESs, ESS is integrated to maintain the stability of an MG. A distributive strategy for cooperative control is used to maintain the supply and demand of the MG [51]. Two types of optimizations are performed in [31]. First, MGs are optimized individually through the noncooperative game. Afterwards, optimization of all MGs is conducted through the cooperative game. Simulation results show that the daily cost of MG is reduced. The authors in [50], [28] also worked on energy management in multi MGs. Xingzheng et al. [52] proposed an adaptive distributed energy scheduling scheme for optimal management of RESs in cooperative MGs. In order to cope up with RESs' generation and demand, Lyapunov Optimization (LO) is used to make an online algorithm. The proposed algorithm achieved a near to optimal solution. Simulation results showed that the proposed algorithm reduced the operational cost and improved the RESs' utilization. However, there is a trade-off between operational cost and battery size. To deal with efficient power scheduling using real time and critical peak pricing, authors proposed a hybrid optimization technique in [37]. The load is shifted from On-peak intervals to Off-peak intervals keeping in view the electricity cost. The proposed work achieved significant electricity bill reduction. For both cost and comfort based optimization of residential load in a SG, the authors implemented a dynamic programming technique along with two heuristic techniques in [26]. The results showed a reasonable reduction in peak power consumption and energy cost with minimum user discomfort.

Traditionally, MGs' energy management is formulated as an offline optimization problem, which forecasts RESs' generation and market demand, which is difficult to achieve practically. On the other hand, online algorithms focused on balancing the power between supply and demand by simplifying the MG model while ignoring the underlying distribution network and power flow. Wenbo et al. [43] proposed an online algorithm for real-time MG operation while considering the underlying distribution network and associated power flow. Simulation results proved that the proposed online algorithm outperformed the offline greedy algorithm. In addition, the effect of the underlying distribution network on energy management is also studied. The authors in [2] proposed a mathematical model for energy resource scheduling and load management in isolated MGs. The focus is to mitigate the greenhouse gas emissions. Simulation results showed that smart charging of PHEV and the presence of DR effectively addressed the energy management problem and reduced the power line losses. Moreover, Battery ESS (BESS) and DR provide more robustness and flexibility to the power system when energy demand is high. The authors in [32] proposed a distributed control strategy with the aim to deal with optimal dispatch of isolated MGs. In [13], the authors suggested that instead of sharing only surplus and deficient energy information with the community energy management system, adjustable power information must also be shared. The main objective is to reduce the operational cost. The authors proposed a hierarchical optimization algorithm for multiple MG system to trade energy with each other. DR is also incorporated for increasing supply reliability and minimizing operational cost. Simulation results showed that community ESS is a better option in order to reduce the operational cost.

No doubt, a large amount of work has been done in the literature to ensure cooperative energy transaction in MGs. Still, there is a room to simultaneously discuss EM [48] and PM from the perspective of power losses' minimization and energy trading cost reduction. The works discussed in literature review either focused on integration of ESS and cost reduction or the coalition of MGs with energy losses' minimization. The proposed study takes into account both the integration of ESS and MGs coalition. Moreover, the readers are provided with a deep insight of how and why coalitions should be established between MGs, and how both power losses and energy trading cost can be minimized.

3. System model
In the proposed system, a distribution network having N number of MGs is considered. The MGs are also linked with the UG through an MS. In the proposed work, MGs are the main shareholders as their roles are decided depending on the amount of energy they have. They either sell energy to users or buy energy from other MGs or UG. On the other hand, the users are considered as the stakeholders because they are part of the entire system and are affected by the operations of MGs. Moreover, the technical aspects of the MGs are handled by MS or UG. For example, the clustering of MGs and the setting of energy trading price when MGs are in coalition is done by MS. On the other hand, energy trading price is decided by the UG when MG and UG are in coalition. Users are connected to the UG through an MG and an MS. Electricity is supplied to the end users through MGs. When an MG will be energy deficit, it will get energy from the UG and provide it to the users. From Fig. 1 it is seen that each user is connected with only one MG. User 1 is connected with 
. Similarly, User 2 is linked with 
. It is also assumed that an MG is capable of meeting the demand of users connected to it. The accumulated users' demand is equal to the energy demand needed by the MG at any particular time t. In smart homes, a Smart Meter (SM) is commissioned to keep track of energy consumption. It has the ability to communicate with a specific MG. Moreover, the radial topology is used to establish a link between all MGs and the MS. Energy trading is conducted amongst MGs and UG via power distribution lines. In Fig. 1, two-way communication and distribution lines are found, which are represented by the dotted and solid lines, respectively. The energy management horizon considered in this work is 24 hourly slots for a day. In any particular time slot t, the energy generation of ith MG is 
 and the energy demand is 
. It is the users' accumulated demand connected with the MG. Energy requirement of an MG in any particular time slot t can be calculated using Equation (1).(1)
 If 
, it means that the MG has the capability to generate and store surplus energy. It also sells surplus energy to other MGs or the UG. On the other hand, 
 means that the MG is energy deficit and buys energy from other MGs or the UG. Moreover, 
 represents that energy generation is equal to the energy demand. If 
, MGs' generation and demand are taken randomly. Under the described scenario, two distinct cases are studied: EM and PM. EM is the base model, which does not include any coordination amongst MGs. In it, energy trading takes place between MGs and UG. An NCESA is proposed for energy transaction between an MG and the UG. In the PM, MGs trade energy locally through coalitions. Moreover, energy is also traded with the UG. For trading energy, an ETA is proposed. It is assumed that the MG has enough money to buy energy from other MGs and the UG.

Fig. 1
Download : Download high-res image (692KB)
Download : Download full-size image
Fig. 1. Illustration of the PM.

3.1. Noncooperative model
In the EM, energy trading between an MG and the UG is conducted through the MS, which is connected to both grids. There is no energy trading among MGs. Both UG and MG are connected through a medium voltage line having a voltage rating of 
. The conventional power system is always accompanied with the power line losses due to 
 effect and the presence of a voltage transformer for voltage conversion. 
 power losses are severe if both MG and UG are located far away from each other. In addition, there are other factors for power losses, such as leakage current, corona effect, heat dissipation, dielectric losses and magnetic losses in transformers. When 
 wants to sell or buy energy to or from the UG, then the power line losses (
) are calculated by Equation (2) [48].(2)
 where 
 
 is the current flowing over the distribution line when energy trading takes place between UG and MG. 
 is the distribution line's resistance and 
 is the amount of energy being transferred between 
 and UG at initial voltage level, denoted as 
. α is the constant of power losses faced due to other factors like transmission loss, natural disasters, etc. After substituting 
 in Equation (2), Equation (3) is obtained.(3)
 
 
 can be found out using Equation (4).(4)
⁎
  where 
⁎
 is the amount of energy produced or required by the UG to fulfill the demand of 
, when it is energy deficient. 
⁎
 is more than 
 because when energy is traded between the UG and the MG, then some power losses are incurred. If there are no power losses during energy trading, then 
⁎
 becomes equal to 
.(5)
⁎
 
 In Equation (5), 
⁎
 is the total energy produced or required by the UG, which is equal to the energy required by the MG plus the power losses. Equation (6) is used to calculate the energy trading cost among MGs or between UG and MG.(6)
 where φ is the unit power price. It is different when energy is traded to and from the UG. If an MG sells energy to the UG, the value of φ is low and when an MG buys energy, then the value of φ is high. In the EM, the objective is the MGs' average payoff (
) maximization, which is defined as follows.(7)

3.2. Proposed cooperative model
In PM, besides energy trading between MG and UG, energy exchange among multiple MGs is made possible. It happens through coalitions among MGs. The coalitions are made on the bases of two conditions: 1) there should be minimum of two MGs and 2) the distance between the MGs should be less than the threshold distance. Energy trading in coalitions alleviates the power line losses over distribution network and maximizes the average payoff as given in Equation (7). For the power line losses' minimization, cooperative groups of MGs are made known as coalitions and denoted by S. In each coalition, there are two sets of MGs. The clustering is performed on the bases of energy surplus and deficiency. The entities with surplus energy are grouped into one cluster, termed as energy sellers 
. On the other hand, the entities with energy deficiency are grouped into another cluster, termed as energy buyers 
. Initially, energy is traded among MGs. If there is surplus energy, it is traded amongst MGs and UG. 
 means that 
 is capable of selling surplus energy and it belongs to 
. Similarly, 
 means that 
 is energy deficient and it belongs to 
. For coalition formation, there must exist one 
 and one 
. Otherwise, there will be no energy trading among MGs. When energy is traded between 
 and 
, which act as seller and buyer MGs, respectively, then the power line losses are calculated by Equation (8).(8)
 
 where 
 and 
 are the power transfer and resistance between two MGs, respectively. 
 is the voltage level at which energy is traded among MGs. When energy is traded among MGs within formed coalitions, then only 
 losses are witnessed and the value of α becomes 0. The cases of energy trading among MGs within formed coalitions are as follows.
  where 
 and 
 are the energy transfer values of seller and buyer MGs, respectively. If 
 cannot meet the demand of 
, the seller MG only sells 
, which is less than or equal to (
) of buyer MG. The power line losses in any coalition S comprises of three parts.

1)
Power line losses caused by energy trading among MGs.

2)
Power line losses due to energy transfer from MG to the UG.

3)
Power line losses due to energy transfer from UG to the MG.

The total power line losses in any coalition S can be calculated using Equation (9).(9)
 where 
 and 
 are the energy selling and buying power line losses, respectively. The total payoff function of any coalition S can be determined using Equation (10).(10)
 
 
 
 where 
 is the unit power energy selling price to UG by MG, 
 is the unit power energy buying price from UG by MG and 
 is the unit power price for energy trading among MGs. The price of unit power is fixed for all cases. The objective is to maximize the total payoff by minimizing the power losses.(11) 
 
3.3. Integration of energy storage system
When RESs expand, the demand for new and efficient methods to deal with fluctuations and uncertainties also arise. ESS is one of the options. It plays a vital role in energy infrastructure and brings cost savings to the utility companies as well as to the consumers. The major task of ESS is to store the surplus energy. The charging and discharging to and from the ESS of MG in any time interval t are represented as 
 and 
, respectively. The charging and discharging efficiencies of the ESS show energy losses caused during both processes. The charging and discharging parameters are denoted by 
 and 
, respectively. In order to increase the life of ESS, energy is stored up to 90% and discharged down to 10% of the rated power.

3.4. Noncooperative energy sharing algorithm

Algorithm 2
Download : Download high-res image (252KB)
Download : Download full-size image
Algorithm 2. Proposed ETA Pseudocode.

In NCESA, MGs are not involved in coalition formation. MGs only trade energy with the UG through MS. Each MG first fulfills the demand of users connected to it. After fulfilling the demand of users, MG shares surplus energy with the UG in order to maximize the economic benefits. When an MG is not viable to meet the users' demand, then it gets the required energy from the UG and has to pay for it. In NCESA, power line losses are high due to energy transfer between an MG and the UG. It is because the power line resistance is high due to a large distance between both entities. Also, the economic benefit is less because UG purchases energy at low price and sells it at high price. Due to this, UG gets more benefit or profit as compared to the MG. In the case of ESS, MG with surplus energy first stores energy in ESS and then shares the remaining energy with the UG. Moreover, an energy deficit MG first obtains energy from ESS and then buys the remaining energy from the UG. NCESA pseudocode is shown in Algorithm 1.

Algorithm 1
Download : Download high-res image (236KB)
Download : Download full-size image
Algorithm 1. NCESA Pseudocode.

3.5. Proposed energy transaction algorithm
Proposed ETA is a game in which players make different choices to achieve the best possible outcome. In this scenario, MGs act as players and their choices to join the coalition decide the amount of benefits that can be achieved. The choices also decide the amount of power losses that can be reduced in the distribution network. Coalitions among MGs are made depending upon the distance threshold. Each MG can only join one coalition in a particular time interval t. The main objectives of the proposed algorithm are minimization of total power line losses and maximization of average payoff.

When coalitions are formed, then energy trading takes place. Information regarding intra-coalitional trading includes position, and amount of energy generation and demand of the MGs. In a coalition, MGs are sorted into two groups. Seller MGs (
) are sorted in one group in the descending order of their energy requirement. Buyer MGs (
) are sorted in another group in the descending order of their energy deficiency. Afterwards, the proposed algorithm selects the most energy deficit MG from 
 and the MG with maximum surplus energy from 
. If the demand of energy deficit MG is fulfilled by 
, the next energy deficit MG is selected. Otherwise, the next MG with surplus energy is selected to fulfill the need of the buyer MG. The energy trading cost of MGs is calculated by Equation (6). Power line losses due to energy trading among MGs are calculated by Equation (8). After energy trading is performed within formed coalitions, the remaining energy required by the deficit MG is provided by the UG and 
 trades the excessive energy with the UG. For calculating power line losses and energy trading cost, Equation (3) and Equation (6) are used, respectively. If ESS is integrated, an MG first stores or obtains energy to or from the ESS, respectively. After that, energy trading takes place within formed coalitions and with the UG.

4. Simulation results and discussion
In this section, the capabilities of the PM and ETA are validated through a series of experiments performed in MATLAB. For simulations' purpose, a distribution network of 10 x 10 km2 and having 15 MGs is taken into account. Fig. 2 shows random deployment of MGs in a certain area with MS being located at the center. MS is considered as the origin of a 2-D space with coordinates (0, 0). It is assumed that MG's energy demand is equal to the users' demand. The demand and generation of an MG are regarded as Gaussian random variables that lie in the range of 1-3 MW. Moreover, the amount of energy required by the MG is computed using the energy generation and demand difference as given in Equation (1). MGs' energy requirements vary from -2 to 2 MW in any particular time slot t. If 
, MG acts as a seller and if 
, MG acts as a buyer. The values of line voltage and resistance are taken to be 11 kV and 0.4 Ω/km in the case of an MG and an MS. While, in the case of two MGs, these values are taken to be 11 kV and 0.2 Ω/km, respectively. When energy is transferred between MGs and between an MG and a UG, the price is taken to be fixed. MG pays 40 cents per kW for electricity purchased from UG. While MG charges 10 cents per kW when selling electricity to UG. The intra-coalition trading price for energy is fixed at 20 cents per kW. The power loss constant throughout energy trading between UG and MG, on the other hand, is assumed as . Moreover, there exist different types of batteries that are designed for various purposes. In the proposed work, Lithium-Ion (Li-Ion) batteries are used. It is because they are mostly used in the MGs' infrastructure. The reasons for using Li-Ion batteries are that they have high voltage capacity, increased energy density and require zero maintenance.

Fig. 2
Download : Download high-res image (98KB)
Download : Download full-size image
Fig. 2. Deployment of MGs and MS (N=15).

Fig. 3 depicts the total energy generation and demand of multiple MGs for one day. Blue and red bars show energy generation and demand, respectively. An MG with a surplus amount of energy sells it to the other MGs or UG to get profit. Likewise, energy deficit MG buys energy from other MGs or UG to fulfill the user's demand. It can be seen from Fig. 3 that MG number 2, 4, 6, 7, 9, 12, 13 and 15 act as seller MGs while remaining MGs act as buyer MGs. Table 1 shows the parameters of MGs considered for performing simulations. The positive value shows MG has surplus energy to sell while negative value shows that MG needs to purchase energy.

Fig. 3
Download : Download high-res image (118KB)
Download : Download full-size image
Fig. 3. MGs surplus and deficient energy. (For interpretation of the colors in the figure(s), the reader is referred to the web version of this article.)


Table 1. MGs' parameters in simulation experiments.

MG ID	Deployment Position	Total Energy Generation (MW)	Total Energy Demand (MW)	Energy Requirement (MW)
1	(0.22315, -4.6766)	28.034	32.057	-4.0232
2	(-1.0264, 0.57067)	40.275	35.612	4.663
3	(-0.2089, 2.198)	37.731	37.909	-0.17791
4	(4.939, -3.8959)	33.027	32.927	0.10075
5	(1.0448, -2.8335)	29.446	34.842	-5.3959
6	(4.4491, 3.1102)	42.268	32.208	10.06
7	(-0.095578, -3.6134)	37.449	35.825	1.6238
8	(-0.62053, 3.819)	35.473	42.026	-6.5536
9	(2.7266, 4.2356)	37.757	37.474	0.28269
10	(2.4407, -4.8724)	31.405	35.808	-4.4033
11	(-0.57096, -1.2284)	38.578	43.277	-4.699
12	(-4.47, -3.3219)	35.830	33.703	2.1271
13	(-4.1218, 0.40223)	42.471	30.146	12.325
14	(2.9799, -3.9834)	30.585	36.255	-5.6697
15	(1.5558, -4.6073)	38.494	35.392	3.1015
Table 2 shows storage capacities of ESSs, which vary from 0 to 1 MW. ESS charging and discharging limits are set at 90% and 10%, respectively.


Table 2. Capacities of ESSs in MGs.

MG ID	Total Capacity of ESS (MW)
1	0.96661
2	0.9858
3	0.68046
4	0.8221
5	0.53397
6	0.60396
7	0.5198
8	0.73468
9	0.57505
10	0.99565
11	0.71353
12	0.97769
13	0.86212
14	0.79045
15	0.77013
4.1. Noncooperative model with and without energy storage system
While considering EM, two cases are discussed: EM with ESS and EM without ESS. Fig. 4 shows power line losses of MGs for one day in the EM without considering ESS. MGs initially satisfy the users' demand and then trade the excessive energy with the UG through an MS. If extra energy is needed to assist the consumers by an MG, it is bought from the UG. The power line losses faced during energy trading between UG and MGs are high because UG is located far from the MGs. In the figure, blue bars represent the total power losses incurred when selling surplus energy to the UG. While red bars show the total power losses incurred when receiving the deficient amount of energy from the UG to meet the users' demand. In Fig. 5, the energy trading cost in the EM without considering ESS is demonstrated. When MGs sell surplus energy to the UG, they receive energy selling cost and when MGs purchase deficient energy from the UG, they pay the respective amount. Energy selling and purchasing costs are represented by blue and red bars, respectively.

Fig. 4
Download : Download high-res image (116KB)
Download : Download full-size image
Fig. 4. Power losses (EM without ESS).

Fig. 5
Download : Download high-res image (119KB)
Download : Download full-size image
Fig. 5. Energy trading cost (EM without ESS).

The total power losses of the MGs for one day in the EM with ESS are shown in Fig. 6. The addition in EM is the inclusion of ESS. Hence, the system checks the status of the corresponding ESS that whether it is fully charged or not before trading energy with the UG. If MG has some extra energy and ESS is not fully charged, it charges the ESS up to 90% of the rated power and after that remaining energy is traded with the UG. Otherwise, if MG does not have enough energy to fully charge the ESS, it is charged to the maximum available energy and no energy is traded with the UG. If MG has deficient energy, it first checks the status of ESS. If ESS is charged, MG initially utilizes the stored energy and then buys the remaining energy from the UG. Red bars show the power losses caused when MGs purchase energy from the UG while blue bars show the power losses incurred when MGs sell energy to the UG.

Fig. 6
Download : Download high-res image (120KB)
Download : Download full-size image
Fig. 6. Power losses (EM with ESS).

Fig. 7 shows energy trading cost regarding EM with ESS. While considering ESS, the energy traded with UG is less as compared to EM without ESS. Energy selling cost is represented by blue bars while red bars show the energy purchasing cost. The integration of ESS within the EM reduces losses and maximizes the economic benefits of the MGs. The simulation results of the EM with and without ESS are shown in Table 3. The results show that both the power losses and energy trading cost are less when ESS is used as compared to when ESS is not used.

Fig. 7
Download : Download high-res image (130KB)
Download : Download full-size image
Fig. 7. Energy trading cost (EM with ESS).


Table 3. Simulation results of EM with and without ESS.

MG ID	Power Losses without ESS (MW)	Energy Trading Cost without ESS ($)	Power Losses with ESS (MW)	Energy Trading Cost with ESS ($)
1	0.52497	4533.3	0.28289	2708.1
2	0.62637	5370.6	0.54799	4757.3
3	0.929	7223	0.64482	5248
4	0.73016	3966	0.42917	2493.9
5	1.2008	8852.3	1.0284	7852.9
6	1.7233	6840.3	1.2982	5277.6
7	0.65655	4545	0.41508	3004
8	0.88675	6648.4	0.71252	5594.6
9	1.0551	6171.4	0.75217	4711.3
10	1.029	6259	0.63062	4397.6
11	0.57073	6067.8	0.42217	4728.8
12	1.5127	7152.6	1.0752	5079.5
13	1.1464	5208.7	0.84893	3688.9
14	1.3359	8111.7	0.89966	6357.9
15	1.2622	6625.4	0.85766	4908.7
A comparative analysis is conducted for power line losses' minimization amongst EM without ESS and EM with ESS. Fig. 8 shows that MGs with ESSs have minimum line losses as compared to MGs without ESS. The reason behind this is that ESS stores energy when MG has a surplus amount of energy and provides it when MG becomes energy deficient. Hence, less amount of energy is traded with the UG. When the energy that flows to and from the UG decreases, the energy trading cost also decreases. A comparative analysis with respect to cost of energy trading in the EM with and without ESS is shown in Fig. 9.

Fig. 8
Download : Download high-res image (149KB)
Download : Download full-size image
Fig. 8. Comparative analysis of power losses in EM.

Fig. 9
Download : Download high-res image (159KB)
Download : Download full-size image
Fig. 9. Comparative analysis of energy trading cost in EM.

The following challenges are most likely to be faced when the MGs act independently.

•
In the absence of coalition between MGs, there would be excessive energy losses. The MG with surplus energy would either have to store the energy in ESS or sell it back to the UG.

•
When MGs act independently, then they have to rely solely on the batteries to store the surplus energy as they are unable to sell energy to the nearby MGs. As a result, the batteries' lifetime is reduced and the batteries are changed frequently, which lead to the increase in the maintenance cost. This increased cost is then paid by the consumers, when MGs sell energy to the users, which ultimately leads to a bad reputation of the MG.

•
When there would not be any coalition between MGs, the energy deficient MG has to buy energy from the UG, which increases the energy cost.

•
If MGs act independently, an increased burden on the UG will be observed as all energy requests are to be directly fulfilled by it.

4.2. Proposed cooperative model with and without energy storage system
As in EM, PM also has two scenarios: PM with and without ESS. Fig. 10 shows losses experienced in the PM by the MGs. In the PM without ESS, MGs make coalitions among themselves based upon the distance threshold and energy requirement. The distance threshold considered for coalition formation is 2.5 km and each coalition must have one seller and one buyer MG. MGs, after fulfilling the users' demand, trade excessive energy. If MGs still have extra energy, they sell it to the UG. In case, an MG's energy demand is not met by the coalition, the remaining energy is bought from the UG. Power losses due to energy trading among MGs within coalitions are less as compared to the energy trading with the UG. The reason is that MGs are found in the close vicinity of each other as compared to the distance between MGs and UG. Fig. 10 shows the power losses incurred in the PM. Fig. 11 shows the cost of trading energy in the PM without considering ESS. Energy trading cost is high for seller MGs and low for buyer MGs. It is due to the reason that the prices for selling and buying energy to and from various MGs are high and low, respectively. MGs with surplus energy get more profit by selling energy to the MGs instead of UG. On the other hand, energy deficient MGs have to pay less energy trading cost if they buy energy from the MGs instead of UG. Energy trading cost of MGs in the PM is less as compared to the EM.

Fig. 10
Download : Download high-res image (116KB)
Download : Download full-size image
Fig. 10. Power losses (PM without ESS).

Fig. 11
Download : Download high-res image (136KB)
Download : Download full-size image
Fig. 11. Energy trading cost (PM without ESS).

In the PM with ESS, a positive effect is observed on the power system. In Fig. 12, power losses experienced in the PM with ESS are illustrated. When ESS is integrated within PM, MGs first store energy in ESSs and then trade energy with MGs within the coalition and with the UG. If MGs are energy deficient, they first obtain energy from ESSs and then from other MGs within the coalition. If the demand is still not fulfilled, MGs buy the remaining energy from the UG. In Fig. 13, energy selling and buying cost is shown. Simulation results of the PM with and without ESS are shown in Table 4. The table shows that energy trading cost is reduced as compared to the PM without ESS. It is because energy trading with other MGs and UG is decreased. Also, the cost of trading energy in the PM with ESS is less than the EM and PM without ESS.

Fig. 12
Download : Download high-res image (112KB)
Download : Download full-size image
Fig. 12. Power losses (PM with ESS).

Fig. 13
Download : Download high-res image (129KB)
Download : Download full-size image
Fig. 13. Energy trading cost (PM with ESS).


Table 4. Simulation results of PM with and without ESS.

MG ID	Power Losses without ESS (MW)	Energy Trading Cost without ESS ($)	Power Losses with ESS (MW)	Energy Trading Cost with ESS ($)
1	0.46736	4285.5	0.25297	2455.5
2	0.55085	5291.7	0.4805	4718.2
3	0.51079	5726.3	0.3657	3913.3
4	0.67022	3691.6	0.40086	2300
5	0.50231	6135.6	0.47744	5917.6
6	1.2239	5957.2	1.0201	4777.6
7	0.41086	4197.8	0.29224	2645.1
8	0.45321	5870.8	0.44836	5237.2
9	0.70272	5496.3	0.54381	4268.4
10	0.42877	3962.3	0.26554	2799.2
11	0.39816	5247.7	0.32764	4386.2
12	1.5127	7152.6	1.0752	5079.5
13	1.1464	5208.7	0.84893	3688.9
14	0.40105	5740	0.26499	3713.2
15	0.54081	6508.7	0.27641	5083
4.3. Comparative analysis of EM and PM
In this subsection, the comparative analyses between the EM and the PM, from the perspective of power line losses and energy trading cost, are presented. The analyses prove the advantage of using the PM over the EM.

4.3.1. Comparative analysis of power line losses' profiles
In Fig. 16, power losses of the EM and the PM, with and without considering ESS, are illustrated. The simulation results clearly show that the PM minimizes the power losses better than the EM. In the case of MGs with ESS, energy is stored when MG has surplus energy and is utilized in the hour of need. By utilizing the stored energy, power losses are decreased. The reduction is more in the PM as compared to the EM. Simulation results show that power losses are reduced by 34.6% in the PM as compared to the EM. Power losses are reduced by 28.6% and 26% due to the integration of ESS in the PM and the EM, respectively when compared with energy losses of both models without ESS. It means that the PM surpasses the EM by 2.6% in terms of power losses' reduction when using ESS. The overall maximum power losses' reduction is achieved by the PM with ESS, which is 51.6%.

Fig. 16
Download : Download high-res image (198KB)
Download : Download full-size image
Fig. 16. Comparative analysis of power losses: EM and PM with and without ESS.

4.3.2. Comparative analysis of energy trading cost profiles
Fig. 17 shows a comparative analysis of the EM and the PM with and without ESS. Energy trading cost of the PM with and without ESS is less as compared to the EM with and without ESS, respectively. It implies that the energy trading cost of MGs having deficient energy is reduced significantly in the PM because MGs provide energy at a lower rate than UG. Energy trading cost of MGs is lower because most of the energy is traded locally and energy deficit MGs purchase energy at a lower price from other MGs as compared to the UG. Moreover, because of the less distance between energy trading MGs, power losses are also low, which further reduce the cost of electricity. Also, maximum energy is stored by the ESS. Moreover, some MGs' energy trading cost is equal to the EM because these MGs are located far away from other MGs and are not involved in any coalition. When an MG is not a part of the coalition, it solely exchanges energy with the UG, resulting in no cost savings during energy trading. The cost of energy trading in the PM is 14% less as compared to the EM. When ESS is integrated with the PM and the EM, then the overall energy trading cost is reduced by 24.3% and 24.2%, respectively. It means that the PM reduces energy trading cost more than the EM. Moreover, energy trading cost of both the EM and the PM with ESS is less as compared to the models in which ESS is not considered. This shows that ESS integration maximizes economic benefits by reducing energy purchasing cost of buyer MGs and increasing energy selling cost of the seller MGs. Moreover, maximum energy trading cost reduction is achieved by the PM with ESS, which is 34.8%.

Fig. 17
Download : Download high-res image (210KB)
Download : Download full-size image
Fig. 17. Comparative analysis of energy trading cost: EM and PM with and without ESS.

4.4. SoC analysis of PM and EM
From SoC perspective, both PM and EM with ESS would be considered. It is because SoC is linked with battery, which is used only in the mentioned cases. In the first case, a gradual change in SoC will be observed as compared to the third case. It is because the amount of energy being wasted is less in the former case than the latter case, which means the batteries would not drain quickly. Fig. 18 shows the accumulative average SoC value of 15 MGs for 24 hours during charging. The demand of all 15 MGs is added for obtaining the total electricity generated by all MGs. It is assumed that 10% of the total load is stored in ESS. For SoC, the upper and lower bounds are set as 90% and 10%, respectively. From the figure a gradual increase in the SoC is observed over the span of 24 hours during charging. Fig. 19 shows the accumulative average SoC value of 15 MGs for 24 hours during discharging. A gradual decrease is observed in the figure with increasing time.

Fig. 18
Download : Download high-res image (89KB)
Download : Download full-size image
Fig. 18. SoC behavior with respect to time during charging.

Fig. 19
Download : Download high-res image (91KB)
Download : Download full-size image
Fig. 19. SoC behavior with respect to time during discharging.

4.5. Test analysis of the PM
The proposed system is tested for a varying number of MGs, ranging from 15 to 75. The results provided in Table 5 show that the power losses increase with the increase in the number of MGs, both with and without ESS. The increase is gradual in the presence of ESS. Whereas, it is rapid when ESS is not employed in the system. Similarly, the energy trading cost is also increased with the increase in the number of MGs. The cost increases drastically with the increase in the number of MGs when ESS is not employed. Contrarily, the increase in energy trading cost is steady in the case of ESS. Table 5 provides the simulation results for power losses and energy trading cost with and without ESS for different number of MGs. Both the power losses and the energy trading price are increased with the increase in the number of MGs because more MGs means more energy transactions and more use of resources. Moreover, if energy transactions are made in near real-time, the computational complexity will also increase. However, it would be within a feasible range. Moreover, it is assumed that an MS has enough computational resources to form coalitions between MGs and respond in near real-time. This ensures that the PM is robust, scalable and does not suffer when the size of the test system is increased.


Table 5. Simulation results of PM for increasing number of MGs.

Cases	Parameters	MG=15	MG=30	MG=45	MG=60	MG=75
Without ESS	Power Losses (MW)	3.99912	7.99824	11.99736	15.99648	19.99956
Energy Trading Cost ($)	29857.7	59715.4	89573.1	119430.8	149288.5

With ESS	Power Losses (MW)	2.79317	5.58634	8.37951	11.17263	13.96585
Energy Trading Cost ($)	21950.8	43901.6	65852.4	87803.2	109754
5. Conclusion and future work
In this paper, a novel ETA is proposed for MGs. The proposed ETA allows MGs to decide whether to charge or discharge the ESS and trade energy with other MGs and UG or not. It is done so that power line losses can be minimized and financial gains can be maximized. The coalitions are formed in which energy trading is performed. Also, intra-coalition energy trading is employed, which is the backbone of the proposed model. Coalitions among MGs are made on the basis of the distance between them. The distance threshold value must be more than the distance between two MGs for forming coalitions and trading energy efficiently. By making coalitions among MGs, energy is traded locally due to which power losses are minimized and the load is alleviated from the UG that enhances the grid stability. Moreover, it is shown that the energy trading cost of deficient MGs is less because they purchase energy from other MGs at a lower price than purchasing energy from the UG. In contrast, MGs with surplus energy get more benefits by selling energy at a higher price to other MGs instead of selling at a lower price to the UG.

Simulation results show that the PM and ETA outperform the EM in terms of power line losses' reduction and economic benefit maximization. Moreover, comparison results show that losses of the system in the PM are reduced by 34.6% and economic benefits of MGs are maximized up to 14% as compared to the EM. ESS further reduces the losses by storing surplus energy and utilizing it in the hour of need. Results show that maximum losses' reduction and economic benefit maximization are achieved by the PM with ESS. It reduces the power losses up to 51.6% and maximizes the economic benefits by 34.8%.

In future work, the interaction of the customers with the MG and energy trading among neighborhood houses at customer level will be studied.