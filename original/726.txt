Abstract
The paradox between the dramatic development of medical data privacy demand and years of bureaucratic regulation has slowed innovation for electronic medical records (EMRs). We are at a historical point for such innovation to prompt patients data autonomy. In this paper, we propose GuardHealth: an efficient, secure and decentralized Blockchain system for data privacy preserving and sharing. GuardHealth manages confidentiality, authentication, data preserving and data sharing when handling sensitive information. We exploit consortium Blockchain and smart contract to achieve secure data storage and sharing, which prevents data sharing without permission. A trust model is utilized for precisely managing trust of users with the implementation of the state-of-art Graph Neural Network (GNN) for malicious node detection. Security analysis and experiment results show that the proposed scheme is applicable for smart healthcare system.

Previous
Next 
Keywords
Blockchain

Smart healthcare

Security and privacy

Graph Convolutional Network

Trust assessment

1. Introduction
The U.S. is poised to spend 20% of its GDP on healthcare in the near future [9], focusing on quality health care services means ensuring patient health management at a superior level at all times. However, in the health care sector, critical patient data and information remains scattered across different departments and systems. Due to this, crucial data is not accessible and handily available in times of need. Moreover, it is also termed as inadequate for handling the exchange of information and requires certain major changes. These very challenging problems are spurring a drive for greater efficiency and innovation.

As for achieving great efficiency, Internet of Things (IoT) -based smart healthcare has been proposed, connecting remote monitoring [32], disease risk assessment [43], and disease prediction system [13]. The health data collected by IoT devices are sent to a healthcare provider for diagnosis and feedback. However, the IoT devices are limited in computing and storage capacity [2], [11]. Cloud computing help healthcare system improve efficiency and reduce the cost of IoT devices. But cloud computing is centralized, once the servers break down, all users are affected. Besides, health data is highly sensitive and valuable for institutes, we cannot deny there is a possibility cloud server could leak the privacy data for commercial profits [12], [44]. Third, it is troublesome for users when they have treatment in different hospitals as before because institutes and hospitals do not share data.

In recent years, Blockchain is one of the most disruptive technologies that has taken the world by storm these days. Blockchain is nothing but a distributed ledger that keeps track of transactions and activities happening throughout the network, and of which immutability is guaranteed by a peer-to-peer network of computers, not by any centralized authority which could avoid the risk of single central point. A Blockchain consists of ordered records arranged in a block structure which contains batches of transactions and Hash of previous block. Each block is connected in chronological order, and the data on the Blockchain network are immutable.

Taking the advantage of characters of Blockchain, a lot of institutes and companies are resolving issues that afflict the current medical system such as FACTOM [31]. In a healthcare system, smooth data sharing between healthcare solution providers can lead to accuracy in diagnosis, effective treatment, and cost-effective ecosystem [10]. In addition, Blockchain for healthcare allows multiple entities of the healthcare ecosystem to stay in synchronous and share data on a commonly distributed ledger, and the participants can share and keep a track of their data and other activities happening in the system without having to look out for additional options for integrity and security.

Nevertheless, as the security and privacy of data on Blockchain are still critical challenges, we propose a new secure scheme for data storage and sharing for healthcare based on consortium Blockchain where we assume that everyone can participate in but Cloud Service Providers (CSPs) and institutes are permitted. Every user can possess their own health data collected from IoT devices or hospitals. Besides, unlike common Blockchain where everyone can see everything on Blockchain, we encrypt health data before uploading to CSPs by using Proxy Re-encryption [38] and no one could have access to the data unless with permission from the user. Two smart contracts are introduced for data storage and data sharing process, one is called GH-DS for data storage, the other GH-IS is for data sharing. Smart contract is a computer protocol that runs automatically when the prerequisites are met, which is like constitution to enforce everything to execute in terms of the law. We use this feature to enforce the institutes payment and ensure the privacy of health data. To keep participators active, institutes request health data from users through an auction scheme which could help them get cheaper but higher quality data, meanwhile, data providers could gain profits GuardHealth Coins (GHC) in return.

Due to the anonymity of the Blockchain system, an effectual mechanism is needed to evaluate the trust for every participator. There have been plenty of research efforts that have investigated data quality evaluation techniques for anonymous data collection. Most of other work which proposed trust assessment mechanism were not adaptive to Blockchain based healthcare systems. Such expositions are unsatisfactory because they did not treat characteristics of health data in much detail. In this paper, we are trying to solve the problem of “trust assessment without sensitive information” in smart healthcare networks as well as the proposed assessment mechanism is well fitting the Blockchain scenario. Compared with a few other existing solutions, our trust assessment scheme takes the characteristics of health relate data and the anonymity of Blockchain. Moreover, we perform out trust assessment not only based on the trustworthiness of the data generators, but also the intermediate cloud service providers. The uncomplicated trust generation mechanism is shown to be effective from the numerical experiment results. The low computing resource consumption meets the requirements of cloud computing.

Discriminating malicious users is crucial for Blockchain systems especially for healthcare related Blockchain systems. Extracting features of performance of user nodes is a feasible approach. Feature extraction for large-scale networks has been a prevalent topic in the representation learning area. For example, Cao et al. [35] advanced methods for learning graph representation via capturing the information in the latent layer of a graph. Kipf and Welling [21] proposed a classification method via GCN based on the features of network nodes. These approaches give a chance to introduce new ways for detecting abnormality in large-scale distributed nodes network. Many proposed security mechanisms to deal with detecting malicious nodes and their harmful behaviors have concluded the methods of behavior prediction for nodes in large-scale networks. Huang et al. [19] proposed a method to characterize the properties of malicious adversaries’ behavior in a large-scale online service network.

We introduce a malicious node detection approach by using Graph Convolutional Network (GCN) and build a trust system in terms of results for subsequent detection, which could guarantee security of the whole distributed networking system. Our proposed approach models the topology in a Blockchain based data sharing system and we define the transaction features in the network. We demonstrate the feasibility and effectiveness of our GCN based detection mechanism. Through simulation, we evaluate the precision of malicious nodes detection to analyze the effectiveness of our detection mechanism.

The main contributions of this paper are summarized as follows.

(a)
We propose a consortium Blockchain-based smart healthcare system for the health data privacy preserving and sharing, named GuardHealth. Smart contracts are deployed on Blockchain to achieve secure and efficient data storage and data sharing.

(b)
GuardHealth separates raw data storage and index of data storage, meanwhile data are encrypted and stored in CSPs.

(c)
Using Proxy Re-encryption, user can dynamically allow requestors to access to data and revoke permissions easily at any time. Through sharing data, user could make profit as an economic incentive.

(d)
We design a trust assessment mechanism to improve the reliability of sharing data. Based on this, we build up a novel GCN model to discriminate malicious nodes.

The rest of this paper is organized as follows. In Section 2, we review the related work. The system model is introduced in Section 3. In Section 4, we describe the details of our proposed scheme. The security analysis and performance evaluation are given in Section 5. Finally, Section 6 concludes this paper.

2. Related work
2.1. Traditional smart healthcare system
A rapid aging population and the dramatically increase in the cost of healthcare in hospital have led to awareness of the importance of efficient healthcare systems and fostered several research directions at the integration of healthcare, data analysis, security preserving.

Li et al. [25] proposed an IoT based health-related data framework where things communicate and cooperate with each other pervasively to achieve common goals. The framework contains three hierarchical computation layers: sensor, edge and the cloud where health-related data could sequentially transform. However, the framework suffers from constrained communication bandwidth, limited server storage and a wide attack surface for malicious adversaries which challenge security and efficiency of the framework.

Li et al. proposed two countermeasures [25] against passive attacks and active attacks in a diabetes mellitus healthcare system. The first method uses a cryptographic approach in both remote control and insulin pump. The second one transmits the command signal via the human body instead of a wireless communication channel. However, both methods incur additional computation cost and additional battery energy. Based on previous work, Zhang et al. proposed a medical security monitor called MedMon [41] to detect wireless attacks with zero additional power. MedMon captures two major types of anomalies including Physical anomalies and behavioral anomalies with a high correct detection rate. However, because of the cost, energy and storage, it is not being widely utilized. In order to reduce storage cost of centralized server in [42], they further proposed an effective solution to remove duplicate data. CINEMA [16] is an effective and privacy-preserving framework for online healthcare based on fast secure permutation and comparison technology. However, it requires centralized cloud server to have high storage and computing performance.

Recently, content-aware smart recommendation systems have been recognized as an efficient method to facilitate the patients’ preliminary judgment on their heath status [6], [7]. They conduct their recommendation approaches based on the patients’ previous health status. However, the non-anonymous data collection mechanism may bring risk of privacy leakage. The attackers can steal sensitive data through matching the identity and recommendation content of the patients. GuardHealth relieves the privacy concerns, and it provides a secure and privacy-preserving platform for patient to share their health data and get suggestion or diagnosis from medical institutes anonymously.

Although these schemes aforementioned provide secure communication and storage, there are still some flaws in the systems such as high storage cost and high demand of computing performance for query. Therefore, in this paper, we propose our own efficient and secure Blockchain-based healthcare system.

2.2. Smart healthcare based on blockchain
In recent years, with the widely used Blockchain technology, many studies have focused on the integration between personal health information privacy and advantages of Blockchain.

Omar et al. presented a healthcare data preserving scheme called MediBchain [1] where users encrypt sensitive health data and store them on chain. However, users must share password when they want to share encrypted data which could cause password leak. Later on, Yue et al. utilized privacy-aware data access authorization [40]. Patients manage all their data through their data gateway securely, but because of the design of storage layer, as the number of users increase, the system might lead to low efficiency and intolerable authentication delay and storage.

In order to reduce excessive storage, Azaria et al. presented a optimized scheme MedRec [3] where medical records are stored in external databases, and store metadata on chain. However, their system did not contain a data security verification mechanism. Xu et al. proposed a Blockchain-based healthcare system [18], where health data are encrypted to conduct fine-grained access control. There are two chains: user chain and Doc chain communicating which could cause low efficiency. Due to POW to reach consensus, as the number of transaction increases, it might lead to transaction congestion and low throughput. Gai et al. proposed a smart treatment model, which was designed to optimize the total cost of the intelligent agents in an healthcare networks [10]. However, their proposed algorithm did not take the impact of sensitive data sharing cost into accountant. Ni et al. proposed HealChain [29], which aims to improve the robustness of health data management mechanism, specifically under DDoS attack. Compared to HealChain, the malicious user detection mechanism of GuardHealth improves the robustness further, and provides a data quality assessment mechanism. Empirical results show that our system have better performance on protecting privacy of the users and managing the sensitive data securely.

According to the problems mentioned above, there are still some difficulties in data security, flexible revocation and good performance. Therefore, we propose GuardHealth, which could support high data security with implementation of Revocable Proxy Re-encryption [38] by using smart contracts, and trust system with malicious node detection based on GNNs. In addition, economic incentive mechanism is added to make the utmost of data value.

2.3. Graph convolutional network
Graph neural networks have attracted considerable attention recently [5], [15] , which was first proposed in [34]. The remarkable success of GNNs in various scenarios has proved its effectiveness and potential. Especially, GCN is a crucial approach among GNNs whose motivation comes from Convolutional Neural Network (CNN) [22], [23] which cannot process Non-Euclidean structure data while GCNs extend existing neural networks to graph structure data. Specifically, GCNs utilize the idea of convolution from CNN which enables GCNs to construct representations for nodes and edges in a graph. GCN has been applied to various tasks, such as node classification, link prediction [28] and graph classification [26]. There are many modified frameworks proposed to optimize GCN models and fit multifarious application scenarios.

Large number of real-world tasks and applications can be mapped to graphs, especially for network related problems, such as social network [33], financial network [37], etc. Recently, conducting GCN to malicious or anomalous network nodes and edges detection has been a focus of the international academic community. Liu et al. [45] proposed a malicious account detection approach in large-scale transaction network via generating graph embeddings for every account nodes. Xu et al. [30] conducted a behavior malware detection method. However, the existing methods typically conduct GCN to detect networks with simple nodes relationship. To tackle above problems, we proposed a new scheme GCN-MD extending GCN for Blockchain-based data sharing anomaly detection. The transaction network is composed of CSP nodes, patient nodes and institutes nodes. The edge is defined on the transaction information between two nodes.

To the best of our knowledge, GuardHealth is the first one introducing GCN to conduct anomaly detection in the context of Blockchain-based healthcare systems.

3. System model
3.1. Overview of system model
We introduce a smart healthcare scheme based on Blockchain named GuardHealth. As illustrated in Fig. 1, GuardHealth is composed of different components, which are described in detail as follows.

•
IoT Devices: IoT devices can monitor kinds of human health parameters whether wearable devices or implanted devices. Collecting different kinds of health-related data, due to its limited computing and storage capabilities, IoT devices send its data which will be well managed to patient nodes.

•
Patient Nodes: Patient nodes can aggregate data from IoT devices and store health-related data from elsewhere such as hospital or healthcare center, and then category the data into different security level. Using symmetric encryption, patient nodes encrypt the data which only can be decrypted by certain patient. Patient nodes can store a replica of their own encrypted data on other nodes like CSPs or institute nodes.

•
CSP: They can collaboratively store encrypted personal health data and store data on GuardHealth chain. The layer of CSPs is an implementation of Kademilia, a distributed Hashtable (or DHT), with added persistence using LevelDB [8]. The CSP could carry out complicated and delay-tolerant computing tasks, such as diagnosis for users using their health data from kinds of sensors and institutes if they have the permission.

•
Institute Nodes: Institute nodes consist of technology and pharma companies or hospitals and so forth. Institute nodes request health data from Patient nodes for analysis. All institute nodes behaviors are restricted by the rule of consortium and only authorized nodes can read or write health information to update status of patient nodes.

•
GuardHealth Chain: It is a consortium chain, which is used to update status of users’ health data and transaction data. No one can enter the system without permission and it reaches consensus by using [4]. GuardHealth chain consists of a series of blocks which contains the Hash of previous block, transactions and users’ health status.

As illustrated in Fig. 1, we briefly show data flows in our scheme: IoT devices collect data and send to certain user nodes periodically. Combining data from IoT and institutes, user nodes encrypt their own data and store them, then send it to CSPs. User nodes upload the indexes of health data as the health status of user on chain with the regulation of GH-DS, a smart contract. Only with user’s permission, institute nodes can get access to the user’s health data. If it is a diagnose, user’s status will be updated after institutes update health data; Otherwise, if it is a data request from institutes nodes, it will trigger the smart contracts (GH-IS) to establish an auction to pay for data from users which will generate transactions.


Download : Download high-res image (307KB)
Download : Download full-size image
Fig. 1. Overview of the GuardHealth Blockchain system using consortium Blockchains.

3.2. Threat model
It is now well recognized by a variety of studies that CSP is vulnerable to several attack approaches. Surveys such as that conducted by Somani et al. have shown that Distributed Denial of Service (DDoS) attack can bring the danger of congestion to CSP nodes in the condition of limited hardware limits, cause large consumption of nodes or even network paralysis [36]. In our proposed system, we take the vulnerability of CSP node into account. So the data integrity protection in the course of data storage and data transmission phases is one pivotal points of our scheme. The detail of our supposed threat model is as follows. For institutes nodes, we consider that CSPs and patients are not trustworthy for conducting reliable health data. The integrity of the sharing data may have been eroded for that the CSP nodes are not reliable and responsible to the data they processed. And the data itself is probable in low quality or even have been modified out of the malicious purpose. Nevertheless, it is supposed that there is no data verification mechanism in a distributed Blockchain based data sharing network which may provide convenience to adversaries. The malicious attackers may pretend to be normal patients, and they deliberately share fraudulent or misleading information from the research institutes. Blockchain network is anonymous for which the institutes cannot track the attackers let alone the new attackers affiliated to attacker groups. Institutes cannot profile the identity of attackers.

For CSP nodes, CSPs are in role of intermediary in transactions between institute nodes and patient nodes. They receive encrypted data from CSPs and send encrypted data to institutes, they do not have enough information to discriminate the patients that request for their cloud service. Also the patients and institutes cannot make sure the integrity of data is not eroded.

As noticed, data verification is not our focus in this work, our design goal is to propose a participants assessment to maintain order in the data sharing order. We will explain the assessment mechanism in detail in next section.

3.3. Trust assessment
Trust is associated with the nodes’ performance in the data flowing process [20] labeled with a value. In our scenario, the institute nodes are data requestors, they leverage the payment and quality of data. The trust scheme includes patients nodes and CSP nodes in order to assess quality of data. The definition of trust is demonstrated as follows.

Definition of Trust: The transaction epoch for institute node  denoted as 
 is the period that starts from institute node sending the demand of data and ends up when the institute nodes receive the data from CSPs providing service for the selected patients.

(1)
Transaction Epoch (TE): The deal epoch for institute node  denoted as 
 is the period that starts from institute node sending the demand of data and ends up when the institute node receive the data sent from CSPs providing service for the selected patients.

(2)
Trust of Patients: The trust of a patient 
 at TE 
, denoted as 
 which ranges from 0 to 1, is the measurement scale of data reliability that the patients can provide. It is based on the trust of the CSPs that provide cloud service for the data access in that transaction epoch. The trust and ID of patients are sent to the institute nodes and maintained in their databases. At the end of each TE, the institute nodes will update the trust.

(3)
Trust of CSPs: The trust of a patient 
 at TE 
, denoted as 
 which ranges from 0 to 1, is the measurement scale of data reliability that the patients can provide. It is based on the trust of the CSPs that provide cloud service for the data access in that transaction epoch. The trust and ID of patients are sent to the institute nodes and maintained in their databases. After per TE, the institute nodes will update the trust.

3.4. Malicious nodes detection
In real-world scenario, there are always some malicious adversaries enrolled in a health data sharing network, they deliberately infuse fake or harmful information or provide fraud services to users and institutes for destructive purpose.

Based on the definition of trust for the nodes, we can primitively filter out some obvious malicious nodes or make a prediction of the malicious nodes’ behaviors. We conduct GCN to extract features of malicious nodes based on the topology of Blockchain network.

To achieve this goal, at first, we record trust-related information for participant nodes in every transaction. Then we build a transaction network graph. The weights of edges are defined on records of previous transactions between the two nodes. Then, GCNs are used to mine the feature of the graph and classify different kinds of transactions. Based on our definition of untrusted nodes, the malicious nodes will be discriminated.

3.5. GuardHealth Blockchain scheme
GuardHealth Blockchain is based on [39]. However, unlike public Blockchain, we utilize consortium Blockchain technology with restricted access to the organization, which reduces a lot of risks in the Blockchain system. As Fig. 2 illustrated, the network layer is implemented with [27], which is much faster to find files using a distributed Hashtable in distributed system compared to unstructured distributed system. The consensus layer is an important part to audit data before adding data into the chain. Considering the efficiency and security, we propose the Delegated Proof-of-Stake (DPoS) to carry out the consensus process where the stake stands for the volume of storage of health data. We also introduce economic incentives to keep nodes active in the economic layer. For the distributed data storage and data sharing among patients, institutes and CSPs, we design a model by using smart contract technology in GuardHealth. The model is made up of two parts, smart contract GH-DS which defines the law of data storage and GH-IS which defines the law of data sharing.

(1)
Validators, Delegators and Proposer: The role of validators is to run a full-node and participate in consensus by broadcasting votes which contain cryptography signatures signed by their private key. Validators are weighted according to their total storage. And they commit new blocks in the Blockchain and receive revenue in exchange for their work, each time there is only one chosen to generate a new block which we can call proposer. Delegators are other nodes who cannot, or do not want to run a validator themselves. They can delegate storage volume to a validator and obtain a part of their revenue in exchange. All of nodes in the Blockchain system could be delegators and validators.

(2)
Delegated Proof-of-Storage: Delegated Proof-of-Stake consensus is proposed by Bitshare, here, we modify the consensus by changing the stake into storage. It is a fast, efficient, decentralized, and highly flexible Blockchain design. GuardHealth Blockchain will have 36 validators, which are determined by volume of storage, and the largest 36 will become GuardHealth validators. Validators and their delegators will earn GHC as block provision through execution of the consensus protocol. Each time there will be one validator selected from 36 validators in turns to generate a new block. If validators cheated, or frequently offline or do not participate in governance, the trust system will record their behaviors and their stake of storage can be slashed, identity of validator will be dismissed.

(3)
GH-DS for Data Storage: GH-DS for Data Storage mainly consists of the following components.

(a)
Raw Data: Raw data consist of two types of data, one is from IoT healthcare devices, the other is from institutes. Due to limited storage of users, the data can be stored in CSPs. For security and privacy protection, the raw data are encrypted and attached with digital signatures of data providers. The CSPs will generate a list of storage address regrading to user’ address.

(b)
Data Block: CSPs will periodically store users’ encrypted data, integrate received data to generate index of health data and write into block for updating users’ health status. Transaction update is also added into block.

(4)
GH-IS for Data Sharing: GH-IS mainly consists of four parts as follows, with using proxy re-encryption for data sharing.

(a)
Transaction Request: When institutes nodes request data from patients nodes and generates transactions which include the timestamp of request, deadline, data price tagged by GHC and address of the smart contract. Transaction Request (TR) applies permission for the collected data.

(b)
Down Payment: When requestors trigger TR, they have to submit enough credits like GHC as down payment.

(c)
Data Permission: Patients nodes grant data permission to the requestors only when they pass through first three steps.

4. Proposed scheme: Guardhealth
4.1. Overview of proposed schemes
GuardHealth consists of two smart contracts and a trust system to ensure the security and privacy. In order to keep participators active, we still define economic incentives and auction scheme GH-AC using game theory to make data value flow.

Fig. 1 shows that patients encrypted data collected from IoT devices and institutes, and then upload it to CSP, update the index of health data on chain through GH-DS. Data sharing is divided into four steps in GH-IS, where requestors get data authorization and providers get economic profit in return (see Table 1).


Table 1. Symbols used in this paper.

P
The ith patient node in GuardHealth
ID
The identity of P
V
The ith validator in GuardHealth
CSP
The ith cloud service provider in GuardHealth
IS
The ith institute node in GuardHealth
MPK	Master public key
MSK	Master secure key
Security parameter
SK
Private key
RK	Re-encryption key
RL	Set of identities
4.2. GH-TG: Assess data trust scheme
(1)
Generate trust for patient nodes: Trust generation mechanism is a critic component of data sharing process. It provides guarantee for the institute nodes to make optimal determination among the balance of data payment and its quality. We consider different factors to formulate the trust assessment mechanism. As for patient nodes, there are two highly correlated factors of the data reliability contributing to the institute nodes’ determination.

(a)
Status Similarity: Considering a data transaction scenario, an institute node IS
 releases a data collecting request to patient nodes. The trust of patient node P
 will change dynamically after every TE. We take one node P
 from the patient nodes in one TE as an example. The institute node IS
 will present their demands about the collected data from many aspects in which time and location similarity are the most essential factors. In a transaction epoch, higher status similarity means patient node is more trustworthy. The status coefficients of patient nodes are represented by . The status similarity between IS
’s demand and P
’s status is 
 which ranges from 0 to 1. And 
 can be derived from (1)
 The closer the time of data collection to IS
’s expected time, the higher the blue P
’s trust score will be. We denote the median of the expected collected time as 
, and median of the experimental collected time as 
. The time period dissimilarity 
 is defined as (2)
 
 where  is the similarity parameter of time period set by the mechanism, which controls the weight of timeliness’ influence on the trust of node P
. Sharing data which could better satisfy the location demand of node IS
 is more trustworthy for institute’s collecting purpose. It is also a part that contributes to trust coefficient of a data provider, patient node P
. We call the center of the expected data collected location as 
, and the center of the provided location as 
. Similarly to the time period definition, we can derive the location dissimilarity 
 from (3)
 where 
 represents the distance from the center of expected data collected location to the center of the patient node’s location.  is a normalization parameter that controls the weight of the location similarity to 
, and it will guarantee 
 ranges from 0 to 1.

(b)
Actual Transaction Frequency: The frequency of actual transaction indicates the degree of honesty of patient nodes and trust of sharing data. To scale the frequency, we introduce the parameter 
 to represent the actual transaction frequency of patient node P
 at TE 
. To make sure the time of 
, we use  to represent the amount of epochs to be observed. The institute node sets the value of  according to their demand of collected data. During the time window of the latest  epochs, patient node P
’s performance in every transaction will be included to the evaluation of its trust. We calculate the value of 
 as (4)
 
 where 
 represents the transaction times of patient node in ith TE. And 
 represents the average times that a institute node IS
 finish a transaction in per TE. The higher 
 brings higher trustworthiness of the patient node P
 in 
. After calculating the value of two main factors that have impact on patient node’s trust, we can get the final trust 
 as (5)

(2)
Generate trust for CSP nodes: The trust of CSP nodes is an important parameter that indicates the CSP’s trustworthiness. We generally evaluate a CSP node’s performance from its reliability on protecting the safety and integrity of the data it conducts. Many adverse factors may have negative impact on the service quality of a CSP node, such as the data loss caused from exoteric malicious attack to the server or the unavoidable crashes during the CSP’s running time. We can evaluate the performance of a CSP node with two parameters, the integrity degree of the conducted data when the CSP node responds to the service request of the patient node We scale this important factor as follows.

(a)
Data Loss Frequency: Data Loss Frequency (DLF) means the ratio of data loss issues among all data conduction in latest  epochs. We can derive DLF by accounting the data loss issues through comparing the Hash value after the data transmission with the data’s original Hash value. The patient node will report the issue after every TE. We formally give the mathematics definition of DLF, we denote it as 
, where k represents the index of CSP node CSP
, 
 represents the TE number. We calculate 
 as (6)
 
 where 
 denotes the amount of data loss issues during the th TE among the all  TEs. 
 represents the average data conduction time of in the latest  TEs. It is obvious that 
 ranges from 0 to 1. The higher 
 indicates higher reliability of CSP node k during 
.

(3)
Generate joint trust for a transaction: In response to the requirements from institute nodes of trust in every transaction, we introduce joint trust value to indicate the trustworthiness of the shared data. We denote the joint trust value as 
. We can get calculate the joint trust value from (7)
where 
 denotes the trust value of the assigned patient node P
 in TE 
, 
 represents the Data Loss Frequency of the CSP node j which provide service for the patient node P
 in 
. The higher 
 indicates the higher quality of the shared data.

4.3. GCN-MD: Detect malicious nodes by GCN
We propose a novel GCN model for malicious nodes detection named as GCN-MD. The design goal of model is to discriminate the malicious nodes in our data sharing system, we will gradually limit the data transaction rights of the doubtful nodes. After several TEs of observation, the doubtful nodes that have determined to be malicious nodes, and they will be kicked out from the data sharing network (see Fig. 3).

(1)
Graph Model: Assuming  vertices include network nodes with each edge corresponds to one transaction relationship. We observe a set of M nodes over a time period of  TEs. The graph network , where the set of nodes, , and the set of edges, , are defined as follows:

•
 is a node in GuardHealth network whose identifier is  }:a set of network nodes.

•
  
: a set of edges connecting nodes representing the data transactions.

Fig. 4 shows an example of a data sharing network graph.
(2)
Node Features: Each node has associated several features, we define the features based on nodes’ performance from the trust assessment mechanism. As for CSP nodes and patient nodes, the features for the observed TEs include their quantified real-time data throughput capability, device type, feedback from previous data buyers, their trust value and their service price. The local information that correlated with their previous interactions are especially pivotal features to be dig out.

(3)
Detection Mechanism Scheme: Based on the node features collected above, we propose a novel GCN on our model. The design goal of model is to discriminate the malicious nodes in our data sharing system, we will gradually limit the data transaction rights of the doubtful nodes. After several TEs of observation, the doubtful nodes have determined to be malicious nodes, and they will be kicked out from the data sharing network. Based on above design goal and solution methods, In the nodes’ data sharing network, where at each TE, each node receives a local observation that contains other nodes’ trust values and their performance evaluation parameters in previous transactions [17]. Based on above design goal and solution methods, we learn effective graph embeddings of lth layer 
 to indicate the malicious nodes’ impact on their interactive nodes from the adjacency matrix . The embedding matrix 
 contains the probability prediction for the suspiciousness of observed nodes. Multi-layer GCN takes the initial embedding 
 which contains the above defined features of the nodes and the initial adjacency matrix  as input. From the propagation rule, we set the trainable weight matrix 
 to the GCNs. The propagation rule is mathematically defined as (8)
 
 
 (9)
 (10)

4.4. GH-DS: Secure data storage scheme
(1)
Encrypted data storage in the GuardHealth: The encrypted data from patients are stored in the GuardHealth Blockchain through the following steps.

(a)
Step 1 (User Parameter Generation): Elliptic curve digital signature algorithm, asymmetric cryptography are used in the Guardhealth. When every patient P
 becomes a legitimate node in the system, every P
 with the identity ID
 obtains its address, public key and private key. When P
 carries out system initialization, it downloads the latest data block from other nodes in the Blockchain.


Download : Download high-res image (71KB)
Download : Download full-size image
(b)
Step 2 (Encrypt Data of User): We modify Proxy Re-Encryption [38] to fit into our encryption scheme. The data encryption process is illustrated in Algorithm 1. As described in line 1, a secure parameter  is chosen to setup public parameter and master secret key (MSK). With public parameter and identity 
 of user, it generates a secret key SK
. Cipher text (CT) is produced by function , using public parameter  and ID
 combined with plain text. Finally, user sends encrypted data CSP.

(c)
Step 3 (Uploading Encrypted Data): Patients encrypted his own data using own private key before uploading it to CSP. Then patient sends his own encrypted data to a cluster of CSPs. Meanwhile, when CSPs successfully store patient’s data, it will update the index of health data in status root on GuardHealth which includes Hash of encrypted data, timestamp, storage address and trust.

(d)
Step 4 (Updating Records of Chain): One of the validators 
 generates a new data block with timestamp and broadcasts them to other validators for audit and verification. During the time, the validator who generates the block will be awarded with GHC. After that, the new block is broadcasted to all other nodes in the network, and then added into the GuardHealth Blockchain.

(2)
Index of Health Data Storage in the GuardHealth Blockchain

(a)
Step 1 (Generating Index of Data and Transaction): When CSPs successfully store encrypted data of one of the users, the CSPs generate an index of the health data as Table 2 shown:

(b)
Step 2 (New Block Generation): When CSPs broadcast the index of health data to nearby nodes. Nearby nodes collect all local information during a certain period, then encrypts and digital signs these data to guarantee authenticity and accuracy. For traceability and verification, each block contains a cryptographic Hash to the prior blocks. Different from Bitcoin or Ethereum, each time the proposer could get a chance to generate a new block. Proposer calculates the Hash value of its block based on a random nonce value , the data block’s Merkle Patricia root, previous Hash of block with pre-defined difficulty which controls speed of generating blocks. When a new block generated, proposer broadcasts the block to other node who will audit and verify the records in the block with random value . If other nodes agree on the data of block, the new block will be added into Blockchain by a chronological order.


Table 2. Index of health data.

Hash of encrypted data
Timestamp
Storage address
Trust opinion
4.5. GH-IS: Secure data sharing scheme
The data sharing among patients, institutes, and CSP consists of the following steps, and we modify the idea of proxy re-encryption to design this scheme.

(1)
Step 1 (Uploading Data Sharing Request): Data requestor first sends its own identity 
 and query for encrypted data as showed in line 1 in Algorithm 2. Meanwhile, if requestors pay to query data, they have to have a down payment into GH-IS account. Received the query for health data, with the records of trust system, the user could grant the requestor access to the information.

(2)
Step 2 (Sharing Data Re-encryption): Data owner would authenticate the request from requestor, verifying the information  with identity 
 and partial secret key 
. If trust of the requestor is valid, data owner would like to grant data permission to requestor by regenerating encryption key 
 and then sends it to CSP to re-encrypt ciphertext using the encryption key 
.

(3)
Step 3 (Recording and Data Sharing Events in the Blockchain): After obtaining the shared data, the requestors pay for the data provider the rest of tokens, and generates a record of data sharing transaction, and adds this transaction to update balance of account as a data block into Blockchain.

(4)
Step 4 (Revocable Access): As it showed in line 8–9 of Algorithm 2, there is a time limit to how long users share data. If the deadline is exceeded, GH-IS will withdraw the permission by removing the requestor from the revocation set (RL) and re-encrypt the data.


Download : Download high-res image (122KB)
Download : Download full-size image
5. Security analysis and experiment
5.1. Security analysis based on Blockchain
Consortium Blockchain and smart contract technologies are utilized to ensure security and privacy protection regarding to data storage and data sharing. Two smart contracts–GH-DS and GH-IS, are autonomous, self-executed and self-maintained among users, even without mutual trust, they could make transactions go into effect.

Different from centralized data storage [24] which concedes serious risks, users could completely own their personal data due to the decentralized characteristic architecture. Data are encrypted stored in CSPs or their own devices, and Blockchain only contains the index of encrypted data. Only with owner’s permission, otherwise no one is accessible to its data.

Getting rid of a trusted intermediary, data sharing could be processed through GH-IS. With implementation of Proxy Re-encryption, owners grant permission to requestor by generating a proxy key. We assume that owner’s private key and requestor’s private key are secure, even proxy key is captured by adversaries, it is still hard to decrypt the data. All sharing records are recorded in TX Merkle Patricia Tree and publicly audited by other entities, so it is impossible to compromise all entities due to cost. Besides, data owners could revoke one of the requestor’s permission if the data sharing process ends or user is dissatisfied.

Once a block is validated and added into chain, it means it is immutable and authentic. No adversary could gain control over the majority of the network resources [14], only controlling a few nodes could do little thing. Therefore, the proposed scheme is feasible.

5.2. Blockchain performance evaluation
The Block structure is based on Ethereum. In a block, the lengths of Prehash, Status root and Tx root are all set as 32 Bytes; Nonce and Timestamp are both with the length of 4 Bytes. Other key parameters in Block header are shown in Table 3.

In our scheme, we use 1024-bit RSA for asymmetric signature, 128-bit AES for symmetric encryption, and SHA-256 for Hash function. In block body, the index of data is stored in Status Merkle Patricia tree where Hash of encrypted data is 32 bytes, timestamp is 4 bytes, storage address is 128 bytes, and trust opinion is 4 bytes. The transaction data for each account stored in TX Merkle Patricia tree is 32 bytes.

We assume that the volume of every block of 1 MB is generated every 1 min which could contain 2987 times different storage record or 8363 times transaction, then the throughput can reach 49 storage records per second or 139 transactions per second.

Fig. 5 shows that the time of two smart contracts execution is almost linear to the size of network. GH-DS illustrates that the time cost of a number of users when smart contract generates its index of data, and GH-IS defines how users share their data. As more nodes get into the network, the time cost of GH-IS and GH-DS increases because contracts have to process more transactions. The time costs on GH-IS per transaction is longer than GH-DS because GH-IS includes key regeneration which makes up most of the time.


Download : Download high-res image (136KB)
Download : Download full-size image
Fig. 5. Execution time of smart contract.


Table 3. Key parameter in Block header.

Parameter	Length (Bytes)
Prehash	32
Timestamp	4
Nonce	4
Status root	32
TX root	32
Difficulty	17
Miner	128
Gaslimit	4
Size	4
Fig. 6 depicts the propagation latency and the bandwidth consumed at each node for different network sizes for reaching consensus once the committees are formed. The number of latency increases when there are more nodes in the network because there are a lot of extra messages required for running and more nodes who are waiting for reception. While the bandwidth consumed at each node remains roughly unchanged around 5 MB per node. Thus, even when more nodes join the network, existing nodes do not have to bear more costs.


Download : Download high-res image (133KB)
Download : Download full-size image
Fig. 6. Propagation latency and bandwidth in the network.

5.3. Numerical results of trust assessment
To evaluate the feasibility and assessing accuracy of our proposed scheme with Python simulation on a single Linux machine. We simulate 20 CSPs, 100 patients and 20 institutes to compose a data sharing network. The default trust value can be set as a random value that ranges from 0.8 to 1. The scattering and relatively big value setting resemble a real-world scenario that we suppose high values to indicate the reliability of a batch of new registers.

To get more accurate evaluation results, we define adversary nodes that perform unreliable data sharing behaviors. We simulate adversary nodes’ behavior based on our before definition for nodes’ trust. But the unreliable nodes are not performing suspicious behaviors in every observed transaction epoch (TE). They launch on–off disturbance to gain higher trust value for which we could test the robustness of our trust assessment mechanism. As for abnormal CSP nodes, they deliberately make data loss mistakes intermittently. Abnormal patient nodes are assigned to bid for data transactions with a very low price and send irrelevant data to disturb institute nodes’ normal order. The abnormal nodes are arranged to be smart enough to make a balance between achieving abnormal intention and gaining trust deceptively. Through this, we can test our GH-TG mechanism in the worst situation. We generate a unique information setting to every node. Our default parameter settings are listed in Table 3.

Our design goal is to propose an effective mechanism that could access the trust value for nodes in the data sharing network. With updating the trust value in real TE, we could leverage the trust assessment results for maintaining data transaction order and its effectiveness. As shown in Fig. 7, we track the average trust value changes of those abnormal nodes over TE. We also observe the average value of other normal nodes. We can see the malicious intention of abnormal nodes are revealed over TE. The average trust value of normal nodes decreases during first several TEs and become smooth fluctuation gradually. And the value of abnormal nodes is obviously lower than that of normal nodes. The test results are in line with our design expectation. In this way, we could make sure the next step data transactions are based on a reliable reference parameter. The accuracy and effectiveness of our trust assessment mechanism thus ensure high-quality and reliable data sharing (see Table 4).

5.4. GCN-MD evaluation
To conduct more accurate detection, we build the network graph using all the normal and abnormal nodes’ transactions generated from 2000 TEs with 500 participant nodes. When the data generating process is started, detail information of a transaction, the trust value for a specific node and other parameters correlated with the transaction will be documented. To show the effectiveness and accuracy of our malicious nodes inference and anomalous behaviors prediction, we conduct experiments with the same default parameter setting in 5.3. The harsh conditions we set can test the robustness of our detection mechanism and make our experiments more credible. We evaluated the detection accuracy and the effect of removing malicious nodes from the network. In the experiment we keep all nodes even if the node has determined to be malicious, we observe the detected nodes to verify malicious behavior prediction effect of our mechanism.

Experiment.
In the experiment, we first tested two classical classification approaches: Logistic Regression and Multilayer Perception. After multiple adjustments, for conducting optimal classification, we set that our MLP model with two hidden layer of 100 neurons and was trained for 500 epochs by using the data transaction dataset collected by us and a learning rate of 0.001. The precision curve in Fig. 8 shows that our detection model out performs other two classical classification approaches. In the front part of observed TEs, our detection precision is a little better than other two. But with the TE increases, the detection accuracy gap between them becomes wider, which is in line with our expectation. The gap changes correspond to the superiority of GCN that with the interaction between nodes to nodes become more frequent, the classification and prediction results show more advantages due to abundant knowledge the model holds among the intrinsic connections between observed nodes.

We also tested the relativity between the amount of participator nodes and the malicious detection performance. We set the same proportion of each kind of participator node as the prior experiment. As is shown in Fig. 9, with the increase of amount of the participators, the detection accuracy is improved. We also found that the GCN-based malicious detection mechanism relies on the group size of nodes a lot. When the amount of nodes is in a relatively low level, the detection accuracy was not too much higher than MLP and Logistic Regression. This result confirmed the characteristics of GCN-based detection model we mentioned above.

6. Conclusion
In this paper, we proposed a secure and efficient scheme for preserving health data based on Blockchain. We present consortium Blockchain and two smart contracts-GH-DS and GH-IS, enabling data storage and data sharing providing auditability and interoperability with implementation of Proxy Re-encryption. Graph Convolutional Network, on detection of malicious nodes, is assembled to build a trust model to enforce security and decrease risks. And we look forward an Economic mechanism to provoke user’s participation and governance. The security analysis demonstrates that our scheme could meet security requirements. Performance evaluation shows our scheme has great advantages on efficiency over traditional schemes.

Limitation: Due to the limited training dataset, sometimes our malicious node detection model is not so adequate to the purpose we set. When the amount of participator nodes is in a relatively low level, the malicious detection accuracy is not much higher than the traditional approaches. Besides that, as the experiment result of Blockchain efficiency performance shows, the network latency goes up in proportion to the increase of number of nodes. This implication point requires us to further optimize the network layer of Blockchain system.

Future work: A few alternatives on Blockchain were proposed recent years. It is interesting to study the performance of other important tasks like the efficiency of Blockchain and privacy issues on smart health. Moreover, as our proposed mechanism is general, it is interesting to see how other existing models behave under this umbrella and find more utilizable models with similar privacy guarantees. In addition, our GCN-based malicious model can be further designed to achieve more functionality in guaranteeing the user’s privacy and the quality of data collected by medical institutes.

