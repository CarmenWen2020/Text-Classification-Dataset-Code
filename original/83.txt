Abstract
Establishing a healthy lifestyle has become a very important aspect in people's lives. The latter requires maintaining a healthy nutrition by considering the type and quantity of consumed foods. It also requires maintaining an active lifestyle including the necessary amount of physical exercise to regulate one's intake and consumption of calories and nutrients. As a result, people reach out for nutrition experts to perform health assessment, whose services are costly, time consuming, and not readily available. While various e-nutrition solutions have been developed, yet most of them perform meal planning without performing health state assessment or evaluation (traditionally provided by human experts). To our knowledge, there is no existing automated solution to perform nutrition health assessment, recommendation, and progress evaluation, which are central pre-requites to the meal planning task. In this study, we introduce a novel framework titled PIN for Personalized Intelligent Nutrition recommendations. PIN relies on the fuzzy logic paradigm to simulate human expert health assessment capabilities, including weight, caloric intake, and exercise recommendations as well as progress evaluation and recommendation adjustments. It includes three essential and complementary modules: i) Weight Assessment and Recommendation (WAR), ii) Caloric Intake and Exercise Recommendation (CIER), and iii) Progress Evaluation and Recommendation Adjustment (PERA). This underlines the first computerized solution for nutrition health assessment. We have conducted a large battery of experiments involving 50 patient profiles and 11 nutrition expert evaluators to test the performance of PIN and evaluate its health assessment quality. Results show that PIN’s assessment and recommendations are on a par with and sometimes surpass those of human nutritionists.

Keywords
Nutrition health
Assessment and recommendation
Progress evaluation
Recommendation adjustment
Fuzzy logic agents
Fuzzy reasoning

1. Introduction
Nowadays, establishing a healthy lifestyle has become a very important aspect in people's lives. The latter requires maintaining a healthy nutrition by considering the type and quantity of consumed foods, as well as maintaining an active lifestyle including the necessary amount of physical exercise to regulate one's intake and consumption of calories and nutrients (Orji and Mandryk 2014, Parker and Grinter 2014). Poor nutrition and a lack of physical activity tend to increase the risks of dangerous complications such as obesity, diabetes, and other health issues (Ayoub et al. 2015, Mattar et al. 2015). As a result, people reach out for nutrition experts to help them achieve healthy lifestyles. In this context, a few obstacles come to play: i) the cost of seeking an expert's help which is recurring and non-trivial, ii) the need to attend regular meetings with the expert which might not be always practical, and iii) the need for readily accessible health services which might be difficult to provide by a human expert. An alternative approach is to use electronic solutions, such as mobile applications and websites that are highly available and provide basic health and nutrition services. While many solutions exist, yet most of them share the following weaknesses: i) lack of a completely automated process, where most existing solutions require manual tuning and a certain level of nutrition expertise to be utilized properly, e.g., (Livestrong Foundation 2021, Evans, 2017, El-Dosuky et al. 2012), ii) providing limited health assessment by considering certain (less informative) health indicators (e.g., BMI1) and disregarding others (e.g., BFP2) (MyNetDiary Inc. 2021, SparkPeople Inc. 2021), and iii) performing meal planning or meal plan evaluation without performing health state assessment and progress evaluation (MakeMyPlate Inc. 2021, Noor et al. 2018, Petot et al. 1998), which are central pre-requites to the meal planning task. In fact, to our knowledge, there is no existing automated solution to perform nutrition health state assessment, recommendation, and progress evaluation.

The main goal of this study is to create a framework that provides the same quality of services offered by a human nutrition expert albeit doing it through a readily available, fully automated, and cheap e-solution. Our framework aims at providing: i) an assessment of the patients’ nutrition health state: whether they should gain, lose, or maintain weight (based on multiple nutrition-health indicators), ii) a recommendation to strike a good balance between food intake (how much the patient should eat) and physical exercise (how much the patient should exercise), and iii) a progress monitoring and adjustment of the patient's health indicators and weight. To achieve the latter services, we develop a new framework titled PIN for Personal Intelligent Nutrition recommendations. It includes three main agents designed using the fuzzy logic paradigm to simulate the “human common sense” thought process involved in nutrition health assessment and recommendation; i) Weight Assessment and Recommendation (WAR) agent: evaluates the weight state of a patient based on various inputs (age, gender, height, weight, and BFP) and then recommends a target BFP and weight (an early version of this agent is described in (Salloum et al. 2018)), ii) Caloric Intake and Exercise Recommendation (CIER) agent: estimates Caloric Intake (CI) and exercise recommendations based on the physical activity level of the patient and the patient's target BFP and weight produced by the WAR agent, and iii) Progress Evaluation and Recommendation Adjustment (PERA) agent: monitors and evaluates the progress of the patient toward the target BFP and weight, and adjusts the CI and exercise recommendations when required (i.e., when the patient is not making the expected progress). PERA is specifically important since patients’ bodies do not always evolve regularly or the same way, even when following the same nutrition recommendations. CIER and PERA’s recommendations are required to perform meal plan generation3.

We have conducted a large battery of experiments involving 50 patient profiles and 11 nutrition experts to test the performance of PIN. Various experimental tasks and metrics were designed with the help of 2 elect experts4 to evaluate each of PIN’s three agents: WAR, CIER, and PERA. Inter-tester correlations were evaluated and matched with PIN’s scores to account for human expert (dis)agreement. Results show that PIN’s assessment quality and recommendations are on a par with and sometimes surpass those of human nutritionists.

The remainder of this paper is organized as follows. Section 2 presents the background and motivations of our study. Section 3 briefly reviews the related works and existing e-solutions revolving around nutrition health assessment. Section 4 describes the PIN framework and its components. Section 5 describes our experimental evaluation and results. Finally, Section 6 concludes with future directions.

2. Background and Motivations
The first step to performing nutrition health assessment requires collecting input information regarding the patient: i) gender, ii) age, iii) height, iv) weight, and v) Body Fat Percentage (BFP). Based on the latter, the human nutritionist's main task consists of: i) evaluating the patient's current BFP and weight, ii) recommending the patient's target BFP and weight, and iii) evaluating the patient's BFP and weight progress to adjust the recommendation accordingly. Based on the latter information and evaluations, the nutritionist can recommend a meal plan allowing the patient to reach her/his target BFP and weight.

In this section, we briefly review basic nutrition and health related concepts targeting the above tasks, and highlight the challenges and motivations of our study. Note that we omit the discussion of meal plan generation and evaluation tasks form this paper and describe them in a dedicated study (Salloum and Tekli 2021). We also provide a brief description of the preliminaries of the fuzzy logic paradigm.

2.1. BFP and Weight Assessment and Recommendation
A common approach for nutrition health assessment relies on the usage of height-weight tables (Kathleen and Janice 2017) as a tool for mapping patients’ heights to recommended weights. Several ideal weight formulas can be used to recommend the weight of a person based on her/his height, while sometimes considering other parameters such as gender and age (Pai M. P. and Paloucek 2000). For instance, Body Mass Index (BMI) (Kathleen and Janice 2017) is a well-known health metric that considers both the current weight and height of the patient, and is computed following Formula 1:(1)
 
(2)
 
While BMI and similar formulas can provide a target (ideal) weight recommendation based on the patient's height (if the target BMI is known in advance), they disregard the current weight of the patient (i.e., the weight of the patient at the time of the recommendation), and more importantly they disregard the patient's body fat composition. For instance, the author in (Khan and Hoffmann 2003) demonstrated in a study of 486 subjects, that about 87% of the patients classified as normal and overweight following BMI were actually obese according to their Body Fat Percentage (BFP). BFP is a commonly used health metric that is computed as the ratio of the patient's body fat weight over the total body weight following Formula 2. It is an indicator of the patient's body fat composition which is essential to perform accurate health assessment (Kathleen and Janice 2017). In our study, we adopt the BFP classification suggested by the American College of Sports Medicine (Khan and Hoffmann 2003), which is commonly used in nutrition health literature. The latter classifies patients as underweight, healthy weight, overweight, or obese based on their BFPs, taking into account their gender and age.

Once the patient's BFP is identified (through a simple test that can be performed at a specialized clinic or pharmacy), the expert nutritionist can decide on the target BFP and weight of the patient using a experiential reasoning process, which brings us to the first challenge motivating our study:

Motivation 1: There is no algorithmic or mathematical procedure to compute the target BFP and the target weight of a patient. Our literature review and discussions with professional nutritionists indicate that BFP and weight recommendations are “fuzzy” tasks which usually rely on the experience and expertise of the nutritionist.

Once the target BFP and weight are identified, the nutritionist needs to determine the daily Caloric Intake (CI) required to reach those targets, considering the patient's Caloric Expenditure (CE) and exercise habits. In fact, weight change comes down to the gap between CI and CE, i.e., the difference between the amount of energy acquired from food and the energy consumed by the human body, both measured in Kilocalories (Kcal). If the daily CI is larger than the daily CE, the patient will gain weight in the long run, and vice versa (Min et al. 2019). In this context, several mathematical formulas exist to identify CE, considering the Basic Metabolic Rate (BMR) and the Total Energy Expenditure (TEE) of the patient (Kathleen and Janice 2017). Also, various guidelines exist regarding how to ensure a steady and healthy weight loss5. In this study, we aim to provide personalized recommendations while abiding by standard health guidelines, e.g., (ODPHP 2015, Hall et al. 2011, Hall 2008).

2.2. Caloric Intake (CI) Recommendation
Another service provided by a nutrition expert is determining the CI of the patients while considering their target weights and Total Energy Expenditures (TEE). When determining CI, three general guidelines are usually adopted: i) if the goal set for the patient is to maintain weight, CI should be equal to TEE; ii) if the goal is to gain weight, CI must be greater than TEE; and iii) if the goal is to lose weight, CI must be lower than TEE, which brings us to our second motivating challenge:

Motivation 2: There is no algorithmic or mathematical procedure to compute CI reduction. Our literature review and discussions with nutritionists indicate that it is a “fuzzy” process which requires common-sense decision making.

2.3. Exercise Recommendation
In addition, daily physical exercise can contribute in increasing the TEE, and thus affects CI recommendation accordingly. In certain cases, exercise is the only way to lose weight without recommending an excessively low and unhealthy CI. However, the exercise caloric expenditure is relative to body weight, and general guidelines are difficult to apply to every case (ODPHP 2015). Exercise recommendation relies on: i) CI, ii) TEE, iii) general exercise guidelines, and iv) the patient's exercise preferences, which highlights our third motivation:

Motivation 3: There is no algorithmic or mathematical procedure to compute the amount of exercise needed to reach a target CI reduction rate. Our literature review and discussions with nutritionists indicate that it is a “fuzzy” process requiring common-sense decision making.

2.4. Progress Evaluation and Recommendation Adjustment
Progress monitoring and re-evaluation are common practice in health nutrition (Kathleen and Janice 2017), allowing a nutritionist to adjust the patient's CI and exercise recommendations when small or no BFP and weight progress are being made - despite the patient's adherence to the nutritionist's previous recommendations, which brings us to our fourth motivating challenge:

Motivation 4: There is no algorithmic or mathematical procedure to evaluate the progress of the patient's BFP and weight, and there are no clear guidelines to determine how much progress is acceptable when the patient is not losing (or gaining) the expected weight. Our literature review and discussions with nutritionists indicate that it is a “fuzzy” and subjective process requiring common-sense decision making which might significantly differ from one nutritionist to the other.

2.5. Preliminaries of Fuzzy Logic
Fuzzy logic is a multivalued logic that allows the definition and usage of intermediate values between conventional evaluations like true/false, yes/no, gain/loose/maintain weight, etc. It is a paradigm for processing data by using partial set membership, where an element can be part of one set and its compliment albeit with varying membership degrees (e.g., 70% true and 30% false). It incorporates a condition-action rule-based IF X AND Y THEN Z approach rather than attempting to model a system mathematically (Ross 2016). The model and its fuzzy membership functions are defined empirically, and rely on the designer's experience and understanding of the system and its environment (Vlachos and Sergiadis 2007). For example, rather than dealing with weight recommendation in terms of CI=1500 kcals, BMI = 21.2, and BFP = 17.5, expressions like IF Overweight(BMI) AND Fair(BFP) THEN Good(BFP) are used. While they seem imprecise, yet such expressions can be very descriptive and provide a necessary level of abstraction on top of the crisp data values, allowing to guide the decision making process.

A typical fuzzy logic agent consists of 4 main components (Ross 2016, Kuncheva 1995, Zadeh 1984): i) fuzzification, ii) inference, iii) aggregation, and iv) defuzzification. Fuzzification consists in transforming input crisp values (received from sensors) into fuzzy membership scores associated with a set of linguistic variables (e.g., normal, underweight, obese) defined by the system designer (e.g., BMI = 21.2 is transformed into 87% normal and 13% underweight). Inference consists in applying a set of designate condition-action rules on the fuzzified data in order to produce fuzzy outputs. Multiple rules can produce different outputs, and need to be aggregated in order to produce one single fuzzy output function. The fuzzy output function is consequently defuzzified in order to produce crisp values as the final output of the agent (sent as commands to the actuators).

In this study, we adopt the fuzzy logic paradigm in order to automate the “human common sense” thought process involved in nutrition health assessment and recommendation.

3. Existing E-Solutions
Computerized applications related to nutrition health are becoming more and more available for users on different platforms. They can be organized in two main categories: i) calorie tracking tools and ii) meal planning tools. Most of them disregard nutrition health assessment, recommendation, and progress evaluation.

3.1. Calorie Tracking Tools
Calorie tracking tools, e.g., (MyNetDiary Inc. 2021, Evans 2017, Hall et al. 2011, Hall 2008), assist patients in monitoring their daily caloric intake (CI) and consumed macronutrients by accepting as input the patient's consumed foods, and producing/calculating as output the amount of calories and macronutrients contained in the consumed foods. One such tool is MyFitnessPal (Evans 2017), a mobile application that accepts as input the patient's consumed foods selected from a predefined food database, and then produces as output the required CI per day and the distribution of macronutrients necessary to reach the destination weight. The application also calculates and keeps track of the CI and macronutrient grams consumed by the patient, and offers additional functionality related to training and workout logs. The tool requires the patient to provide basic health information (e.g., age, weight, height, and physical activity level), as well as more technical nutrition health information (e.g., target weight, daily CI, and macronutrient distribution) which are usually determined by a nutrition expert. Another similar tool is MyPlate (Livestrong Foundation 2021) which collects the patient's basic health information (e.g., gender, age, height, weight) and requires the patient to determine her own target weight. The tool then estimates CI levels based on the patient's target weight and total energy expenditure (TEE). No exercise recommendations are suggested in the case of low TEE to compensate for the recommended low CI. Other similar tools such as MyNetDiary (MyNetDiary Inc. 2021) and SparkPeople (SparkPeople Inc. 2021) are also available on the Web. In short, the above mentioned tools i) require technical inputs which might be difficult to provide by non-expert users (e.g., target weight and macronutrient distribution), and ii) perform calorie consumption tracking based solely on the patient's weight and height (without considering the patient's BFP) which do not always produce accurate recommendations (due to the lack of distinction between fat mass and muscle mass, cf. Section 2).

3.2. Meal Planning Tools
Meal planning tools, e.g., (EatThisMuch Inc. 2021, Fitness Meal Planner 2021, MakeMyPlate Inc. 2021), generate daily meal plans based on patient provided CI requirements. One such tool is MakeMyPlate (MakeMyPlate Inc. 2021), a mobile application that recommends daily pre-defined meal plans fulfilling user specified CI levels. It allows the patient to replace a meal with an existing meal stored in the database, without verifying whether the replacement meal is calorically equivalent to the original one (which might result in surpassing or dropping below the recommended CI and macronutrient amounts). Another solution is EatThisMuch (EatThisMuch Inc. 2021), which accepts as input the patient's basic health information (e.g., gender, age, height, weight, and physical activity level) in addition to the BFP. It also accepts as input the patient's target weight in textual from (i.e., maintain weight, lose weight, gain weight, and gain muscle), the preferred diet type (e.g., Mediterranean, vegetarian), as well as patient food preferences. The application then produces as output daily meal plans. While powerful, yet this solution does not make any recommendation or decision regarding the health state of the patient (i.e., it does not generate a target weight or a CI recommendation). Fitness Meal Planner (Fitness Meal Planner 2021) is yet another online application sharing most of the functionalities as well as the limitation of the latter solution. The authors in (Yang et al. 2017) describe an online framework to monitor foods consumed by the patient, using food image recognition through machine learning. The system learns patient preferences by allowing the patients to select their favorite foods by uploading pictures of them. Then, image analysis is performed through a dedicated convolutional neural network to recognize the foods in the picture, allowing the system to recommend similar foods from a pre-defined food database. The aim of the study is to improve the recommendations of survey-based systems (where food preferences are learned through manual patient surveys) by using image analysis-based preference learning. Yet, the study in (Yang et al. 2017) does not aim to produce target weight or CI recommendations, nor does it produce meal plans that meet the nutrition requirements of a patient. In (Rabbi et al. 2015), the authors introduce another machine learning algorithm called Multi-Armed Ban (MAB) to cluster the physical activities and food logs of the patient, and provide personalized suggestions such as recommended meals or increasing the patient's physical activity. Yet, similarly to (Yang et al. 2017), the solution does not perform nutrition health assessment, and does not produce target weight or CI recommendations. Few knowledge-based approaches have been developed to evaluate meal plans, e.g., (Lertkrai et al. 2016, Wang. et al. 2016, El-Dosuky et al. 2012, Lee et al. 2010, Wang 2009), using food ontologies constructed by domain experts and coined with fuzzy inference rules. Yet, most approaches in this category focus on evaluating existing meal plans suggested by the patient, rather than performing automatic nutrition health assessment, recommendation, and progress evaluation. The reader can refer to (Tran et al. 2020, Valdez et al. 2016) for comprehensive reviews of recommender systems for health informatics.

3.3. Discussion
To sum up, most existing nutrition health e-solutions share the following limitations: i) lack of a completely automated process for health assessment and meal planning, requiring domain expert intervention at different stages of the recommendation process (e.g., identifying target weight and macronutrient distribution), ii) most solutions address the meal planning problem while disregarding nutrition health assessment, recommendation, and progress evaluation, iii) those few solutions which partly perform health assessment, e.g., (Livestrong Foundation 2021, MyNetDiary Inc. 2021, SparkPeople Inc. 2021, Evans 2017), provide “coarse” assessments considering basic indicators (such as gender and weight) rather than using a more informative nutrition measurements such as BFP which would produce more accurate results (due to the distinction between fat mass and muscle mass). We address all the above limitations in our current solution.

4. Proposal
We introduce a framework titled Personal Intelligent Nutritionist (or PIN) which aims at automating the health assessment and recommendation services offered by a nutrition expert. PIN’s general architecture is shown in Fig. 1. First, the patient provides initial health information (e.g., gender, age, weight, height, and BFP) to the Weight Assessment and Recommendation (WAR) agent who determines the patient's destination BFP and weight. WAR’s selected output is then fed as input to the Caloric Intake and Exercise Recommendation (CIER) agent to determine the patient's recommended CI and amount of physical exercise. One or more “healthy” recommendations can be generated (e.g., the same patient could be recommended to maintain her/his healthy weight and CI even though the target BFP is not reached, or to lose some weight by either reducing CI or increasing the amount of physical exercise – in order to reach the target BFP). Most importantly, and at any point in time, the patient can input her/his updated BFP and weight to the Progress Evaluation and Recommendation (PERA) agent who assesses the progress of the patient and adjusts the recommendations accordingly. The above three agents are designed based on the fuzzy logic paradigm in order to automate the “human common sense” thought process involved in nutrition health assessment and recommendation. CIER and PERA’s outputs are subsequently used to perform meal plan generation6.

FIgure 1
Download : Download high-res image (589KB)
Download : Download full-size image
Fig. 1. Simplified diagram describing PIN's overall architecture

4.1. Weight Assessment and Recommendation (WAR) agent
The WAR agent's overall process is shown in Fig. 2. It accepts as input the patient's BMI and BFP, and provides as output: i) the target BFP, ii) the target weight, and iii) the recommendation goal (i.e., loose, gain, or maintain weight). WAR considers both BMI and BMF metrics as input since their combination allows for a more accurate assessment of the patient's weight state, versus only considering the patient's weight or BMI (as discussed in Section 2.1). More specifically, WAR consists of a set of fuzzy agents carefully designed following well established crisp value BMI and BFP classifications (Kathleen and Janice 2017, Dalleck and Tischendorf 2012). The appropriate fuzzy agent is selected based on the patient's age and gender, and is then run on the input BMI and BFP of the patient in order to produce the recommended target BFP as output. Recall that there is no algorithmic or mathematical process that allows determining a target weight based on a starting BFP and weight (cf. Motivation 1 in Section 2.1). The BFP Recommendation agents are described in more detail in the following sub-section.

FIgure 2
Download : Download high-res image (221KB)
Download : Download full-size image
Fig. 2. Simplified diagram describing the general process of the WAR agent

After the target BFP is computed, the next step is to estimate the patient's target weight. Following our review of the nutrition literature, there is no agreed upon mathematical procedure to determine the percentage of fat loss out of the total weight loss. In addition, the literature lacks a clear definition on how much of the lost weight is attributed to fat loss (cf. Section 2). Hence, after many discussions with our elect nutrition experts, we adopt the following assumption: weight loss is only due to fat loss. The fat loss is the difference between the old fat mass and the new fat mass, which is represented by the BFP multiplied by the body weight (the same logic is applied in the case of weight gain). As a result, we compute the target weight as follows:(3)
 
 
which simplifies to:(4)
 
 
 
where w and w’ represent the current and target weights respectively, and p and p’ represent the current and target BFP respectively. The current body weight (w) and current BFP (p) are acquired inputs. The target BFP (p’) is computed by the corresponding fuzzy BFP Recommendation agent. Consequently, the target weight (w’) is computed using Formula 4.

As a result, more than one “healthy” option can be recommended (e.g., maintain a healthy weight even though the target BFP is not exactly reached, or slightly lose some weight to perfectly reach the target BFP) allowing the patients to choose the option that best fits their preferences. These options are produced following the condition-action rules that are activated by the agent when processing the patient's inputs. Finally, the recommendation goal is determined based on the weight recommendation: i) if the target weight is larger than the current weight, the goal is to gain weight, ii) if the target weight is lesser than the current weight, the goal is to lose weight, iii) if the difference between the target and current weights is within ±0.5 kilograms, the goal is to maintain the current weight. Ts.

4.1.1. BFP Recommendation agent(s)
The BFP Recommendation agent's overall process is shown in Fig. 3. First, the input BMI and BFP scalar values are fuzzified, producing linguistic values associated with fuzzy membership degrees (e.g., BMI 21.2 becomes 87% normal and 13% underweight after fuzzification following Fig. 4. a). We carefully craft the BMI fuzzy partitions following the WHO (World Health Organization) BMI crisp value classification (Kathleen and Janice 2017)7. BFP fuzzy partitions are crafted based on the classification suggested by the American College of Sports Medicine (Dalleck and Tischendorf 2012)7. In contrast to BMI classification that is applied for both adult females and males, BFP classification is both age and gender specific, and consists of 6 different female age categories, and 6 different male age categories (cf. Fig. 4. b and c). As a result, we define 12 separate agents: i) a female BFP Recommendation agent for each female age categories and ii) a male BFP Recommendation agent for each male age category. The fuzzy partitions for all agents are available online8.

FIgure 3
Download : Download high-res image (154KB)
Download : Download full-size image
Fig. 3. Simplified diagram describing the BFP Recommendation agent's fuzzy control logic

FIgure 4
Download : Download high-res image (447KB)
Download : Download full-size image
Fig. 4. BMI fuzzy partitions, and sample BFP partitions for female and male patients between 20 and 29 years old

As for the agent's condition-action rules, they reflect the common sense logic applied by a human nutrition expert to determine a target BFP based on the patient's current BMI and BFP. We provide in Table 1 a set of condition-actions rules that we defined with the help of our elect nutrition experts (to our knowledge, such rules are not explicitly defined in the literature). Note that the same condition-action rules, inference mechanism, aggregation and defuzzification functions are adopted in all 12 BFP recommendation agents.


Table 1. BFP Recommendation agent(s)’ condition-action rules

BFP\BMI	Underweight	Normal	Overweight	Obese
Very Lean	R1: BFP is Excellent	R7: BFP is Excellent	R13: BFP is Excellent	R19: BFP is Excellent
Excellent	R2: BFP is Good	R8: BFP is Good	R14: BFP is Good	R20: BFP is Good
Good	R3: BFP is Good	R9: BFP is Good	R15: BFP is Good	R21: BFP is Good
Fair	R4: BFP is Fair OR Good	R10: BFP is Fair OR Good	R16: BFP is Good	R22: BFP is Good
Poor	R5: BFP is Fair	R11: BFP is Fair	R17: BFP is Fair	R23: BFP is Fair
Very Poor	R6: BFP is Poor	R12: BFP is Poor	R18: BFP is Poor	R24: BFP is Poor
The rules in Table 1 can be reduced to the following set of composite rules without any loss of expressiveness:

4-
Ra: Very Lean(BFP) ⇒ Excellent (BFP) summing up rules R1, R7, R13, and R19

4-
Rb: Excellent(BFP) ∨ Good(BFP) ⇒ Good (BFP) summing up rules R2, R3, R8, R9, R14, R15, R20 and R21

4-
Rc: Poor(BFP) ⇒ Fair (BFP) summing up rules R5, R11, R17, R23

4-
Rd: Very Poor(BFP) ⇒ Poor (BFP) summing up rules R6, R12, R18 and R24

4-
R4: Underweight(BMI) ∧ Fair(BFP) ⇒ Fair(BFP) ∨ Good(BFP)

4-
R10: Normal(BMI) ∧ Fair(BFP) ⇒ Fair(BFP) ∨ Good(BFP)

4-
R16: Overweight(BMI) ∧ Fair(BFP) ⇒ Good(BFP)

4-
R22: Obese(BMI) ∧ Fair(BFP) ⇒ Good(BFP)

We adopt Mamdani's implication operator as the inference function (Formula 5), maximization as the aggregation function (Formula 6), and center of gravity as the defuzzification function (Formula 7) given the latter's common usage in the literature (Bouchon-Meunier et al. 2003, Kuncheva L. 1995) and their empirical performance in our study, i.e., they produced better target BFP recommendations compared with alternative functions. Note that our framework is flexible in allowing users to apply other fuzzy inference, aggregation, or defuzzification functions of their choosing.

Mamdani’s implication:

Given fuzzy sets f1, f2:(5)
where ∧ is the AND fuzzy logic operator9

Maximization aggregation:

Given fuzzy sets f1, f2, …, fn:(6)

Center of gravity defuzzification:

Given aggregate fuzzy set FAgg:(7)
 

The same condition-action rules, inference mechanism, aggregation and defuzzification functions are adopted in all agents. The difference between them relies in the BFP input classification and fuzzy membership functions.

4.1.2. Computation Examples
We consider in Table 210. a three running examples describing three patient cases extracted from our experimental dataset: i) a male with a good BFP, ii) a female with a high BFP, and iii) a male with a very low BFP. Table 2. b shows the results of the WAR agent produced for each of the three cases. The detailed computation process for case 1 is described in Fig. 5. Similar computation processes for case 2 and case 3 are provided in (Salloum and Tekli 2020). For case 1, two options are recommended by the agent: i) maintain the current weight, or ii) lose almost 2/3 of a kilogram. Since the patient's BFP is considered good based on his age and gender, the two recommended options are valid (following expert nutritionist feedback, cf. experiments in Section 5) allowing the patient either to maintain his current good BFP state and “healthy” weight, or to slightly reduce BFP and lose a small amount of extra weight. For case 2, considering the patient's age and gender, BFP is considered to be very poor. Here, WAR’s recommendation is to drop the BFP and weight in order to reach a poor BFP as a first step, since the agent aims to help the patient reach the good BFP state in a healthy step-by-step process. As for case 3, the patient's BFP is in the excellent category following his age and gender. Here, WAR’s recommendation is to gain some additional weight in order to increase the BFP toward the good state. Note that the good BFP state is the recommended state for non-athlete patients who do not exercise, whereas the excellent state is recommended for athletes or patients who regularly exercise (this will be further discussed in the following section).


Table 2. Patient cases extracted from the experimental dataset

a. Input data provided in the patient profiles	b. Output produced by the WAR agent
Patients	Gender	Age	Height	Weight	BMI	BFP	Goal	Target BFP	Target Weight
Case 1	Male	32	1.77 m	66.94 Kg	21.2	17.7 %	Maintain weight	17.14 %	66.49
Lose weight	16.90 %	66.28
Case 2	Female	28	1.59 m	57.6 Kg	22.82	34.4 %	Lose weight	28.07 %	52.53
Case 3	Male	23	1.83	71.88	21.34	9.4 %	Gain weight	13.32 %	75.13
FIgure 5
Download : Download high-res image (2MB)
Download : Download full-size image
Fig. 5. WAR's fuzzy computation process when applied to case 1 of our running example (cf. Table 2. a)

4.2. Caloric Intake and Exercise Recommendation (CIER) agent
While the WAR agent computes the patient's target BFP, target weight, and the goal (lose, gain, or maintain weight), the CIER agent computes both the caloric intake (CI) and the amount of exercise (or percentage of exercise, PE) that the patient should perform to reach her/his target weight recommended by WAR. As discussed in Section 2, the first step in a caloric assessment is determining the basic metabolic rate (or BMR) of a patient, based on gender, age, height, and weight. Then the total energy expenditure (TEE) is determined based on the BMR and the physical activity level of the patient11. As a result, CI is determined based on two main factors (cf. Background in Section 2.2): the goal of the patient (lose, gain, or maintain weight) and the patient's TEE. Here, three main possibilities arise: i) if the goal of the patient is to maintain weight, CI should be equal to TEE, and hence no decision making is required in this case, ii) if the goal is to gain weight, CI must be greater than TEE, and iii) if the goal is to lose weight, CI must be lower than TEE. In addition to the above, a nutritionist could provide exercise recommendations (ER) for the patient to remain in a healthy state. Yet, CI and PE recommendations are by nature fuzzy processes that involve “common sense” human reasoning considering multiple factors such as, patient preferences, general guidelines, and the expertise of the nutritionist, etc. (cf. Motivations 2 and 3 in Section 2)

In order to automate these processes, we design two dedicated fuzzy agents: i) caloric intake recommendation (CIR) agent and ii) percentage of exercise recommendation (PER) agent. The first agent is responsible for producing CI recommendations based on the TEE of the patient. The second agent produces the percentage of (the BMR to be added as physical) exercise, PE, based on the patient's caloric gap (i.e., the difference between TEE and the recommended CI). CIER’s overall process is shown in Fig. 6. We further describe each of its constituent fuzzy agents in the following subsections.

FIgure 6
Download : Download high-res image (311KB)
Download : Download full-size image
Fig. 6. Simplified activity diagram describing the general process of the CIER agent

4.2.1. Caloric Intake Recommendation (CIR) agent(s)
This CI recommendation agent accepts as input the TEE of the patient, and produces as output a set of possible CI recommendations. Based on the ODPHP12 guidelines (ODPHP 2015), CI is gender specific where different CI recommendation guidelines are provided for females and males. For instance, the CI estimations for adult females and males range between 1600-to-2400 and 2000-to-3000 Kcals respectively, whereas the minimum recommended healthy intakes for females and males are 1200 Kcals and 1500 Kcals respectively. Table 313 shows the CI classification which we define based on (ODPHP 2015). The same classification can be adopted for TEE. The corresponding CI and TEE fuzzy sets are produced using the same logic adopted with the WAR agent (cf. Section 4.1.1) and are shown in Fig. 7, Fig. 814 respectively15.


Table 3. CI classifications

a. Female classes	b. Male classes
Category	Range (Kcals)	Range (Kcals)
Extremely Low	950-1200	1250-1500
Very Low	1200-1450	1500-1750
Low	1450-1700	1750-2000
Normal	1700-1950	2000-2250
High	1950-2200	2250-2500
Very High	2200-2450	2500-2750
Extremely High	2450+	2750+

Table 4. TEE classifications (ODPHP 2015)

a. Female classes	b. Male classes
Category	Range (Kcals)	Range (Kcals)
Extremely Low	950-1200	1250-1500
Very Low	1200-1450	1500-1750
Low	1450-1700	1750-2000
Normal	1700-1950	2000-2250
High	1950-2200	2250-2500
Very High	2200-2450	2500-2750
Extremely High	2450+	2750+
FIgure 7
Download : Download high-res image (369KB)
Download : Download full-size image
Fig. 7. CI fuzzy sets defined based on the classification in Table 3

FIgure 8
Download : Download high-res image (397KB)
Download : Download full-size image
Fig. 8. TEE fuzzy sets defined based on the classification in Table 4

In addition to the gender specific classification, the CI decision making process differs if the goal is to lose, gain, or maintain weight, leading to different sets of condition-action rules for every case. Thus, we introduce 4 fuzzy agents for CI recommendation: 1) female weight gain agent, 2) female weight loss agent, 3) male weight gain agent, and 4) male weight loss agent. Both weight gain agents (1 and 3) and both weight loss agents (2 and 4) share the same condition-action rules as shown in Table 5. The condition-action rules are designed following the nutrition guidelines discussed in Section 2. We adopt Mamdani's implication operator as the inference function, and maximization as the aggregation function. The right most defuzzification function is adopted for the weight loss agents whereas the center of gravity defuzzification function is used with the weight gain agents. The latter functions were adopted following a battery of empirical results16 (cf. experiments in Section 5). Recall that our framework is flexible in allowing users to apply any other inference, aggregation, or defuzzification function of their choosing.


Table 5. CIR agent(s)’s condition action rules

a. Weight loss agent condition-action rules	b. Weight gain agent condition-action rules
TEE	Rules	Rules
Extremely Low	R1: CI is Extremely Low	R1: CI is Very Low OR Low OR Normal
Very Low	R2: CI is Very Low OR Extremely Low	R2: CI Low OR Normal OR High
Low	R3: CI is Very Low OR Extremely	R3: CI is Normal OR High OR Very High
Normal	R4: CI is Low OR Very Low OR Extremely Low	R4: CI is High OR Very High OR Extremely High
High	R5: CI is Normal OR Low OR Very Low	R5: CI is Very High OR Extremely High
Very High	R6: CI is High OR Normal OR Low	R6: CI is Extremely High
Extremely High	R7: CI is Very High OR High OR Normal	R7: CI is Extremely High
Note that the recommended CI value will be always comprised within the suggested thresholds. Nonetheless, when TEE is extremely low or very low, one of the output options is to have CI equal to TEE, since very low CI values are not recommended. The issue of extremely high/low TEE will be later tackled with the PER agent described in the following section. Note that if the weight goal of the patient is to maintain the current weight, CI is set equal to the caloric expenditure (CE), and thus no additional exercise recommendations are required (i.e., no fuzzy processing in required in this case).

4.2.2. Computation Example
Consider our running example patient cases reported in Table 6. The computation process for patient case 1 is shown in Fig. 9.


Table 6. Patient cases from our running example, including the inputs and output of the CIR agent

a. Input data provided in the patient profile	b. Target weight produced by WAR agent	c. Resulting BMR and TEE required as input for CIR agent	d. Output of CIR agent
Patient	Gender	Age	Height	Weight	BMI	BFP	Goal	Target BFP	Target Weight	BMR	TEE	Recommended CI
Case 1	Male	32	1.77 m	66.94 Kg	21.2	17.7%	Lose	16.90 %	66.28 Kg	1620.65 Kcals	1944.78 Kcals	1555 Kcals
1804 Kcals
Case 2	Female	28	1.59 m	57.6 Kg	22.8	34.4%	Lose	28.07 %	52.53 Kg	1268.75 Kcals	1744.53 Kcals	1244 Kcals
1495 Kcals
Case 3	Male	23	1.83 m	71.88	21.34	9.4%	Gain	13.32 %	75.13	1752.55 Kcals	2409.75 Kcals	2653 Kcals
2750 Kcals
3211 Kcals
3413 Kcals
FIgure 9
Download : Download high-res image (2MB)
Download : Download full-size image
Fig. 9. CIR agent's fuzzy computation process when applied on case 1 of our running example (cf. Table 6. a)

The patients’ target weights produced by the WAR agent are shown in Table 6. b. The resulting BMR and TEE computed based on the target weight17 are provided in Table 6. c, where TEE is required as input to the CIR agent. The recommended CI output is provided in Table 6. d. The detailed computation process for case 1 is described in Fig. 9, and similar computation processes for case 2 and case 3 are provided in (Salloum and Tekli 2020). For case 1 where the patient's target is to lose weight, two options are recommended by the agent: i) reduce CI to 1555 Kcals, which leads to a weight loss rate of around 0.39 Kilograms per week, and ii) reduce CI to 1804 Kcal, which leads to slower weight loss of around 0.15 kilograms per week. This patient can select the option that best fits his preference depending on the amount of daily CI reduction that he is willing to sustain daily. Similarly for case 2, two options are recommended for the patient with caloric deficits of approximately 500 Kcals and 250 Kcals respectively. Note that in both cases, the first being a male and the second being a female, the minimum recommended (gender-specific) CI of 1500 Kcal and 1200 Kcal respectively are well respected. For case 3 where the patient's target is to gain weight, four different CI options are recommended providing a range of caloric surplus options to reach the target weight, based on the daily caloric surplus (i.e. the additional amount of food) that the patient desires to consume.

4.2.3. Percentage of Exercise Recommendation (PER) agent
In addition to CI recommendations, exercise recommendations also need to be considered when the patient's goal is to lose weight. The PER agent is designed to meet this purpose. It receives as input the daily caloric deficit (CD), i.e., the difference between TEE and the recommended daily CI produced by the CIR agent. It then produces as output an exercise recommendation value representing the percentage of the BMR to be added as physical exercise: which we refer to as percentage of exercise (PE) for short. The PE recommendation is determined based on the amount of CD: i) if CD is small, exercise must be added to achieve a larger difference between TEE and CI, and ii) if CD is large, then PE should be minimal. In Table 718. a and b, we adopt commonly used classifications for CD and PE from (Hall et al. 2011) and (Kathleen and Janice 2017) respectively. The corresponding fuzzy sets are shown in Fig. 10. Note that this agent is only applied on weight loss cases. Also, the same classifications in Table 7 apply for both male and female patients since a single fuzzy agent is needed for PER19.


Table 7. Daily caloric deficit (CD) and percentage of exercise (PE) classifications, and corresponding condition-action rules

Category	a. Caloric deficit (CD)	b. Percentage of exercise (PE)	c. Condition-action rules
Very Low	0-250 Kcals	0 – 20 %	R1: Exercise percentage is High OR Normal
Low	250-500 Kcals	20 – 37.5 %	R2: Exercise percentage is Normal OR Low
Normal	500-750 Kcals	37.5 – 55 %	R3: Exercise percentage is Low OR Very Low
High	750-1000 Kcals	55 – 72.5 %	R4: Exercise percentage is Low OR Very Low
Very High	1000+ Kcals	55 – 90 %	R5: Exercise percentage is Low OR Very Low
FIgure 10
Download : Download high-res image (343KB)
Download : Download full-size image
Fig. 10. CD and PE fuzzy sets, defined based on the crisp classification boundaries from Table 7

The agent's condition-action rules in Table 7. c are defined with the help of our elect nutrition experts. They supply small CD with high PE (in order to compensate them with exercise alternatives); and supply very high CD with either no or small PE. In other words, if the CI is close to the TEE and thus the CD is small, the agent uses physical exercise as an alternative to increase the TEE and thus increase the weight loss rate accordingly. The defined rules allow multiple possible (PE) outputs, allowing patients to choose the ones most adapted to their needs. We adopt Mamdani's implication operator as the inference function, maximization as the aggregation function, and center of gravity as the defuzzification function (given the latter's empirical performance). Yet, any other inference, aggregation, and defuzzification function can be applied.

4.2.4. Computation Example
Consider the three patient cases from our running example, reported in Table 820. a. The patient's weight target (computed by the WAR agent), as well as the recommendation CI (computed by the CIR agent) and the resulting CD are provided in Table 8. b. CD is required as input to the PER agent. The recommended PE output is provided in Table 8. c.


Table 8. Patient cases from our running example, including the inputs and output of the PE recommendation agent

a. Input data provided in the patient profile	b. Resulting weight goal, CI, and CD, where CD is required as input to the PER agent	c. Output of PER agent
Patient	Gender	Age	Height	Weight	BMI	BFP	Activity	Goal	BMR	CI	CD	PE (% of BMR)	PE's caloric equivalent	Days to target
Case 1	Male	32	1.77m	66.94Kg	21.2	17.7%	Sedentary	Lose	1620.65 Kcals	1555 Kcals	389.78 Kcals	11.23%	182 Kcals	8
0 %	0 Kcals	12
1804 Kcals	140.78 Kcals	11.25 %	184 Kcals	15
29.79 %	484 Kcals	8
Case 2	Female	28	1.59m	57.6Kg	22.8	34.4%	Light activity	Lose	1268.75 Kcals	1244 Kcals	500.53 Kcals	0%	0 Kcals	78
19.94%	253 Kcals	52
1495 Kcals	249.53 Kcals	19.94%	253 Kcals	78
37.52%	476 Kcals	54
Case 3	Male	23	1.83m	71.88Kg	21.34	9.4%	Light activity	Gain	1752.55 Kcals	2653 Kcals	-243.25 Kcals	0%	0 Kcals	102
2750 Kcals	-340.25 Kcals	0%	0 Kcals	73
3211 Kcals	-801.25 Kcals	0%	0 Kcals	31
3413 Kcals	-1003.25 Kcals	0%	0 Kcals	24
The detailed computation process for patient case 1 is described in Fig. 11. Similar computation processes for case 2 and case 3 are provided in (Salloum and Tekli 2020). The outputs for all three cases include different CI and PE recommendations, all leading to the target weight albeit in different time durations. For case 1 for instance, outputs 1 and 2 include low CI with small or no PE, whereas outputs 3 and 5 include large CI recommendations with small or large PE recommendations. Notice that the minimum CI recommendation is 1555 Kcals and does not drop below the minimum 1500 Kcals CI recommendation for males. Similar observations can be made for case 2. As for case 3, four different CI outputs are provided, each increasing the CI in an amount that leads to reaching the target weight in a different time duration. Also, no additional PE is recommended for case 3 since the target is to gain weight.

FIgure 11
Download : Download high-res image (2MB)
Download : Download full-size image
Fig. 11. PER agent's fuzzy computation process when applied on case 1 of our running example (reported in Table 8)

Once the CI and PE are known, deducing the expected number of days for the patient to reach the target weight can be calculated accordingly21. Recall that TEE varies proportionally to the weight, which highlights the need for regular monitoring and adjustment of the CI even if the patient is making good progress. We present in the following section our mechanism for monitoring progress evaluation and recommendation adjustment.

4.3. Progress Evaluation and Recommendation Adjustment (PERA) agent
Patient progress monitoring and evaluation are essential parts of the nutrition care cycle, especially when the patient is abiding by the nutrition recommendations but not making the expected process. Based on our review of the nutrition literature and various discussions with our elect nutrition experts, we adopt a three-week monitoring timeframe for progress monitoring, where an evaluation occurs at the three-week mark to evaluate the progress of the patient and adjust the recommendations accordingly. Weight change depends on energy expenditure, which itself depends on the changing body weight. Even though weight change is not linear over a long period of time, yet we assume that weight change is linear within the early three-week timeframe (which is an acceptable assumption following our discussion with the elect nutrition experts). Here, progress evaluation and adjustment are mostly needed in the case of weight loss, since a patient should not face weight gain issues if abiding by the recommended CI22. At each three-week mark, the CI is adjusted to account for the non-linear nature of weight loss.

4.3.1. Progress Evaluation
PERA includes two stages of progress evaluation: i) evaluating if the final target goal is reached based on the expected date determined at the caloric assessment stage, and ii) evaluating BFP progress three weeks after the last assessment.

Evaluating the final goal: following our literature review, there is no clear methodology that nutrition experts adopt to adjust recommendations based on the patient's progress (cf. Motivation 4 in Section 2.4). In fact, progress evaluation involves “common sense” decision making, where experts use different classifications of whether a certain amount of progress is good, moderate, or bad, based on their background and experience. As a result, different experts might recommend different adjustments for the same patient. In our study, we adopt the following approach when a patient is having difficulty losing weight: i) reduce the CI, and ii) increase PE in a reasonable fashion, while abiding by standardized recommended guidelines. This is performed under the assumption that the patient is abiding by the recommended CI and PE without reaching the target BFP and weight. Here, we define BFP progress (weight progress follows accordingly):(8)
 
where BFPold is the BFP recommendation provided in the previous assessment, BFPcurrent is the one provided in the current assessment, and BFPtarget is the one expected to be reached after the current assessment.

While even the slightest progress in weight loss introduces health benefits, yet the nutrition literature does not provide a clear classification of progress levels. As a result, we introduce the classification for progress in Table 9 with the help and vetting of our elect nutrition experts. To our knowledge, this is the first attempt at classifying BFP progress in the literature.


Table 9. BFP progress percentage classification

Category	BFPProgress range	Description
Good	[70 – 100] %	The progress is significantly close to the expected progress
Moderate	[40 – 70[%	Progress is good enough to be considered but is still far from target
Slow	[0 – 40[%	No significant progress
Following PERA’s final goal evaluation process (cf. Fig. 12), the following behaviors might take place: i) if the patient progress qualifies as good, the next step is to re-evaluate the weight state of the patient to determine the next target weight. For example, the result might be to lose more weight, or to maintain the current weight if a healthy state is reached. Otherwise, ii) if the progress is slow or moderate, then the caloric recommendation should be adjusted accordingly. The latter is performed through a dedicated fuzzy agent which is described in the following sub-section. Note that a negative progress means that the patient is not abiding by the CI and PE recommendations. In this case, the process is reset by the WAR agent to re-compute a new target BFP and weight for the patient, and then re-evaluate the CI and PE recommendations accordingly.

Evaluating BFP progress: As mentioned previously, PERA evaluates the patient's BFP progress every three weeks to perform recommendation adjustment when needed. Once a patient is evaluated, the target BFP is determined by the WAR agent, followed by the CIER agent who determines the expected number of days, noted n, for the patient to reach the target BFP. Here, we compute BFP progress at the three-week mark as follows:(9)
 
 
where α (=21 in this case) represents the number of days between the initial assessment and the subsequent assessment when n > α. The expected difference in BFP (i.e., BFPold – BFPtarget) is scaled by the number of days from the last assessment over the expected number of days to reach the target. This gives an approximation of the difference in BFP to be achieved after α days.

As a result, the following behaviors might take place following PERA’s progress evaluation process (cf. Fig. 12): i) if BFP progress is good, the agent considers that the patient is on track even if the BFP target is not reached. In this case, CI and PE recommendations are updated through the CIER agent (since TEE is dependent of the changed weight of the patient). Otherwise, ii) if BFP progress is slow or moderate, then the caloric recommendation should be adjusted accordingly. The latter is performed through a dedicated fuzzy agent which is described in the following sub-section.

4.3.2. Caloric and Exercise Adjustment (CEA) agent
Similar to the initial CI and PE recommendation processes described through CIER in Section 4.2, CI and PE recommendation adjustments require human-like decision making which we emulate through the Caloric and Exercise Adjustment (CEA) agent. Recall that there is no mathematical process to perform CI and PE adjustments (cf. Motivation 4).

The condition-action rules in Table 1025 are designed to generate adjusted CI recommendations following nutrition guidelines, aiming to reduce or maintain CI based on the patient progress. They are defined with the help of our elect nutrition experts based on the following premises: i) if the patient is making slow BFP progress, CI must be reduced and PE must be increased. Otherwise, ii) if the patient is making moderate BFP progress, two options arise: CI is reduced while PE remains the same, or CI remains the same while PE is increased26. Patients can choose the preferred option based on their personal preferences. Here, we adopt Mamdani’s inference, maximization aggregation, and the left most defuzzification functions when running the CEA agent due to their good performance based on empirical results. Yet, users can apply other inference, aggregation, or defuzzification functions.


Table 10. CEA fuzzy agent's condition action rules

BFP progress
CI	Slow	Moderate
Extremely Low	R1: Adjusted CI is Extremely Low AND additional PE is High	R8: Adjusted CI is Extremely Low AND additional PE is Moderate
Very Low	R2: Adjusted CI is Extremely Low AND additional PE is Moderate	R9: (Adjusted CI is Very Low AND additional PE is Moderate)OR (Adjusted CI is Extremely Low AND exercise is Low)
Low	R3: Adjusted CI Very Low AND additional PE is Moderate	R10: (Adjusted CI is Low AND additional PE is Moderate)OR (Adjusted CI is Very Low AND exercise is Low)
Normal	R4: Adjusted CI is Low AND additional PE is Moderate	R11: (Adjusted CI is Normal AND additional PE is Moderate)OR (Adjusted CI is Low AND additional PE is Low)
High	R5: Adjusted Intake is Normal AND exercise is Moderate	R12: (Adjusted Intake is High AND exercise is Moderate)OR (Adjusted Intake is Normal AND exercise is Low)
Very High	R6: Adjusted Intake is High AND exercise is Moderate	R13: Adjusted Intake is High AND exercise is Low
Extremely High	R7: Adjusted Intake is Very High AND exercise is Moderate	R14: Adjusted Intake is Very High AND exercise is Low
4.3.3. Computation Example
Consider the patient weight loss cases27 from our running example, reported in Table 1128. a. PERA’s recommendation adjustments are shown in Table 11. c. The detailed computation process for patient case 1 is described in Fig. 16. A similar computation process for case 2 is provided in (Salloum and Tekli 2020).


Table 11. Patient weight loss cases from our running example

a. Input data provided in the patient profile	b. Recommendations of the WAR and CIER agents
Patient	Gender	Age	Height	Weight	BMI	BFP	Goal	Target BFP	Target weight	BMR	TEE	CI	PE caloric equivalent	Days to target
Case 1	Male	32	1.77m	66.94 Kg	21.2	17.7%	Lose	16.90 %	66.28 Kg	1620.65 Kcals	1944.78 Kcals	1804 Kcals	184 Kcals	15
Case 2	Female	28	1.59m	57.6 Kg	22.8	34.4%	Lose	28.07 %	52.53 Kg	1268.75 Kcals	1744.53 Kcals	1244 Kcals	253 Kcals	52
c. Status of patient after 15 days (considering multiple scenarios per patient)	d. Output of the PERA agent
Patient	Scenario	Reached BFP	Reached weight	BFP progress	Adjusted CI	Adjusted PE caloric equivalent	Remaining Days to target
Case 1	A	17.5 %	66.80 Kg	25%	1500 Kcals	324 Kcals	4
B	17.3 %	66.60	50%.	1500 Kcals	182 Kcals	2
1688 Kcals	314 Kcals	2
Case 2	AB	33.9 %	57.17 Kg	19.2%	1200 Kcals	459 Kcals	35
33.3 %	56.22 Kg	42%.	1200 Kcals	369 Kcals	31
Figure 16
Download : Download high-res image (2MB)
Download : Download full-size image
Fig. 16. CEA agent's fuzzy computation process when applied on case 1 of our running example (cf. Table 11)

We consider different scenarios for every case to highlight PERA’s adjusted recommendations accordingly. Given case 1 for instance, we consider two scenarios A and B assuming a 15 day re-evaluation period for both scenarios. In scenario A, we consider that the reached BFP is 17.5% and the reached weight is 66.80 Kg, resulting in a BFP progress percentage of 25%. Here, PERA would recommend an adjusted CI of 1500 Kcals (versus the original 1804 Kcals CI recommendation), an adjusted PE caloric equivalent of 324 Kcals (versus the original 184 Kcals recommendation), and 4 remaining days to reach the target (versus the original 0 remaining days). Note that CI is reduced and PE is increased within the acceptable “healthy” recommendations. In scenario B, we consider that the reached BFP is 17.3% and the reached weight is 66.60 Kg, resulting in a BFP progress percentage of 50%. Here, PERA would recommend two options: i) reducing the CI (from 1804 Kcals) to 1500 Kcals while maintaining the same PE (at 184 Kcals); or ii) reducing the CI (from 1804 Kcals) to 1688 Kcals while increasing PE (from 184 Kcals) to 314 Kcals. Both options require a 2-day remaining time to reach the goal (versus 4 days with scenario A).

Given case 2, we also consider two scenarios A and B assuming a 51-day re-evaluation period for both scenarios, where the first assessment occurs after the first 21 days (considering PERA’s three-weak evaluation window). In scenario A, we consider that the reached BFP is 33.9% and the reached weight is 57.17 Kg, resulting in a BFP progress percentage of 19.2%. Here, PERA recommends an adjusted CI of 1200 Kcals (versus the original 1244 Kcals CI recommendation), an adjusted PE caloric equivalent of 459 Kcals (versus the original 253 Kcals recommendation), and 35 remaining days to target (versus the original 30 remaining days). Note that CI is not reduced less than 1200 Kcals to avoid going below the minimum “healthy” recommendation of 1200 Kcals for females. Hence, PERA’s only option in this case is to increase PE. As for scenario B, we consider that the reached BFP is 33.3% and the reached weight is 56.22 Kg, resulting in a BFP progress percentage of 42%. Here, PERA recommends decreasing CI (from 1244 Kcals) to 1200 Kcals, increasing PE (from 253 Kcals) to 396 Kcals, and adjusting the number of remaining days (from 52) to 31 days to reach the target. While CI remains at its minimum “healthy” bound of 1200 Kcals for a female patient, yet in contrast with scenario A, PE is not increased as much since the patient is closer to reaching her goal compared with scenario A. Recall that CEA adjustments to CI and PE are larger/smaller depending on the patient's slower/faster progress.

When a patient reaches the target BFP and weight, the latter are re-assessed by the WAR and CIER to verify whether the patient is currently at a good weight state or needs to further lose (or gain) more weight, continuously adjusting to the patient's state.

4.4. Recommendation Preference Ranking
As described previously, PIN’s fuzzy agents are designed in a flexible manner that offers the patient a wide variety of “healthy” options to choose from, similarly to a human nutritionist's way of recommending multiple healthy solutions. Yet, providing various options could become confusing for the patient, if not presented properly. To address this issue, we introduce a function to rank the recommendations based on patient preferences considering: i) the size of the daily caloric deficit (CD, i.e., the amount of food the patient would like to abstain from) and ii) the amount (percentage) of exercise PE that the patient would like to perform. Our ranking function accepts as input the patient's preferences in terms of desired CD and PE in the form of linguist qualifiers following the linguistic variables previously defined in Section 4.2 (e.g., CD and PE share the same qualifiers: {very low, low, normal, high, and very high}). Allowing the patients to express their preferences using linguistic qualifiers is easier than asking them to provide scalar CD and PE inputs. Consequently, we compute the preference score for a recommendation in terms of the corresponding CD and PE membership scores, as follows:(10)
where S is the total normalized preference score, SCD the fuzzy CD score, SPE the fuzzy PE score, and α and β the CD and PE score weights such as α, β ≥ 0 and α + β = 1. The weight factors can be fine-tuned based on the patient preferences in terms of underdoing a more severe caloric restriction or doing more exercise.

The fuzzy CD score (SCD) and PE score (SPE) are computed based on: i) the fuzzy sets corresponding to the linguistic qualifiers selected by the patient, and ii) the scalar CD and PE values recommended by the system (i.e., by CIER when making initial recommendations, and by PERA when making recommendation adjustments). To do so, we take the system generated recommendations and compute their membership values in terms of the patient selected fuzzy sets, and then we average the membership values greater than zero. The fuzzy scores are computed as follows:(11)
 
where n is number of fuzzy sets selected by the patient where the membership is greater than 0, and mi is the membership of the fuzzy value recommended in fuzzy set j. If the patient does not select any preference, all recommendation scores will be set to the minimal value of 0. Note that the patient can also make more than one selection/preference (e.g., the patient's selected PE levels could be low and very low, meaning that the patient desires performing a low or a very low amount of exercise). If the patient selects all possible options as acceptable values, all recommendations will score the highest possible membership value of 1.

Consider for instance a patient with BMR=1770 Kcals, TEE= 2434 Kcals, and goal = lose weight. Here, we consider two patient preferences presented in Table 12: i) high CD and low PE, and ii) low CD and high PE.


Table 12. Recommendation ranking examples following patient preferences

a. High CD and low PE	b. Low CD and high PE
CD preference	PE preference	CD preference	PE preference
Normal or High	Very Low or Low	Very Low or Low	Normal or High
Resulting recommendations ranking	Resulting recommendations ranking
Rank	CI (Kcals)	Additional PE's caloric equivalent (Kcals)	CI (Kcals)	Additional PE's caloric equivalent (Kcals)
1	1965	0	2215	626
2	1715	0	2215	310
3	1965	310	1965	310
4	1715	310	1965	0
5	2215	310	1715	310
6	2215	626	1715	0
Consider the first scenario, where the patient prefers to have a normal or high CD (e.g., eating significantly less), while having low or very low PE (e.g., performing very little exercise). Results in Table 12. a show that the top four recommendations introduce CD values of 469 (#1 and 3) and 719 (# 2 and 4) Kcals: which fall in the normal and high categories respectively based on our CD fuzzy sets (cf. Fig. 10. a). The first two recommendations do not add any exercise while the third and fourth recommendations add 316 Kcals worth of PE daily caloric expenditure; i.e., the equivalent of 17% of the patient's BMR, which falls in the very low PE fuzzy set category (cf. Fig. 10. b). As for the last ranked recommendation, it introduces a minimal CD of 219 Kcals and a daily PE caloric expenditure of 626 Kcals; i.e., the equivalent of 35% of the BMR (which falls in the low PE fuzzy set category). Hence, the latter ranking of the results clearly reflects the patient's preferences in terms of normal/high CD and very low/low PE.

Likewise for the second scenario where the patient wishes to keep a low CD (e.g., eating regularly) with high PE (e.g., performing more exercise). Results in Table 12. b show that the recommendation having the lowest CD and the highest PE is correctly ranked as the first option, while recommendations with larger CD and smaller PE are decrementally ranked accordingly.

5. Experimental Evaluation
We have implemented our PIN framework as a web-based application, using methods from the jFuzzyLogic open source library (Cingolani and Alcalá-Fdez 2013, Cingolani and Alcala-Fdez 2012) in implementing our fuzzy logic agents, to allow easy access for patients and experts using and evaluating the system29. We have empirically tested the different components of our system using multiple sets of experiments which we categorize in two main groups: i) comparative evaluation: comparing the recommendations of PIN’s main agents (i.e. WAR, CIER, and PERA) with those of human nutrition experts, and ii) correctness evaluation: allowing human experts to evaluate PIN’s recommendations, and rate their level of agreement with the system's outputs. A total of 11 nutrition experts where involved in conducting the experiments, where each experiment was performed by 4 different testers (certain testers participated in multiple experiments). We first start by describing our test data, experimental scenarios and metrics, and then we present our empirical results. The system implementation, experimental datasets, and test results are available online30.

5.1. Experimental Test Data
We built a test dataset of 50 patient cases, consisting of 25 female and 25 male cases (cf. Table 13). The 25 male cases were selected from the Carleton College public dataset (Johnson 1996). Yet, due to the lack of published female cases, we collected the latter data from local pharmacies where body composition machines (measuring BFP) were available. The patient profiles were carefully selected to cover different cases ranging from low BFP to overweight patients.


Table 13. Description of experimental test data

a. Male data summary	b. Female data summary
Input	Age	Weight (Kg)	Height (m)	BFP	BMI	Input	Age	Weight (Kg)	Height (m)	BFP	BMI
Avg	33.64	84.52	1.81	18.18	25.89	Avg	28.92	62.99	1.65	29.30	23.24
Min	23.00	56.36	1.72	5.30	18.89	Min	18.00	50.00	1.56	16.10	18.94
Max	65.00	163.42	1.97	36.30	48.52	Max	59.00	88.40	1.75	46.20	30.23
STD	10.36	19.96	0.07	8.39	5.93	STD	11.49	8.76	0.05	7.63	2.90
Note that different subsets of the experimental dataset are used in the different experimental phases. All 50 cases are used to evaluate the WAR agent in the first experimental phase, while a subset of 20 cases are used to evaluate CIER in the second experimental phase, and a subset of 10 cases are used to evaluate PERA in the third experimental phase. The reason for not using all 50 cases in all three phases is the sheer number of aggregated recommendations that would need to be evaluated, which is not practically feasible given the number of (11) testers involved in the study. In total, the number of recommendations that are considered in our experimental study comes down to around: 50 WAR + 80 CIER + 80 PERA = 210 recommendations. Given that every recommendation is evaluated by 4 different testers, every nutrition expert evaluated on average 80 different recommendations, requiring around 3.5-to-4 hours of manual effort. Please note that following our review of the related literature and following the confirmation of most nutrition experts involved in our study, this experimental evaluation is the largest and most comprehensive of its kind, and can be considered as its own contribution to the nutrition literature (in addition to the theoretical and computation models in the study).

5.2. Experiments and Metrics
Experiments and metrics were designed with the help of our elect nutrition experts to evaluate each of PIN’s three main agents: WAR, CIER, and PERA. We describe them in the below subsections.

5.2.1. WAR Agent Evaluation
Comparative evaluation: In this experiment, we provide the expert testers with input data for all 50 patients, consisting of 25 female and 25 male cases. The input data includes: age, height, weight, and BFP of the patients. For each case, 4 expert testers are requested to provide: i) a goal recommendation (i.e., patient needs to lose weight, gain weight, or maintain current weight), ii) a target BFP, and iii) a target weight. For each of the latter, we evaluate:

i
Average inter-tester agreement: computed as the pairwise similarity scores between the recommendations produced by the expert testers, averaged over all test cases.

ii
Average PIN-tester agreement: computed as the similarity between system recommendations and those produced by the expert testers, averaged over all test cases.

Here, we compute the similarity between two goal recommendations using Formula 12, and the similarity between two target BFPs (likewise for two target weights) using Formula 13:(12)
 
 
(13)
 
where gx and gy represent two goal recommendations, and x and y represent either two target BFPs or two target weights.

Note that WAR can sometimes produce more than one option (following the nature of its condition-action rules, cf. Section 4.1), allowing the patient to maintain a good BFP/weight, or slightly reduce/loose BFP/weight to reach a more “perfect” or excellent health state. In this experiment, we only consider the good state which is recommended for non-athlete patients. We will consider excellent BFP/weight recommendations in a future study targeting athletes and patients who regularly exercise.

Correctness evaluation: We provide the experts with WAR’s goal, target BFP, and target weight recommendations for each of the 50 patient cases, and ask the experts to evaluate and rate them on an integer scale ranging from 0 (strong disagreement, or “absolutely incorrect”) to 4 (strong agreement, or “absolutely correct”). Every case is rated by 4 different experts. We then compute the average ratings and their standard deviations, and evaluate WAR’s scores accordingly.

5.2.2. CIER Agent Evaluation
Comparative evaluation: In this experiment, the expert testers are requested to produce CI and PE recommendations, to be compared with CIER’s recommendations. We provide the experts with 20 patient cases organized in three groups: i) 5 cases that require gaining weight, ii) 5 cases that require maintaining weight, and iii) 10 cases that require losing weight. Each case includes the current BFP and weight, the target BFP and target weight, in addition to the exercise preference (i.e. the amount of exercise the patient desires to perform daily, e.g., low, high), and the caloric deficit preference (i.e. the amount of calories the patient desires to abstain from daily, e.g., low, high). Each case is evaluated by 4 experts, and every recommendation (by the experts and CIER) is represented as a doublet (CI, PE), where CI represents the recommended caloric intake and PE the percentage of exercise's caloric equivalent. We treat the latter as a single recommendation, and compute the similarity between two recommendations (CIx, PEx) and (CIy, PEy) as the linear sum of their CI and PE similarities:(14)
 
 
where α ∈ [0, 1]. We initially set α = 0.5 to give equal weights to both CI and PE recommendation components. Similarly, to the previous experiment, we first compare the recommendations produced by the expert testers themselves, quantifying inter-tester agreement, and then evaluate PIN-tester agreement by comparing the recommendations produced by PIN’s CIER agent with those produced by the experts. Note that each expert can produce multiple possible options (usually 1-to-3 following nutrition recommendation common practice). Similarly, PIN can produce multiple options (usually up to 6, following the nature of the condition-action rules of the CIER fuzzy agent, cf. Section 4.2). Thus, when comparing the recommendations of two agents (i.e., inter-tester and PIN-tester), we consider all possible combination pairs and apply two types of analyses: i) maximum analysis, where we select the combination with the highest similarity, and ii) average analysis, where we compute the average similarity of all recommendation combinations. More formally, considering agent1 producing m pairs of recommendations (CI1, PE1) and agent2 producing n pairs (CI2, PE2):(15)
(16)

Correctness evaluation: In this experiment, we present the expert testers with the CI and PE recommendations produced by CIER for each test case, and then ask the experts to evaluate and rate system recommendations on an integer scale from 0 (absolutely incorrect) to 4 (absolutely correct). When rating weight loss cases, we ask the experts to provide their feedback, not only on the correctness of the recommendation, but also on recommendation preference: evaluating whether the system recommendations meet the preferences of the patients (i.e., whether they prefer to reduce their CI, i.e., eat less, or increase their PE, i.e., do more physical exercise). Recall that additional exercise is not necessary for weight gain and weight maintenance cases, and thus the latter are only evaluated in terms of recommendation correctness31. Every case is rated by 4 different experts, where both human experts and PIN might produce multiple recommendations for every patient case (as described in the previous section). Hence, we apply two types of analyses in evaluating the rating results: i) maximum analysis where we consider the maximum rating produced for each case, and ii) average analysis where we consider the average rating produced for each case. We finally compute average ratings and the standard deviations, and evaluate CIER’s scores accordingly.

5.2.3. PERA Agent Evaluation
Comparative evaluation: In this experiment, we provide the experts with 10 cases, where each case represents i) the profile of a patient, ii) the target BFP and target weight of the patient, and iii) multiple scenarios of different BFP/weight targets that could be reached by the patient (i.e., 20%, 40%, 50% and 75% of the target BFP/weight32). Experts are then required to rate the patients’ progress as: slow, moderate, or good. Here, we define the similarity between two recommendations as follows:

 
 
(17)

Similarly to the previous experiments, we first compare the recommendations produced by the expert testers themselves, evaluating inter-tester agreement, and then evaluate PIN-tester agreement by comparing the recommendations produced by PIN’s PERA with those produced by the experts.

Correctness evaluation: In this experiment, we ask the experts to rate the recommendations produced by PERA, on an integer scale ranging from 0 (absolutely incorrect) to 4 (absolutely correct) for the same cases processed in the previous experiment, where every case is rated by 4 different experts, and then compute average ratings and their standard deviations accordingly.

5.3. Experimental Results
5.3.1. WAR Agent Evaluation
Comparative evaluation: We first evaluate nutrition goal agreement (i.e., lose, maintain, or gain weight), comparing the experts’ recommendations with those produced by PIN’s WAR agent. Fig. 17.a presents inter-tester average similarity results produced for the 25 female and 25 male cases considered in our study, and Fig. 17. b provides PIN-tester average similarities for the same cases. Two observations can be made here:

•
The highest average inter-tester similarity is equal to 1 (i.e., 100% since they match exactly) and is obtained between experts 2 and 3, while the lowest average inter-tester similarity is 0.6 and is obtained between experts 1 and 3. In the case of PIN-tester scores, the highest average similarity is 0.96 for both PIN vs expert 1 and PIN vs expert 2, while the lowest similarity is 0.64 for PIN vs expert 1. Also, PIN scores 0.87 and 0.8 similarity on average for female and male cases respectively, which is higher than the average inter-tester similarity. This shows that PIN’s WAR goal recommendations highlight an overall accuracy similar (and even surpassing) those of human experts.

•
In addition, we notice, that for both inter-tester and PIN-tester recommendations, goal similarity scores are higher on average for female cases, compared with male cases. This means that both human experts and PIN tend to agree more when evaluating female cases, compared with male cases. This is probably because males are usually given more options between maintaining and losing weight (leading to more variation in the recommendation result), whereas fewer options are usually recommended for female patients.

Figure 17
Download : Download high-res image (492KB)
Download : Download full-size image
Fig. 17. Nutrition goal similarity results: comparing average inter-tester and PIN-tester agreement levels

In addition to comparing nutrition goal agreement, Fig. 18 presents inter-tester and PIN-tester agreement results in terms of average target BFP and target weight values. Two main observations can be made here:

•
By comparing the experts’ recommendations for both BFP and weight, we notice very high inter-tester similarities, with a slightly higher agreement on weight recommendations versus BFP recommendations. We also notice relatively low standard deviations (of 0.06 and 0.02 for BFP and weight respectively) underlining high inter-tester agreement for most cases.

•
Also, results clearly show very close agreement between WAR’s recommendations and those provided by experts, producing high PIN-tester average similarity levels in terms of both BFP (0.94 and 0.92 respectively) and weight (0.98 and 0.97 respectively), coined with relatively low standard deviations. This indicates PIN’s ability of producing human-like BFP and weight recommendations.

Figure 18
Download : Download high-res image (459KB)
Download : Download full-size image
Fig. 18. Target BFP and target weight similarity results: comparing average inter-tester and PIN-tester agreement levels

Correctness evaluation: In this experiment, we evaluate the human experts’ ratings of the recommendations produced by PIN’s WAR agent (provided in the form of integers ∈ [0, 4], ranging from: absolutely incorrect - to - absolutely correct):

Results in Fig. 19 show high overall average correctness ratings of 2.81 and 2.77 (with relatively low standard deviations of 0.3 and 0.2) for female and male cases respectively. Considering all cases combined, we notice that 18% of the ratings are greater than or equal to 3.5, 46% fall between 3.5 and 2.75, 24 % of the ratings fall between 2.5 and 2, and 12% of the ratings fall between 1.75 and 1.25.

•
Results also show an almost opposite correlation between average tester rating and standard deviation: i.e., as the average rating decreases, the standard deviation increases. From the latter, we can infer that testers tend to agree more on the cases where they provide high ratings, i.e., cases where they strongly agree with WAR’s goal recommendations, while they tend to agree less among themselves on the cases where they provide lower ratings, i.e., cases where they do not strongly agree with WAR’s goal recommendations.

Figure 19
Download : Download high-res image (604KB)
Download : Download full-size image
Fig. 19. Average expert ratings for WAR's goal, target BFP, and target weight recommendation results

Discussion: Experimental results show high correlation between the nutrition goal, target BFP, and target weight recommendations of PIN's WAR agent and those of the nutrition experts. Results also show that average PIN-tester similarity scores fall within the same range of inter-tester similarity scores obtained when comparing the experts’ recommendations with each other. In addition, the high expert correctness ratings of WAR's recommendations demonstrate the system's ability in producing mostly correct nutrition goal, target BFP, and target weight recommendations. To sum up, PIN can be considered as “yet another human tester” (as stated by one of the expert nutritionists), producing recommendations which accuracy and correctness are on a par with those of human expert recommendations.

5.3.2. CIER Agent Evaluation
The CIER agent generates caloric intake (CI) and percentage of exercise (PE) recommendations based on i) the patient's current weight, ii) target weight, iii) physical activity level, and iv) preferences regarding exercise and caloric deficit.

Comparative evaluation: In this experiment, we evaluate and compare inter-tester and PIN-tester CI and PE recommendations. As previously described (in Section 4), patient cases can be classified in three categories; i) weight loss, ii) weight gain, and iii) weight maintenance cases, where the experts and CIER can produce multiple optional recommendations for every case (e.g., to lose weight, a patient can either: decrease CI; or maintain CI and add PE). Results are provided in Fig. 20, Fig. 21, Fig. 22, Fig. 23 and underline the following observations. Considering weight loss cases in Fig. 20:

•
When applying maximum analysis (i.e., selecting the combination with the highest similarity), CIER’s recommendations show an average 0.94 overall agreement with the experts’ recommendations, compared with a lower average inter-tester agreement of 0.84. We also notice a smaller standard deviation of 0.04 on average for PIN-tester agreement, compared with a 0.14 standard deviation for inter-tester agreement.

•
When applying average analysis (i.e., computing the average similarity of all recommendation combinations), CIER’s recommendations show an average 0.64 overall agreement with the experts’ recommendations, compared with an almost equivalent average of 0.67 for inter-tester agreement. PIN-tester results also show a smaller standard deviation of 0.06 in comparison with 0.13 for inter-tester agreement.

Figure 20
Download : Download high-res image (463KB)
Download : Download full-size image
Fig. 20. CI and PE average similarity results: comparing inter-tester and PIN-tester agreement levels for weight loss cases

The latter results show that CIER’s recommendations are in close agreement with those of human experts when handling weight loss cases.

Similar results are obtained with weight gain cases in Fig. 21:

•
When applying maximum analysis, we obtain very high average agreements of 0.99 (0.01 standard deviation) and 0.99 (0.01 standard deviation) for both inter-tester and PIN-tester results respectively.

•
When applying average analysis, we obtain an average agreement score of 0.84 (0.11 standard deviation) for inter-tester similarity and a slightly higher average agreement score of 0.90 (0.07 standard deviation) for PIN-tester similarity.

Figure 21
Download : Download high-res image (435KB)
Download : Download full-size image
Fig. 21. CI and PE average similarity results: comparing inter-tester and PIN-tester agreement levels for weight gain cases

The high agreement levels show that CIER’s recommendations are in close agreement with those of human experts when handling weight gain cases. Different from weight loss and weight gain cases, a single recommendation is usually needed for weight maintenance cases: recommending a CI that fulfills the patient's TEE (Total Energy Expenditure). Similarly to weight loss and weight gain cases, Fig. 22 shows high agreement levels of 0.78 (0.09 standard deviation) and 0.85 (0.15 standard deviation) when comparing both inter-tester and PIN-tester results respectively.

Figure 22
Download : Download high-res image (360KB)
Download : Download full-size image
Fig. 22. CI and PE average similarity results: comparing inter-tester and PIN-tester agreement levels for weight maintenance cases

Discussion: By comparing the results of the three case categories, we notice higher agreement levels among human experts when dealing with weight gain cases (average 0.99 with maximum analysis), compared with weight loss cases (average 0.84) and weight maintenance cases (average 0.78). Following our discussions with the nutrition experts, we realized that weight gain is considered as the more straightforward case among the three categories, where nutritionists usually suggest somewhat standardized/homogenous recommendations, in contrast with weight loss and weight maintenance cases which are considered more delicate and challenging, and where expert recommendations can differ from one expert to the other. We also noticed that CIER adheres to this observation and produces higher agreement levels with human experts in weight gain cases (average 0.99 with maximum analysis) when compared with weight loss cases (average 0.94) and weight maintenance cases (average 85). The latter observation is mainly due to the different possible PE recommendations that the system suggests for weight loss cases, compared with the fewer (and more typical) options that the system produces for the other case categories. Given both inter-tester and PIN-tester agreement levels, we highlight that PIN’s CIER recommendations are comparable and on a par with those of human expert recommendations.

Correctness evaluation: In addition to the above comparative analysis, we evaluate the human experts’ ratings of CI and PE recommendations produced by PIN’s CIER agent (provided in the form of integers ∈ [0, 4], ranging from: absolutely incorrect - to - absolutely correct). We use two types of ratings to evaluate every recommendation: i) a correctness rating and ii) a preference rating. We first ask the experts to provide a correctness rating for each recommendation, evaluating the expert's level of agreement with the system generated recommendation. We also ask the testers to provide a preference rating describing how the recommendation meets the tester's preferences towards the recommended CI and PE levels (whether patients prefer to reduce their CI or increase their PE). In addition, we use two types of analyses to evaluate multiple recommendations per patient case: i) maximum analysis and b) average analysis. Since multiple recommendations can be provided for one patient case, we perform maximum analysis (i.e., identifying the maximum rating score among all provided recommendations) and average analysis (i.e., identifying the average rating score among the provided recommendations), in order to produce a single aggregate rating score for every patient case. This results in 4 different rating scores evaluating each patient case: i) correctness grade based on maximum analysis, ii) correctness rating based on average analysis, iii) preference rating based on maximum analysis, and iv) preference rating based on average analysis. Fig. 23 shows the results of weight loss cases, and Fig. 24 shows the results of both weight gain and weight maintenance cases33. Recall that additional exercise is not necessary for weight gain and weight maintenance cases, and thus the latter are only evaluated in terms of recommendation correctness (cf. Fig. 24).

Figure 23
Download : Download high-res image (662KB)
Download : Download full-size image
Fig. 23. Average expert ratings for CI and PE recommendations for weight loss cases

Figure 24
Download : Download high-res image (440KB)
Download : Download full-size image
Fig. 24. Average expert ratings for CI and PE recommendations for weight gain and weight maintenance cases

Here, we highlight the following observations:

•
Regarding weight loss cases with maximum analysis, Fig. 23. a shows high rating scores for CI and PE recommendation correctness (average = 3.75) and preference (average = 3.63). The lowest score of 2.75 is obtained for the preference rating of patient case 9, and is associated with the highest standard deviation (i.e., highest tester disagreement). Regarding average analysis results in Fig. 23. b, we notice that preference scores are generally lower (average = 2.08) than their correctness counterparts (average = 2.93). This is due to the fact that CIER produces all the possible recommendations and then sorts them based on patient preference without eliminating any recommendation, while all the produced recommendations (those with high and low preference scores) are considered in computing the average ratings.

•
Regarding weight gain cases, results in Fig. 24. b show satisfying human expert ratings for CIER’s recommendations, considering both maximum analysis (average = 3.35) and average analysis (average = 2.63).

•
Regarding weight maintenance cases, Fig. 24. c also shows satisfying human tester ratings (average = 3.20). Recall that there is no need for maximum and average analyses here since a single recommendation is produced for every patient case (consisting of the CI that fulfills the patient's TEE, cf. Section 4.2).

Discussion: The above results highlight PIN’s ability of producing CI and PE recommendations that are in strong agreement with those of human experts. The system recommendations have also been largely approved by the expert testers as reflected by their high correctness rating scores.

5.3.3. PERA Agent Evaluation
PIN’s PERA agent evaluates patient progress based on their i) current BFP, ii) target BFP, and iii) the expected date to reach the target BFP after running WAR and CIER’s recommendation processes. First, it classifies progress as slow, moderate, or good. In the case of slow or moderate progress, it adjusts the CI and PE recommendations accordingly. Otherwise, in the case of good progress, it maintains the same CI and PE recommendations without adjustment, since the patient is on the right nutrition track.

Comparative evaluation: In the first part of this experiment, we evaluate PERA’s progress classification quality, i.e., its ability to correctly classify progress cases as slow, moderate, or good. Various test cases covering the different progress classes were considered. Fig. 25 shows inter-tester and PIN-tester classification similarity. Results show that PIN-tester classification similarity scores are very close to, and slightly surpass, those of inter-tester classification similarities. In other words, PERA’s classification results are on a par with (and even slightly surpass) those of human nutrition experts.

Figure 25
Download : Download high-res image (409KB)
Download : Download full-size image
Fig. 25. Progress classification results: comparing inter-tester and PIN-tester agreement levels

In the second part of the experiment, we evaluate PERA’s CI and PE recommendation adjustment quality. We consider two classification scenarios: i) slow progress and ii) moderate progress, disregarding good progress where recommendation adjustment is not required. Note that PERA provides one single recommendation for slow progress cases, while it can generate one or more recommendation options for moderate progress cases (based on the fuzzy agents’ condition action rules, cf. Section 4.3).

Results in Fig. 26 show average similarity scores considering all generated options, mapping slow progress against moderate progress cases34. One can clearly realize that PIN-tester average similarity and standard deviation results are almost identical to those of inter-tester results, which means that PERA’s adjusted CI and PE recommendations for both slow and moderate progress cases are very similar to those of human experts.

Figure 26
Download : Download high-res image (485KB)
Download : Download full-size image
Fig. 26. CI and PE progress adjustment results: comparing inter-tester and PIN-tester agreement levels

Correctness evaluation: In addition to the above results, we asked the expert testers to evaluate the correctness of PERA’s recommendations by rating them from 0 (absolutely incorrect) to 4 (absolutely correct). Recall that PERA can provide one or more recommendation options for moderate progress cases, where we consider both maximum analysis and average analysis methods in presenting the corresponding results. Results in Fig. 27 show satisfying expert ratings, considering both slow progress cases (average = 3.20) and moderate progress cases (average = 3.5 and 3.04 based on maximum analysis and average analysis respectively).

Figure 27
Download : Download high-res image (496KB)
Download : Download full-size image
Fig. 27. Average expert ratings for CI and PE recommendation adjustment results

Discussion: Experimental results show high correlation between PIN’s patient progress classification and its adjusted CI and PE recommendations compared with those provided by nutrition experts. Results clearly show that PIN-tester similarity scores are on a par with inter-tester similarity scores. In addition, the satisfying ratings provided by the expert testers demonstrate PIN’s ability in adjusting CI and PE recommendations for patients struggling to reach their BFP and weight targets. Note that in the case of good progress, PERA invokes the WAR agent to generate new target BFP and weight recommendations, hence re-starting PIN’s overall assessment process to allow for continuous patient re-evaluation.

6. Conclusion
In this paper, we introduce a novel framework for Personalized Intelligent Nutrition recommendation titled PIN, allowing to automate the health assessment, recommendation, and monitoring services offered by a nutrition expert. It consists of three main agents designed using the fuzzy logic paradigm to simulate the “human common sense” thought process involved in nutrition health assessment and recommendation: i) Weight Assessment and Recommendation (WAR) agent, providing an assessment of the patients’ nutrition health state and recommending BFP adjustments to gain, lose, or maintain their weight, ii) Caloric Intake and Exercise Recommendation (CIER) agent, estimating CI and exercise levels based on the patients’ target BFP and weight, and physical activity preferences, and iii) Progress Evaluation and Recommendation Adjustment (PERA) agent, monitoring and evaluating the progress of the patients towards their target BFP and weight, and adjusting their CI and exercise recommendations accordingly. Experimental results reflect PIN’s effectiveness and quality in producing (BFP, weight, CI, exercise, and adjusted) recommendations which are on a par with (and sometimes surpass those of) human experts.

We are currently completing an extended study, building on PIN’s nutrition health assessment and recommendation capabilities to perform automated and personalized meal planning: generating meal plans which fulfill a recommended CI, personalizing the plans following patient preferences, and evaluating the relevance of the produced plans w.r.t. the target patients (Salloum and Tekli 2021). In the near future, we aim to extend PIN’s CIER and PERA agents to include exercise recommendations even when the patient's goal is to lose or maintain weight. This is a special case that would be most useful to athletes or patients who regularly exercise. On the long run, we plan to develop a dedicated exercise planning mechanism that incorporates and schedules multiple exercise types (e.g., jogging, swimming) based on the patient's time availability and exercise preferences (Elliott et al. 2019). Using alternative computation techniques such as non-parametric and lazy machine learners (e.g., fuzzy k-nearest neighbors, or fuzzy support vector machines (Abboud and Tekli 2019, Fahmi et al. 2019, Abboud and Tekli 2018)) could be most useful in this context, in order to compensate for the lack of formal rules and lack of sizeable training data linking physical exercise with nutrition recommendations. Another aspect that needs to be considered is the user friendliness of the application interface, allowing the user to easily input the required health data and access the output recommendations. Summarization techniques based on fuzzy logic could be useful in this regard (Kacprzyk et al. 2006), allowing to present the data as short quantified sentences of natural language (Hudec et al. 2018). Furthermore, data security and privacy aspects need to be considered in the future, to make sure that the patient's nutrition health data is not compromised and is safely processed online.