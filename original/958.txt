Device authentication is essential for securing Internet of things. Radio frequency fingerprint identification (RFFI) is an emerging technique that exploits intrinsic and unique hardware impairments as the device identifier. The existing RFFI literature focuses on experimental exploration but comprehensive modelling is missing. This paper systematically models impairments of transmitter and receiver in narrowband systems and carries out extensive experiments and simulations to evaluate their effects on RFFI. The modelled impairments include oscillator imperfections, imbalance of inphase (I) and quadrature (Q) branches of mixers and power amplifier (PA) nonlinearity. We then propose a convolutional neural network-based RFFI protocol. We carry out experimental measurements over three months and demonstrate that oscillator imperfections are not suitable for RFFI due to their unpredictable time variation caused by temperature change. Our simulation results show that our protocol can classify 50 and 200 devices with uniformly and randomly distributed IQ imbalances and PA nonlinearities with high accuracy, namely 99% and 89%, respectively. We also show that the RFFI has some tolerance on different receiver imbalances during training and classification. Specifically, the accuracy is shown to degrade less than 20% when the residual receiver's gain and phase imbalances are small. Based on the experimental and simulation results, we made recommendations for designing a robust RFFI protocol, namely compensate carrier frequency offset and calibrate IQ imbalances of receivers.
SECTION I.Introduction
Internet of things (IoT) has digitally transformed our everyday life which aims to connect everything and everyone. Many exciting IoT applications such as smart home, smart cities, connected healthcare, industry 4.0, etc. are enabled by a wide range of IoT devices [1]. Cisco predicts that there will be 300 billion IoT devices by 2030,1 mainly connected wirelessly thanks to the easy installation and deployment. However, the broadcast nature of wireless transmissions makes device authentication challenging as any malicious users can access the network. Devices are conventionally authenticated by cryptographic schemes, which rely on a commonly pre-shared key and software address. However, key management and distribution become challenging for IoT devices, as many of them will be low-cost and distributed in remote areas [2]. Software address, such as MAC/IP address, is not encrypted and can be spoofed easily.

A new and secure device authentication method is thus urgently needed and should be designed to be tamper-proof. It should ideally be lightweight, because many IoT devices are low-cost with limited computational and power resources and some are required to work for over 10,000 hours on a coin cell battery [3]. Radio frequency fingerprint identification (RFFI) has emerged as a promising candidate [4], [5], which exploits the unique hardware features of transceiver devices as their identifiers. These features are produced because of the manufacturing process variations, which cannot be eliminated even with advanced manufacturing technologies. The hardware features deviate from the nominal values and will slightly affect the waveform of wireless transmissions, but the deviation is within such a small range that it does not affect the normal communication operation. As these impairments are unique, stable and difficult to tamper with, they can be extracted as device identifiers.

Many IoT techniques, for example, ZigBee, Bluetooth, LoRa, and Sigfox, only require a low communication rate as the payload is short. These techniques are usually narrowband. For example, LoRa only occupies a bandwidth of 125, 250 or 500 kHz, and supports a bit rate ranging from 0.24 - 37.5 kbps.2 It can be used to transmit environmental monitoring information such as temperature. RF impairments of narrowband techniques consist of oscillator imperfections such as carrier frequency offset (CFO) and phase noise, mixer imperfections including inphase (I) and quadrature (Q) imbalance, power amplifier (PA) nonlinearity as well as antenna patterns [6]. The emitted signal of IoT devices will be distorted by the above transmitter impairments. A receiver will capture the physical waveform and extract these impairments to infer the device identity.

Modelling RF impairments is important to understand the behavior of hardware impairments and the capacity of RFFI. While there is detailed general RF impairments modelling [6]–[7][8][9], the modelling for RFFI is rather limited or only partially complete. For example, the work in [10], [11] modelled RF impairments but did not examine their individual and overall impacts on the RFFI. In addition, other work focused on only one single transmitter impairment, for example, CFO [12]–[13][14][15], IQ imbalance [11], [12], [16], PA nonlinearity [17]–[18][19][20][21], antenna pattern [22], [23]. However, transmitter impairments are twisted with each other and coexist in practical systems. The overall effects of these impairments require further investigation. Finally, there is very limited work on receiver impairments [11], [24]. In practice, different receivers may be used for RFFI and their impairments will interfere with the extraction of transmitter impairments. This important aspect is not properly modelled and explored yet. However, if we are to achieve progress and create a system to efficiently exploit RFFI, we need an effective model that is backed up and based on solid research.

In summary, this paper starts to address the need for the design of a robust RFFI protocol by providing a comprehensive study of RF impairments modelling in the RFFI context. This paper carries out a systematic modelling of both transmitter and receiver impairments in narrowband systems as well as comprehensive experimental and simulation validation for their effects on RFFI. Specifically, we create a model that involves the major RF impairments that are exploited for RFFI in the literature, including oscillator imperfections [12]–[13][14][15], IQ gain and phase imbalances [11], [12], [16], and PA nonlinearity [17]–[18][19][20][21]. We study the impact of individual and overall impairments as well as other relevant configurations such as the transmission power (backoff level of PA), signal-to-noise ratio (SNR), payload pattern and length. We finally make design guidelines for a practical and robust RFFI system. Our detailed contributions are as follows.

We carry out six experiments over three months using five LoRa devices and demonstrate that CFO is time-varying and not suitable for classifying low-cost IoT devices. In addition, we show that CFO interferes with other RF impairments.

Extensive simulations are carried out to validate the effects of transmitter impairments including IQ imbalances and PA nonlinearities. We show that our RFFI protocol can classify 50 devices of uniformly distributed impairments with accuracies as high as 99% at SNR of 20 dB.

Extensive simulations are carried out to study the effects of receiver impaired by IQ imbalances. It demonstrates that, for the first time, when the receiver IQ imbalances are within a limited range, that is, the gain and phase imbalances were within the range of [−0.2 0.2] dB and [−1 1] degree, respectively, the classification accuracy is compromised by less than 20%.

As the RF impairments cannot be reconfigured or customized, the following recommendations have been identified for designing a robust RFFI protocol:
Estimate and compensate CFO before RFFI in order to avoid CFO interfering with other RF impairments.

Calibrate IQ imbalance of the receiver in advance for obtaining low residual IQ imbalances to minimize the impact of different receivers.

The rest of the paper is organized as follows. Section II introduces the related work. Section III presents the overview of RFFI systems, which consists of transmitter and receiver impairments and the RFFI protocol. Specifically, transmitter impairments are modelled in Section IV while Section V models the receiver impairments and introduces the RFFI protocol. Section VI explains the simulation setup. The experimental and simulation results are given in Section VII. Section VIII concludes the paper.

SECTION II.Related Work
RFFI research can be generally categorized into experimental-based studies and model-based work. The former constitutes the majority of the current literature, which uses IoT devices as devices under test (DUTs) and software defined radio (SDR) platforms, for example, universal software radio peripheral (USRP) or high specification equipment such as oscilloscope as receivers. RFFI has been applied to ZigBee [24]–[25][26], WiFi [12], [14], [15], [27]–[28][29], and LoRa [30]. These research efforts validate the practicability of RFFI.

RFFI is a multi-class classification problem and state-of-the-art machine learning and deep learning algorithms can be leveraged. Specifically, classic machine learning algorithms such as support vector machine (SVM) [12], [30], random forest and decision tree [27], [31], are used. However, the work usually relies on the handcrafted features, which will be twisted with each other and accurate estimation of individual feature will be challenging in some cases. It also requires a good understanding of the underlying communication protocols. On the other hand, deep learning algorithms can take the raw signals directly and extract the hidden features, which can significantly decrease the development overhead and difficulty. Deep learning is hence widely used for RFFI, including convolutional neural network (CNN) [26], [29], [30], [32], [33], long short-term memory (LSTM) [11], [34], and gated recurrent units (GRU) [34].

The transmitter impairments are the intrinsic and unique features of each device that RFFI aims to exploit as device identifiers. Specifically, CFO has been extracted to classify WiFi devices [15]. Wong et al. [16] designed an IQ imbalance-based RFFI. Hanna and Cabric [18] used the Saleh model to depict the PA nonlinearity in narrowband systems while Polak et al. [17] used Volterra series to represent the memory effects of a PA in a wideband system. The Taylor polynomial model has also been used to model the PA memory effects [19]–[20][21]. The radiation patterns of antennas have also been explored for RFFI [22], [23].

The receiver impairments also affect the RFFI performance. In practical applications, the manufacturers may carry out the RFFI training using a high specification receiver to capture wireless signals, and provide the training information to customers. The users are likely to use their own receivers for classification. Another example is that roaming IoT devices will access the network from different base stations/access points, hence the RFFI will be carried out via different receivers. However, because received signals will be impacted by receiver impairments, different receivers will probably interfere with the recognition of the transmitter impairments. There are very few efforts on this challenge. He and Wang [11] employed multiple distorted receivers and used information fusion to combine their results. However, the same receiver sets were used for training and classification. Peng et al. [24] used two different USRP SDR platforms for training and classification and demonstrated the performance is only slightly affected. Nevertheless, proper modelling of the receiver impairments is missing and the effect of different receivers for training and classification on the RFFI is not clear.

SECTION III.System Overview
The overview of an RFFI system is shown in Fig. 1. There are NDUT DUTs with different hardware impairments, such as IQ mismatch and PA nonlinearity. The ith DUT will emit modulated signals, si(t) , which will be captured by a receiver. Based on the received signal, r(t) , the receiver tries to identify the slight differences among the RF impairments and deduce the transmitter identity using the RFFI protocol.


Fig. 1.
System overview.

Show All

For each DUT, the transmitted signal is first modulated digitally, for example, using 16 quadrature amplitude modulation (16QAM) or quadrature phase shift keying (QPSK). It is then converted to the analog domain by a digital-to-analog converter (DAC). The analog signal, x(t) , further undergoes upconversion and power amplification, and is finally emitted by an antenna. The overall effects of these analog processes can be expressed as
si(t)=Fi(x(t)),(1)
View Sourcewhere Fi(⋅) denotes combined effects of the transmitter chain of ith DUT. Each DUT is subject to hardware impairments during the manufacturing process and this paper focuses on modelling and analyzing oscillator imperfections, IQ mismatch and PA nonlinearity as they are the most common impairments for RFFI, which will be done in Section IV.

The signal reaching the receiver will undergo channel effects. In a narrowband system, the received signal can be given as
r(t)=h(t)si(t)+n(t),(2)
View Sourcewhere h(t) is the channel effect and n(t) is the additive white Gaussian noise (AWGN), that is, n(t)∼CN(0,σ2n) .

Once the receiver captures the signal r(t) , it is processed by the receiver chain in the analog domain such as downconversion and demodulation, which yields
y(t)=G(r(t)),(3)
View Sourcewhere G(⋅) represents the overall receiver chain effect. The receiver impairments are modelled in Section V-A.

Based on the received signal y(t) , the receiver aims to infer the identity of the DUT using RFFI. As shown in Fig. 2, a deep learning-based RFFI protocol consists of two stages, namely training and classification. During the training stage, a receiver, acting as an authenticator, will collect sufficient packets from each DUT and use these packets to train a neural network (NN) model. The training only needs to be done offline and for one time. Signal preprocessing algorithms are adopted consisting of packet detection and synchronization, CFO estimation and compensation. At the classification stage, a DUT will emit a wireless signal and the receiver will classify the origin based on the received waveform and the pre-trained NN model. A CNN-based RFFI protocol will be designed in Section V-B. Compared with traditional schemes, CNN-based RFFI protocol does not need handcrafted features. In addition, CNN has been applied with great success in image classification, speech recognition, natural language processing, etc. Its excellent classification capability can also be leveraged for RFFI.


Fig. 2.
A deep learning-based RFFI protocol.

Show All

SECTION IV.Transmitter Impairments
The architecture of the direct (homodyne) conversion transmitter is portrayed in Fig. 3. The impairment modelling is based on the general RF impairments modelling for a direct conversion transmitter [6], [8], [35]–[36][37], with a special focus on the oscillator imperfection including CFO and phase noise, mismatch of I and Q branches, and PA nonlinearity, as they are the main features studied for RFFI.

Fig. 3. - Transmitter chain with hardware impairments.
Fig. 3.
Transmitter chain with hardware impairments.

Show All

A. Oscillator Imperfection
A crystal local oscillator (LO) generates sinusoidal waves with the required carrier frequency, which is used for upconversion at the transmitter. It usually employs a phase-locked loop (PLL) circuit to synthesize the carrier frequency.

The frequency stability, δf , represents the variation of the frequency output of a LO, which can be quantified in the parts per million (ppm). The frequency offset will satisfy [38]
−δf106×f0c≤Δf≤+δf106×f0c,(4)
View Sourcewhere f0c is the reference nominal frequency. The output frequency can then be given as
fc=f0c+Δf.(5)
View Source

Besides the frequency offset, the LO is also affected by the phase noise, ϕ(t) . The phase noise can be characterized by single sideband noise spectral density and has the unit of decibels below the carrier per Hertz (dBc/Hz). It can be modelled as a filtered Gaussian noise. Both CFO and phase noise will bring a phase shift to the constellation points. For example, the effect of phase noise is shown in Fig. 4.


Fig. 4.
Phase noise effect. Constellation change due to phase noise.

Show All

Based on the above analysis, the carrier at the transmitter side can be mathematically expressed as
Ωtx(t)=cos(ωtxt+ϕtx(t)),(6)
View Sourcewhere
ωtx=2π(f0c+Δftx),(7)
View Sourceand Δftx is the frequency offset of the transmitter.

B. IQ Imbalance at Mixer
The transmitter uses a quadrature mixer to upconvert the signals from the baseband to the RF band. There will often be mismatch/imbalance between the I and Q branches.

The transmitter will digitally modulate the payload using, for example, QAM, and convert the modulated signals by a DAC to
x(t)=xI(t)+jxQ(t),(8)
View Sourcewhere xI(t) and xQ(t) are the modulated signals at I and Q branches, respectively. The signal is upconverted from the baseband to the RF band. The RF band signal at the mixer in the presence of IQ imbalance and oscillator imperfections can be given as [39]
sRF(t)=gtxIxI(t)cos(ωtxt+ϕtx(t)+θtx)−gtxQxQ(t)sin(ωtxt+ϕtx(t)−θtx),(9)
View Sourcewhere gtxI and gtxQ are the I and Q gains, respectively, ψtx=2θtx is the IQ phase mismatch. The IQ gains in the linear scale at the transmitter can be given as [40]
gtxI=gtxQ=10(0.5Gtx20),10(−0.5Gtx20),(10)(11)
View Sourcewhere Gtx is the gain imbalance in dB at the transmitter.

The equivalent baseband signal of sBB(t) can be given as
sBB(t)=sI(t)+jsQ(t).(12)
View SourceThe signal in (9) can be rewritten as
sRF(t)==sI(t)cos(ωtxt+ϕtx(t))−sQ(t)sin(ωtxt+ϕtx(t))R{sBB(t)ej(ωtxt+ϕtx(t))},(13)
View Sourcewhere R{⋅} denotes the real part operation, and
sI(t)=sQ(t)=gtxIxI(t)cos(θtx)+gtxQxQ(t)sin(θtx),gtxIxI(t)sin(θtx)+gtxQxQ(t)cos(θtx).(14)(15)
View Source

The baseband signal can be rearranged as
sBB(t)=gtxIxI(t)ejθtx+jgtxQxQ(t)e−jθtx.(16)
View Source

In the simulation of wireless transmissions, complex forms of the signal and channel are more commonly used because of the elegant mathematical expression. Therefore, from now on, we denote the signal of the RF band as
sRF(t)=sBB(t)ej(ωtxt+ϕtx(t)).(17)
View Source

The effect of the IQ imbalance is illustrated in Fig. 5. As shown in Fig. 5(a), a positive/negative gain imbalance will bring a horizontal/vertical stretch. The phase imbalance will result in constellation rotation, which can be observed in Fig. 5(b).


Fig. 5.
IQ imbalance of mixers impairment. (a) Constellation change with gain imbalances. SNR γ=20 dB. (b) Constellation change with phase imbalances. SNR γ=20 dB. (c) BER versus gain imbalance. SNR γ=10 dB. (d) BER versus phase imbalance. SNR γ=10 dB. (e) BER versus gain and phase imbalance with IQ compensation. (f) BER versus gain and phase imbalance without IQ compensation.

Show All

As shown in Figs. 5(c) and 5(d), when the gain imbalance of a transmitter, Gtx , is within [−5 5] dB, or the phase imbalance, ψtx , is within [−30 30] degree, these imbalances do not cause a severe impact on the bit error rate (BER) for a 16QAM system at an SNR of 10 dB. In addition, the BER when there are both gain and phase imbalances is given in Figs. 5(e) and 5(f). The BER is only compromised by 1% when IQ compensation is adopted [41].

It should be noted that IQ compensation will always be adopted by a receiver in practical systems [41]. However, as the IQ imbalances are part of the intrinsic hardware impairments that we aim to exploit for RFFI, we employ raw signals without IQ compensation, which can be implemented independently from, and in parallel with, normal receiver operations.

C. Power Amplifier Nonlinearity
The PA is an indispensable part of the transmitter that amplifies a low-power signal to a higher power one. It is, however, usually nonlinear. The memoryless nonlinear effects of a PA in a narrowband system can be modelled as amplitude/amplitude (AM/AM) and amplitude/phase (AM/PM) characteristics [6]. As the relation |sRF(t)|=|sBB(t)| holds, where |⋅| calculates the amplitude, the combined effects of the PA can be written as
s(t)=A(|sBB(t)|)ej(φ+Φ(|sBB(t)|)),(18)
View Sourcewhere A(⋅) and Φ(⋅) denote the AM/AM and AM/PM effects, respectively, φ=∠sBB(t)+ωtxt+ϕtx(t) .

There have been several behavioural models proposed, such as the Saleh, Rapp and Ghorbani models, etc. [6]. For example, the AM/AM and AM/PM characteristics of the Saleh model can then be defined as
A(|sBB(t)|)=Φ(|sBB(t)|)=αA|sBB(t)|1+βA|sBB(t)|2,αΦ|sBB(t)|21+βΦ|sBB(t)|2,(19)(20)
View Sourcerespectively, where αA , βA , αΦ , and βΦ are the corresponding coefficients. The AM/AM and AM/PM characteristics are shown in Fig. 6. When the input power increases to a certain level, the PA enters the non-linear region, which should be avoided. The backoff is a level below the saturation point. The larger it is, the further the PA is from the saturation point.


Fig. 6.
AM/AM and AM/PM characteristics of the Saleh model. [αA=2.1587,βA=1.1517,αΦ=4.0033,βΦ=9.1040] .

Show All

The effect of the PA is given in Fig. 7. Regarding the same Saleh model used for Fig. 6, the constellation is rotated about 10 degrees due to the AM/PM effect, when the input power is 20 dBm, as shown in Fig. 7(a). This matches Fig. 6 as the AM/PM effect is 12.01 degrees for a 20 dBm input power. As can be observed in Fig. 7(b), BER for a 16QAM system at 10 dB SNR significantly decreases with the backoff level, especially when the PA leaves away from the nonlinear region. We further configured different PA models by setting their parameters with a change of ±10% to the default values, that is, [αA=2.1587,βA=1.1517,αΦ=4.0033,βΦ=9.1040] . Fig. 7(c) demonstrates that the BER remains stable for different PA parameters when the backoff level is fixed.


Fig. 7.
PA impairment. SNR γ=10 dB. (a) Constellation change with PA distortions. (b) BER versus back off level of a PA. (c) BER versus varied PA parameters.

Show All

D. Summary
After the above hardware modulation and processing, the transmitted signal is ready and will be emitted by an antenna. For the simplification of notation, we rewrite (18) as
s(t)=s′(t)ej(ωtxt+ϕtx(t)),(21)
View Sourcewhere
s′(t)=A(|sBB(t)|)ej(∠sBB(t)+Φ(|sBB(t)|)).(22)
View SourceThis completes the transmitter modulation and processing.

SECTION V.RFFI System
As shown in Fig. 8, the receiver will capture the signal via an antenna, downconvert it from the RF band to the baseband, and carry out IQ demodulation, which will be introduced in Section V-A. The processed analog signals are then converted to digital sequences and fed into the RFFI protocol, which will be explained in Section V-B.


Fig. 8.
Receiver chain with hardware impairments.

Show All

A. Receiver Chain With RF Impairments
Similar to the transmitter, the receiver will also have RF impairments. The receiver oscillator is subject to frequency offset, Δfrx , and phase noise, ϕrx(t) . The receiver uses a mixer to downconvert received signals from the RF band to the baseband, which will also have imbalanced I and Q branches. The gains of I and Q branches in the linear scale at the receiver can be defined as [40]
grxI=grxQ=10(0.5Grx20),10(−0.5Grx20),(23)(24)
View SourceRight-click on figure for MathML and additional features.respectively, where Grx is the gain imbalance in dB at the receiver.

Considering these effects, the receiver’s carrier can be given as
Ωrx(t)=Krx1e−j(ωrxt+ϕrx(t))+Krx2ej(ωrxt+ϕrx(t)),(25)
View SourceRight-click on figure for MathML and additional features.where
Krx1=Krx2=grxIe−jθrx+grxQejθrx2,grxIejθrx−grxQe−jθrx2,(26)(27)
View Sourceand
ωrx=2π(f0c+Δfrx),(28)
View Sourceand θrx=ψrx2 , ψrx is the IQ phase mismatch at the receiver.

The received signal at the antenna (RF band) can be written as
r(t)=h(t)s(t)=h(t)s′(t)ej(ωtxt+ϕtx(t)).(29)
View SourceAfter the downconversion and low pass filter, the received signal (baseband) becomes
y(t)==r(t)Ωrx(t)Krx1h(t)s′(t)ejΔC+Krx2(h(t)s′(t))∗e−jΔC,(30)
View Sourcewhere
ΔC=2π(Δftx−Δfrx)t+ϕtx(t)−ϕrx(t).(31)
View SourceIt can be observed that the signal y(t) possesses all the RF impairments of both the transmitter and receiver.

When a receiver without gain and phase imbalances is considered, (30) can be simplified as
y(t)=h(t)s′(t)ejΔC.(32)
View Source

Finally, y(t) is sampled by the analog-to-digital converter (ADC), which produces a complex sequence, y[n] , with Ns symbols. The sequence is fed into the RFFI protocol for training and classification.

B. A CNN-Based RFFI Protocol
As RFFI is a multi-class classification problem, we can leverage state-of-the-art deep learning algorithms to classify these devices. Specifically, CNN has been widely used in RFFI to learn the correlation within the IQ samples [26], [29], [30], [32], [33], which is also adopted in this paper.

The CNN architecture is shown in Fig. 9, which is designed based on the famous AlexNet CNN architecture [42]. AlexNet has five convolutional layers and achieves excellent performance on the ImageNet dataset. The complex IQ samples, y[n] , are stacked as a new matrix, (yI[n]yQ[n]) , with a size of 2×Ns . The sequences are then fed into the CNN model. Each convolutional layer contains batch normalization and uses ReLU as the activation function. The number of filters and size of the filter are marked in Fig. 9.


Fig. 9.
The architecture of the adopted CNN model.

Show All

Following the configurations of other similar deep learning-based RFFI work [29], [33], we used the Adam optimizer with an initial learning rate of 1×10−4 for training CNN. The maximum number of epochs is 100 but the training will stop when the condition for patience of validation stopping is met, which is set to 20 in this paper. MATLAB Deep Learning Toolbox3 was used to build the CNN model. The simulation was carried out on a node powered with two Nvidia Quadro P4000 GPUs, which is part of the high performance computing facilities at the University of Liverpool.

SECTION VI.Simulation Setup
This section will introduce the simulation setup in terms of the transmitter and receiver impairments as well as the channel model.

A. Transmitter
We configure NDUT DUTs with different IQ imbalance and PA nonlinearity. Oscillator imperfection was not included as a suitable impairment for RFFI, which will be explained in Section VII-A.

As shown in Table I, we considered five cases. Cases T1-T4 represented individual transmitter impairment, namely gain imbalance, phase imbalance, gain & phase imbalances, and PA nonlinearities, respectively, while case T5 included all the above impairments. The ranges of the impairments are selected as follows.

IQ Imbalance: From the literature, the absolute gain imbalance ranges from 0.02 to 0.82 and the phase imbalance varies from 2 degrees to 11.42 degrees [16], [34]. Therefore, we set the ranges of gain and phase imbalances as [−1 1] dB and [−5 5] degree, respectively. Based on the BER simulation results in Fig. 5, the IQ mismatches in the above ranges do not impact the BER.

PA nonlinearity: The Saleh model was used. Each parameter, namely [αA,βA,αΦ,βΦ] , was varied within ±5% of the default values, [αA=2.1587,βA=1.1517,αΦ=4.0033,βΦ=9.1040] .

For cases T1, T2 and T3, the same Saleh PA model with the default values were used.
TABLE I Transmitter and Receiver Impairments

We also studied the effect of the payload pattern on classification performance. The payload, x(t) , is not part of RF impairments, but will lead to different modulated signals, hence affect the extraction of RF impairments. We simulated both the same data payload and random data payload to study the effect of the data pattern. All the data was modulated by QPSK.

B. Channel
As shown in (30), the channel effect will interfere with RF impairments, which has been experimentally validated by [43]. As this paper focuses on the device-specific hardware features, we adopted an AWGN channel. The channel impairments can be potentially solved by data augmentation [44], [45] or using channel-independent features [29].

Different SNR levels were simulated to evaluate the noise effects.

C. Receiver
The training and classification stages of RFFI require a receiver to capture wireless transmissions. RFFI with the same receiver at these stages allows us to investigate the effects of the hardware impairments at DUTs.

However, RFFI may not use the same receiver for these stages in practice, as we discussed in Section II. Hence, RFFI with different receivers is a more practical setup, which has not been comprehensively investigated. In this paper, we simulated both scenarios, that is, RFFI with the same receiver and RFFI with different receivers of varied IQ imbalances. Specifically, we considered the receiver at the training stage has no RF impairment. Regarding the receiver at the classification stage, the cases in Table I were considered.

We built our RF impairments model using the MATLAB Communications Toolbox and based on a MATLAB example simulating a QAM system with RF impairments.4

D. Metric
We used the overall classification accuracy and confusion matrix to evaluate the RFFI performance during the classification stage. In particular, classification accuracy is defined as the percentage of correctly identified packets over the total packets. Confusion matrix is an effective method to visualize the machine learning classification results. The row and column of the matrix represent the instances in a predicted class and the ones in an actual class, respectively.

SECTION VII.Experimental and Simulation Results
This section will present the experimental and simulation results of RFFI with different transmitter and receiver impairments. The system configurations differ in the number of DUT, NDUT , transmitter impairments (case T1 to T5), SNR, data pattern and length, as well as the receiver impairments (case R0 to R3). For each configuration, we train a CNN model whose architecture is shown in Fig. 9. We generate 1,000 packets for each DUT, among which 90% are used for CNN training and the rest 10% are for validation; we further generate another 1,000 packets for CNN testing (classification).

In order to exclusively study the transmitter impairments, Section VII-A and Section VII-B considers the same receiver for both training and classification stages, that is, Grx=0 and ψrx=0 . Frequency offset is affected by working environmental conditions such as temperature. There is no suitable mathematical expression to describe the variation of frequency offset against temperature. Hence we designed experiments to estimate the frequency offset, and demonstrated oscillator imperfections are not suitable for RFFI due to their time-varying nature in Section VII-A. On the other hand, IQ imbalance and PA nonlinearity are time-invariant and can be described mathematically. In order to carry out comprehensive studies on their individual and overall effects, simulation allows us to tune the parameters. Hence, Section VII-B presents the effects of IQ imbalance and PA nonlinearity using simulation. Finally, Section VII-C evaluates the impact of different receivers for training and classification stages by simulation.

A. RFFI Experiments With Oscillator Imperfections
The oscillator imperfections are not ideal for RFFI as they are not stable and may interfere with other transmitter impairments. We use NDUT=5 DUTs as a case study to investigate the CFO effect in this section.

1) CFO Variation:
Oscillators are subject to temperature change and aging. For example, FTR5123-B is a crystal oscillator used in LoRa devices5; its frequency variation over −20 to + 70 °C is ±10 ppm and its aging effect is ±10 ppm over 10 years.

As it is difficult to get mathematical expressions of the oscillator drift, we carried out measurements to obtain CFO variations using five SX1272MB2xAS LoRa shields,6 which are equipped with FTR5123-B oscillators. As shown in Fig. 10, we connected each LoRa end device with a USRP N210 SDR platform using an attenuator, which brought a 40 dB power attenuation but had no effect on the frequency offset, hence the channel effect was avoided. USRP SDR platforms are commonly used for RFFI as a receiver to collect raw IQ samples [10], [14], [26], [29]. The frequency accuracy of the USRP N210 platform is 2.5 ppm,7 which is smaller than that of the LoRa devices. In addition, the same USRP board was always used to minimize its effect on the estimation of the transmitter frequency offset. Compared to sophisticated equipment such as spectrum analyzers, USRP N210 is a low-end receiver. Using USRP as the testbed will provide insights into whether low-end receivers will be eligible for RFFI. High-end receivers will be too expensive to be widely used in practical applications.


Fig. 10.
Experimental setup for measuring CFO. The LoRa device and USRP SDR were connected using an attenuator.

Show All

We carried out six measurements over three months, with two tests each in August, September and October 2020. Each measurement lasted about one hour and 1,000 packets were collected. The CFOs estimated from these packets are shown in Fig. 11, which shows that CFO is not stable in neither short nor long term. Within the one hour collection on each day, CFOs of each DUT were varying, perhaps due to the self-heating. They also varied over three months, especially DUT4 and DUT5, which is probably due to the environmental temperature changes.


Fig. 11.
Frequency drift variations in six days: Day 1 and Day 2 in August, Day 3 and Day 4 in September and Day 5 and Day 6 in October 2020.

Show All

2) CFO-Based RFFI:
As shown in (32), the varying CFO and phase noise will cause phase rotation to the signal. In order to evaluate the CFO effect on the RFFI, we adopted a hybrid method of integrating experimentally estimated CFO with the simulation model. We first generated 1,000 packets without any RF impairments, by configuring Gtx=0 , ψtx=0 , and PA with the default parameter in the simulation. We converted the estimated CFOs from day 1 in August to ΔC and applied them to packets one by one using (32). These CFO impaired packets were used as the training data. The test data was generated similarly but the estimated CFOs were from a different day. Fig. 12 shows the confusion matrices when the test data was generated using CFOs from day 2 in August, day 3 and 4 in September 2020.

Fig. 12. - Confusion matrix of CFO-based RFFI. CFOs from Day 1 were used for training. (a) Overall accuracy, 89.76%. CFOs from Day 2 as test data. (b) Overall accuracy, 59.86%. CFOs from Day 3 as test data. (c) Overall accuracy, 54.66%. CFOs from Day 4 as test data.
Fig. 12.
Confusion matrix of CFO-based RFFI. CFOs from Day 1 were used for training. (a) Overall accuracy, 89.76%. CFOs from Day 2 as test data. (b) Overall accuracy, 59.86%. CFOs from Day 3 as test data. (c) Overall accuracy, 54.66%. CFOs from Day 4 as test data.

Show All

As can be observed from Figs. 12(b) and 12(c), the results are not promising as some DUTs are completely misclassified. Take DUT3 as an example. As the CFOs of DUT3 on day 3, August are very similar to the CFO of DUT2 on day 1, August, they cannot represent reliable device identifier anymore. The CNN thus made a wrong classification, as shown in Fig. 12(b).

3) CFO Interference to Other RF Impairments:
While Section VII-A2 only involved CFO impairment, this section will investigate CFO co-existence with other transmitter impairments to explore whether CFO will interfere with them.

Similar to Section VII-A2, we combined the simulation data with different RF impairments and CFO estimated from experiments. Regarding training data, we generated 1,000 packets with RF impairments and applied the CFO from day 1, August. Another 1,000 packets were generated and applied with the CFOs from day 2 to day 6 as the test data. We carried out the above process for the cases T1 to T5 involving different transmitter impairments. We also did the simulation when there was no CFO impairment which can be regarded as references. The results are given in Fig. 13.

Fig. 13. - CFO Interference. “No CFO Impairment” means no CFO applied to training and test data. “Day n” indicates that the Day 1 CFO was applied to the training data and the CFO from the Day 
$n$
 was applied to the test data. 
$N_{\text {DUT}} = 5$
, SNR, 
$\gamma = 10$
 dB. 
$N_{s} =600$
. (a) Same data payload. (b) Random data payload.
Fig. 13.
CFO Interference. “No CFO Impairment” means no CFO applied to training and test data. “Day n” indicates that the Day 1 CFO was applied to the training data and the CFO from the Day n was applied to the test data. NDUT=5 , SNR, γ=10 dB. Ns=600 . (a) Same data payload. (b) Random data payload.

Show All

As can be observed, the CFO effect on RFFI is not stable. For some cases and test data, for example, cases T1, T2 and T4 of day 2 in Fig 13(a), the classification accuracies were improved. This is probably because these RF impairments are distinguishable and CFO adds another dimension of feature variations, even though CFOs of several devices are quite similar. On the other hand, CFO may compromise RFFI, for example, cases T1 to T5 with day 3 - day 6 test data as shown in Fig. 13(a) and all the results in Fig. 13(b). As we are not able to predict the CFO effect in advance, it is suggested to compensate the CFO impairment to avoid potential performance reduction.

4) Discussion:
More CFO measurement results and its effect on RFFI have been experimentally shown in [46]. This paper advances the work in [46] by taking a hybrid method to combine experimentally measured CFO with the simulated RF impairments, which allows the investigation of CFO interfering with other RF impairments.

As many IoT devices use cheaply made components in order to reduce the cost and we are not able to control environmental temperature, frequency drift of an oscillator may not be a stable parameter for RFFI. In addition, apart from the oscillator drift, the estimated CFO may also include Doppler shift in a mobile channel, although its value may be small in slow fading channels. For example, it has been analyzed in [13] that the Doppler shift is only about 1% of oscillator frequency drift. Phase noise changes quickly from packet to packet. While it is possible to calculate the statistical features of the phase noise as the device characteristics [47], this method requires collecting numerous signals, which cannot be done on a per-packet basis. Finally, it should be noted both CFO and phase noise can be estimated and compensated for reliable communications. However, their time-varying nature makes them not suitable for RFFI.

While there is existing work exploiting CFO and phase noise for RFFI [15], [48], we reckon their oscillators may be more sophisticated, which is not the case for low-cost IoT. In addition, long-term experiments involving temperature and aging are not available. Hence, their stability over time and environment changes are unknown, which is one of the most essential metrics for a device authentication scheme.

Recommendation One: Always estimate and compensate CFO before RFFI. In any practical wireless communication systems, we will often employ repeated preambles for CFO estimation and compensation, for example, the popular Schmidl-Cox algorithm [49]. Hence, we do not consider the oscillator imperfections in the following of this paper.

B. RFFI Simulation With IQ Imbalance and PA Nonlinearity
In the simulation of this subsection, we simulated NDUT=50 DUTs with RF impairments, except in Section VII-B5. The same receiver without RF impairments is used for training and classification, that is, case R0.

1) IQ Imbalance (T1 - T3 & R0):
As shown in Fig. 14, the classification accuracies of case T3 (with both gain and phase imbalances) with the same data are about three times of the accuracies of case T1 (with gain imbalance only) and case T2 (with phase imbalance only). The effects of gain and phase imbalances are complementary, and their co-existence can significantly increase the feature space.


Fig. 14.
Effects of different transmitter impairments on classification accuracy. Number of devices NDUT=50 . (a) Classification accuracy versus the number of symbols per packet. SNR, γ=10 dB. (b) Classification accuracy versus SNR. Number of symbols per packet, Ns=600 .

Show All

The effect of the number of symbols of each packet is shown in Fig. 14(a). Intuitively, more symbols will lead to higher classification accuracy, as the packet contains more information, which is validated by the simulation results. A physical layer waveform usually has much more than 800 symbols. For example, a ZigBee physical layer packet with 120 bytes will be modulated into about 16,000 symbols.

The effect of SNR on RFFI accuracy is given in Fig. 14(b). When the SNR increases, the signal has a better quality. Hence, the small variations among devices are more visible and can be learned easier by CNN. The accuracy is not promising in low SNR scenarios as the signal is swamped by noise. Signal pre-processing algorithms can be adopted to improve the SNR, for example, the denoising algorithm in [50].

2) Power Amplifier Nonlinearity (T4 & R0):
Figs. 14(a) and 14(b) show the classification accuracies of PA nonlinearities regarding number of symbols and SNR, respectively.

Fig. 15 demonstrates that a smaller backoff level will have a better classification accuracy, because the nonlinear effect is more severe. However, as shown in Fig. 7(b), backoff level that is too small will result in a higher BER, which should be avoided. We used a 30 dB backoff level in this paper, which is the worst case for RFFI as the PA nonlinearity is the least.

Fig. 15. - Effects of PA nonlinearity, classification accuracy versus backoff levels. Number of devices 
$N_{\text {DUT}} = 50$
. Number of symbols per packet, 
$N_{s} = 600$
. SNR, 
$\gamma = 20$
 dB.
Fig. 15.
Effects of PA nonlinearity, classification accuracy versus backoff levels. Number of devices NDUT=50 . Number of symbols per packet, Ns=600 . SNR, γ=20 dB.

Show All

3) Overall Effect (T5 & R0):
We consider the case T5 that NDUT=50 DUTs have both gain & phase imbalances and PA nonlinearities. As shown in Fig. 14(a), the accuracy with the same data payload becomes relatively stable when there are 800 symbols.

As can be observed from Fig. 14(b), with a packet length of 600 symbols, the classification accuracy is 87.1% when SNR is 10 dB, which is a reasonable level for a practical system. It can be boosted to 99% for a 20 dB SNR. These accuracies are quite high and very promising for developing RFFI as a matured solution.

4) Data Pattern:
From Figs. 14(a) and 14(b), it can be observed that the same data payload always achieves better accuracy than random data payload, which is not surprising. Random payload brings another dimension of the variation, hence it is more difficult for CNN to find patterns incurred by the RF impairments. The simulation results in Fig. 14 matches those in [18], regarding the observation that the same data payload achieves better classification accuracy than random payload for classifying PA nonlinearities.

5) Number of DUT (T5 & R0):
Intuitively, it is more difficult to classify more DUTs when their RF impairments are within the same range, because their features will be closer to each other. We carried out more simulation with NDUT=100 and NDUT=200 with all the transmitter impairments and the results are shown in Table II. When there are more DUTs, smaller initial learning rates are used.

TABLE II Classification Accuracy and Initial Learning Rate Versus Number of DUT. Number of Symbols Per Packet, Ns=600 . SNR, γ=20 dB
Table II- 
Classification Accuracy and Initial Learning Rate Versus Number of DUT. Number of Symbols Per Packet, 
$N_{s} = 600$
. SNR, 
$\gamma= 20$
 dB
As can be observed, when there are 200 DUT with the same data payload and 20 dB SNR, the classification accuracy is only slightly decreased to 89.3%.

C. RFFI Simulation With Different Receivers
This section will demonstrate the effects of different receivers used for training and classification stages, that is, cases R1, R2 and R3. Specifically, in the simulation setup, we configure the receiver at the training stage as Grxtrain=0 and ψrxtrain=0 . We consider the receiver at the classification stage with IQ imbalances, Grxtest and ψrxtest .

1) Receiver Gain and Phase Imbalance (T1 - T5 & R1 and R2):
We first investigated the individual effects of gain and phase imbalances of receivers. Specifically, we considered NDUT=50 DUTs with impairments configured as cases T1 to T5 and the receiver cases R1 and R2 in order to independently study receiver’s gain and phase imbalances.

As shown in Fig. 16, the effects of the gain and phase imbalances are complementary. For example, when there are only gain imbalances at DUTs (case T1), that is, ψtx=0 :

the gain imbalances at the receiver (R1) will affect the classification accuracy, as shown in Fig 16(a);

the phase imbalances at the receiver (R2) will affect the classification accuracy in a slighter manner, as shown in Fig 16(b). There is no effect when random data is used.

This is because the gain and phase imbalances affect the signal modulation and constellation differently, as shown in (16) and Figs. 5(c) and 5(d).

Fig. 16.
Effects of a different classification receiver on classification accuracy. Number of devices NDUT=50 . Number of symbols per packet, Ns=600 . SNR, γ=20 dB. (a) R1, classification accuracy versus gain imbalances of receivers. ψrxtest=0 . (b) R2, classification accuracy versus phase imbalances of receivers. Grxtest=0 .

Show All

2) Overall Effect (T5 & R3):
In practice, DUTs will include all the impairments and the receiver will also have both gain and phase imbalances. Hence, we carried out further simulations with DUTs configured with IQ imbalances and PA nonlinearities, that is, case T5, and the classification receiver with both gain and phase imbalances, that is, case R3.

As shown in Fig. 17, the accuracy gradually drops when the classification receiver deviates from the training receiver in terms of the gain and phase imbalances. The accuracies dropped less than 20%, when the gain and imbalances were in a small range, for example, Grxtest and ψrxtest within the range of [−0.2 0.2] dB and [−1 1] degree, respectively.


Fig. 17.
R3, effects of a different classification receiver on classification accuracy. Number of devices NDUT=50 . Number of symbols per packet, Ns=600 . SNR, γ=20 dB (a) Same data payload. (b) Random data payload.

Show All

Recommendation Two: The receiver should carry out IQ estimation and calibration in advance before RFFI [51]–[52][53]. Hence, when the residual imbalances after calibration are limited to a small range, the classification performance will not be significantly compromised.

SECTION VIII.Conclusion
This paper carried out systematic modelling on the hardware impairments of a narrowband transmitter and receiver as well as extensive experimental and simulation validation of their effects on the RFFI. Specifically, hardware impairments involve oscillator imperfections, phase and gain imbalances at mixer and PA nonlinearity. Through our experimental campaign over three months, we found that oscillator imperfections are not stable and interfere with other impairments. Our extensive simulations demonstrated phase and gain imbalances, as well as PA nonlinearities, are suitable for RFFI and we should exploit all of them to achieve the optimal classification accuracy. Our proposed protocol can classify 50 and 200 DUTs that have uniformly and randomly distributed transmitter impairments with high accuracy, namely 99.0% and 89.3%, respectively, at SNR of 20 dB when the same data payload was used. We also modelled the receiver impairments and analyzed their effect on the RFFI when different receivers were used for training and classification stages. The accuracy dropped less than 20% when the residual gain and phase imbalances of the classification receiver were within the range of [−0.2 0.2] dB and [−1 1] degree, respectively. Based on the experimental and simulation results, we recommend that we should compensate CFO and calibrate IQ imbalances at receivers in order to design a robust RFFI protocol. Our future work will study the effect of different modulation schemes on the RFFI.